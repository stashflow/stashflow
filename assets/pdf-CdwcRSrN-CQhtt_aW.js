var Gf=Object.defineProperty,Du=r=>{throw TypeError(r)},zf=(r,t,e)=>t in r?Gf(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,I=(r,t,e)=>zf(r,typeof t!="symbol"?t+"":t,e),Md=(r,t,e)=>t.has(r)||Du("Cannot "+e),n=(r,t,e)=>(Md(r,t,"read from private field"),e?e.call(r):t.get(r)),m=(r,t,e)=>t.has(r)?Du("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(r):t.set(r,e),p=(r,t,e,s)=>(Md(r,t,"write to private field"),t.set(r,e),e),v=(r,t,e)=>(Md(r,t,"access private method"),e),oe=(r,t,e,s)=>({set _(i){p(r,t,i)},get _(){return n(r,t,s)}}),Br={};Br.d=(r,t)=>{for(var e in t)Br.o(t,e)&&!Br.o(r,e)&&Object.defineProperty(r,e,{enumerable:!0,get:t[e]})};Br.o=(r,t)=>Object.prototype.hasOwnProperty.call(r,t);var $=globalThis.pdfjsLib={};Br.d($,{AbortException:()=>bi,AnnotationEditorLayer:()=>Ym,AnnotationEditorParamsType:()=>V,AnnotationEditorType:()=>G,AnnotationEditorUIManager:()=>wo,AnnotationLayer:()=>Gm,AnnotationMode:()=>ni,AnnotationType:()=>ft,ColorPicker:()=>gf,DOMSVGFactory:()=>bh,DrawLayer:()=>Km,FeatureTest:()=>Bt,GlobalWorkerOptions:()=>Ai,ImageKind:()=>$o,InvalidPDFException:()=>hc,MathClamp:()=>Jt,OPS:()=>Zl,OutputScale:()=>Ls,PDFDataRangeTransport:()=>Np,PDFDateString:()=>Id,PDFWorker:()=>wl,PasswordResponses:()=>Vf,PermissionFlag:()=>jf,PixelsPerInch:()=>Da,RenderingCancelledException:()=>Rd,ResponseException:()=>th,SignatureExtractor:()=>Is,SupportedImageMimeTypes:()=>Dd,TextLayer:()=>$c,TouchManager:()=>ip,Util:()=>L,VerbosityLevel:()=>Hh,XfaLayer:()=>Wp,build:()=>ym,createValidAbsoluteUrl:()=>Kf,fetchData:()=>yo,getDocument:()=>lm,getFilenameFromUrl:()=>ag,getPdfFilenameFromUrl:()=>rg,getUuid:()=>Ou,getXfaPageViewport:()=>og,isDataScheme:()=>Uh,isPdfFile:()=>Pd,isValidExplicitDest:()=>um,noContextMenu:()=>$e,normalizeUnicode:()=>sg,setLayerDimensions:()=>fn,shadow:()=>j,stopEvent:()=>vt,version:()=>Am});const Nt=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),Nu=[1,0,0,1,0,0],lc=[.001,0,0,.001,0,0],Xh=1.35,pe={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},ni={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},Uf="pdfjs_internal_editor_",G={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15,SIGNATURE:101},V={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_DEFAULT_COLOR:32,HIGHLIGHT_THICKNESS:33,HIGHLIGHT_FREE:34,HIGHLIGHT_SHOW_ALL:35,DRAW_STEP:41},jf={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},Ht={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},$o={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},ft={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},An={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},Hh={ERRORS:0,WARNINGS:1,INFOS:5},Zl={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93},Mo={moveTo:0,lineTo:1,curveTo:2,closePath:3},Vf={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let Gh=Hh.WARNINGS;function qf(r){Number.isInteger(r)&&(Gh=r)}function Xf(){return Gh}function zh(r){Gh>=Hh.INFOS&&console.log(`Info: ${r}`)}function z(r){Gh>=Hh.WARNINGS&&console.log(`Warning: ${r}`)}function Z(r){throw new Error(r)}function wt(r,t){r||Z(t)}function Yf(r){switch(r==null?void 0:r.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function Kf(r,t=null,e=null){if(!r)return null;if(e&&typeof r=="string"){if(e.addDefaultProtocol&&r.startsWith("www.")){const i=r.match(/\./g);(i==null?void 0:i.length)>=2&&(r=`http://${r}`)}if(e.tryConvertEncoding)try{r=eg(r)}catch{}}const s=t?URL.parse(r,t):URL.parse(r);return Yf(s)?s:null}function j(r,t,e,s=!1){return Object.defineProperty(r,t,{value:e,enumerable:!s,configurable:!0,writable:!1}),e}const mn=function(){function r(t,e){this.message=t,this.name=e}return r.prototype=new Error,r.constructor=r,r}();class zd extends mn{constructor(t,e){super(t,"PasswordException"),this.code=e}}class Yh extends mn{constructor(t,e){super(t,"UnknownErrorException"),this.details=e}}class hc extends mn{constructor(t){super(t,"InvalidPDFException")}}class th extends mn{constructor(t,e,s){super(t,"ResponseException"),this.status=e,this.missing=s}}class Qf extends mn{constructor(t){super(t,"FormatError")}}class bi extends mn{constructor(t){super(t,"AbortException")}}function Fu(r){(typeof r!="object"||(r==null?void 0:r.length)===void 0)&&Z("Invalid argument for bytesToString");const t=r.length,e=8192;if(t<e)return String.fromCharCode.apply(null,r);const s=[];for(let i=0;i<t;i+=e){const a=Math.min(i+e,t),o=r.subarray(i,a);s.push(String.fromCharCode.apply(null,o))}return s.join("")}function Ao(r){typeof r!="string"&&Z("Invalid argument for stringToBytes");const t=r.length,e=new Uint8Array(t);for(let s=0;s<t;++s)e[s]=r.charCodeAt(s)&255;return e}function Jf(r){return String.fromCharCode(r>>24&255,r>>16&255,r>>8&255,r&255)}function Cd(r){const t=Object.create(null);for(const[e,s]of r)t[e]=s;return t}function Zf(){const r=new Uint8Array(4);return r[0]=1,new Uint32Array(r.buffer,0,1)[0]===1}function tg(){try{return new Function(""),!0}catch{return!1}}class Bt{static get isLittleEndian(){return j(this,"isLittleEndian",Zf())}static get isEvalSupported(){return j(this,"isEvalSupported",tg())}static get isOffscreenCanvasSupported(){return j(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return j(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get platform(){if(typeof navigator<"u"&&typeof(navigator==null?void 0:navigator.platform)=="string"&&typeof(navigator==null?void 0:navigator.userAgent)=="string"){const{platform:t,userAgent:e}=navigator;return j(this,"platform",{isAndroid:e.includes("Android"),isLinux:t.includes("Linux"),isMac:t.includes("Mac"),isWindows:t.includes("Win"),isFirefox:e.includes("Firefox")})}return j(this,"platform",{isAndroid:!1,isLinux:!1,isMac:!1,isWindows:!1,isFirefox:!1})}static get isCSSRoundSupported(){var t,e;return j(this,"isCSSRoundSupported",(e=(t=globalThis.CSS)==null?void 0:t.supports)==null?void 0:e.call(t,"width: round(1.5px, 1px)"))}}const Kh=Array.from(Array(256).keys(),r=>r.toString(16).padStart(2,"0"));var Yi,Co,cc;class L{static makeHexColor(t,e,s){return`#${Kh[t]}${Kh[e]}${Kh[s]}`}static transform(t,e){return[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],t[0]*e[4]+t[2]*e[5]+t[4],t[1]*e[4]+t[3]*e[5]+t[5]]}static applyTransform(t,e){const s=t[0]*e[0]+t[1]*e[2]+e[4],i=t[0]*e[1]+t[1]*e[3]+e[5];return[s,i]}static applyInverseTransform(t,e){const s=e[0]*e[3]-e[1]*e[2],i=(t[0]*e[3]-t[1]*e[2]+e[2]*e[5]-e[4]*e[3])/s,a=(-t[0]*e[1]+t[1]*e[0]+e[4]*e[1]-e[5]*e[0])/s;return[i,a]}static getAxialAlignedBoundingBox(t,e){const s=this.applyTransform(t,e),i=this.applyTransform(t.slice(2,4),e),a=this.applyTransform([t[0],t[3]],e),o=this.applyTransform([t[2],t[1]],e);return[Math.min(s[0],i[0],a[0],o[0]),Math.min(s[1],i[1],a[1],o[1]),Math.max(s[0],i[0],a[0],o[0]),Math.max(s[1],i[1],a[1],o[1])]}static inverseTransform(t){const e=t[0]*t[3]-t[1]*t[2];return[t[3]/e,-t[1]/e,-t[2]/e,t[0]/e,(t[2]*t[5]-t[4]*t[3])/e,(t[4]*t[1]-t[5]*t[0])/e]}static singularValueDecompose2dScale(t){const e=[t[0],t[2],t[1],t[3]],s=t[0]*e[0]+t[1]*e[2],i=t[0]*e[1]+t[1]*e[3],a=t[2]*e[0]+t[3]*e[2],o=t[2]*e[1]+t[3]*e[3],l=(s+o)/2,h=Math.sqrt((s+o)**2-4*(s*o-a*i))/2,c=l+h||1,d=l-h||1;return[Math.sqrt(c),Math.sqrt(d)]}static normalizeRect(t){const e=t.slice(0);return t[0]>t[2]&&(e[0]=t[2],e[2]=t[0]),t[1]>t[3]&&(e[1]=t[3],e[3]=t[1]),e}static intersect(t,e){const s=Math.max(Math.min(t[0],t[2]),Math.min(e[0],e[2])),i=Math.min(Math.max(t[0],t[2]),Math.max(e[0],e[2]));if(s>i)return null;const a=Math.max(Math.min(t[1],t[3]),Math.min(e[1],e[3])),o=Math.min(Math.max(t[1],t[3]),Math.max(e[1],e[3]));return a>o?null:[s,a,i,o]}static pointBoundingBox(t,e,s){s[0]=Math.min(s[0],t),s[1]=Math.min(s[1],e),s[2]=Math.max(s[2],t),s[3]=Math.max(s[3],e)}static rectBoundingBox(t,e,s,i,a){a[0]=Math.min(a[0],t,s),a[1]=Math.min(a[1],e,i),a[2]=Math.max(a[2],t,s),a[3]=Math.max(a[3],e,i)}static bezierBoundingBox(t,e,s,i,a,o,l,h,c){c[0]=Math.min(c[0],t,l),c[1]=Math.min(c[1],e,h),c[2]=Math.max(c[2],t,l),c[3]=Math.max(c[3],e,h),v(this,Yi,cc).call(this,t,s,a,l,e,i,o,h,3*(-t+3*(s-a)+l),6*(t-2*s+a),3*(s-t),c),v(this,Yi,cc).call(this,t,s,a,l,e,i,o,h,3*(-e+3*(i-o)+h),6*(e-2*i+o),3*(i-e),c)}}Yi=new WeakSet,Co=function(r,t,e,s,i,a,o,l,h,c){if(h<=0||h>=1)return;const d=1-h,u=h*h,f=u*h,g=d*(d*(d*r+3*h*t)+3*u*e)+f*s,b=d*(d*(d*i+3*h*a)+3*u*o)+f*l;c[0]=Math.min(c[0],g),c[1]=Math.min(c[1],b),c[2]=Math.max(c[2],g),c[3]=Math.max(c[3],b)},cc=function(r,t,e,s,i,a,o,l,h,c,d,u){if(Math.abs(h)<1e-12){Math.abs(c)>=1e-12&&v(this,Yi,Co).call(this,r,t,e,s,i,a,o,l,-d/c,u);return}const f=c**2-4*d*h;if(f<0)return;const g=Math.sqrt(f),b=2*h;v(this,Yi,Co).call(this,r,t,e,s,i,a,o,l,(-c+g)/b,u),v(this,Yi,Co).call(this,r,t,e,s,i,a,o,l,(-c-g)/b,u)},m(L,Yi);function eg(r){return decodeURIComponent(escape(r))}let Qh=null,Ud=null;function sg(r){return Qh||(Qh=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,Ud=new Map([["ﬅ","ſt"]])),r.replaceAll(Qh,(t,e,s)=>e?e.normalize("NFKC"):Ud.get(s))}function Ou(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();const r=new Uint8Array(32);return crypto.getRandomValues(r),Fu(r)}const Td="pdfjs_internal_id_";function ig(r,t,e){if(!Array.isArray(e)||e.length<2)return!1;const[s,i,...a]=e;if(!r(s)&&!Number.isInteger(s)||!t(i))return!1;const o=a.length;let l=!0;switch(i.name){case"XYZ":if(o<2||o>3)return!1;break;case"Fit":case"FitB":return o===0;case"FitH":case"FitBH":case"FitV":case"FitBV":if(o>1)return!1;break;case"FitR":if(o!==4)return!1;l=!1;break;default:return!1}for(const h of a)if(!(typeof h=="number"||l&&h===null))return!1;return!0}function Jt(r,t,e){return Math.min(Math.max(r,t),e)}function Wu(r){return Uint8Array.prototype.toBase64?r.toBase64():btoa(Fu(r))}function ng(r){return Uint8Array.fromBase64?Uint8Array.fromBase64(r):Ao(atob(r))}typeof Promise.try!="function"&&(Promise.try=function(r,...t){return new Promise(e=>{e(r(...t))})});typeof Math.sumPrecise!="function"&&(Math.sumPrecise=function(r){return r.reduce((t,e)=>t+e,0)});const ls="http://www.w3.org/2000/svg",yn=class{};I(yn,"CSS",96),I(yn,"PDF",72),I(yn,"PDF_TO_CSS_UNITS",yn.CSS/yn.PDF);let Da=yn;async function yo(r,t="text"){if(_n(r,document.baseURI)){const e=await fetch(r);if(!e.ok)throw new Error(e.statusText);switch(t){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"json":return e.json()}return e.text()}return new Promise((e,s)=>{const i=new XMLHttpRequest;i.open("GET",r,!0),i.responseType=t,i.onreadystatechange=()=>{if(i.readyState===XMLHttpRequest.DONE){if(i.status===200||i.status===0){switch(t){case"arraybuffer":case"blob":case"json":e(i.response);return}e(i.responseText);return}s(new Error(i.statusText))}},i.send(null)})}class _o{constructor({viewBox:t,userUnit:e,scale:s,rotation:i,offsetX:a=0,offsetY:o=0,dontFlip:l=!1}){this.viewBox=t,this.userUnit=e,this.scale=s,this.rotation=i,this.offsetX=a,this.offsetY=o,s*=e;const h=(t[2]+t[0])/2,c=(t[3]+t[1])/2;let d,u,f,g;switch(i%=360,i<0&&(i+=360),i){case 180:d=-1,u=0,f=0,g=1;break;case 90:d=0,u=1,f=1,g=0;break;case 270:d=0,u=-1,f=-1,g=0;break;case 0:d=1,u=0,f=0,g=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}l&&(f=-f,g=-g);let b,w,A,y;d===0?(b=Math.abs(c-t[1])*s+a,w=Math.abs(h-t[0])*s+o,A=(t[3]-t[1])*s,y=(t[2]-t[0])*s):(b=Math.abs(h-t[0])*s+a,w=Math.abs(c-t[1])*s+o,A=(t[2]-t[0])*s,y=(t[3]-t[1])*s),this.transform=[d*s,u*s,f*s,g*s,b-d*s*h-f*s*c,w-u*s*h-g*s*c],this.width=A,this.height=y}get rawDims(){const t=this.viewBox;return j(this,"rawDims",{pageWidth:t[2]-t[0],pageHeight:t[3]-t[1],pageX:t[0],pageY:t[1]})}clone({scale:t=this.scale,rotation:e=this.rotation,offsetX:s=this.offsetX,offsetY:i=this.offsetY,dontFlip:a=!1}={}){return new _o({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:t,rotation:e,offsetX:s,offsetY:i,dontFlip:a})}convertToViewportPoint(t,e){return L.applyTransform([t,e],this.transform)}convertToViewportRectangle(t){const e=L.applyTransform([t[0],t[1]],this.transform),s=L.applyTransform([t[2],t[3]],this.transform);return[e[0],e[1],s[0],s[1]]}convertToPdfPoint(t,e){return L.applyInverseTransform([t,e],this.transform)}}class Rd extends mn{constructor(t,e=0){super(t,"RenderingCancelledException"),this.extraDelay=e}}function Uh(r){const t=r.length;let e=0;for(;e<t&&r[e].trim()==="";)e++;return r.substring(e,e+5).toLowerCase()==="data:"}function Pd(r){return typeof r=="string"&&/\.pdf$/i.test(r)}function ag(r){return[r]=r.split(/[#?]/,1),r.substring(r.lastIndexOf("/")+1)}function rg(r,t="document.pdf"){if(typeof r!="string")return t;if(Uh(r))return z('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),t;const e=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,s=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,i=e.exec(r);let a=s.exec(i[1])||s.exec(i[2])||s.exec(i[3]);if(a&&(a=a[0],a.includes("%")))try{a=s.exec(decodeURIComponent(a))[0]}catch{}return a||t}class jd{constructor(){I(this,"started",Object.create(null)),I(this,"times",[])}time(t){t in this.started&&z(`Timer is already running for ${t}`),this.started[t]=Date.now()}timeEnd(t){t in this.started||z(`Timer has not been started for ${t}`),this.times.push({name:t,start:this.started[t],end:Date.now()}),delete this.started[t]}toString(){const t=[];let e=0;for(const{name:s}of this.times)e=Math.max(s.length,e);for(const{name:s,start:i,end:a}of this.times)t.push(`${s.padEnd(e)} ${a-i}ms
`);return t.join("")}}function _n(r,t){const e=t?URL.parse(r,t):URL.parse(r);return(e==null?void 0:e.protocol)==="http:"||(e==null?void 0:e.protocol)==="https:"}function $e(r){r.preventDefault()}function vt(r){r.preventDefault(),r.stopPropagation()}var $r;class Id{static toDateObject(t){if(!t||typeof t!="string")return null;n(this,$r)||p(this,$r,new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const e=n(this,$r).exec(t);if(!e)return null;const s=parseInt(e[1],10);let i=parseInt(e[2],10);i=i>=1&&i<=12?i-1:0;let a=parseInt(e[3],10);a=a>=1&&a<=31?a:1;let o=parseInt(e[4],10);o=o>=0&&o<=23?o:0;let l=parseInt(e[5],10);l=l>=0&&l<=59?l:0;let h=parseInt(e[6],10);h=h>=0&&h<=59?h:0;const c=e[7]||"Z";let d=parseInt(e[8],10);d=d>=0&&d<=23?d:0;let u=parseInt(e[9],10)||0;return u=u>=0&&u<=59?u:0,c==="-"?(o+=d,l+=u):c==="+"&&(o-=d,l-=u),new Date(Date.UTC(s,i,a,o,l,h))}}$r=new WeakMap,m(Id,$r);function og(r,{scale:t=1,rotation:e=0}){const{width:s,height:i}=r.attributes.style,a=[0,0,parseInt(s),parseInt(i)];return new _o({viewBox:a,userUnit:1,scale:t,rotation:e})}function Ld(r){if(r.startsWith("#")){const t=parseInt(r.slice(1),16);return[(t&16711680)>>16,(t&65280)>>8,t&255]}return r.startsWith("rgb(")?r.slice(4,-1).split(",").map(t=>parseInt(t)):r.startsWith("rgba(")?r.slice(5,-1).split(",").map(t=>parseInt(t)).slice(0,3):(z(`Not a valid color format: "${r}"`),[0,0,0])}function lg(r){const t=document.createElement("span");t.style.visibility="hidden",document.body.append(t);for(const e of r.keys()){t.style.color=e;const s=window.getComputedStyle(t).color;r.set(e,Ld(s))}t.remove()}function nt(r){const{a:t,b:e,c:s,d:i,e:a,f:o}=r.getTransform();return[t,e,s,i,a,o]}function Ge(r){const{a:t,b:e,c:s,d:i,e:a,f:o}=r.getTransform().invertSelf();return[t,e,s,i,a,o]}function fn(r,t,e=!1,s=!0){if(t instanceof _o){const{pageWidth:i,pageHeight:a}=t.rawDims,{style:o}=r,l=Bt.isCSSRoundSupported,h=`var(--total-scale-factor) * ${i}px`,c=`var(--total-scale-factor) * ${a}px`,d=l?`round(down, ${h}, var(--scale-round-x))`:`calc(${h})`,u=l?`round(down, ${c}, var(--scale-round-y))`:`calc(${c})`;!e||t.rotation%180===0?(o.width=d,o.height=u):(o.width=u,o.height=d)}s&&r.setAttribute("data-main-rotation",t.rotation)}class Ls{constructor(){const{pixelRatio:t}=Ls;this.sx=t,this.sy=t}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}limitCanvas(t,e,s,i){let a=1/0,o=1/0,l=1/0;s>0&&(a=Math.sqrt(s/(t*e))),i!==-1&&(o=i/t,l=i/e);const h=Math.min(a,o,l);return this.sx>h||this.sy>h?(this.sx=h,this.sy=h,!0):!1}static get pixelRatio(){return globalThis.devicePixelRatio||1}}const Dd=["image/apng","image/avif","image/bmp","image/gif","image/jpeg","image/png","image/svg+xml","image/webp","image/x-icon"];var Si,Sn,Be,Ki,Ho,za,Hr,dc,Bu,ke,Vd,qd,Gr,$u,Go;const zo=class Uo{constructor(t){m(this,ke),m(this,Si,null),m(this,Sn,null),m(this,Be),m(this,Ki,null),m(this,Ho,null),m(this,za,null),p(this,Be,t),n(Uo,Hr)||p(Uo,Hr,Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button",signature:"pdfjs-editor-remove-signature-button"}))}render(){const t=p(this,Si,document.createElement("div"));t.classList.add("editToolbar","hidden"),t.setAttribute("role","toolbar");const e=n(this,Be)._uiManager._signal;t.addEventListener("contextmenu",$e,{signal:e}),t.addEventListener("pointerdown",v(Uo,dc,Bu),{signal:e});const s=p(this,Ki,document.createElement("div"));s.className="buttons",t.append(s);const i=n(this,Be).toolbarPosition;if(i){const{style:a}=t,o=n(this,Be)._uiManager.direction==="ltr"?1-i[0]:i[0];a.insetInlineEnd=`${100*o}%`,a.top=`calc(${100*i[1]}% + var(--editor-toolbar-vert-offset))`}return v(this,ke,$u).call(this),t}get div(){return n(this,Si)}hide(){var t;n(this,Si).classList.add("hidden"),(t=n(this,Sn))==null||t.hideDropdown()}show(){var t;n(this,Si).classList.remove("hidden"),(t=n(this,Ho))==null||t.shown()}async addAltText(t){const e=await t.render();v(this,ke,Gr).call(this,e),n(this,Ki).prepend(e,n(this,ke,Go)),p(this,Ho,t)}addColorPicker(t){p(this,Sn,t);const e=t.renderButton();v(this,ke,Gr).call(this,e),n(this,Ki).prepend(e,n(this,ke,Go))}async addEditSignatureButton(t){const e=p(this,za,await t.renderEditButton(n(this,Be)));v(this,ke,Gr).call(this,e),n(this,Ki).prepend(e,n(this,ke,Go))}updateEditSignatureButton(t){n(this,za)&&(n(this,za).title=t)}remove(){var t;n(this,Si).remove(),(t=n(this,Sn))==null||t.destroy(),p(this,Sn,null)}};Si=new WeakMap,Sn=new WeakMap,Be=new WeakMap,Ki=new WeakMap,Ho=new WeakMap,za=new WeakMap,Hr=new WeakMap,dc=new WeakSet,Bu=function(r){r.stopPropagation()},ke=new WeakSet,Vd=function(r){n(this,Be)._focusEventsAllowed=!1,vt(r)},qd=function(r){n(this,Be)._focusEventsAllowed=!0,vt(r)},Gr=function(r){const t=n(this,Be)._uiManager._signal;r.addEventListener("focusin",v(this,ke,Vd).bind(this),{capture:!0,signal:t}),r.addEventListener("focusout",v(this,ke,qd).bind(this),{capture:!0,signal:t}),r.addEventListener("contextmenu",$e,{signal:t})},$u=function(){const{editorType:r,_uiManager:t}=n(this,Be),e=document.createElement("button");e.className="delete",e.tabIndex=0,e.setAttribute("data-l10n-id",n(zo,Hr)[r]),v(this,ke,Gr).call(this,e),e.addEventListener("click",s=>{t.delete()},{signal:t._signal}),n(this,Ki).append(e)},Go=function(){const r=document.createElement("div");return r.className="divider",r},m(zo,dc),m(zo,Hr,null);let hg=zo;var jo,Qi,la,zr,Hu,Gu,Xd;class cg{constructor(t){m(this,zr),m(this,jo,null),m(this,Qi,null),m(this,la),p(this,la,t)}show(t,e,s){const[i,a]=v(this,zr,Gu).call(this,e,s),{style:o}=n(this,Qi)||p(this,Qi,v(this,zr,Hu).call(this));t.append(n(this,Qi)),o.insetInlineEnd=`${100*i}%`,o.top=`calc(${100*a}% + var(--editor-toolbar-vert-offset))`}hide(){n(this,Qi).remove()}}jo=new WeakMap,Qi=new WeakMap,la=new WeakMap,zr=new WeakSet,Hu=function(){const r=p(this,Qi,document.createElement("div"));r.className="editToolbar",r.setAttribute("role","toolbar"),r.addEventListener("contextmenu",$e,{signal:n(this,la)._signal});const t=p(this,jo,document.createElement("div"));return t.className="buttons",r.append(t),v(this,zr,Xd).call(this),r},Gu=function(r,t){let e=0,s=0;for(const i of r){const a=i.y+i.height;if(a<e)continue;const o=i.x+(t?i.width:0);if(a>e){s=o,e=a;continue}t?o>s&&(s=o):o<s&&(s=o)}return[t?1-s:s,e]},Xd=function(){const r=document.createElement("button");r.className="highlightButton",r.tabIndex=0,r.setAttribute("data-l10n-id","pdfjs-highlight-floating-button1");const t=document.createElement("span");r.append(t),t.className="visuallyHidden",t.setAttribute("data-l10n-id","pdfjs-highlight-floating-button-label");const e=n(this,la)._signal;r.addEventListener("contextmenu",$e,{signal:e}),r.addEventListener("click",()=>{n(this,la).highlightSelection("floating_button")},{signal:e}),n(this,jo).append(r)};function Nd(r,t,e){for(const s of e)t.addEventListener(s,r[s].bind(r))}var uc;class dg{constructor(){m(this,uc,0)}get id(){return`${Uf}${oe(this,uc)._++}`}}uc=new WeakMap;var Ur,eh,At,Ua,Vo;const zu=class{constructor(){m(this,Ua),m(this,Ur,Ou()),m(this,eh,0),m(this,At,null)}static get _isSVGFittingCanvas(){const t='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',e=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),s=new Image;s.src=t;const i=s.decode().then(()=>(e.drawImage(s,0,0,1,1,0,0,1,3),new Uint32Array(e.getImageData(0,0,1,1).data.buffer)[0]===0));return j(this,"_isSVGFittingCanvas",i)}async getFromFile(t){const{lastModified:e,name:s,size:i,type:a}=t;return v(this,Ua,Vo).call(this,`${e}_${s}_${i}_${a}`,t)}async getFromUrl(t){return v(this,Ua,Vo).call(this,t,t)}async getFromBlob(t,e){const s=await e;return v(this,Ua,Vo).call(this,t,s)}async getFromId(t){n(this,At)||p(this,At,new Map);const e=n(this,At).get(t);if(!e)return null;if(e.bitmap)return e.refCounter+=1,e;if(e.file)return this.getFromFile(e.file);if(e.blobPromise){const{blobPromise:s}=e;return delete e.blobPromise,this.getFromBlob(e.id,s)}return this.getFromUrl(e.url)}getFromCanvas(t,e){n(this,At)||p(this,At,new Map);let s=n(this,At).get(t);if(s!=null&&s.bitmap)return s.refCounter+=1,s;const i=new OffscreenCanvas(e.width,e.height);return i.getContext("2d").drawImage(e,0,0),s={bitmap:i.transferToImageBitmap(),id:`image_${n(this,Ur)}_${oe(this,eh)._++}`,refCounter:1,isSvg:!1},n(this,At).set(t,s),n(this,At).set(s.id,s),s}getSvgUrl(t){const e=n(this,At).get(t);return e!=null&&e.isSvg?e.svgUrl:null}deleteId(t){var e;n(this,At)||p(this,At,new Map);const s=n(this,At).get(t);if(!s||(s.refCounter-=1,s.refCounter!==0))return;const{bitmap:i}=s;if(!s.url&&!s.file){const a=new OffscreenCanvas(i.width,i.height);a.getContext("bitmaprenderer").transferFromImageBitmap(i),s.blobPromise=a.convertToBlob()}(e=i.close)==null||e.call(i),s.bitmap=null}isValidId(t){return t.startsWith(`image_${n(this,Ur)}_`)}};Ur=new WeakMap,eh=new WeakMap,At=new WeakMap,Ua=new WeakSet,Vo=async function(r,t){n(this,At)||p(this,At,new Map);let e=n(this,At).get(r);if(e===null)return null;if(e!=null&&e.bitmap)return e.refCounter+=1,e;try{e||(e={bitmap:null,id:`image_${n(this,Ur)}_${oe(this,eh)._++}`,refCounter:0,isSvg:!1});let s;if(typeof t=="string"?(e.url=t,s=await yo(t,"blob")):t instanceof File?s=e.file=t:t instanceof Blob&&(s=t),s.type==="image/svg+xml"){const i=zu._isSVGFittingCanvas,a=new FileReader,o=new Image,l=new Promise((h,c)=>{o.onload=()=>{e.bitmap=o,e.isSvg=!0,h()},a.onload=async()=>{const d=e.svgUrl=a.result;o.src=await i?`${d}#svgView(preserveAspectRatio(none))`:d},o.onerror=a.onerror=c});a.readAsDataURL(s),await l}else e.bitmap=await createImageBitmap(s);e.refCounter=1}catch(s){z(s),e=null}return n(this,At).set(r,e),e&&n(this,At).set(e.id,e),e};let ug=zu;var pt,xi,qo,it;class pg{constructor(t=128){m(this,pt,[]),m(this,xi,!1),m(this,qo),m(this,it,-1),p(this,qo,t)}add({cmd:t,undo:e,post:s,mustExec:i,type:a=NaN,overwriteIfSameType:o=!1,keepUndo:l=!1}){if(i&&t(),n(this,xi))return;const h={cmd:t,undo:e,post:s,type:a};if(n(this,it)===-1){n(this,pt).length>0&&(n(this,pt).length=0),p(this,it,0),n(this,pt).push(h);return}if(o&&n(this,pt)[n(this,it)].type===a){l&&(h.undo=n(this,pt)[n(this,it)].undo),n(this,pt)[n(this,it)]=h;return}const c=n(this,it)+1;c===n(this,qo)?n(this,pt).splice(0,1):(p(this,it,c),c<n(this,pt).length&&n(this,pt).splice(c)),n(this,pt).push(h)}undo(){if(n(this,it)===-1)return;p(this,xi,!0);const{undo:t,post:e}=n(this,pt)[n(this,it)];t(),e==null||e(),p(this,xi,!1),p(this,it,n(this,it)-1)}redo(){if(n(this,it)<n(this,pt).length-1){p(this,it,n(this,it)+1),p(this,xi,!0);const{cmd:t,post:e}=n(this,pt)[n(this,it)];t(),e==null||e(),p(this,xi,!1)}}hasSomethingToUndo(){return n(this,it)!==-1}hasSomethingToRedo(){return n(this,it)<n(this,pt).length-1}cleanType(t){if(n(this,it)!==-1){for(let e=n(this,it);e>=0;e--)if(n(this,pt)[e].type!==t){n(this,pt).splice(e+1,n(this,it)-e),p(this,it,e);return}n(this,pt).length=0,p(this,it,-1)}}destroy(){p(this,pt,null)}}pt=new WeakMap,xi=new WeakMap,qo=new WeakMap,it=new WeakMap;var pc,Uu;class So{constructor(t){m(this,pc),this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:e}=Bt.platform;for(const[s,i,a={}]of t)for(const o of s){const l=o.startsWith("mac+");e&&l?(this.callbacks.set(o.slice(4),{callback:i,options:a}),this.allKeys.add(o.split("+").at(-1))):!e&&!l&&(this.callbacks.set(o,{callback:i,options:a}),this.allKeys.add(o.split("+").at(-1)))}}exec(t,e){if(!this.allKeys.has(e.key))return;const s=this.callbacks.get(v(this,pc,Uu).call(this,e));if(!s)return;const{callback:i,options:{bubbles:a=!1,args:o=[],checker:l=null}}=s;l&&!l(t,e)||(i.bind(t,...o,e)(),a||vt(e))}}pc=new WeakSet,Uu=function(r){r.altKey&&this.buffer.push("alt"),r.ctrlKey&&this.buffer.push("ctrl"),r.metaKey&&this.buffer.push("meta"),r.shiftKey&&this.buffer.push("shift"),this.buffer.push(r.key);const t=this.buffer.join("+");return this.buffer.length=0,t};const ju=class Vu{get _colors(){const t=new Map([["CanvasText",null],["Canvas",null]]);return lg(t),j(this,"_colors",t)}convert(t){const e=Ld(t);if(!window.matchMedia("(forced-colors: active)").matches)return e;for(const[s,i]of this._colors)if(i.every((a,o)=>a===e[o]))return Vu._colorsMapping.get(s);return e}getHexCode(t){const e=this._colors.get(t);return e?L.makeHexColor(...e):t}};I(ju,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));let fg=ju;var ja,ve,Et,Ut,Va,Ns,xn,Le,Ei,En,qa,kn,hs,je,Mn,sh,Xo,Xa,Yo,cs,ki,Ya,Ji,Ze,fc,Zi,Ko,Mi,Cn,Tn,Fs,Qo,Ft,J,Os,Ci,Rn,Ka,Jo,Ti,ds,Ws,Zo,De,O,tl,gc,Yd,Kd,ih,qu,Xu,Yu,mc,Ku,vc,wc,Qu,Kt,_s,Ju,Zu,bc,tp,Qa,Ac;const yc=class _c{constructor(t,e,s,i,a,o,l,h,c,d,u,f,g,b){m(this,O),m(this,ja,new AbortController),m(this,ve,null),m(this,Et,new Map),m(this,Ut,new Map),m(this,Va,null),m(this,Ns,null),m(this,xn,null),m(this,Le,new pg),m(this,Ei,null),m(this,En,null),m(this,qa,0),m(this,kn,new Set),m(this,hs,null),m(this,je,null),m(this,Mn,new Set),I(this,"_editorUndoBar",null),m(this,sh,!1),m(this,Xo,!1),m(this,Xa,!1),m(this,Yo,null),m(this,cs,null),m(this,ki,null),m(this,Ya,null),m(this,Ji,!1),m(this,Ze,null),m(this,fc,new dg),m(this,Zi,!1),m(this,Ko,!1),m(this,Mi,null),m(this,Cn,null),m(this,Tn,null),m(this,Fs,null),m(this,Qo,null),m(this,Ft,G.NONE),m(this,J,new Set),m(this,Os,null),m(this,Ci,null),m(this,Rn,null),m(this,Ka,null),m(this,Jo,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1}),m(this,Ti,[0,0]),m(this,ds,null),m(this,Ws,null),m(this,Zo,null),m(this,De,null);const w=this._signal=n(this,ja).signal;p(this,Ws,t),p(this,Zo,e),p(this,Va,s),p(this,Ci,i),this._eventBus=a,a._on("editingaction",this.onEditingAction.bind(this),{signal:w}),a._on("pagechanging",this.onPageChanging.bind(this),{signal:w}),a._on("scalechanging",this.onScaleChanging.bind(this),{signal:w}),a._on("rotationchanging",this.onRotationChanging.bind(this),{signal:w}),a._on("setpreference",this.onSetPreference.bind(this),{signal:w}),a._on("switchannotationeditorparams",A=>this.updateParams(A.type,A.value),{signal:w}),v(this,O,qu).call(this),v(this,O,Qu).call(this),v(this,O,mc).call(this),p(this,Ns,o.annotationStorage),p(this,Yo,o.filterFactory),p(this,Rn,l),p(this,Ya,h||null),p(this,sh,c),p(this,Xo,d),p(this,Xa,u),p(this,Qo,f||null),this.viewParameters={realScale:Da.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=g||null,this._supportsPinchToZoom=b!==!1}static get _keyboardManager(){const t=_c.prototype,e=o=>n(o,Ws).contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&o.hasSomethingToControl(),s=(o,{target:l})=>{if(l instanceof HTMLInputElement){const{type:h}=l;return h!=="text"&&h!=="number"}return!0},i=this.TRANSLATE_SMALL,a=this.TRANSLATE_BIG;return j(this,"_keyboardManager",new So([[["ctrl+a","mac+meta+a"],t.selectAll,{checker:s}],[["ctrl+z","mac+meta+z"],t.undo,{checker:s}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],t.redo,{checker:s}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],t.delete,{checker:s}],[["Enter","mac+Enter"],t.addNewEditorFromKeyboard,{checker:(o,{target:l})=>!(l instanceof HTMLButtonElement)&&n(o,Ws).contains(l)&&!o.isEnterHandled}],[[" ","mac+ "],t.addNewEditorFromKeyboard,{checker:(o,{target:l})=>!(l instanceof HTMLButtonElement)&&n(o,Ws).contains(document.activeElement)}],[["Escape","mac+Escape"],t.unselectAll],[["ArrowLeft","mac+ArrowLeft"],t.translateSelectedEditors,{args:[-i,0],checker:e}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t.translateSelectedEditors,{args:[-a,0],checker:e}],[["ArrowRight","mac+ArrowRight"],t.translateSelectedEditors,{args:[i,0],checker:e}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t.translateSelectedEditors,{args:[a,0],checker:e}],[["ArrowUp","mac+ArrowUp"],t.translateSelectedEditors,{args:[0,-i],checker:e}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t.translateSelectedEditors,{args:[0,-a],checker:e}],[["ArrowDown","mac+ArrowDown"],t.translateSelectedEditors,{args:[0,i],checker:e}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t.translateSelectedEditors,{args:[0,a],checker:e}]]))}destroy(){var t,e,s,i,a,o,l,h;(t=n(this,De))==null||t.resolve(),p(this,De,null),(e=n(this,ja))==null||e.abort(),p(this,ja,null),this._signal=null;for(const c of n(this,Ut).values())c.destroy();n(this,Ut).clear(),n(this,Et).clear(),n(this,Mn).clear(),(s=n(this,Fs))==null||s.clear(),p(this,ve,null),n(this,J).clear(),n(this,Le).destroy(),(i=n(this,Va))==null||i.destroy(),(a=n(this,Ci))==null||a.destroy(),(o=n(this,Ze))==null||o.hide(),p(this,Ze,null),(l=n(this,Tn))==null||l.destroy(),p(this,Tn,null),n(this,cs)&&(clearTimeout(n(this,cs)),p(this,cs,null)),n(this,ds)&&(clearTimeout(n(this,ds)),p(this,ds,null)),(h=this._editorUndoBar)==null||h.destroy()}combinedSignal(t){return AbortSignal.any([this._signal,t.signal])}get mlManager(){return n(this,Qo)}get useNewAltTextFlow(){return n(this,Xo)}get useNewAltTextWhenAddingImage(){return n(this,Xa)}get hcmFilter(){return j(this,"hcmFilter",n(this,Rn)?n(this,Yo).addHCMFilter(n(this,Rn).foreground,n(this,Rn).background):"none")}get direction(){return j(this,"direction",getComputedStyle(n(this,Ws)).direction)}get highlightColors(){return j(this,"highlightColors",n(this,Ya)?new Map(n(this,Ya).split(",").map(t=>t.split("=").map(e=>e.trim()))):null)}get highlightColorNames(){return j(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,t=>t.reverse())):null)}setCurrentDrawingSession(t){t?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),p(this,En,t)}setMainHighlightColorPicker(t){p(this,Tn,t)}editAltText(t,e=!1){var s;(s=n(this,Va))==null||s.editAltText(this,t,e)}getSignature(t){var e;(e=n(this,Ci))==null||e.getSignature({uiManager:this,editor:t})}get signatureManager(){return n(this,Ci)}switchToMode(t,e){this._eventBus.on("annotationeditormodechanged",e,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:t})}setPreference(t,e){this._eventBus.dispatch("setpreference",{source:this,name:t,value:e})}onSetPreference({name:t,value:e}){switch(t){case"enableNewAltTextWhenAddingImage":p(this,Xa,e);break}}onPageChanging({pageNumber:t}){p(this,qa,t-1)}focusMainContainer(){n(this,Ws).focus()}findParent(t,e){for(const s of n(this,Ut).values()){const{x:i,y:a,width:o,height:l}=s.div.getBoundingClientRect();if(t>=i&&t<=i+o&&e>=a&&e<=a+l)return s}return null}disableUserSelect(t=!1){n(this,Zo).classList.toggle("noUserSelect",t)}addShouldRescale(t){n(this,Mn).add(t)}removeShouldRescale(t){n(this,Mn).delete(t)}onScaleChanging({scale:t}){var e;this.commitOrRemove(),this.viewParameters.realScale=t*Da.PDF_TO_CSS_UNITS;for(const s of n(this,Mn))s.onScaleChanging();(e=n(this,En))==null||e.onScaleChanging()}onRotationChanging({pagesRotation:t}){this.commitOrRemove(),this.viewParameters.rotation=t}highlightSelection(t=""){const e=document.getSelection();if(!e||e.isCollapsed)return;const{anchorNode:s,anchorOffset:i,focusNode:a,focusOffset:o}=e,l=e.toString(),h=v(this,O,tl).call(this,e).closest(".textLayer"),c=this.getSelectionBoxes(h);if(!c)return;e.empty();const d=v(this,O,gc).call(this,h),u=n(this,Ft)===G.NONE,f=()=>{d==null||d.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:t,boxes:c,anchorNode:s,anchorOffset:i,focusNode:a,focusOffset:o,text:l}),u&&this.showAllEditors("highlight",!0,!0)};if(u){this.switchToMode(G.HIGHLIGHT,f);return}f()}addToAnnotationStorage(t){!t.isEmpty()&&n(this,Ns)&&!n(this,Ns).has(t.id)&&n(this,Ns).setValue(t.id,t)}blur(){if(this.isShiftKeyDown=!1,n(this,Ji)&&(p(this,Ji,!1),v(this,O,ih).call(this,"main_toolbar")),!this.hasSelection)return;const{activeElement:t}=document;for(const e of n(this,J))if(e.div.contains(t)){p(this,Cn,[e,t]),e._focusEventsAllowed=!1;break}}focus(){if(!n(this,Cn))return;const[t,e]=n(this,Cn);p(this,Cn,null),e.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:this._signal}),e.focus()}addEditListeners(){v(this,O,mc).call(this),v(this,O,vc).call(this)}removeEditListeners(){v(this,O,Ku).call(this),v(this,O,wc).call(this)}dragOver(t){for(const{type:e}of t.dataTransfer.items)for(const s of n(this,je))if(s.isHandlingMimeForPasting(e)){t.dataTransfer.dropEffect="copy",t.preventDefault();return}}drop(t){for(const e of t.dataTransfer.items)for(const s of n(this,je))if(s.isHandlingMimeForPasting(e.type)){s.paste(e,this.currentLayer),t.preventDefault();return}}copy(t){var e;if(t.preventDefault(),(e=n(this,ve))==null||e.commitOrRemove(),!this.hasSelection)return;const s=[];for(const i of n(this,J)){const a=i.serialize(!0);a&&s.push(a)}s.length!==0&&t.clipboardData.setData("application/pdfjs",JSON.stringify(s))}cut(t){this.copy(t),this.delete()}async paste(t){t.preventDefault();const{clipboardData:e}=t;for(const a of e.items)for(const o of n(this,je))if(o.isHandlingMimeForPasting(a.type)){o.paste(a,this.currentLayer);return}let s=e.getData("application/pdfjs");if(!s)return;try{s=JSON.parse(s)}catch(a){z(`paste: "${a.message}".`);return}if(!Array.isArray(s))return;this.unselectAll();const i=this.currentLayer;try{const a=[];for(const h of s){const c=await i.deserialize(h);if(!c)return;a.push(c)}const o=()=>{for(const h of a)v(this,O,bc).call(this,h);v(this,O,Ac).call(this,a)},l=()=>{for(const h of a)h.remove()};this.addCommands({cmd:o,undo:l,mustExec:!0})}catch(a){z(`paste: "${a.message}".`)}}keydown(t){!this.isShiftKeyDown&&t.key==="Shift"&&(this.isShiftKeyDown=!0),n(this,Ft)!==G.NONE&&!this.isEditorHandlingKeyboard&&_c._keyboardManager.exec(this,t)}keyup(t){this.isShiftKeyDown&&t.key==="Shift"&&(this.isShiftKeyDown=!1,n(this,Ji)&&(p(this,Ji,!1),v(this,O,ih).call(this,"main_toolbar")))}onEditingAction({name:t}){switch(t){case"undo":case"redo":case"delete":case"selectAll":this[t]();break;case"highlightSelection":this.highlightSelection("context_menu");break}}setEditingState(t){t?(v(this,O,Xu).call(this),v(this,O,vc).call(this),v(this,O,Kt).call(this,{isEditing:n(this,Ft)!==G.NONE,isEmpty:v(this,O,Qa).call(this),hasSomethingToUndo:n(this,Le).hasSomethingToUndo(),hasSomethingToRedo:n(this,Le).hasSomethingToRedo(),hasSelectedEditor:!1})):(v(this,O,Yu).call(this),v(this,O,wc).call(this),v(this,O,Kt).call(this,{isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(t){if(!n(this,je)){p(this,je,t);for(const e of n(this,je))v(this,O,_s).call(this,e.defaultPropertiesToUpdate)}}getId(){return n(this,fc).id}get currentLayer(){return n(this,Ut).get(n(this,qa))}getLayer(t){return n(this,Ut).get(t)}get currentPageIndex(){return n(this,qa)}addLayer(t){n(this,Ut).set(t.pageIndex,t),n(this,Zi)?t.enable():t.disable()}removeLayer(t){n(this,Ut).delete(t.pageIndex)}async updateMode(t,e=null,s=!1){var i,a;if(n(this,Ft)!==t&&!(n(this,De)&&(await n(this,De).promise,!n(this,De)))){if(p(this,De,Promise.withResolvers()),p(this,Ft,t),t===G.NONE){this.setEditingState(!1),v(this,O,Zu).call(this),(i=this._editorUndoBar)==null||i.hide(),n(this,De).resolve();return}t===G.SIGNATURE&&await((a=n(this,Ci))==null?void 0:a.loadSignatures()),this.setEditingState(!0),await v(this,O,Ju).call(this),this.unselectAll();for(const o of n(this,Ut).values())o.updateMode(t);if(!e){s&&this.addNewEditorFromKeyboard(),n(this,De).resolve();return}for(const o of n(this,Et).values())o.annotationElementId===e?(this.setSelected(o),o.enterInEditMode()):o.unselect();n(this,De).resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(t){t!==n(this,Ft)&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:t})}updateParams(t,e){var s;if(n(this,je)){switch(t){case V.CREATE:this.currentLayer.addNewEditor(e);return;case V.HIGHLIGHT_DEFAULT_COLOR:(s=n(this,Tn))==null||s.updateColor(e);break;case V.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(n(this,Ka)||p(this,Ka,new Map)).set(t,e),this.showAllEditors("highlight",e);break}for(const i of n(this,J))i.updateParams(t,e);for(const i of n(this,je))i.updateDefaultParams(t,e)}}showAllEditors(t,e,s=!1){var i;for(const a of n(this,Et).values())a.editorType===t&&a.show(e);(((i=n(this,Ka))==null?void 0:i.get(V.HIGHLIGHT_SHOW_ALL))??!0)!==e&&v(this,O,_s).call(this,[[V.HIGHLIGHT_SHOW_ALL,e]])}enableWaiting(t=!1){if(n(this,Ko)!==t){p(this,Ko,t);for(const e of n(this,Ut).values())t?e.disableClick():e.enableClick(),e.div.classList.toggle("waiting",t)}}getEditors(t){const e=[];for(const s of n(this,Et).values())s.pageIndex===t&&e.push(s);return e}getEditor(t){return n(this,Et).get(t)}addEditor(t){n(this,Et).set(t.id,t)}removeEditor(t){var e,s;t.div.contains(document.activeElement)&&(n(this,cs)&&clearTimeout(n(this,cs)),p(this,cs,setTimeout(()=>{this.focusMainContainer(),p(this,cs,null)},0))),n(this,Et).delete(t.id),t.annotationElementId&&((e=n(this,Fs))==null||e.delete(t.annotationElementId)),this.unselect(t),(!t.annotationElementId||!n(this,kn).has(t.annotationElementId))&&((s=n(this,Ns))==null||s.remove(t.id))}addDeletedAnnotationElement(t){n(this,kn).add(t.annotationElementId),this.addChangedExistingAnnotation(t),t.deleted=!0}isDeletedAnnotationElement(t){return n(this,kn).has(t)}removeDeletedAnnotationElement(t){n(this,kn).delete(t.annotationElementId),this.removeChangedExistingAnnotation(t),t.deleted=!1}setActiveEditor(t){n(this,ve)!==t&&(p(this,ve,t),t&&v(this,O,_s).call(this,t.propertiesToUpdate))}updateUI(t){n(this,O,tp)===t&&v(this,O,_s).call(this,t.propertiesToUpdate)}updateUIForDefaultProperties(t){v(this,O,_s).call(this,t.defaultPropertiesToUpdate)}toggleSelected(t){if(n(this,J).has(t)){n(this,J).delete(t),t.unselect(),v(this,O,Kt).call(this,{hasSelectedEditor:this.hasSelection});return}n(this,J).add(t),t.select(),v(this,O,_s).call(this,t.propertiesToUpdate),v(this,O,Kt).call(this,{hasSelectedEditor:!0})}setSelected(t){var e;(e=n(this,En))==null||e.commitOrRemove();for(const s of n(this,J))s!==t&&s.unselect();n(this,J).clear(),n(this,J).add(t),t.select(),v(this,O,_s).call(this,t.propertiesToUpdate),v(this,O,Kt).call(this,{hasSelectedEditor:!0})}isSelected(t){return n(this,J).has(t)}get firstSelectedEditor(){return n(this,J).values().next().value}unselect(t){t.unselect(),n(this,J).delete(t),v(this,O,Kt).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return n(this,J).size!==0}get isEnterHandled(){return n(this,J).size===1&&this.firstSelectedEditor.isEnterHandled}undo(){var t;n(this,Le).undo(),v(this,O,Kt).call(this,{hasSomethingToUndo:n(this,Le).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:v(this,O,Qa).call(this)}),(t=this._editorUndoBar)==null||t.hide()}redo(){n(this,Le).redo(),v(this,O,Kt).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:n(this,Le).hasSomethingToRedo(),isEmpty:v(this,O,Qa).call(this)})}addCommands(t){n(this,Le).add(t),v(this,O,Kt).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:v(this,O,Qa).call(this)})}cleanUndoStack(t){n(this,Le).cleanType(t)}delete(){var t;this.commitOrRemove();const e=(t=this.currentLayer)==null?void 0:t.endDrawingSession(!0);if(!this.hasSelection&&!e)return;const s=e?[e]:[...n(this,J)],i=()=>{var o;(o=this._editorUndoBar)==null||o.show(a,s.length===1?s[0].editorType:s.length);for(const l of s)l.remove()},a=()=>{for(const o of s)v(this,O,bc).call(this,o)};this.addCommands({cmd:i,undo:a,mustExec:!0})}commitOrRemove(){var t;(t=n(this,ve))==null||t.commitOrRemove()}hasSomethingToControl(){return n(this,ve)||this.hasSelection}selectAll(){for(const t of n(this,J))t.commit();v(this,O,Ac).call(this,n(this,Et).values())}unselectAll(){var t;if(!(n(this,ve)&&(n(this,ve).commitOrRemove(),n(this,Ft)!==G.NONE))&&!((t=n(this,En))!=null&&t.commitOrRemove())&&this.hasSelection){for(const e of n(this,J))e.unselect();n(this,J).clear(),v(this,O,Kt).call(this,{hasSelectedEditor:!1})}}translateSelectedEditors(t,e,s=!1){if(s||this.commitOrRemove(),!this.hasSelection)return;n(this,Ti)[0]+=t,n(this,Ti)[1]+=e;const[i,a]=n(this,Ti),o=[...n(this,J)];n(this,ds)&&clearTimeout(n(this,ds)),p(this,ds,setTimeout(()=>{p(this,ds,null),n(this,Ti)[0]=n(this,Ti)[1]=0,this.addCommands({cmd:()=>{for(const h of o)n(this,Et).has(h.id)&&(h.translateInPage(i,a),h.translationDone())},undo:()=>{for(const h of o)n(this,Et).has(h.id)&&(h.translateInPage(-i,-a),h.translationDone())},mustExec:!1})},1e3));for(const h of o)h.translateInPage(t,e),h.translationDone()}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),p(this,hs,new Map);for(const t of n(this,J))n(this,hs).set(t,{savedX:t.x,savedY:t.y,savedPageIndex:t.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!n(this,hs))return!1;this.disableUserSelect(!1);const t=n(this,hs);p(this,hs,null);let e=!1;for(const[{x:i,y:a,pageIndex:o},l]of t)l.newX=i,l.newY=a,l.newPageIndex=o,e||(e=i!==l.savedX||a!==l.savedY||o!==l.savedPageIndex);if(!e)return!1;const s=(i,a,o,l)=>{if(n(this,Et).has(i.id)){const h=n(this,Ut).get(l);h?i._setParentAndPosition(h,a,o):(i.pageIndex=l,i.x=a,i.y=o)}};return this.addCommands({cmd:()=>{for(const[i,{newX:a,newY:o,newPageIndex:l}]of t)s(i,a,o,l)},undo:()=>{for(const[i,{savedX:a,savedY:o,savedPageIndex:l}]of t)s(i,a,o,l)},mustExec:!0}),!0}dragSelectedEditors(t,e){if(n(this,hs))for(const s of n(this,hs).keys())s.drag(t,e)}rebuild(t){if(t.parent===null){const e=this.getLayer(t.pageIndex);e?(e.changeParent(t),e.addOrRebuild(t)):(this.addEditor(t),this.addToAnnotationStorage(t),t.rebuild())}else t.parent.addOrRebuild(t)}get isEditorHandlingKeyboard(){var t;return((t=this.getActive())==null?void 0:t.shouldGetKeyboardEvents())||n(this,J).size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(t){return n(this,ve)===t}getActive(){return n(this,ve)}getMode(){return n(this,Ft)}get imageManager(){return j(this,"imageManager",new ug)}getSelectionBoxes(t){if(!t)return null;const e=document.getSelection();for(let c=0,d=e.rangeCount;c<d;c++)if(!t.contains(e.getRangeAt(c).commonAncestorContainer))return null;const{x:s,y:i,width:a,height:o}=t.getBoundingClientRect();let l;switch(t.getAttribute("data-main-rotation")){case"90":l=(c,d,u,f)=>({x:(d-i)/o,y:1-(c+u-s)/a,width:f/o,height:u/a});break;case"180":l=(c,d,u,f)=>({x:1-(c+u-s)/a,y:1-(d+f-i)/o,width:u/a,height:f/o});break;case"270":l=(c,d,u,f)=>({x:1-(d+f-i)/o,y:(c-s)/a,width:f/o,height:u/a});break;default:l=(c,d,u,f)=>({x:(c-s)/a,y:(d-i)/o,width:u/a,height:f/o});break}const h=[];for(let c=0,d=e.rangeCount;c<d;c++){const u=e.getRangeAt(c);if(!u.collapsed)for(const{x:f,y:g,width:b,height:w}of u.getClientRects())b===0||w===0||h.push(l(f,g,b,w))}return h.length===0?null:h}addChangedExistingAnnotation({annotationElementId:t,id:e}){(n(this,xn)||p(this,xn,new Map)).set(t,e)}removeChangedExistingAnnotation({annotationElementId:t}){var e;(e=n(this,xn))==null||e.delete(t)}renderAnnotationElement(t){var e;const s=(e=n(this,xn))==null?void 0:e.get(t.data.id);if(!s)return;const i=n(this,Ns).getRawValue(s);i&&(n(this,Ft)===G.NONE&&!i.hasBeenModified||i.renderAnnotationElement(t))}setMissingCanvas(t,e,s){var i;const a=(i=n(this,Fs))==null?void 0:i.get(t);a&&(a.setCanvas(e,s),n(this,Fs).delete(t))}addMissingCanvas(t,e){(n(this,Fs)||p(this,Fs,new Map)).set(t,e)}};ja=new WeakMap,ve=new WeakMap,Et=new WeakMap,Ut=new WeakMap,Va=new WeakMap,Ns=new WeakMap,xn=new WeakMap,Le=new WeakMap,Ei=new WeakMap,En=new WeakMap,qa=new WeakMap,kn=new WeakMap,hs=new WeakMap,je=new WeakMap,Mn=new WeakMap,sh=new WeakMap,Xo=new WeakMap,Xa=new WeakMap,Yo=new WeakMap,cs=new WeakMap,ki=new WeakMap,Ya=new WeakMap,Ji=new WeakMap,Ze=new WeakMap,fc=new WeakMap,Zi=new WeakMap,Ko=new WeakMap,Mi=new WeakMap,Cn=new WeakMap,Tn=new WeakMap,Fs=new WeakMap,Qo=new WeakMap,Ft=new WeakMap,J=new WeakMap,Os=new WeakMap,Ci=new WeakMap,Rn=new WeakMap,Ka=new WeakMap,Jo=new WeakMap,Ti=new WeakMap,ds=new WeakMap,Ws=new WeakMap,Zo=new WeakMap,De=new WeakMap,O=new WeakSet,tl=function({anchorNode:r}){return r.nodeType===Node.TEXT_NODE?r.parentElement:r},gc=function(r){const{currentLayer:t}=this;if(t.hasTextLayer(r))return t;for(const e of n(this,Ut).values())if(e.hasTextLayer(r))return e;return null},Yd=function(){const r=document.getSelection();if(!r||r.isCollapsed)return;const t=v(this,O,tl).call(this,r).closest(".textLayer"),e=this.getSelectionBoxes(t);e&&(n(this,Ze)||p(this,Ze,new cg(this)),n(this,Ze).show(t,e,this.direction==="ltr"))},Kd=function(){var r,t,e;const s=document.getSelection();if(!s||s.isCollapsed){n(this,Os)&&((r=n(this,Ze))==null||r.hide(),p(this,Os,null),v(this,O,Kt).call(this,{hasSelectedText:!1}));return}const{anchorNode:i}=s;if(i===n(this,Os))return;const a=v(this,O,tl).call(this,s).closest(".textLayer");if(!a){n(this,Os)&&((t=n(this,Ze))==null||t.hide(),p(this,Os,null),v(this,O,Kt).call(this,{hasSelectedText:!1}));return}if((e=n(this,Ze))==null||e.hide(),p(this,Os,i),v(this,O,Kt).call(this,{hasSelectedText:!0}),!(n(this,Ft)!==G.HIGHLIGHT&&n(this,Ft)!==G.NONE)&&(n(this,Ft)===G.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),p(this,Ji,this.isShiftKeyDown),!this.isShiftKeyDown)){const o=n(this,Ft)===G.HIGHLIGHT?v(this,O,gc).call(this,a):null;o==null||o.toggleDrawing();const l=new AbortController,h=this.combinedSignal(l),c=d=>{d.type==="pointerup"&&d.button!==0||(l.abort(),o==null||o.toggleDrawing(!0),d.type==="pointerup"&&v(this,O,ih).call(this,"main_toolbar"))};window.addEventListener("pointerup",c,{signal:h}),window.addEventListener("blur",c,{signal:h})}},ih=function(r=""){n(this,Ft)===G.HIGHLIGHT?this.highlightSelection(r):n(this,sh)&&v(this,O,Yd).call(this)},qu=function(){document.addEventListener("selectionchange",v(this,O,Kd).bind(this),{signal:this._signal})},Xu=function(){if(n(this,ki))return;p(this,ki,new AbortController);const r=this.combinedSignal(n(this,ki));window.addEventListener("focus",this.focus.bind(this),{signal:r}),window.addEventListener("blur",this.blur.bind(this),{signal:r})},Yu=function(){var r;(r=n(this,ki))==null||r.abort(),p(this,ki,null)},mc=function(){if(n(this,Mi))return;p(this,Mi,new AbortController);const r=this.combinedSignal(n(this,Mi));window.addEventListener("keydown",this.keydown.bind(this),{signal:r}),window.addEventListener("keyup",this.keyup.bind(this),{signal:r})},Ku=function(){var r;(r=n(this,Mi))==null||r.abort(),p(this,Mi,null)},vc=function(){if(n(this,Ei))return;p(this,Ei,new AbortController);const r=this.combinedSignal(n(this,Ei));document.addEventListener("copy",this.copy.bind(this),{signal:r}),document.addEventListener("cut",this.cut.bind(this),{signal:r}),document.addEventListener("paste",this.paste.bind(this),{signal:r})},wc=function(){var r;(r=n(this,Ei))==null||r.abort(),p(this,Ei,null)},Qu=function(){const r=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:r}),document.addEventListener("drop",this.drop.bind(this),{signal:r})},Kt=function(r){Object.entries(r).some(([t,e])=>n(this,Jo)[t]!==e)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(n(this,Jo),r)}),n(this,Ft)===G.HIGHLIGHT&&r.hasSelectedEditor===!1&&v(this,O,_s).call(this,[[V.HIGHLIGHT_FREE,!0]]))},_s=function(r){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:r})},Ju=async function(){if(!n(this,Zi)){p(this,Zi,!0);const r=[];for(const t of n(this,Ut).values())r.push(t.enable());await Promise.all(r);for(const t of n(this,Et).values())t.enable()}},Zu=function(){if(this.unselectAll(),n(this,Zi)){p(this,Zi,!1);for(const r of n(this,Ut).values())r.disable();for(const r of n(this,Et).values())r.disable()}},bc=function(r){const t=n(this,Ut).get(r.pageIndex);t?t.addOrRebuild(r):(this.addEditor(r),this.addToAnnotationStorage(r))},tp=function(){let r=null;for(r of n(this,J));return r},Qa=function(){if(n(this,Et).size===0)return!0;if(n(this,Et).size===1)for(const r of n(this,Et).values())return r.isEmpty();return!1},Ac=function(r){for(const t of n(this,J))t.unselect();n(this,J).clear();for(const t of r)t.isEmpty()||(n(this,J).add(t),t.select());v(this,O,Kt).call(this,{hasSelectedEditor:this.hasSelection})},I(yc,"TRANSLATE_SMALL",1),I(yc,"TRANSLATE_BIG",10);let wo=yc;var Ot,ks,Xe,jr,Ss,Me,Ja,us,fe,Bs,Pn,xs,pi,Ms,Vr,el;const Za=class $s{constructor(t){m(this,Ms),m(this,Ot,null),m(this,ks,!1),m(this,Xe,null),m(this,jr,null),m(this,Ss,null),m(this,Me,null),m(this,Ja,!1),m(this,us,null),m(this,fe,null),m(this,Bs,null),m(this,Pn,null),m(this,xs,!1),p(this,fe,t),p(this,xs,t._uiManager.useNewAltTextFlow),n($s,pi)||p($s,pi,Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"}))}static initialize(t){$s._l10n??($s._l10n=t)}async render(){const t=p(this,Xe,document.createElement("button"));t.className="altText",t.tabIndex="0";const e=p(this,jr,document.createElement("span"));t.append(e),n(this,xs)?(t.classList.add("new"),t.setAttribute("data-l10n-id",n($s,pi).missing),e.setAttribute("data-l10n-id",n($s,pi)["missing-label"])):(t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const s=n(this,fe)._uiManager._signal;t.addEventListener("contextmenu",$e,{signal:s}),t.addEventListener("pointerdown",a=>a.stopPropagation(),{signal:s});const i=a=>{a.preventDefault(),n(this,fe)._uiManager.editAltText(n(this,fe)),n(this,xs)&&n(this,fe)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:n(this,Ms,Vr)}})};return t.addEventListener("click",i,{capture:!0,signal:s}),t.addEventListener("keydown",a=>{a.target===t&&a.key==="Enter"&&(p(this,Ja,!0),i(a))},{signal:s}),await v(this,Ms,el).call(this),t}finish(){n(this,Xe)&&(n(this,Xe).focus({focusVisible:n(this,Ja)}),p(this,Ja,!1))}isEmpty(){return n(this,xs)?n(this,Ot)===null:!n(this,Ot)&&!n(this,ks)}hasData(){return n(this,xs)?n(this,Ot)!==null||!!n(this,Bs):this.isEmpty()}get guessedText(){return n(this,Bs)}async setGuessedText(t){n(this,Ot)===null&&(p(this,Bs,t),p(this,Pn,await $s._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:t})),v(this,Ms,el).call(this))}toggleAltTextBadge(t=!1){var e;if(!n(this,xs)||n(this,Ot)){(e=n(this,us))==null||e.remove(),p(this,us,null);return}if(!n(this,us)){const s=p(this,us,document.createElement("div"));s.className="noAltTextBadge",n(this,fe).div.append(s)}n(this,us).classList.toggle("hidden",!t)}serialize(t){let e=n(this,Ot);return!t&&n(this,Bs)===e&&(e=n(this,Pn)),{altText:e,decorative:n(this,ks),guessedText:n(this,Bs),textWithDisclaimer:n(this,Pn)}}get data(){return{altText:n(this,Ot),decorative:n(this,ks)}}set data({altText:t,decorative:e,guessedText:s,textWithDisclaimer:i,cancel:a=!1}){s&&(p(this,Bs,s),p(this,Pn,i)),!(n(this,Ot)===t&&n(this,ks)===e)&&(a||(p(this,Ot,t),p(this,ks,e)),v(this,Ms,el).call(this))}toggle(t=!1){n(this,Xe)&&(!t&&n(this,Me)&&(clearTimeout(n(this,Me)),p(this,Me,null)),n(this,Xe).disabled=!t)}shown(){n(this,fe)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:n(this,Ms,Vr)}})}destroy(){var t,e;(t=n(this,Xe))==null||t.remove(),p(this,Xe,null),p(this,jr,null),p(this,Ss,null),(e=n(this,us))==null||e.remove(),p(this,us,null)}};Ot=new WeakMap,ks=new WeakMap,Xe=new WeakMap,jr=new WeakMap,Ss=new WeakMap,Me=new WeakMap,Ja=new WeakMap,us=new WeakMap,fe=new WeakMap,Bs=new WeakMap,Pn=new WeakMap,xs=new WeakMap,pi=new WeakMap,Ms=new WeakSet,Vr=function(){return n(this,Ot)&&"added"||n(this,Ot)===null&&this.guessedText&&"review"||"missing"},el=async function(){var r,t,e;const s=n(this,Xe);if(!s)return;if(n(this,xs)){if(s.classList.toggle("done",!!n(this,Ot)),s.setAttribute("data-l10n-id",n(Za,pi)[n(this,Ms,Vr)]),(r=n(this,jr))==null||r.setAttribute("data-l10n-id",n(Za,pi)[`${n(this,Ms,Vr)}-label`]),!n(this,Ot)){(t=n(this,Ss))==null||t.remove();return}}else{if(!n(this,Ot)&&!n(this,ks)){s.classList.remove("done"),(e=n(this,Ss))==null||e.remove();return}s.classList.add("done"),s.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let i=n(this,Ss);if(!i){p(this,Ss,i=document.createElement("span")),i.className="tooltip",i.setAttribute("role","tooltip"),i.id=`alt-text-tooltip-${n(this,fe).id}`;const o=100,l=n(this,fe)._uiManager._signal;l.addEventListener("abort",()=>{clearTimeout(n(this,Me)),p(this,Me,null)},{once:!0}),s.addEventListener("mouseenter",()=>{p(this,Me,setTimeout(()=>{p(this,Me,null),n(this,Ss).classList.add("show"),n(this,fe)._reportTelemetry({action:"alt_text_tooltip"})},o))},{signal:l}),s.addEventListener("mouseleave",()=>{var h;n(this,Me)&&(clearTimeout(n(this,Me)),p(this,Me,null)),(h=n(this,Ss))==null||h.classList.remove("show")},{signal:l})}n(this,ks)?i.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(i.removeAttribute("data-l10n-id"),i.textContent=n(this,Ot)),i.parentNode||s.append(i);const a=n(this,fe).getElementForAltText();a==null||a.setAttribute("aria-describedby",i.id)},m(Za,pi,null),I(Za,"_l10n",null);let Qd=Za;var qr,In,nh,ah,rh,oh,lh,ai,_a,Hs,Ln,Ri,Xr,ep,Jd,Zd;const sp=class{constructor({container:t,isPinchingDisabled:e=null,isPinchingStopped:s=null,onPinchStart:i=null,onPinching:a=null,onPinchEnd:o=null,signal:l}){m(this,Xr),m(this,qr),m(this,In,!1),m(this,nh,null),m(this,ah),m(this,rh),m(this,oh),m(this,lh),m(this,ai,null),m(this,_a),m(this,Hs,null),m(this,Ln),m(this,Ri,null),p(this,qr,t),p(this,nh,s),p(this,ah,e),p(this,rh,i),p(this,oh,a),p(this,lh,o),p(this,Ln,new AbortController),p(this,_a,AbortSignal.any([l,n(this,Ln).signal])),t.addEventListener("touchstart",v(this,Xr,ep).bind(this),{passive:!1,signal:n(this,_a)})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return 35/Ls.pixelRatio}destroy(){var t,e;(t=n(this,Ln))==null||t.abort(),p(this,Ln,null),(e=n(this,ai))==null||e.abort(),p(this,ai,null)}};qr=new WeakMap,In=new WeakMap,nh=new WeakMap,ah=new WeakMap,rh=new WeakMap,oh=new WeakMap,lh=new WeakMap,ai=new WeakMap,_a=new WeakMap,Hs=new WeakMap,Ln=new WeakMap,Ri=new WeakMap,Xr=new WeakSet,ep=function(r){var t,e,s;if((t=n(this,ah))!=null&&t.call(this))return;if(r.touches.length===1){if(n(this,ai))return;const o=p(this,ai,new AbortController),l=AbortSignal.any([n(this,_a),o.signal]),h=n(this,qr),c={capture:!0,signal:l,passive:!1},d=u=>{var f;u.pointerType==="touch"&&((f=n(this,ai))==null||f.abort(),p(this,ai,null))};h.addEventListener("pointerdown",u=>{u.pointerType==="touch"&&(vt(u),d(u))},c),h.addEventListener("pointerup",d,c),h.addEventListener("pointercancel",d,c);return}if(!n(this,Ri)){p(this,Ri,new AbortController);const o=AbortSignal.any([n(this,_a),n(this,Ri).signal]),l=n(this,qr),h={signal:o,capture:!1,passive:!1};l.addEventListener("touchmove",v(this,Xr,Jd).bind(this),h);const c=v(this,Xr,Zd).bind(this);l.addEventListener("touchend",c,h),l.addEventListener("touchcancel",c,h),h.capture=!0,l.addEventListener("pointerdown",vt,h),l.addEventListener("pointermove",vt,h),l.addEventListener("pointercancel",vt,h),l.addEventListener("pointerup",vt,h),(e=n(this,rh))==null||e.call(this)}if(vt(r),r.touches.length!==2||(s=n(this,nh))!=null&&s.call(this)){p(this,Hs,null);return}let[i,a]=r.touches;i.identifier>a.identifier&&([i,a]=[a,i]),p(this,Hs,{touch0X:i.screenX,touch0Y:i.screenY,touch1X:a.screenX,touch1Y:a.screenY})},Jd=function(r){var t;if(!n(this,Hs)||r.touches.length!==2)return;vt(r);let[e,s]=r.touches;e.identifier>s.identifier&&([e,s]=[s,e]);const{screenX:i,screenY:a}=e,{screenX:o,screenY:l}=s,h=n(this,Hs),{touch0X:c,touch0Y:d,touch1X:u,touch1Y:f}=h,g=u-c,b=f-d,w=o-i,A=l-a,y=Math.hypot(w,A)||1,S=Math.hypot(g,b)||1;if(!n(this,In)&&Math.abs(S-y)<=sp.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(h.touch0X=i,h.touch0Y=a,h.touch1X=o,h.touch1Y=l,!n(this,In)){p(this,In,!0);return}const _=[(i+o)/2,(a+l)/2];(t=n(this,oh))==null||t.call(this,_,S,y)},Zd=function(r){var t;r.touches.length>=2||(n(this,Ri).abort(),p(this,Ri,null),(t=n(this,lh))==null||t.call(this),n(this,Hs)&&(vt(r),p(this,Hs,null),p(this,In,!1)))};let ip=sp;var Dn,ts,at,tr,Pi,sl,Nn,Vt,Fn,Qs,an,hh,ha,jt,il,On,fi,ps,er,sr,we,tn,nl,Sc,X,xc,ch,Ec,To,np,tu,Jh,Ro,kc,ap,rp,op,Mc,lp,Cc,hp,cp,dp,Tc,Yr;const ct=class Mt{constructor(t){m(this,X),m(this,Dn,null),m(this,ts,null),m(this,at,null),m(this,tr,!1),m(this,Pi,null),m(this,sl,""),m(this,Nn,!1),m(this,Vt,null),m(this,Fn,null),m(this,Qs,null),m(this,an,null),m(this,hh,""),m(this,ha,!1),m(this,jt,null),m(this,il,!1),m(this,On,!1),m(this,fi,!1),m(this,ps,null),m(this,er,0),m(this,sr,0),m(this,we,null),m(this,tn,null),I(this,"_isCopy",!1),I(this,"_editToolbar",null),I(this,"_initialOptions",Object.create(null)),I(this,"_initialData",null),I(this,"_isVisible",!0),I(this,"_uiManager",null),I(this,"_focusEventsAllowed",!0),m(this,nl,!1),m(this,Sc,Mt._zIndex++),this.parent=t.parent,this.id=t.id,this.width=this.height=null,this.pageIndex=t.parent.pageIndex,this.name=t.name,this.div=null,this._uiManager=t.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=t.isCentered,this._structTreeParentId=null;const{rotation:e,rawDims:{pageWidth:s,pageHeight:i,pageX:a,pageY:o}}=this.parent.viewport;this.rotation=e,this.pageRotation=(360+e-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[s,i],this.pageTranslation=[a,o];const[l,h]=this.parentDimensions;this.x=t.x/l,this.y=t.y/h,this.isAttachedToDOM=!1,this.deleted=!1}static get _resizerKeyboardManager(){const t=Mt.prototype._resizeWithKeyboard,e=wo.TRANSLATE_SMALL,s=wo.TRANSLATE_BIG;return j(this,"_resizerKeyboardManager",new So([[["ArrowLeft","mac+ArrowLeft"],t,{args:[-e,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t,{args:[-s,0]}],[["ArrowRight","mac+ArrowRight"],t,{args:[e,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t,{args:[s,0]}],[["ArrowUp","mac+ArrowUp"],t,{args:[0,-e]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t,{args:[0,-s]}],[["ArrowDown","mac+ArrowDown"],t,{args:[0,e]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t,{args:[0,s]}],[["Escape","mac+Escape"],Mt.prototype._stopResizingWithKeyboard]]))}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get isDrawer(){return!1}static get _defaultLineColor(){return j(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(t){const e=new gg({id:t.parent.getNextId(),parent:t.parent,uiManager:t._uiManager});e.annotationElementId=t.annotationElementId,e.deleted=!0,e._uiManager.addToAnnotationStorage(e)}static initialize(t,e){if(Mt._l10n??(Mt._l10n=t),Mt._l10nResizer||(Mt._l10nResizer=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"})),Mt._borderLineWidth!==-1)return;const s=getComputedStyle(document.documentElement);Mt._borderLineWidth=parseFloat(s.getPropertyValue("--outline-width"))||0}static updateDefaultParams(t,e){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(t){return!1}static paste(t,e){Z("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return n(this,nl)}set _isDraggable(t){var e;p(this,nl,t),(e=this.div)==null||e.classList.toggle("draggable",t)}get isEnterHandled(){return!0}center(){const[t,e]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*e/(t*2),this.y+=this.width*t/(e*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*e/(t*2),this.y-=this.width*t/(e*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(t){this._uiManager.addCommands(t)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=n(this,Sc)}setParent(t){t!==null?(this.pageIndex=t.pageIndex,this.pageDimensions=t.pageDimensions):v(this,X,Yr).call(this),this.parent=t}focusin(t){this._focusEventsAllowed&&(n(this,ha)?p(this,ha,!1):this.parent.setSelected(this))}focusout(t){var e;if(!this._focusEventsAllowed||!this.isAttachedToDOM)return;const s=t.relatedTarget;s!=null&&s.closest(`#${this.id}`)||(t.preventDefault(),(e=this.parent)!=null&&e.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(t,e,s,i){const[a,o]=this.parentDimensions;[s,i]=this.screenToPageTranslation(s,i),this.x=(t+s)/a,this.y=(e+i)/o,this.fixAndSetPosition()}_moveAfterPaste(t,e){const[s,i]=this.parentDimensions;this.setAt(t*s,e*i,this.width*s,this.height*i),this._onTranslated()}translate(t,e){v(this,X,xc).call(this,this.parentDimensions,t,e)}translateInPage(t,e){n(this,jt)||p(this,jt,[this.x,this.y,this.width,this.height]),v(this,X,xc).call(this,this.pageDimensions,t,e),this.div.scrollIntoView({block:"nearest"})}translationDone(){this._onTranslated(this.x,this.y)}drag(t,e){n(this,jt)||p(this,jt,[this.x,this.y,this.width,this.height]);const{div:s,parentDimensions:[i,a]}=this;if(this.x+=t/i,this.y+=e/a,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:u,y:f}=this.div.getBoundingClientRect();this.parent.findNewParent(this,u,f)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:o,y:l}=this;const[h,c]=this.getBaseTranslation();o+=h,l+=c;const{style:d}=s;d.left=`${(100*o).toFixed(2)}%`,d.top=`${(100*l).toFixed(2)}%`,this._onTranslating(o,l),s.scrollIntoView({block:"nearest"})}_onTranslating(t,e){}_onTranslated(t,e){}get _hasBeenMoved(){return!!n(this,jt)&&(n(this,jt)[0]!==this.x||n(this,jt)[1]!==this.y)}get _hasBeenResized(){return!!n(this,jt)&&(n(this,jt)[2]!==this.width||n(this,jt)[3]!==this.height)}getBaseTranslation(){const[t,e]=this.parentDimensions,{_borderLineWidth:s}=Mt,i=s/t,a=s/e;switch(this.rotation){case 90:return[-i,a];case 180:return[i,a];case 270:return[i,-a];default:return[-i,-a]}}get _mustFixPosition(){return!0}fixAndSetPosition(t=this.rotation){const{div:{style:e},pageDimensions:[s,i]}=this;let{x:a,y:o,width:l,height:h}=this;if(l*=s,h*=i,a*=s,o*=i,this._mustFixPosition)switch(t){case 0:a=Jt(a,0,s-l),o=Jt(o,0,i-h);break;case 90:a=Jt(a,0,s-h),o=Jt(o,l,i);break;case 180:a=Jt(a,l,s),o=Jt(o,h,i);break;case 270:a=Jt(a,h,s),o=Jt(o,0,i-l);break}this.x=a/=s,this.y=o/=i;const[c,d]=this.getBaseTranslation();a+=c,o+=d,e.left=`${(100*a).toFixed(2)}%`,e.top=`${(100*o).toFixed(2)}%`,this.moveInDOM()}screenToPageTranslation(t,e){var s;return v(s=Mt,ch,Ec).call(s,t,e,this.parentRotation)}pageTranslationToScreen(t,e){var s;return v(s=Mt,ch,Ec).call(s,t,e,360-this.parentRotation)}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:t,pageDimensions:[e,s]}=this;return[e*t,s*t]}setDims(t,e){const[s,i]=this.parentDimensions,{style:a}=this.div;a.width=`${(100*t/s).toFixed(2)}%`,n(this,Nn)||(a.height=`${(100*e/i).toFixed(2)}%`)}fixDims(){const{style:t}=this.div,{height:e,width:s}=t,i=s.endsWith("%"),a=!n(this,Nn)&&e.endsWith("%");if(i&&a)return;const[o,l]=this.parentDimensions;i||(t.width=`${(100*parseFloat(s)/o).toFixed(2)}%`),!n(this,Nn)&&!a&&(t.height=`${(100*parseFloat(e)/l).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}_onResized(){}static _round(t){return Math.round(t*1e4)/1e4}_onResizing(){}altTextFinish(){var t;(t=n(this,at))==null||t.finish()}async addEditToolbar(){return this._editToolbar||n(this,On)?this._editToolbar:(this._editToolbar=new hg(this),this.div.append(this._editToolbar.render()),n(this,at)&&await this._editToolbar.addAltText(n(this,at)),this._editToolbar)}removeEditToolbar(){var t;this._editToolbar&&(this._editToolbar.remove(),this._editToolbar=null,(t=n(this,at))==null||t.destroy())}addContainer(t){var e;const s=(e=this._editToolbar)==null?void 0:e.div;s?s.before(t):this.div.append(t)}getClientDimensions(){return this.div.getBoundingClientRect()}async addAltTextButton(){n(this,at)||(Qd.initialize(Mt._l10n),p(this,at,new Qd(this)),n(this,Dn)&&(n(this,at).data=n(this,Dn),p(this,Dn,null)),await this.addEditToolbar())}get altTextData(){var t;return(t=n(this,at))==null?void 0:t.data}set altTextData(t){n(this,at)&&(n(this,at).data=t)}get guessedAltText(){var t;return(t=n(this,at))==null?void 0:t.guessedText}async setGuessedAltText(t){var e;await((e=n(this,at))==null?void 0:e.setGuessedText(t))}serializeAltText(t){var e;return(e=n(this,at))==null?void 0:e.serialize(t)}hasAltText(){return!!n(this,at)&&!n(this,at).isEmpty()}hasAltTextData(){var t;return((t=n(this,at))==null?void 0:t.hasData())??!1}render(){var t;const e=this.div=document.createElement("div");e.setAttribute("data-editor-rotation",(360-this.rotation)%360),e.className=this.name,e.setAttribute("id",this.id),e.tabIndex=n(this,tr)?-1:0,e.setAttribute("role","application"),this.defaultL10nId&&e.setAttribute("data-l10n-id",this.defaultL10nId),this._isVisible||e.classList.add("hidden"),this.setInForeground(),v(this,X,Cc).call(this);const[s,i]=this.parentDimensions;this.parentRotation%180!==0&&(e.style.maxWidth=`${(100*i/s).toFixed(2)}%`,e.style.maxHeight=`${(100*s/i).toFixed(2)}%`);const[a,o]=this.getInitialTranslation();return this.translate(a,o),Nd(this,e,["keydown","pointerdown"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(n(this,tn)||p(this,tn,new ip({container:e,isPinchingDisabled:()=>!this.isSelected,onPinchStart:v(this,X,ap).bind(this),onPinching:v(this,X,rp).bind(this),onPinchEnd:v(this,X,op).bind(this),signal:this._uiManager._signal}))),(t=this._uiManager._editorUndoBar)==null||t.hide(),e}pointerdown(t){const{isMac:e}=Bt.platform;if(t.button!==0||t.ctrlKey&&e){t.preventDefault();return}if(p(this,ha,!0),this._isDraggable){v(this,X,lp).call(this,t);return}v(this,X,Mc).call(this,t)}get isSelected(){return this._uiManager.isSelected(this)}_onStartDragging(){}_onStopDragging(){}moveInDOM(){n(this,ps)&&clearTimeout(n(this,ps)),p(this,ps,setTimeout(()=>{var t;p(this,ps,null),(t=this.parent)==null||t.moveEditorInDOM(this)},0))}_setParentAndPosition(t,e,s){t.changeParent(this),this.x=e,this.y=s,this.fixAndSetPosition(),this._onTranslated()}getRect(t,e,s=this.rotation){const i=this.parentScale,[a,o]=this.pageDimensions,[l,h]=this.pageTranslation,c=t/i,d=e/i,u=this.x*a,f=this.y*o,g=this.width*a,b=this.height*o;switch(s){case 0:return[u+c+l,o-f-d-b+h,u+c+g+l,o-f-d+h];case 90:return[u+d+l,o-f+c+h,u+d+b+l,o-f+c+g+h];case 180:return[u-c-g+l,o-f+d+h,u-c+l,o-f+d+b+h];case 270:return[u-d-b+l,o-f-c-g+h,u-d+l,o-f-c+h];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(t,e){const[s,i,a,o]=t,l=a-s,h=o-i;switch(this.rotation){case 0:return[s,e-o,l,h];case 90:return[s,e-i,h,l];case 180:return[a,e-i,l,h];case 270:return[a,e-o,h,l];default:throw new Error("Invalid rotation")}}onceAdded(t){}isEmpty(){return!1}enableEditMode(){p(this,On,!0)}disableEditMode(){p(this,On,!1)}isInEditMode(){return n(this,On)}shouldGetKeyboardEvents(){return n(this,fi)}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){const{top:t,left:e,bottom:s,right:i}=this.getClientDimensions(),{innerHeight:a,innerWidth:o}=window;return e<o&&i>0&&t<a&&s>0}rebuild(){v(this,X,Cc).call(this)}rotate(t){}resize(){}serializeDeleted(){var t;return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:((t=this._initialData)==null?void 0:t.popupRef)||""}}serialize(t=!1,e=null){Z("An editor must be serializable")}static async deserialize(t,e,s){const i=new this.prototype.constructor({parent:e,id:e.getNextId(),uiManager:s});i.rotation=t.rotation,p(i,Dn,t.accessibilityData),i._isCopy=t.isCopy||!1;const[a,o]=i.pageDimensions,[l,h,c,d]=i.getRectInCurrentCoords(t.rect,o);return i.x=l/a,i.y=h/o,i.width=c/a,i.height=d/o,i}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){var t,e;if((t=n(this,an))==null||t.abort(),p(this,an,null),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),n(this,ps)&&(clearTimeout(n(this,ps)),p(this,ps,null)),v(this,X,Yr).call(this),this.removeEditToolbar(),n(this,we)){for(const s of n(this,we).values())clearTimeout(s);p(this,we,null)}this.parent=null,(e=n(this,tn))==null||e.destroy(),p(this,tn,null)}get isResizable(){return!1}makeResizable(){this.isResizable&&(v(this,X,np).call(this),n(this,Vt).classList.remove("hidden"))}get toolbarPosition(){return null}keydown(t){if(!this.isResizable||t.target!==this.div||t.key!=="Enter")return;this._uiManager.setSelected(this),p(this,Qs,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const e=n(this,Vt).children;if(!n(this,ts)){p(this,ts,Array.from(e));const o=v(this,X,hp).bind(this),l=v(this,X,cp).bind(this),h=this._uiManager._signal;for(const c of n(this,ts)){const d=c.getAttribute("data-resizer-name");c.setAttribute("role","spinbutton"),c.addEventListener("keydown",o,{signal:h}),c.addEventListener("blur",l,{signal:h}),c.addEventListener("focus",v(this,X,dp).bind(this,d),{signal:h}),c.setAttribute("data-l10n-id",Mt._l10nResizer[d])}}const s=n(this,ts)[0];let i=0;for(const o of e){if(o===s)break;i++}const a=(360-this.rotation+this.parentRotation)%360/90*(n(this,ts).length/4);if(a!==i){if(a<i)for(let l=0;l<i-a;l++)n(this,Vt).append(n(this,Vt).firstChild);else if(a>i)for(let l=0;l<a-i;l++)n(this,Vt).firstChild.before(n(this,Vt).lastChild);let o=0;for(const l of e){const h=n(this,ts)[o++].getAttribute("data-resizer-name");l.setAttribute("data-l10n-id",Mt._l10nResizer[h])}}v(this,X,Tc).call(this,0),p(this,fi,!0),n(this,Vt).firstChild.focus({focusVisible:!0}),t.preventDefault(),t.stopImmediatePropagation()}_resizeWithKeyboard(t,e){n(this,fi)&&v(this,X,kc).call(this,n(this,hh),{deltaX:t,deltaY:e,fromKeyboard:!0})}_stopResizingWithKeyboard(){v(this,X,Yr).call(this),this.div.focus()}select(){var t,e,s;if(this.makeResizable(),(t=this.div)==null||t.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{var i,a;(i=this.div)!=null&&i.classList.contains("selectedEditor")&&((a=this._editToolbar)==null||a.show())});return}(e=this._editToolbar)==null||e.show(),(s=n(this,at))==null||s.toggleAltTextBadge(!1)}unselect(){var t,e,s,i,a;(t=n(this,Vt))==null||t.classList.add("hidden"),(e=this.div)==null||e.classList.remove("selectedEditor"),(s=this.div)!=null&&s.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),(i=this._editToolbar)==null||i.hide(),(a=n(this,at))==null||a.toggleAltTextBadge(!0)}updateParams(t,e){}disableEditing(){}enableEditing(){}enterInEditMode(){}getElementForAltText(){return this.div}get contentDiv(){return this.div}get isEditing(){return n(this,il)}set isEditing(t){p(this,il,t),this.parent&&(t?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(t,e){p(this,Nn,!0);const s=t/e,{style:i}=this.div;i.aspectRatio=s,i.height="auto"}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(t,e=!1){if(e){n(this,we)||p(this,we,new Map);const{action:s}=t;let i=n(this,we).get(s);i&&clearTimeout(i),i=setTimeout(()=>{this._reportTelemetry(t),n(this,we).delete(s),n(this,we).size===0&&p(this,we,null)},Mt._telemetryTimeout),n(this,we).set(s,i);return}t.type||(t.type=this.editorType),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:t}})}show(t=this._isVisible){this.div.classList.toggle("hidden",!t),this._isVisible=t}enable(){this.div&&(this.div.tabIndex=0),p(this,tr,!1)}disable(){this.div&&(this.div.tabIndex=-1),p(this,tr,!0)}renderAnnotationElement(t){let e=t.container.querySelector(".annotationContent");if(!e)e=document.createElement("div"),e.classList.add("annotationContent",this.editorType),t.container.prepend(e);else if(e.nodeName==="CANVAS"){const s=e;e=document.createElement("div"),e.classList.add("annotationContent",this.editorType),s.before(e)}return e}resetAnnotationElement(t){const{firstChild:e}=t.container;(e==null?void 0:e.nodeName)==="DIV"&&e.classList.contains("annotationContent")&&e.remove()}};Dn=new WeakMap,ts=new WeakMap,at=new WeakMap,tr=new WeakMap,Pi=new WeakMap,sl=new WeakMap,Nn=new WeakMap,Vt=new WeakMap,Fn=new WeakMap,Qs=new WeakMap,an=new WeakMap,hh=new WeakMap,ha=new WeakMap,jt=new WeakMap,il=new WeakMap,On=new WeakMap,fi=new WeakMap,ps=new WeakMap,er=new WeakMap,sr=new WeakMap,we=new WeakMap,tn=new WeakMap,nl=new WeakMap,Sc=new WeakMap,X=new WeakSet,xc=function([r,t],e,s){[e,s]=this.screenToPageTranslation(e,s),this.x+=e/r,this.y+=s/t,this._onTranslating(this.x,this.y),this.fixAndSetPosition()},ch=new WeakSet,Ec=function(r,t,e){switch(e){case 90:return[t,-r];case 180:return[-r,-t];case 270:return[-t,r];default:return[r,t]}},To=function(r){switch(r){case 90:{const[t,e]=this.pageDimensions;return[0,-t/e,e/t,0]}case 180:return[-1,0,0,-1];case 270:{const[t,e]=this.pageDimensions;return[0,t/e,-e/t,0]}default:return[1,0,0,1]}},np=function(){if(n(this,Vt))return;p(this,Vt,document.createElement("div")),n(this,Vt).classList.add("resizers");const r=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],t=this._uiManager._signal;for(const e of r){const s=document.createElement("div");n(this,Vt).append(s),s.classList.add("resizer",e),s.setAttribute("data-resizer-name",e),s.addEventListener("pointerdown",v(this,X,tu).bind(this,e),{signal:t}),s.addEventListener("contextmenu",$e,{signal:t}),s.tabIndex=-1}this.div.prepend(n(this,Vt))},tu=function(r,t){var e;t.preventDefault();const{isMac:s}=Bt.platform;if(t.button!==0||t.ctrlKey&&s)return;(e=n(this,at))==null||e.toggle(!1);const i=this._isDraggable;this._isDraggable=!1,p(this,Fn,[t.screenX,t.screenY]);const a=new AbortController,o=this._uiManager.combinedSignal(a);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",v(this,X,kc).bind(this,r),{passive:!0,capture:!0,signal:o}),window.addEventListener("touchmove",vt,{passive:!1,signal:o}),window.addEventListener("contextmenu",$e,{signal:o}),p(this,Qs,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const l=this.parent.div.style.cursor,h=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(t.target).cursor;const c=()=>{var d;a.abort(),this.parent.togglePointerEvents(!0),(d=n(this,at))==null||d.toggle(!0),this._isDraggable=i,this.parent.div.style.cursor=l,this.div.style.cursor=h,v(this,X,Ro).call(this)};window.addEventListener("pointerup",c,{signal:o}),window.addEventListener("blur",c,{signal:o})},Jh=function(r,t,e,s){this.width=e,this.height=s,this.x=r,this.y=t;const[i,a]=this.parentDimensions;this.setDims(i*e,a*s),this.fixAndSetPosition(),this._onResized()},Ro=function(){if(!n(this,Qs))return;const{savedX:r,savedY:t,savedWidth:e,savedHeight:s}=n(this,Qs);p(this,Qs,null);const i=this.x,a=this.y,o=this.width,l=this.height;i===r&&a===t&&o===e&&l===s||this.addCommands({cmd:v(this,X,Jh).bind(this,i,a,o,l),undo:v(this,X,Jh).bind(this,r,t,e,s),mustExec:!0})},kc=function(r,t){const[e,s]=this.parentDimensions,i=this.x,a=this.y,o=this.width,l=this.height,h=ct.MIN_SIZE/e,c=ct.MIN_SIZE/s,d=v(this,X,To).call(this,this.rotation),u=(B,P)=>[d[0]*B+d[2]*P,d[1]*B+d[3]*P],f=v(this,X,To).call(this,360-this.rotation),g=(B,P)=>[f[0]*B+f[2]*P,f[1]*B+f[3]*P];let b,w,A=!1,y=!1;switch(r){case"topLeft":A=!0,b=(B,P)=>[0,0],w=(B,P)=>[B,P];break;case"topMiddle":b=(B,P)=>[B/2,0],w=(B,P)=>[B/2,P];break;case"topRight":A=!0,b=(B,P)=>[B,0],w=(B,P)=>[0,P];break;case"middleRight":y=!0,b=(B,P)=>[B,P/2],w=(B,P)=>[0,P/2];break;case"bottomRight":A=!0,b=(B,P)=>[B,P],w=(B,P)=>[0,0];break;case"bottomMiddle":b=(B,P)=>[B/2,P],w=(B,P)=>[B/2,0];break;case"bottomLeft":A=!0,b=(B,P)=>[0,P],w=(B,P)=>[B,0];break;case"middleLeft":y=!0,b=(B,P)=>[0,P/2],w=(B,P)=>[B,P/2];break}const S=b(o,l),_=w(o,l);let x=u(..._);const k=ct._round(i+x[0]),E=ct._round(a+x[1]);let M=1,C=1,T,N;if(t.fromKeyboard)({deltaX:T,deltaY:N}=t);else{const{screenX:B,screenY:P}=t,[xt,le]=n(this,Fn);[T,N]=this.screenToPageTranslation(B-xt,P-le),n(this,Fn)[0]=B,n(this,Fn)[1]=P}if([T,N]=g(T/e,N/s),A){const B=Math.hypot(o,l);M=C=Math.max(Math.min(Math.hypot(_[0]-S[0]-T,_[1]-S[1]-N)/B,1/o,1/l),h/o,c/l)}else y?M=Jt(Math.abs(_[0]-S[0]-T),h,1)/o:C=Jt(Math.abs(_[1]-S[1]-N),c,1)/l;const W=ct._round(o*M),Y=ct._round(l*C);x=u(...w(W,Y));const q=k-x[0],tt=E-x[1];n(this,jt)||p(this,jt,[this.x,this.y,this.width,this.height]),this.width=W,this.height=Y,this.x=q,this.y=tt,this.setDims(e*W,s*Y),this.fixAndSetPosition(),this._onResizing()},ap=function(){var r;p(this,Qs,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height}),(r=n(this,at))==null||r.toggle(!1),this.parent.togglePointerEvents(!1)},rp=function(r,t,e){let s=.7*(e/t)+1-.7;if(s===1)return;const i=v(this,X,To).call(this,this.rotation),a=(x,k)=>[i[0]*x+i[2]*k,i[1]*x+i[3]*k],[o,l]=this.parentDimensions,h=this.x,c=this.y,d=this.width,u=this.height,f=ct.MIN_SIZE/o,g=ct.MIN_SIZE/l;s=Math.max(Math.min(s,1/d,1/u),f/d,g/u);const b=ct._round(d*s),w=ct._round(u*s);if(b===d&&w===u)return;n(this,jt)||p(this,jt,[h,c,d,u]);const A=a(d/2,u/2),y=ct._round(h+A[0]),S=ct._round(c+A[1]),_=a(b/2,w/2);this.x=y-_[0],this.y=S-_[1],this.width=b,this.height=w,this.setDims(o*b,l*w),this.fixAndSetPosition(),this._onResizing()},op=function(){var r;(r=n(this,at))==null||r.toggle(!0),this.parent.togglePointerEvents(!0),v(this,X,Ro).call(this)},Mc=function(r){const{isMac:t}=Bt.platform;r.ctrlKey&&!t||r.shiftKey||r.metaKey&&t?this.parent.toggleSelected(this):this.parent.setSelected(this)},lp=function(r){const{isSelected:t}=this;this._uiManager.setUpDragSession();let e=!1;const s=new AbortController,i=this._uiManager.combinedSignal(s),a={capture:!0,passive:!1,signal:i},o=h=>{s.abort(),p(this,Pi,null),p(this,ha,!1),this._uiManager.endDragSession()||v(this,X,Mc).call(this,h),e&&this._onStopDragging()};t&&(p(this,er,r.clientX),p(this,sr,r.clientY),p(this,Pi,r.pointerId),p(this,sl,r.pointerType),window.addEventListener("pointermove",h=>{e||(e=!0,this._onStartDragging());const{clientX:c,clientY:d,pointerId:u}=h;if(u!==n(this,Pi)){vt(h);return}const[f,g]=this.screenToPageTranslation(c-n(this,er),d-n(this,sr));p(this,er,c),p(this,sr,d),this._uiManager.dragSelectedEditors(f,g)},a),window.addEventListener("touchmove",vt,a),window.addEventListener("pointerdown",h=>{h.pointerType===n(this,sl)&&(n(this,tn)||h.isPrimary)&&o(h),vt(h)},a));const l=h=>{if(!n(this,Pi)||n(this,Pi)===h.pointerId){o(h);return}vt(h)};window.addEventListener("pointerup",l,{signal:i}),window.addEventListener("blur",l,{signal:i})},Cc=function(){if(n(this,an)||!this.div)return;p(this,an,new AbortController);const r=this._uiManager.combinedSignal(n(this,an));this.div.addEventListener("focusin",this.focusin.bind(this),{signal:r}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:r})},hp=function(r){ct._resizerKeyboardManager.exec(this,r)},cp=function(r){var t;n(this,fi)&&((t=r.relatedTarget)==null?void 0:t.parentNode)!==n(this,Vt)&&v(this,X,Yr).call(this)},dp=function(r){p(this,hh,n(this,fi)?r:"")},Tc=function(r){if(n(this,ts))for(const t of n(this,ts))t.tabIndex=r},Yr=function(){p(this,fi,!1),v(this,X,Tc).call(this,-1),v(this,X,Ro).call(this)},m(ct,ch),I(ct,"_l10n",null),I(ct,"_l10nResizer",null),I(ct,"_borderLineWidth",-1),I(ct,"_colorManager",new fg),I(ct,"_zIndex",1),I(ct,"_telemetryTimeout",1e3);let ht=ct;class gg extends ht{constructor(t){super(t),this.annotationElementId=t.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}const eu=3285377520,me=4294901760,ze=65535;class up{constructor(t){this.h1=t?t&4294967295:eu,this.h2=t?t&4294967295:eu}update(t){let e,s;if(typeof t=="string"){e=new Uint8Array(t.length*2),s=0;for(let w=0,A=t.length;w<A;w++){const y=t.charCodeAt(w);y<=255?e[s++]=y:(e[s++]=y>>>8,e[s++]=y&255)}}else if(ArrayBuffer.isView(t))e=t.slice(),s=e.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const i=s>>2,a=s-i*4,o=new Uint32Array(e.buffer,0,i);let l=0,h=0,c=this.h1,d=this.h2;const u=3432918353,f=461845907,g=u&ze,b=f&ze;for(let w=0;w<i;w++)w&1?(l=o[w],l=l*u&me|l*g&ze,l=l<<15|l>>>17,l=l*f&me|l*b&ze,c^=l,c=c<<13|c>>>19,c=c*5+3864292196):(h=o[w],h=h*u&me|h*g&ze,h=h<<15|h>>>17,h=h*f&me|h*b&ze,d^=h,d=d<<13|d>>>19,d=d*5+3864292196);switch(l=0,a){case 3:l^=e[i*4+2]<<16;case 2:l^=e[i*4+1]<<8;case 1:l^=e[i*4],l=l*u&me|l*g&ze,l=l<<15|l>>>17,l=l*f&me|l*b&ze,i&1?c^=l:d^=l}this.h1=c,this.h2=d}hexdigest(){let t=this.h1,e=this.h2;return t^=e>>>1,t=t*3981806797&me|t*36045&ze,e=e*4283543511&me|((e<<16|t>>>16)*2950163797&me)>>>16,t^=e>>>1,t=t*444984403&me|t*60499&ze,e=e*3301882366&me|((e<<16|t>>>16)*3120437893&me)>>>16,t^=e>>>1,(t>>>0).toString(16).padStart(8,"0")+(e>>>0).toString(16).padStart(8,"0")}}const Rc=Object.freeze({map:null,hash:"",transfer:void 0});var Sa,Wn,Ct,Pc,pp;class Fd{constructor(){m(this,Pc),m(this,Sa,!1),m(this,Wn,null),m(this,Ct,new Map),this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(t,e){const s=n(this,Ct).get(t);return s===void 0?e:Object.assign(e,s)}getRawValue(t){return n(this,Ct).get(t)}remove(t){if(n(this,Ct).delete(t),n(this,Ct).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const e of n(this,Ct).values())if(e instanceof ht)return;this.onAnnotationEditor(null)}}setValue(t,e){const s=n(this,Ct).get(t);let i=!1;if(s!==void 0)for(const[a,o]of Object.entries(e))s[a]!==o&&(i=!0,s[a]=o);else i=!0,n(this,Ct).set(t,e);i&&v(this,Pc,pp).call(this),e instanceof ht&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(e.constructor._type)}has(t){return n(this,Ct).has(t)}getAll(){return n(this,Ct).size>0?Cd(n(this,Ct)):null}setAll(t){for(const[e,s]of Object.entries(t))this.setValue(e,s)}get size(){return n(this,Ct).size}resetModified(){n(this,Sa)&&(p(this,Sa,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new fp(this)}get serializable(){if(n(this,Ct).size===0)return Rc;const t=new Map,e=new up,s=[],i=Object.create(null);let a=!1;for(const[o,l]of n(this,Ct)){const h=l instanceof ht?l.serialize(!1,i):l;h&&(t.set(o,h),e.update(`${o}:${JSON.stringify(h)}`),a||(a=!!h.bitmap))}if(a)for(const o of t.values())o.bitmap&&s.push(o.bitmap);return t.size>0?{map:t,hash:e.hexdigest(),transfer:s}:Rc}get editorStats(){let t=null;const e=new Map;for(const s of n(this,Ct).values()){if(!(s instanceof ht))continue;const i=s.telemetryFinalData;if(!i)continue;const{type:a}=i;e.has(a)||e.set(a,Object.getPrototypeOf(s).constructor),t||(t=Object.create(null));const o=t[a]||(t[a]=new Map);for(const[l,h]of Object.entries(i)){if(l==="type")continue;let c=o.get(l);c||(c=new Map,o.set(l,c));const d=c.get(h)??0;c.set(h,d+1)}}for(const[s,i]of e)t[s]=i.computeTelemetryFinalData(t[s]);return t}resetModifiedIds(){p(this,Wn,null)}get modifiedIds(){if(n(this,Wn))return n(this,Wn);const t=[];for(const e of n(this,Ct).values())!(e instanceof ht)||!e.annotationElementId||!e.serialize()||t.push(e.annotationElementId);return p(this,Wn,{ids:new Set(t),hash:t.join(",")})}}Sa=new WeakMap,Wn=new WeakMap,Ct=new WeakMap,Pc=new WeakSet,pp=function(){n(this,Sa)||(p(this,Sa,!0),typeof this.onSetModified=="function"&&this.onSetModified())};var al;class fp extends Fd{constructor(t){super(),m(this,al);const{map:e,hash:s,transfer:i}=t.serializable,a=structuredClone(e,i?{transfer:i}:null);p(this,al,{map:a,hash:s,transfer:i})}get print(){Z("Should not call PrintAnnotationStorage.print")}get serializable(){return n(this,al)}get modifiedIds(){return j(this,"modifiedIds",{ids:new Set,hash:""})}}al=new WeakMap;var ir;class mg{constructor({ownerDocument:t=globalThis.document,styleElement:e=null}){m(this,ir,new Set),this._document=t,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(t){this.nativeFontFaces.add(t),this._document.fonts.add(t)}removeNativeFontFace(t){this.nativeFontFaces.delete(t),this._document.fonts.delete(t)}insertRule(t){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const e=this.styleElement.sheet;e.insertRule(t,e.cssRules.length)}clear(){for(const t of this.nativeFontFaces)this._document.fonts.delete(t);this.nativeFontFaces.clear(),n(this,ir).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:t,disableFontFace:e,_inspectFont:s}){if(!(!t||n(this,ir).has(t.loadedName))){if(wt(!e,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:i,src:a,style:o}=t,l=new FontFace(i,a,o);this.addNativeFontFace(l);try{await l.load(),n(this,ir).add(i),s==null||s(t)}catch{z(`Cannot load system font: ${t.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(l)}return}Z("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(t){if(t.attached||t.missingFile&&!t.systemFontInfo)return;if(t.attached=!0,t.systemFontInfo){await this.loadSystemFont(t);return}if(this.isFontLoadingAPISupported){const s=t.createNativeFontFace();if(s){this.addNativeFontFace(s);try{await s.loaded}catch(i){throw z(`Failed to load font '${s.family}': '${i}'.`),t.disableFontFace=!0,i}}return}const e=t.createFontFaceRule();if(e){if(this.insertRule(e),this.isSyncFontLoadingSupported)return;await new Promise(s=>{const i=this._queueLoadingCallback(s);this._prepareFontLoadEvent(t,i)})}}get isFontLoadingAPISupported(){var t;const e=!!((t=this._document)!=null&&t.fonts);return j(this,"isFontLoadingAPISupported",e)}get isSyncFontLoadingSupported(){return j(this,"isSyncFontLoadingSupported",Nt||Bt.platform.isFirefox)}_queueLoadingCallback(t){function e(){for(wt(!i.done,"completeRequest() cannot be called twice."),i.done=!0;s.length>0&&s[0].done;){const a=s.shift();setTimeout(a.callback,0)}}const{loadingRequests:s}=this,i={done:!1,complete:e,callback:t};return s.push(i),i}get _loadTestFont(){const t=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return j(this,"_loadTestFont",t)}_prepareFontLoadEvent(t,e){function s(_,x){return _.charCodeAt(x)<<24|_.charCodeAt(x+1)<<16|_.charCodeAt(x+2)<<8|_.charCodeAt(x+3)&255}function i(_,x,k,E){const M=_.substring(0,x),C=_.substring(x+k);return M+E+C}let a,o;const l=this._document.createElement("canvas");l.width=1,l.height=1;const h=l.getContext("2d");let c=0;function d(_,x){if(++c>30){z("Load test font never loaded."),x();return}if(h.font="30px "+_,h.fillText(".",0,20),h.getImageData(0,0,1,1).data[3]>0){x();return}setTimeout(d.bind(null,_,x))}const u=`lt${Date.now()}${this.loadTestFontId++}`;let f=this._loadTestFont;f=i(f,976,u.length,u);const g=16,b=1482184792;let w=s(f,g);for(a=0,o=u.length-3;a<o;a+=4)w=w-b+s(u,a)|0;a<u.length&&(w=w-b+s(u+"XXX",a)|0),f=i(f,g,4,Jf(w));const A=`url(data:font/opentype;base64,${btoa(f)});`,y=`@font-face {font-family:"${u}";src:${A}}`;this.insertRule(y);const S=this._document.createElement("div");S.style.visibility="hidden",S.style.width=S.style.height="10px",S.style.position="absolute",S.style.top=S.style.left="0px";for(const _ of[t.loadedName,u]){const x=this._document.createElement("span");x.textContent="Hi",x.style.fontFamily=_,S.append(x)}this._document.body.append(S),d(u,()=>{S.remove(),e.complete()})}}ir=new WeakMap;class vg{constructor(t,e=null){this.compiledGlyphs=Object.create(null);for(const s in t)this[s]=t[s];this._inspectFont=e}createNativeFontFace(){var t;if(!this.data||this.disableFontFace)return null;let e;if(!this.cssFontInfo)e=new FontFace(this.loadedName,this.data,{});else{const s={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(s.style=`oblique ${this.cssFontInfo.italicAngle}deg`),e=new FontFace(this.cssFontInfo.fontFamily,this.data,s)}return(t=this._inspectFont)==null||t.call(this,this),e}createFontFaceRule(){var t;if(!this.data||this.disableFontFace)return null;const e=`url(data:${this.mimetype};base64,${Wu(this.data)});`;let s;if(!this.cssFontInfo)s=`@font-face {font-family:"${this.loadedName}";src:${e}}`;else{let i=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(i+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),s=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${i}src:${e}}`}return(t=this._inspectFont)==null||t.call(this,this,e),s}getPathGenerator(t,e){if(this.compiledGlyphs[e]!==void 0)return this.compiledGlyphs[e];const s=this.loadedName+"_path_"+e;let i;try{i=t.get(s)}catch(o){z(`getPathGenerator - ignoring character: "${o}".`)}const a=new Path2D(i||"");return this.fontExtraProperties||t.delete(s),this.compiledGlyphs[e]=a}}const Po={DATA:1,ERROR:2},gt={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function su(){}function ne(r){if(r instanceof bi||r instanceof hc||r instanceof zd||r instanceof th||r instanceof Yh)return r;switch(r instanceof Error||typeof r=="object"&&r!==null||Z('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),r.name){case"AbortException":return new bi(r.message);case"InvalidPDFException":return new hc(r.message);case"PasswordException":return new zd(r.message,r.code);case"ResponseException":return new th(r.message,r.status,r.missing);case"UnknownErrorException":return new Yh(r.message,r.details)}return new Yh(r.message,r.toString())}var nr,Js,gp,iu,nu,Io;class ar{constructor(t,e,s){m(this,Js),m(this,nr,new AbortController),this.sourceName=t,this.targetName=e,this.comObj=s,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),s.addEventListener("message",v(this,Js,gp).bind(this),{signal:n(this,nr).signal})}on(t,e){const s=this.actionHandler;if(s[t])throw new Error(`There is already an actionName called "${t}"`);s[t]=e}send(t,e,s){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,data:e},s)}sendWithPromise(t,e,s){const i=this.callbackId++,a=Promise.withResolvers();this.callbackCapabilities[i]=a;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,callbackId:i,data:e},s)}catch(o){a.reject(o)}return a.promise}sendWithStream(t,e,s,i){const a=this.streamId++,o=this.sourceName,l=this.targetName,h=this.comObj;return new ReadableStream({start:c=>{const d=Promise.withResolvers();return this.streamControllers[a]={controller:c,startCall:d,pullCall:null,cancelCall:null,isClosed:!1},h.postMessage({sourceName:o,targetName:l,action:t,streamId:a,data:e,desiredSize:c.desiredSize},i),d.promise},pull:c=>{const d=Promise.withResolvers();return this.streamControllers[a].pullCall=d,h.postMessage({sourceName:o,targetName:l,stream:gt.PULL,streamId:a,desiredSize:c.desiredSize}),d.promise},cancel:c=>{wt(c instanceof Error,"cancel must have a valid reason");const d=Promise.withResolvers();return this.streamControllers[a].cancelCall=d,this.streamControllers[a].isClosed=!0,h.postMessage({sourceName:o,targetName:l,stream:gt.CANCEL,streamId:a,reason:ne(c)}),d.promise}},s)}destroy(){var t;(t=n(this,nr))==null||t.abort(),p(this,nr,null)}}nr=new WeakMap,Js=new WeakSet,gp=function({data:r}){if(r.targetName!==this.sourceName)return;if(r.stream){v(this,Js,nu).call(this,r);return}if(r.callback){const e=r.callbackId,s=this.callbackCapabilities[e];if(!s)throw new Error(`Cannot resolve callback ${e}`);if(delete this.callbackCapabilities[e],r.callback===Po.DATA)s.resolve(r.data);else if(r.callback===Po.ERROR)s.reject(ne(r.reason));else throw new Error("Unexpected callback case");return}const t=this.actionHandler[r.action];if(!t)throw new Error(`Unknown action from worker: ${r.action}`);if(r.callbackId){const e=this.sourceName,s=r.sourceName,i=this.comObj;Promise.try(t,r.data).then(function(a){i.postMessage({sourceName:e,targetName:s,callback:Po.DATA,callbackId:r.callbackId,data:a})},function(a){i.postMessage({sourceName:e,targetName:s,callback:Po.ERROR,callbackId:r.callbackId,reason:ne(a)})});return}if(r.streamId){v(this,Js,iu).call(this,r);return}t(r.data)},iu=function(r){const t=r.streamId,e=this.sourceName,s=r.sourceName,i=this.comObj,a=this,o=this.actionHandler[r.action],l={enqueue(h,c=1,d){if(this.isCancelled)return;const u=this.desiredSize;this.desiredSize-=c,u>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),i.postMessage({sourceName:e,targetName:s,stream:gt.ENQUEUE,streamId:t,chunk:h},d)},close(){this.isCancelled||(this.isCancelled=!0,i.postMessage({sourceName:e,targetName:s,stream:gt.CLOSE,streamId:t}),delete a.streamSinks[t])},error(h){wt(h instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,i.postMessage({sourceName:e,targetName:s,stream:gt.ERROR,streamId:t,reason:ne(h)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:r.desiredSize,ready:null};l.sinkCapability.resolve(),l.ready=l.sinkCapability.promise,this.streamSinks[t]=l,Promise.try(o,r.data,l).then(function(){i.postMessage({sourceName:e,targetName:s,stream:gt.START_COMPLETE,streamId:t,success:!0})},function(h){i.postMessage({sourceName:e,targetName:s,stream:gt.START_COMPLETE,streamId:t,reason:ne(h)})})},nu=function(r){const t=r.streamId,e=this.sourceName,s=r.sourceName,i=this.comObj,a=this.streamControllers[t],o=this.streamSinks[t];switch(r.stream){case gt.START_COMPLETE:r.success?a.startCall.resolve():a.startCall.reject(ne(r.reason));break;case gt.PULL_COMPLETE:r.success?a.pullCall.resolve():a.pullCall.reject(ne(r.reason));break;case gt.PULL:if(!o){i.postMessage({sourceName:e,targetName:s,stream:gt.PULL_COMPLETE,streamId:t,success:!0});break}o.desiredSize<=0&&r.desiredSize>0&&o.sinkCapability.resolve(),o.desiredSize=r.desiredSize,Promise.try(o.onPull||su).then(function(){i.postMessage({sourceName:e,targetName:s,stream:gt.PULL_COMPLETE,streamId:t,success:!0})},function(h){i.postMessage({sourceName:e,targetName:s,stream:gt.PULL_COMPLETE,streamId:t,reason:ne(h)})});break;case gt.ENQUEUE:if(wt(a,"enqueue should have stream controller"),a.isClosed)break;a.controller.enqueue(r.chunk);break;case gt.CLOSE:if(wt(a,"close should have stream controller"),a.isClosed)break;a.isClosed=!0,a.controller.close(),v(this,Js,Io).call(this,a,t);break;case gt.ERROR:wt(a,"error should have stream controller"),a.controller.error(ne(r.reason)),v(this,Js,Io).call(this,a,t);break;case gt.CANCEL_COMPLETE:r.success?a.cancelCall.resolve():a.cancelCall.reject(ne(r.reason)),v(this,Js,Io).call(this,a,t);break;case gt.CANCEL:if(!o)break;const l=ne(r.reason);Promise.try(o.onCancel||su,l).then(function(){i.postMessage({sourceName:e,targetName:s,stream:gt.CANCEL_COMPLETE,streamId:t,success:!0})},function(h){i.postMessage({sourceName:e,targetName:s,stream:gt.CANCEL_COMPLETE,streamId:t,reason:ne(h)})}),o.sinkCapability.reject(l),o.isCancelled=!0,delete this.streamSinks[t];break;default:throw new Error("Unexpected stream case")}},Io=async function(r,t){var e,s,i;await Promise.allSettled([(e=r.startCall)==null?void 0:e.promise,(s=r.pullCall)==null?void 0:s.promise,(i=r.cancelCall)==null?void 0:i.promise]),delete this.streamControllers[t]};var rl;class mp{constructor({enableHWA:t=!1}){m(this,rl,!1),p(this,rl,t)}create(t,e){if(t<=0||e<=0)throw new Error("Invalid canvas size");const s=this._createCanvas(t,e);return{canvas:s,context:s.getContext("2d",{willReadFrequently:!n(this,rl)})}}reset(t,e,s){if(!t.canvas)throw new Error("Canvas is not specified");if(e<=0||s<=0)throw new Error("Invalid canvas size");t.canvas.width=e,t.canvas.height=s}destroy(t){if(!t.canvas)throw new Error("Canvas is not specified");t.canvas.width=0,t.canvas.height=0,t.canvas=null,t.context=null}_createCanvas(t,e){Z("Abstract method `_createCanvas` called.")}}rl=new WeakMap;class wg extends mp{constructor({ownerDocument:t=globalThis.document,enableHWA:e=!1}){super({enableHWA:e}),this._document=t}_createCanvas(t,e){const s=this._document.createElement("canvas");return s.width=t,s.height=e,s}}class vp{constructor({baseUrl:t=null,isCompressed:e=!0}){this.baseUrl=t,this.isCompressed=e}async fetch({name:t}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!t)throw new Error("CMap name must be specified.");const e=this.baseUrl+t+(this.isCompressed?".bcmap":"");return this._fetch(e).then(s=>({cMapData:s,isCompressed:this.isCompressed})).catch(s=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${e}`)})}async _fetch(t){Z("Abstract method `_fetch` called.")}}class au extends vp{async _fetch(t){const e=await yo(t,this.isCompressed?"arraybuffer":"text");return e instanceof ArrayBuffer?new Uint8Array(e):Ao(e)}}class wp{addFilter(t){return"none"}addHCMFilter(t,e){return"none"}addAlphaFilter(t){return"none"}addLuminosityFilter(t){return"none"}addHighlightHCMFilter(t,e,s,i,a){return"none"}destroy(t=!1){}}var Bn,xa,ri,Gs,Yt,rn,$n,F,Gt,rr,ca,ol,Hn,bp,Ic,Gn,Fa,or,Lc,lr;class bg extends wp{constructor({docId:t,ownerDocument:e=globalThis.document}){super(),m(this,F),m(this,Bn),m(this,xa),m(this,ri),m(this,Gs),m(this,Yt),m(this,rn),m(this,$n,0),p(this,Gs,t),p(this,Yt,e)}addFilter(t){if(!t)return"none";let e=n(this,F,Gt).get(t);if(e)return e;const[s,i,a]=v(this,F,ol).call(this,t),o=t.length===1?s:`${s}${i}${a}`;if(e=n(this,F,Gt).get(o),e)return n(this,F,Gt).set(t,e),e;const l=`g_${n(this,Gs)}_transfer_map_${oe(this,$n)._++}`,h=v(this,F,Hn).call(this,l);n(this,F,Gt).set(t,h),n(this,F,Gt).set(o,h);const c=v(this,F,Gn).call(this,l);return v(this,F,or).call(this,s,i,a,c),h}addHCMFilter(t,e){var s;const i=`${t}-${e}`,a="base";let o=n(this,F,rr).get(a);if((o==null?void 0:o.key)===i||(o?((s=o.filter)==null||s.remove(),o.key=i,o.url="none",o.filter=null):(o={key:i,url:"none",filter:null},n(this,F,rr).set(a,o)),!t||!e))return o.url;const l=v(this,F,lr).call(this,t);t=L.makeHexColor(...l);const h=v(this,F,lr).call(this,e);if(e=L.makeHexColor(...h),n(this,F,ca).style.color="",t==="#000000"&&e==="#ffffff"||t===e)return o.url;const c=new Array(256);for(let b=0;b<=255;b++){const w=b/255;c[b]=w<=.03928?w/12.92:((w+.055)/1.055)**2.4}const d=c.join(","),u=`g_${n(this,Gs)}_hcm_filter`,f=o.filter=v(this,F,Gn).call(this,u);v(this,F,or).call(this,d,d,d,f),v(this,F,Ic).call(this,f);const g=(b,w)=>{const A=l[b]/255,y=h[b]/255,S=new Array(w+1);for(let _=0;_<=w;_++)S[_]=A+_/w*(y-A);return S.join(",")};return v(this,F,or).call(this,g(0,5),g(1,5),g(2,5),f),o.url=v(this,F,Hn).call(this,u),o.url}addAlphaFilter(t){let e=n(this,F,Gt).get(t);if(e)return e;const[s]=v(this,F,ol).call(this,[t]),i=`alpha_${s}`;if(e=n(this,F,Gt).get(i),e)return n(this,F,Gt).set(t,e),e;const a=`g_${n(this,Gs)}_alpha_map_${oe(this,$n)._++}`,o=v(this,F,Hn).call(this,a);n(this,F,Gt).set(t,o),n(this,F,Gt).set(i,o);const l=v(this,F,Gn).call(this,a);return v(this,F,Lc).call(this,s,l),o}addLuminosityFilter(t){let e=n(this,F,Gt).get(t||"luminosity");if(e)return e;let s,i;if(t?([s]=v(this,F,ol).call(this,[t]),i=`luminosity_${s}`):i="luminosity",e=n(this,F,Gt).get(i),e)return n(this,F,Gt).set(t,e),e;const a=`g_${n(this,Gs)}_luminosity_map_${oe(this,$n)._++}`,o=v(this,F,Hn).call(this,a);n(this,F,Gt).set(t,o),n(this,F,Gt).set(i,o);const l=v(this,F,Gn).call(this,a);return v(this,F,bp).call(this,l),t&&v(this,F,Lc).call(this,s,l),o}addHighlightHCMFilter(t,e,s,i,a){var o;const l=`${e}-${s}-${i}-${a}`;let h=n(this,F,rr).get(t);if((h==null?void 0:h.key)===l||(h?((o=h.filter)==null||o.remove(),h.key=l,h.url="none",h.filter=null):(h={key:l,url:"none",filter:null},n(this,F,rr).set(t,h)),!e||!s))return h.url;const[c,d]=[e,s].map(v(this,F,lr).bind(this));let u=Math.round(.2126*c[0]+.7152*c[1]+.0722*c[2]),f=Math.round(.2126*d[0]+.7152*d[1]+.0722*d[2]),[g,b]=[i,a].map(v(this,F,lr).bind(this));f<u&&([u,f,g,b]=[f,u,b,g]),n(this,F,ca).style.color="";const w=(S,_,x)=>{const k=new Array(256),E=(f-u)/x,M=S/255,C=(_-S)/(255*x);let T=0;for(let N=0;N<=x;N++){const W=Math.round(u+N*E),Y=M+N*C;for(let q=T;q<=W;q++)k[q]=Y;T=W+1}for(let N=T;N<256;N++)k[N]=k[T-1];return k.join(",")},A=`g_${n(this,Gs)}_hcm_${t}_filter`,y=h.filter=v(this,F,Gn).call(this,A);return v(this,F,Ic).call(this,y),v(this,F,or).call(this,w(g[0],b[0],5),w(g[1],b[1],5),w(g[2],b[2],5),y),h.url=v(this,F,Hn).call(this,A),h.url}destroy(t=!1){var e,s,i,a;t&&(e=n(this,rn))!=null&&e.size||((s=n(this,ri))==null||s.parentNode.parentNode.remove(),p(this,ri,null),(i=n(this,xa))==null||i.clear(),p(this,xa,null),(a=n(this,rn))==null||a.clear(),p(this,rn,null),p(this,$n,0))}}Bn=new WeakMap,xa=new WeakMap,ri=new WeakMap,Gs=new WeakMap,Yt=new WeakMap,rn=new WeakMap,$n=new WeakMap,F=new WeakSet,Gt=function(){return n(this,xa)||p(this,xa,new Map)},rr=function(){return n(this,rn)||p(this,rn,new Map)},ca=function(){if(!n(this,ri)){const r=n(this,Yt).createElement("div"),{style:t}=r;t.visibility="hidden",t.contain="strict",t.width=t.height=0,t.position="absolute",t.top=t.left=0,t.zIndex=-1;const e=n(this,Yt).createElementNS(ls,"svg");e.setAttribute("width",0),e.setAttribute("height",0),p(this,ri,n(this,Yt).createElementNS(ls,"defs")),r.append(e),e.append(n(this,ri)),n(this,Yt).body.append(r)}return n(this,ri)},ol=function(r){if(r.length===1){const l=r[0],h=new Array(256);for(let d=0;d<256;d++)h[d]=l[d]/255;const c=h.join(",");return[c,c,c]}const[t,e,s]=r,i=new Array(256),a=new Array(256),o=new Array(256);for(let l=0;l<256;l++)i[l]=t[l]/255,a[l]=e[l]/255,o[l]=s[l]/255;return[i.join(","),a.join(","),o.join(",")]},Hn=function(r){if(n(this,Bn)===void 0){p(this,Bn,"");const t=n(this,Yt).URL;t!==n(this,Yt).baseURI&&(Uh(t)?z('#createUrl: ignore "data:"-URL for performance reasons.'):p(this,Bn,t.split("#",1)[0]))}return`url(${n(this,Bn)}#${r})`},bp=function(r){const t=n(this,Yt).createElementNS(ls,"feColorMatrix");t.setAttribute("type","matrix"),t.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),r.append(t)},Ic=function(r){const t=n(this,Yt).createElementNS(ls,"feColorMatrix");t.setAttribute("type","matrix"),t.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),r.append(t)},Gn=function(r){const t=n(this,Yt).createElementNS(ls,"filter");return t.setAttribute("color-interpolation-filters","sRGB"),t.setAttribute("id",r),n(this,F,ca).append(t),t},Fa=function(r,t,e){const s=n(this,Yt).createElementNS(ls,t);s.setAttribute("type","discrete"),s.setAttribute("tableValues",e),r.append(s)},or=function(r,t,e,s){const i=n(this,Yt).createElementNS(ls,"feComponentTransfer");s.append(i),v(this,F,Fa).call(this,i,"feFuncR",r),v(this,F,Fa).call(this,i,"feFuncG",t),v(this,F,Fa).call(this,i,"feFuncB",e)},Lc=function(r,t){const e=n(this,Yt).createElementNS(ls,"feComponentTransfer");t.append(e),v(this,F,Fa).call(this,e,"feFuncA",r)},lr=function(r){return n(this,F,ca).style.color=r,Ld(getComputedStyle(n(this,F,ca)).getPropertyValue("color"))};class Ap{constructor({baseUrl:t=null}){this.baseUrl=t}async fetch({filename:t}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!t)throw new Error("Font filename must be specified.");const e=`${this.baseUrl}${t}`;return this._fetch(e).catch(s=>{throw new Error(`Unable to load font data at: ${e}`)})}async _fetch(t){Z("Abstract method `_fetch` called.")}}class ru extends Ap{async _fetch(t){const e=await yo(t,"arraybuffer");return new Uint8Array(e)}}class yp{constructor({baseUrl:t=null}){this.baseUrl=t}async fetch({filename:t}){if(!this.baseUrl)throw new Error("Ensure that the `wasmUrl` API parameter is provided.");if(!t)throw new Error("Wasm filename must be specified.");const e=`${this.baseUrl}${t}`;return this._fetch(e).catch(s=>{throw new Error(`Unable to load wasm data at: ${e}`)})}async _fetch(t){Z("Abstract method `_fetch` called.")}}class ou extends yp{async _fetch(t){const e=await yo(t,"arraybuffer");return new Uint8Array(e)}}Nt&&z("Please use the `legacy` build in Node.js environments.");async function Od(r){const t=await process.getBuiltinModule("fs").promises.readFile(r);return new Uint8Array(t)}class Ag extends wp{}class yg extends mp{_createCanvas(t,e){return process.getBuiltinModule("module").createRequire(import.meta.url)("@napi-rs/canvas").createCanvas(t,e)}}class _g extends vp{async _fetch(t){return Od(t)}}class Sg extends Ap{async _fetch(t){return Od(t)}}class xg extends yp{async _fetch(t){return Od(t)}}const Wt={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function Dc(r,t){if(!t)return;const e=t[2]-t[0],s=t[3]-t[1],i=new Path2D;i.rect(t[0],t[1],e,s),r.clip(i)}class Wd{isModifyingCurrentTransform(){return!1}getPattern(){Z("Abstract method `getPattern` called.")}}class Eg extends Wd{constructor(t){super(),this._type=t[1],this._bbox=t[2],this._colorStops=t[3],this._p0=t[4],this._p1=t[5],this._r0=t[6],this._r1=t[7],this.matrix=null}_createGradient(t){let e;this._type==="axial"?e=t.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(e=t.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const s of this._colorStops)e.addColorStop(s[0],s[1]);return e}getPattern(t,e,s,i){let a;if(i===Wt.STROKE||i===Wt.FILL){const o=e.current.getClippedPathBoundingBox(i,nt(t))||[0,0,0,0],l=Math.ceil(o[2]-o[0])||1,h=Math.ceil(o[3]-o[1])||1,c=e.cachedCanvases.getCanvas("pattern",l,h),d=c.context;d.clearRect(0,0,d.canvas.width,d.canvas.height),d.beginPath(),d.rect(0,0,d.canvas.width,d.canvas.height),d.translate(-o[0],-o[1]),s=L.transform(s,[1,0,0,1,o[0],o[1]]),d.transform(...e.baseTransform),this.matrix&&d.transform(...this.matrix),Dc(d,this._bbox),d.fillStyle=this._createGradient(d),d.fill(),a=t.createPattern(c.canvas,"no-repeat");const u=new DOMMatrix(s);a.setTransform(u)}else Dc(t,this._bbox),a=this._createGradient(t);return a}}function Zh(r,t,e,s,i,a,o,l){const h=t.coords,c=t.colors,d=r.data,u=r.width*4;let f;h[e+1]>h[s+1]&&(f=e,e=s,s=f,f=a,a=o,o=f),h[s+1]>h[i+1]&&(f=s,s=i,i=f,f=o,o=l,l=f),h[e+1]>h[s+1]&&(f=e,e=s,s=f,f=a,a=o,o=f);const g=(h[e]+t.offsetX)*t.scaleX,b=(h[e+1]+t.offsetY)*t.scaleY,w=(h[s]+t.offsetX)*t.scaleX,A=(h[s+1]+t.offsetY)*t.scaleY,y=(h[i]+t.offsetX)*t.scaleX,S=(h[i+1]+t.offsetY)*t.scaleY;if(b>=S)return;const _=c[a],x=c[a+1],k=c[a+2],E=c[o],M=c[o+1],C=c[o+2],T=c[l],N=c[l+1],W=c[l+2],Y=Math.round(b),q=Math.round(S);let tt,B,P,xt,le,yi,rs,os;for(let $t=Y;$t<=q;$t++){if($t<A){const ot=$t<b?0:(b-$t)/(b-A);tt=g-(g-w)*ot,B=_-(_-E)*ot,P=x-(x-M)*ot,xt=k-(k-C)*ot}else{let ot;$t>S?ot=1:A===S?ot=0:ot=(A-$t)/(A-S),tt=w-(w-y)*ot,B=E-(E-T)*ot,P=M-(M-N)*ot,xt=C-(C-W)*ot}let ut;$t<b?ut=0:$t>S?ut=1:ut=(b-$t)/(b-S),le=g-(g-y)*ut,yi=_-(_-T)*ut,rs=x-(x-N)*ut,os=k-(k-W)*ut;const wn=Math.round(Math.min(tt,le)),Ds=Math.round(Math.max(tt,le));let He=u*$t+wn*4;for(let ot=wn;ot<=Ds;ot++)ut=(tt-ot)/(tt-le),ut<0?ut=0:ut>1&&(ut=1),d[He++]=B-(B-yi)*ut|0,d[He++]=P-(P-rs)*ut|0,d[He++]=xt-(xt-os)*ut|0,d[He++]=255}}function kg(r,t,e){const s=t.coords,i=t.colors;let a,o;switch(t.type){case"lattice":const l=t.verticesPerRow,h=Math.floor(s.length/l)-1,c=l-1;for(a=0;a<h;a++){let d=a*l;for(let u=0;u<c;u++,d++)Zh(r,e,s[d],s[d+1],s[d+l],i[d],i[d+1],i[d+l]),Zh(r,e,s[d+l+1],s[d+1],s[d+l],i[d+l+1],i[d+1],i[d+l])}break;case"triangles":for(a=0,o=s.length;a<o;a+=3)Zh(r,e,s[a],s[a+1],s[a+2],i[a],i[a+1],i[a+2]);break;default:throw new Error("illegal figure")}}class Mg extends Wd{constructor(t){super(),this._coords=t[2],this._colors=t[3],this._figures=t[4],this._bounds=t[5],this._bbox=t[6],this._background=t[7],this.matrix=null}_createMeshCanvas(t,e,s){const i=Math.floor(this._bounds[0]),a=Math.floor(this._bounds[1]),o=Math.ceil(this._bounds[2])-i,l=Math.ceil(this._bounds[3])-a,h=Math.min(Math.ceil(Math.abs(o*t[0]*1.1)),3e3),c=Math.min(Math.ceil(Math.abs(l*t[1]*1.1)),3e3),d=o/h,u=l/c,f={coords:this._coords,colors:this._colors,offsetX:-i,offsetY:-a,scaleX:1/d,scaleY:1/u},g=h+2*2,b=c+2*2,w=s.getCanvas("mesh",g,b),A=w.context,y=A.createImageData(h,c);if(e){const S=y.data;for(let _=0,x=S.length;_<x;_+=4)S[_]=e[0],S[_+1]=e[1],S[_+2]=e[2],S[_+3]=255}for(const S of this._figures)kg(y,S,f);return A.putImageData(y,2,2),{canvas:w.canvas,offsetX:i-2*d,offsetY:a-2*u,scaleX:d,scaleY:u}}isModifyingCurrentTransform(){return!0}getPattern(t,e,s,i){Dc(t,this._bbox);let a;if(i===Wt.SHADING)a=L.singularValueDecompose2dScale(nt(t));else if(a=L.singularValueDecompose2dScale(e.baseTransform),this.matrix){const l=L.singularValueDecompose2dScale(this.matrix);a=[a[0]*l[0],a[1]*l[1]]}const o=this._createMeshCanvas(a,i===Wt.SHADING?null:this._background,e.cachedCanvases);return i!==Wt.SHADING&&(t.setTransform(...e.baseTransform),this.matrix&&t.transform(...this.matrix)),t.translate(o.offsetX,o.offsetY),t.scale(o.scaleX,o.scaleY),t.createPattern(o.canvas,"no-repeat")}}class Cg extends Wd{getPattern(){return"hotpink"}}function Tg(r){switch(r[0]){case"RadialAxial":return new Eg(r);case"Mesh":return new Mg(r);case"Dummy":return new Cg}throw new Error(`Unknown IR type: ${r[0]}`)}const lu={COLORED:1,UNCOLORED:2},_p=class Sp{constructor(t,e,s,i){this.color=t[1],this.operatorList=t[2],this.matrix=t[3],this.bbox=t[4],this.xstep=t[5],this.ystep=t[6],this.paintType=t[7],this.tilingType=t[8],this.ctx=e,this.canvasGraphicsFactory=s,this.baseTransform=i}createPatternCanvas(t){const{bbox:e,operatorList:s,paintType:i,tilingType:a,color:o,canvasGraphicsFactory:l}=this;let{xstep:h,ystep:c}=this;h=Math.abs(h),c=Math.abs(c),zh("TilingType: "+a);const d=e[0],u=e[1],f=e[2],g=e[3],b=f-d,w=g-u,A=L.singularValueDecompose2dScale(this.matrix),y=L.singularValueDecompose2dScale(this.baseTransform),S=A[0]*y[0],_=A[1]*y[1];let x=b,k=w,E=!1,M=!1;const C=Math.ceil(h*S),T=Math.ceil(c*_),N=Math.ceil(b*S),W=Math.ceil(w*_);C>=N?x=h:E=!0,T>=W?k=c:M=!0;const Y=this.getSizeAndScale(x,this.ctx.canvas.width,S),q=this.getSizeAndScale(k,this.ctx.canvas.height,_),tt=t.cachedCanvases.getCanvas("pattern",Y.size,q.size),B=tt.context,P=l.createCanvasGraphics(B);if(P.groupLevel=t.groupLevel,this.setFillAndStrokeStyleToContext(P,i,o),B.translate(-Y.scale*d,-q.scale*u),P.transform(Y.scale,0,0,q.scale,0,0),B.save(),this.clipBbox(P,d,u,f,g),P.baseTransform=nt(P.ctx),P.executeOperatorList(s),P.endDrawing(),B.restore(),E||M){const xt=tt.canvas;E&&(x=h),M&&(k=c);const le=this.getSizeAndScale(x,this.ctx.canvas.width,S),yi=this.getSizeAndScale(k,this.ctx.canvas.height,_),rs=le.size,os=yi.size,$t=t.cachedCanvases.getCanvas("pattern-workaround",rs,os),ut=$t.context,wn=E?Math.floor(b/h):0,Ds=M?Math.floor(w/c):0;for(let He=0;He<=wn;He++)for(let ot=0;ot<=Ds;ot++)ut.drawImage(xt,rs*He,os*ot,rs,os,0,0,rs,os);return{canvas:$t.canvas,scaleX:le.scale,scaleY:yi.scale,offsetX:d,offsetY:u}}return{canvas:tt.canvas,scaleX:Y.scale,scaleY:q.scale,offsetX:d,offsetY:u}}getSizeAndScale(t,e,s){const i=Math.max(Sp.MAX_PATTERN_SIZE,e);let a=Math.ceil(t*s);return a>=i?a=i:s=a/t,{scale:s,size:a}}clipBbox(t,e,s,i,a){const o=i-e,l=a-s;t.ctx.rect(e,s,o,l),t.current.updateRectMinMax(nt(t.ctx),[e,s,i,a]),t.clip(),t.endPath()}setFillAndStrokeStyleToContext(t,e,s){const i=t.ctx,a=t.current;switch(e){case lu.COLORED:const o=this.ctx;i.fillStyle=o.fillStyle,i.strokeStyle=o.strokeStyle,a.fillColor=o.fillStyle,a.strokeColor=o.strokeStyle;break;case lu.UNCOLORED:const l=L.makeHexColor(s[0],s[1],s[2]);i.fillStyle=l,i.strokeStyle=l,a.fillColor=l,a.strokeColor=l;break;default:throw new Qf(`Unsupported paint type: ${e}`)}}isModifyingCurrentTransform(){return!1}getPattern(t,e,s,i){let a=s;i!==Wt.SHADING&&(a=L.transform(a,e.baseTransform),this.matrix&&(a=L.transform(a,this.matrix)));const o=this.createPatternCanvas(e);let l=new DOMMatrix(a);l=l.translate(o.offsetX,o.offsetY),l=l.scale(1/o.scaleX,1/o.scaleY);const h=t.createPattern(o.canvas,"repeat");return h.setTransform(l),h}};I(_p,"MAX_PATTERN_SIZE",3e3);let Rg=_p;function Pg({src:r,srcPos:t=0,dest:e,width:s,height:i,nonBlackColor:a=4294967295,inverseDecode:o=!1}){const l=Bt.isLittleEndian?4278190080:255,[h,c]=o?[a,l]:[l,a],d=s>>3,u=s&7,f=r.length;e=new Uint32Array(e.buffer);let g=0;for(let b=0;b<i;b++){for(const A=t+d;t<A;t++){const y=t<f?r[t]:255;e[g++]=y&128?c:h,e[g++]=y&64?c:h,e[g++]=y&32?c:h,e[g++]=y&16?c:h,e[g++]=y&8?c:h,e[g++]=y&4?c:h,e[g++]=y&2?c:h,e[g++]=y&1?c:h}if(u===0)continue;const w=t<f?r[t++]:255;for(let A=0;A<u;A++)e[g++]=w&1<<7-A?c:h}return{srcPos:t,destPos:g}}const hu=16,cu=100,Ig=15,du=10,uu=1e3,re=16,tc=new DOMMatrix;function Lg(r,t){if(r._removeMirroring)throw new Error("Context is already forwarding operations.");r.__originalSave=r.save,r.__originalRestore=r.restore,r.__originalRotate=r.rotate,r.__originalScale=r.scale,r.__originalTranslate=r.translate,r.__originalTransform=r.transform,r.__originalSetTransform=r.setTransform,r.__originalResetTransform=r.resetTransform,r.__originalClip=r.clip,r.__originalMoveTo=r.moveTo,r.__originalLineTo=r.lineTo,r.__originalBezierCurveTo=r.bezierCurveTo,r.__originalRect=r.rect,r.__originalClosePath=r.closePath,r.__originalBeginPath=r.beginPath,r._removeMirroring=()=>{r.save=r.__originalSave,r.restore=r.__originalRestore,r.rotate=r.__originalRotate,r.scale=r.__originalScale,r.translate=r.__originalTranslate,r.transform=r.__originalTransform,r.setTransform=r.__originalSetTransform,r.resetTransform=r.__originalResetTransform,r.clip=r.__originalClip,r.moveTo=r.__originalMoveTo,r.lineTo=r.__originalLineTo,r.bezierCurveTo=r.__originalBezierCurveTo,r.rect=r.__originalRect,r.closePath=r.__originalClosePath,r.beginPath=r.__originalBeginPath,delete r._removeMirroring},r.save=function(){t.save(),this.__originalSave()},r.restore=function(){t.restore(),this.__originalRestore()},r.translate=function(e,s){t.translate(e,s),this.__originalTranslate(e,s)},r.scale=function(e,s){t.scale(e,s),this.__originalScale(e,s)},r.transform=function(e,s,i,a,o,l){t.transform(e,s,i,a,o,l),this.__originalTransform(e,s,i,a,o,l)},r.setTransform=function(e,s,i,a,o,l){t.setTransform(e,s,i,a,o,l),this.__originalSetTransform(e,s,i,a,o,l)},r.resetTransform=function(){t.resetTransform(),this.__originalResetTransform()},r.rotate=function(e){t.rotate(e),this.__originalRotate(e)},r.clip=function(e){t.clip(e),this.__originalClip(e)},r.moveTo=function(e,s){t.moveTo(e,s),this.__originalMoveTo(e,s)},r.lineTo=function(e,s){t.lineTo(e,s),this.__originalLineTo(e,s)},r.bezierCurveTo=function(e,s,i,a,o,l){t.bezierCurveTo(e,s,i,a,o,l),this.__originalBezierCurveTo(e,s,i,a,o,l)},r.rect=function(e,s,i,a){t.rect(e,s,i,a),this.__originalRect(e,s,i,a)},r.closePath=function(){t.closePath(),this.__originalClosePath()},r.beginPath=function(){t.beginPath(),this.__originalBeginPath()}}class Dg{constructor(t){this.canvasFactory=t,this.cache=Object.create(null)}getCanvas(t,e,s){let i;return this.cache[t]!==void 0?(i=this.cache[t],this.canvasFactory.reset(i,e,s)):(i=this.canvasFactory.create(e,s),this.cache[t]=i),i}delete(t){delete this.cache[t]}clear(){for(const t in this.cache){const e=this.cache[t];this.canvasFactory.destroy(e),delete this.cache[t]}}}function Lo(r,t,e,s,i,a,o,l,h,c){const[d,u,f,g,b,w]=nt(r);if(u===0&&f===0){const S=o*d+b,_=Math.round(S),x=l*g+w,k=Math.round(x),E=(o+h)*d+b,M=Math.abs(Math.round(E)-_)||1,C=(l+c)*g+w,T=Math.abs(Math.round(C)-k)||1;return r.setTransform(Math.sign(d),0,0,Math.sign(g),_,k),r.drawImage(t,e,s,i,a,0,0,M,T),r.setTransform(d,u,f,g,b,w),[M,T]}if(d===0&&g===0){const S=l*f+b,_=Math.round(S),x=o*u+w,k=Math.round(x),E=(l+c)*f+b,M=Math.abs(Math.round(E)-_)||1,C=(o+h)*u+w,T=Math.abs(Math.round(C)-k)||1;return r.setTransform(0,Math.sign(u),Math.sign(f),0,_,k),r.drawImage(t,e,s,i,a,0,0,T,M),r.setTransform(d,u,f,g,b,w),[T,M]}r.drawImage(t,e,s,i,a,o,l,h,c);const A=Math.hypot(d,u),y=Math.hypot(f,g);return[A*h,y*c]}function Ng(r){const{width:t,height:e}=r;if(t>uu||e>uu)return null;const s=1e3,i=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),a=t+1,o=new Uint8Array(a*(e+1));let l,h,c;const d=t+7&-8,u=new Uint8Array(d*e);let f=0;for(const E of r.data){let M=128;for(;M>0;)u[f++]=E&M?0:255,M>>=1}let g=0;for(f=0,u[f]!==0&&(o[0]=1,++g),h=1;h<t;h++)u[f]!==u[f+1]&&(o[h]=u[f]?2:1,++g),f++;for(u[f]!==0&&(o[h]=2,++g),l=1;l<e;l++){f=l*d,c=l*a,u[f-d]!==u[f]&&(o[c]=u[f]?1:8,++g);let E=(u[f]?4:0)+(u[f-d]?8:0);for(h=1;h<t;h++)E=(E>>2)+(u[f+1]?4:0)+(u[f-d+1]?8:0),i[E]&&(o[c+h]=i[E],++g),f++;if(u[f-d]!==u[f]&&(o[c+h]=u[f]?2:4,++g),g>s)return null}for(f=d*(e-1),c=l*a,u[f]!==0&&(o[c]=8,++g),h=1;h<t;h++)u[f]!==u[f+1]&&(o[c+h]=u[f]?4:8,++g),f++;if(u[f]!==0&&(o[c+h]=4,++g),g>s)return null;const b=new Int32Array([0,a,-1,0,-a,0,0,0,1]),w=new Path2D,{a:A,b:y,c:S,d:_,e:x,f:k}=new DOMMatrix().scaleSelf(1/t,-1/e).translateSelf(0,-e);for(l=0;g&&l<=e;l++){let E=l*a;const M=E+t;for(;E<M&&!o[E];)E++;if(E===M)continue;let C=E%a,T=l;w.moveTo(A*C+S*T+x,y*C+_*T+k);const N=E;let W=o[E];do{const Y=b[W];do E+=Y;while(!o[E]);const q=o[E];q!==5&&q!==10?(W=q,o[E]=0):(W=q&51*W>>4,o[E]&=W>>2|W<<2),C=E%a,T=E/a|0,w.lineTo(A*C+S*T+x,y*C+_*T+k),o[E]||--g}while(N!==E);--l}return w}class pu{constructor(t,e){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=Nu,this.textMatrixScale=1,this.fontMatrix=lc,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=Ht.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.patternStroke=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,t,e])}clone(){const t=Object.create(this);return t.clipBox=this.clipBox.slice(),t}updateRectMinMax(t,e){const s=L.applyTransform(e,t),i=L.applyTransform(e.slice(2),t),a=L.applyTransform([e[0],e[3]],t),o=L.applyTransform([e[2],e[1]],t);this.minX=Math.min(this.minX,s[0],i[0],a[0],o[0]),this.minY=Math.min(this.minY,s[1],i[1],a[1],o[1]),this.maxX=Math.max(this.maxX,s[0],i[0],a[0],o[0]),this.maxY=Math.max(this.maxY,s[1],i[1],a[1],o[1])}getPathBoundingBox(t=Wt.FILL,e=null){const s=[this.minX,this.minY,this.maxX,this.maxY];if(t===Wt.STROKE){e||Z("Stroke bounding box must include transform.");const i=L.singularValueDecompose2dScale(e),a=i[0]*this.lineWidth/2,o=i[1]*this.lineWidth/2;s[0]-=a,s[1]-=o,s[2]+=a,s[3]+=o}return s}updateClipFromPath(){const t=L.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(t||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(t){this.clipBox=t,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(t=Wt.FILL,e=null){return L.intersect(this.clipBox,this.getPathBoundingBox(t,e))}}function fu(r,t){if(t instanceof ImageData){r.putImageData(t,0,0);return}const e=t.height,s=t.width,i=e%re,a=(e-i)/re,o=i===0?a:a+1,l=r.createImageData(s,re);let h=0,c;const d=t.data,u=l.data;let f,g,b,w;if(t.kind===$o.GRAYSCALE_1BPP){const A=d.byteLength,y=new Uint32Array(u.buffer,0,u.byteLength>>2),S=y.length,_=s+7>>3,x=4294967295,k=Bt.isLittleEndian?4278190080:255;for(f=0;f<o;f++){for(b=f<a?re:i,c=0,g=0;g<b;g++){const E=A-h;let M=0;const C=E>_?s:E*8-7,T=C&-8;let N=0,W=0;for(;M<T;M+=8)W=d[h++],y[c++]=W&128?x:k,y[c++]=W&64?x:k,y[c++]=W&32?x:k,y[c++]=W&16?x:k,y[c++]=W&8?x:k,y[c++]=W&4?x:k,y[c++]=W&2?x:k,y[c++]=W&1?x:k;for(;M<C;M++)N===0&&(W=d[h++],N=128),y[c++]=W&N?x:k,N>>=1}for(;c<S;)y[c++]=0;r.putImageData(l,0,f*re)}}else if(t.kind===$o.RGBA_32BPP){for(g=0,w=s*re*4,f=0;f<a;f++)u.set(d.subarray(h,h+w)),h+=w,r.putImageData(l,0,g),g+=re;f<o&&(w=s*i*4,u.set(d.subarray(h,h+w)),r.putImageData(l,0,g))}else if(t.kind===$o.RGB_24BPP)for(b=re,w=s*b,f=0;f<o;f++){for(f>=a&&(b=i,w=s*b),c=0,g=w;g--;)u[c++]=d[h++],u[c++]=d[h++],u[c++]=d[h++],u[c++]=255;r.putImageData(l,0,f*re)}else throw new Error(`bad image kind: ${t.kind}`)}function gu(r,t){if(t.bitmap){r.drawImage(t.bitmap,0,0);return}const e=t.height,s=t.width,i=e%re,a=(e-i)/re,o=i===0?a:a+1,l=r.createImageData(s,re);let h=0;const c=t.data,d=l.data;for(let u=0;u<o;u++){const f=u<a?re:i;({srcPos:h}=Pg({src:c,srcPos:h,dest:d,width:s,height:f,nonBlackColor:0})),r.putImageData(l,0,u*re)}}function Oa(r,t){const e=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const s of e)r[s]!==void 0&&(t[s]=r[s]);r.setLineDash!==void 0&&(t.setLineDash(r.getLineDash()),t.lineDashOffset=r.lineDashOffset)}function Do(r){if(r.strokeStyle=r.fillStyle="#000000",r.fillRule="nonzero",r.globalAlpha=1,r.lineWidth=1,r.lineCap="butt",r.lineJoin="miter",r.miterLimit=10,r.globalCompositeOperation="source-over",r.font="10px sans-serif",r.setLineDash!==void 0&&(r.setLineDash([]),r.lineDashOffset=0),!Nt){const{filter:t}=r;t!=="none"&&t!==""&&(r.filter="none")}}function mu(r,t){if(t)return!0;const e=L.singularValueDecompose2dScale(r);e[0]=Math.fround(e[0]),e[1]=Math.fround(e[1]);const s=Math.fround(Ls.pixelRatio*Da.PDF_TO_CSS_UNITS);return e[0]<=s&&e[1]<=s}const Fg=["butt","round","square"],Og=["miter","round","bevel"],Wg={},vu={};var zs,Nc,Fc,Oc;const Bg=class xp{constructor(t,e,s,i,a,{optionalContentConfig:o,markedContentStack:l=null},h,c){m(this,zs),this.ctx=t,this.current=new pu(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=e,this.objs=s,this.canvasFactory=i,this.filterFactory=a,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=l||[],this.optionalContentConfig=o,this.cachedCanvases=new Dg(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=h,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=c,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(t,e=null){return typeof t=="string"?t.startsWith("g_")?this.commonObjs.get(t):this.objs.get(t):e}beginDrawing({transform:t,viewport:e,transparency:s=!1,background:i=null}){const a=this.ctx.canvas.width,o=this.ctx.canvas.height,l=this.ctx.fillStyle;if(this.ctx.fillStyle=i||"#ffffff",this.ctx.fillRect(0,0,a,o),this.ctx.fillStyle=l,s){const h=this.cachedCanvases.getCanvas("transparent",a,o);this.compositeCtx=this.ctx,this.transparentCanvas=h.canvas,this.ctx=h.context,this.ctx.save(),this.ctx.transform(...nt(this.compositeCtx))}this.ctx.save(),Do(this.ctx),t&&(this.ctx.transform(...t),this.outputScaleX=t[0],this.outputScaleY=t[0]),this.ctx.transform(...e.transform),this.viewportScale=e.scale,this.baseTransform=nt(this.ctx)}executeOperatorList(t,e,s,i){const a=t.argsArray,o=t.fnArray;let l=e||0;const h=a.length;if(h===l)return l;const c=h-l>du&&typeof s=="function",d=c?Date.now()+Ig:0;let u=0;const f=this.commonObjs,g=this.objs;let b;for(;;){if(i!==void 0&&l===i.nextBreakPoint)return i.breakIt(l,s),l;if(b=o[l],b!==Zl.dependency)this[b].apply(this,a[l]);else for(const w of a[l]){const A=w.startsWith("g_")?f:g;if(!A.has(w))return A.get(w,s),l}if(l++,l===h)return l;if(c&&++u>du){if(Date.now()>d)return s(),l;u=0}}}endDrawing(){v(this,zs,Nc).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const t of this._cachedBitmapsMap.values()){for(const e of t.values())typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&(e.width=e.height=0);t.clear()}this._cachedBitmapsMap.clear(),v(this,zs,Fc).call(this)}_scaleImage(t,e){const s=t.width??t.displayWidth,i=t.height??t.displayHeight;let a=Math.max(Math.hypot(e[0],e[1]),1),o=Math.max(Math.hypot(e[2],e[3]),1),l=s,h=i,c="prescale1",d,u;for(;a>2&&l>1||o>2&&h>1;){let f=l,g=h;a>2&&l>1&&(f=l>=16384?Math.floor(l/2)-1||1:Math.ceil(l/2),a/=l/f),o>2&&h>1&&(g=h>=16384?Math.floor(h/2)-1||1:Math.ceil(h)/2,o/=h/g),d=this.cachedCanvases.getCanvas(c,f,g),u=d.context,u.clearRect(0,0,f,g),u.drawImage(t,0,0,l,h,0,0,f,g),t=d.canvas,l=f,h=g,c=c==="prescale1"?"prescale2":"prescale1"}return{img:t,paintWidth:l,paintHeight:h}}_createMaskCanvas(t){const e=this.ctx,{width:s,height:i}=t,a=this.current.fillColor,o=this.current.patternFill,l=nt(e);let h,c,d,u;if((t.bitmap||t.data)&&t.count>1){const C=t.bitmap||t.data.buffer;c=JSON.stringify(o?l:[l.slice(0,4),a]),h=this._cachedBitmapsMap.get(C),h||(h=new Map,this._cachedBitmapsMap.set(C,h));const T=h.get(c);if(T&&!o){const N=Math.round(Math.min(l[0],l[2])+l[4]),W=Math.round(Math.min(l[1],l[3])+l[5]);return{canvas:T,offsetX:N,offsetY:W}}d=T}d||(u=this.cachedCanvases.getCanvas("maskCanvas",s,i),gu(u.context,t));let f=L.transform(l,[1/s,0,0,-1/i,0,0]);f=L.transform(f,[1,0,0,1,0,-i]);const[g,b,w,A]=L.getAxialAlignedBoundingBox([0,0,s,i],f),y=Math.round(w-g)||1,S=Math.round(A-b)||1,_=this.cachedCanvases.getCanvas("fillCanvas",y,S),x=_.context,k=g,E=b;x.translate(-k,-E),x.transform(...f),d||(d=this._scaleImage(u.canvas,Ge(x)),d=d.img,h&&o&&h.set(c,d)),x.imageSmoothingEnabled=mu(nt(x),t.interpolate),Lo(x,d,0,0,d.width,d.height,0,0,s,i),x.globalCompositeOperation="source-in";const M=L.transform(Ge(x),[1,0,0,1,-k,-E]);return x.fillStyle=o?a.getPattern(e,this,M,Wt.FILL):a,x.fillRect(0,0,s,i),h&&!o&&(this.cachedCanvases.delete("fillCanvas"),h.set(c,_.canvas)),{canvas:_.canvas,offsetX:Math.round(k),offsetY:Math.round(E)}}setLineWidth(t){t!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=t,this.ctx.lineWidth=t}setLineCap(t){this.ctx.lineCap=Fg[t]}setLineJoin(t){this.ctx.lineJoin=Og[t]}setMiterLimit(t){this.ctx.miterLimit=t}setDash(t,e){const s=this.ctx;s.setLineDash!==void 0&&(s.setLineDash(t),s.lineDashOffset=e)}setRenderingIntent(t){}setFlatness(t){}setGState(t){for(const[e,s]of t)switch(e){case"LW":this.setLineWidth(s);break;case"LC":this.setLineCap(s);break;case"LJ":this.setLineJoin(s);break;case"ML":this.setMiterLimit(s);break;case"D":this.setDash(s[0],s[1]);break;case"RI":this.setRenderingIntent(s);break;case"FL":this.setFlatness(s);break;case"Font":this.setFont(s[0],s[1]);break;case"CA":this.current.strokeAlpha=s;break;case"ca":this.ctx.globalAlpha=this.current.fillAlpha=s;break;case"BM":this.ctx.globalCompositeOperation=s;break;case"SMask":this.current.activeSMask=s?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(s);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const t=this.inSMaskMode;this.current.activeSMask&&!t?this.beginSMaskMode():!this.current.activeSMask&&t&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const t=this.ctx.canvas.width,e=this.ctx.canvas.height,s="smaskGroupAt"+this.groupLevel,i=this.cachedCanvases.getCanvas(s,t,e);this.suspendedCtx=this.ctx;const a=this.ctx=i.context;a.setTransform(this.suspendedCtx.getTransform()),Oa(this.suspendedCtx,a),Lg(a,this.suspendedCtx),this.setGState([["BM","source-over"]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),Oa(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(t){if(!this.current.activeSMask)return;t?(t[0]=Math.floor(t[0]),t[1]=Math.floor(t[1]),t[2]=Math.ceil(t[2]),t[3]=Math.ceil(t[3])):t=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const e=this.current.activeSMask,s=this.suspendedCtx;this.composeSMask(s,e,this.ctx,t),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(t,e,s,i){const a=i[0],o=i[1],l=i[2]-a,h=i[3]-o;l===0||h===0||(this.genericComposeSMask(e.context,s,l,h,e.subtype,e.backdrop,e.transferMap,a,o,e.offsetX,e.offsetY),t.save(),t.globalAlpha=1,t.globalCompositeOperation="source-over",t.setTransform(1,0,0,1,0,0),t.drawImage(s.canvas,0,0),t.restore())}genericComposeSMask(t,e,s,i,a,o,l,h,c,d,u){let f=t.canvas,g=h-d,b=c-u;if(o){const A=L.makeHexColor(...o);if(g<0||b<0||g+s>f.width||b+i>f.height){const y=this.cachedCanvases.getCanvas("maskExtension",s,i),S=y.context;S.drawImage(f,-g,-b),S.globalCompositeOperation="destination-atop",S.fillStyle=A,S.fillRect(0,0,s,i),S.globalCompositeOperation="source-over",f=y.canvas,g=b=0}else{t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0);const y=new Path2D;y.rect(g,b,s,i),t.clip(y),t.globalCompositeOperation="destination-atop",t.fillStyle=A,t.fillRect(g,b,s,i),t.restore()}}e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0),a==="Alpha"&&l?e.filter=this.filterFactory.addAlphaFilter(l):a==="Luminosity"&&(e.filter=this.filterFactory.addLuminosityFilter(l));const w=new Path2D;w.rect(h,c,s,i),e.clip(w),e.globalCompositeOperation="destination-in",e.drawImage(f,g,b,s,i,h,c,s,i),e.restore()}save(){this.inSMaskMode&&Oa(this.ctx,this.suspendedCtx),this.ctx.save();const t=this.current;this.stateStack.push(t),this.current=t.clone()}restore(){if(this.stateStack.length===0){this.inSMaskMode&&this.endSMaskMode();return}this.current=this.stateStack.pop(),this.ctx.restore(),this.inSMaskMode&&Oa(this.suspendedCtx,this.ctx),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}transform(t,e,s,i,a,o){this.ctx.transform(t,e,s,i,a,o),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(t,e,s){let[i]=e;if(!s){i||(i=e[0]=new Path2D),this[t](i);return}if(!(i instanceof Path2D)){const a=e[0]=new Path2D;for(let o=0,l=i.length;o<l;)switch(i[o++]){case Mo.moveTo:a.moveTo(i[o++],i[o++]);break;case Mo.lineTo:a.lineTo(i[o++],i[o++]);break;case Mo.curveTo:a.bezierCurveTo(i[o++],i[o++],i[o++],i[o++],i[o++],i[o++]);break;case Mo.closePath:a.closePath();break;default:z(`Unrecognized drawing path operator: ${i[o-1]}`);break}i=a}this.current.updateRectMinMax(nt(this.ctx),s),this[t](i)}closePath(){this.ctx.closePath()}stroke(t,e=!0){const s=this.ctx,i=this.current.strokeColor;if(s.globalAlpha=this.current.strokeAlpha,this.contentVisible)if(typeof i=="object"&&i!=null&&i.getPattern){const a=i.isModifyingCurrentTransform()?s.getTransform():null;if(s.save(),s.strokeStyle=i.getPattern(s,this,Ge(s),Wt.STROKE),a){const o=new Path2D;o.addPath(t,s.getTransform().invertSelf().multiplySelf(a)),t=o}this.rescaleAndStroke(t,!1),s.restore()}else this.rescaleAndStroke(t,!0);e&&this.consumePath(t,this.current.getClippedPathBoundingBox(Wt.STROKE,nt(this.ctx))),s.globalAlpha=this.current.fillAlpha}closeStroke(t){this.stroke(t)}fill(t,e=!0){const s=this.ctx,i=this.current.fillColor,a=this.current.patternFill;let o=!1;if(a){const h=i.isModifyingCurrentTransform()?s.getTransform():null;if(s.save(),s.fillStyle=i.getPattern(s,this,Ge(s),Wt.FILL),h){const c=new Path2D;c.addPath(t,s.getTransform().invertSelf().multiplySelf(h)),t=c}o=!0}const l=this.current.getClippedPathBoundingBox();this.contentVisible&&l!==null&&(this.pendingEOFill?(s.fill(t,"evenodd"),this.pendingEOFill=!1):s.fill(t)),o&&s.restore(),e&&this.consumePath(t,l)}eoFill(t){this.pendingEOFill=!0,this.fill(t)}fillStroke(t){this.fill(t,!1),this.stroke(t,!1),this.consumePath(t)}eoFillStroke(t){this.pendingEOFill=!0,this.fillStroke(t)}closeFillStroke(t){this.fillStroke(t)}closeEOFillStroke(t){this.pendingEOFill=!0,this.fillStroke(t)}endPath(t){this.consumePath(t)}clip(){this.pendingClip=Wg}eoClip(){this.pendingClip=vu}beginText(){this.current.textMatrix=Nu,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const t=this.pendingTextPaths,e=this.ctx;if(t===void 0){e.beginPath();return}const s=new Path2D,i=e.getTransform().invertSelf();for(const{transform:a,x:o,y:l,fontSize:h,path:c}of t)s.addPath(c,new DOMMatrix(a).preMultiplySelf(i).translate(o,l).scale(h,-h));e.clip(s),e.beginPath(),delete this.pendingTextPaths}setCharSpacing(t){this.current.charSpacing=t}setWordSpacing(t){this.current.wordSpacing=t}setHScale(t){this.current.textHScale=t/100}setLeading(t){this.current.leading=-t}setFont(t,e){var s;const i=this.commonObjs.get(t),a=this.current;if(!i)throw new Error(`Can't find font for ${t}`);if(a.fontMatrix=i.fontMatrix||lc,(a.fontMatrix[0]===0||a.fontMatrix[3]===0)&&z("Invalid font matrix for font "+t),e<0?(e=-e,a.fontDirection=-1):a.fontDirection=1,this.current.font=i,this.current.fontSize=e,i.isType3Font)return;const o=i.loadedName||"sans-serif",l=((s=i.systemFontInfo)==null?void 0:s.css)||`"${o}", ${i.fallbackName}`;let h="normal";i.black?h="900":i.bold&&(h="bold");const c=i.italic?"italic":"normal";let d=e;e<hu?d=hu:e>cu&&(d=cu),this.current.fontSizeScale=e/d,this.ctx.font=`${c} ${h} ${d}px ${l}`}setTextRenderingMode(t){this.current.textRenderingMode=t}setTextRise(t){this.current.textRise=t}moveText(t,e){this.current.x=this.current.lineX+=t,this.current.y=this.current.lineY+=e}setLeadingMoveText(t,e){this.setLeading(-e),this.moveText(t,e)}setTextMatrix(t,e,s,i,a,o){this.current.textMatrix=[t,e,s,i,a,o],this.current.textMatrixScale=Math.hypot(t,e),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(t,e,s,i,a){const o=this.ctx,l=this.current,h=l.font,c=l.textRenderingMode,d=l.fontSize/l.fontSizeScale,u=c&Ht.FILL_STROKE_MASK,f=!!(c&Ht.ADD_TO_PATH_FLAG),g=l.patternFill&&!h.missingFile,b=l.patternStroke&&!h.missingFile;let w;if((h.disableFontFace||f||g||b)&&(w=h.getPathGenerator(this.commonObjs,t)),h.disableFontFace||g||b){o.save(),o.translate(e,s),o.scale(d,-d);let A;if((u===Ht.FILL||u===Ht.FILL_STROKE)&&(i?(A=o.getTransform(),o.setTransform(...i),o.fill(v(this,zs,Oc).call(this,w,A,i))):o.fill(w)),u===Ht.STROKE||u===Ht.FILL_STROKE)if(a){A||(A=o.getTransform()),o.setTransform(...a);const{a:y,b:S,c:_,d:x}=A,k=L.inverseTransform(a),E=L.transform([y,S,_,x,0,0],k),[M,C]=L.singularValueDecompose2dScale(E);o.lineWidth*=Math.max(M,C)/d,o.stroke(v(this,zs,Oc).call(this,w,A,a))}else o.lineWidth/=d,o.stroke(w);o.restore()}else(u===Ht.FILL||u===Ht.FILL_STROKE)&&o.fillText(t,e,s),(u===Ht.STROKE||u===Ht.FILL_STROKE)&&o.strokeText(t,e,s);f&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:nt(o),x:e,y:s,fontSize:d,path:w})}get isFontSubpixelAAEnabled(){const{context:t}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);t.scale(1.5,1),t.fillText("I",0,10);const e=t.getImageData(0,0,10,10).data;let s=!1;for(let i=3;i<e.length;i+=4)if(e[i]>0&&e[i]<255){s=!0;break}return j(this,"isFontSubpixelAAEnabled",s)}showText(t){const e=this.current,s=e.font;if(s.isType3Font)return this.showType3Text(t);const i=e.fontSize;if(i===0)return;const a=this.ctx,o=e.fontSizeScale,l=e.charSpacing,h=e.wordSpacing,c=e.fontDirection,d=e.textHScale*c,u=t.length,f=s.vertical,g=f?1:-1,b=s.defaultVMetrics,w=i*e.fontMatrix[0],A=e.textRenderingMode===Ht.FILL&&!s.disableFontFace&&!e.patternFill;a.save(),a.transform(...e.textMatrix),a.translate(e.x,e.y+e.textRise),c>0?a.scale(d,-1):a.scale(d,1);let y,S;if(e.patternFill){a.save();const M=e.fillColor.getPattern(a,this,Ge(a),Wt.FILL);y=nt(a),a.restore(),a.fillStyle=M}if(e.patternStroke){a.save();const M=e.strokeColor.getPattern(a,this,Ge(a),Wt.STROKE);S=nt(a),a.restore(),a.strokeStyle=M}let _=e.lineWidth;const x=e.textMatrixScale;if(x===0||_===0){const M=e.textRenderingMode&Ht.FILL_STROKE_MASK;(M===Ht.STROKE||M===Ht.FILL_STROKE)&&(_=this.getSinglePixelWidth())}else _/=x;if(o!==1&&(a.scale(o,o),_/=o),a.lineWidth=_,s.isInvalidPDFjsFont){const M=[];let C=0;for(const T of t)M.push(T.unicode),C+=T.width;a.fillText(M.join(""),0,0),e.x+=C*w*d,a.restore(),this.compose();return}let k=0,E;for(E=0;E<u;++E){const M=t[E];if(typeof M=="number"){k+=g*M*i/1e3;continue}let C=!1;const T=(M.isSpace?h:0)+l,N=M.fontChar,W=M.accent;let Y,q,tt=M.width;if(f){const P=M.vmetric||b,xt=-(M.vmetric?P[1]:tt*.5)*w,le=P[2]*w;tt=P?-P[0]:tt,Y=xt/o,q=(k+le)/o}else Y=k/o,q=0;if(s.remeasure&&tt>0){const P=a.measureText(N).width*1e3/i*o;if(tt<P&&this.isFontSubpixelAAEnabled){const xt=tt/P;C=!0,a.save(),a.scale(xt,1),Y/=xt}else tt!==P&&(Y+=(tt-P)/2e3*i/o)}if(this.contentVisible&&(M.isInFont||s.missingFile)){if(A&&!W)a.fillText(N,Y,q);else if(this.paintChar(N,Y,q,y,S),W){const P=Y+i*W.offset.x/o,xt=q-i*W.offset.y/o;this.paintChar(W.fontChar,P,xt,y,S)}}const B=f?tt*w-T*c:tt*w+T*c;k+=B,C&&a.restore()}f?e.y-=k:e.x+=k*d,a.restore(),this.compose()}showType3Text(t){const e=this.ctx,s=this.current,i=s.font,a=s.fontSize,o=s.fontDirection,l=i.vertical?1:-1,h=s.charSpacing,c=s.wordSpacing,d=s.textHScale*o,u=s.fontMatrix||lc,f=t.length,g=s.textRenderingMode===Ht.INVISIBLE;let b,w,A,y;if(!(g||a===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,e.save(),e.transform(...s.textMatrix),e.translate(s.x,s.y+s.textRise),e.scale(d,o),b=0;b<f;++b){if(w=t[b],typeof w=="number"){y=l*w*a/1e3,this.ctx.translate(y,0),s.x+=y*d;continue}const S=(w.isSpace?c:0)+h,_=i.charProcOperatorList[w.operatorListId];_?this.contentVisible&&(this.processingType3=w,this.save(),e.scale(a,a),e.transform(...u),this.executeOperatorList(_),this.restore()):z(`Type3 character "${w.operatorListId}" is not available.`),A=L.applyTransform([w.width,0],u)[0]*a+S,e.translate(A,0),s.x+=A*d}e.restore(),this.processingType3=null}}setCharWidth(t,e){}setCharWidthAndBounds(t,e,s,i,a,o){this.ctx.rect(s,i,a-s,o-i),this.ctx.clip(),this.endPath()}getColorN_Pattern(t){let e;if(t[0]==="TilingPattern"){const s=this.baseTransform||nt(this.ctx),i={createCanvasGraphics:a=>new xp(a,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};e=new Rg(t,this.ctx,i,s)}else e=this._getPattern(t[1],t[2]);return e}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments),this.current.patternStroke=!0}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(t,e,s){this.ctx.strokeStyle=this.current.strokeColor=L.makeHexColor(t,e,s),this.current.patternStroke=!1}setStrokeTransparent(){this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(t,e,s){this.ctx.fillStyle=this.current.fillColor=L.makeHexColor(t,e,s),this.current.patternFill=!1}setFillTransparent(){this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(t,e=null){let s;return this.cachedPatterns.has(t)?s=this.cachedPatterns.get(t):(s=Tg(this.getObject(t)),this.cachedPatterns.set(t,s)),e&&(s.matrix=e),s}shadingFill(t){if(!this.contentVisible)return;const e=this.ctx;this.save();const s=this._getPattern(t);e.fillStyle=s.getPattern(e,this,Ge(e),Wt.SHADING);const i=Ge(e);if(i){const{width:a,height:o}=e.canvas,[l,h,c,d]=L.getAxialAlignedBoundingBox([0,0,a,o],i);this.ctx.fillRect(l,h,c-l,d-h)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){Z("Should not call beginInlineImage")}beginImageData(){Z("Should not call beginImageData")}paintFormXObjectBegin(t,e){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),t&&this.transform(...t),this.baseTransform=nt(this.ctx),e)){const s=e[2]-e[0],i=e[3]-e[1];this.ctx.rect(e[0],e[1],s,i),this.current.updateRectMinMax(nt(this.ctx),e),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(t){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const e=this.ctx;t.isolated||zh("TODO: Support non-isolated groups."),t.knockout&&z("Knockout groups not supported.");const s=nt(e);if(t.matrix&&e.transform(...t.matrix),!t.bbox)throw new Error("Bounding box is required.");let i=L.getAxialAlignedBoundingBox(t.bbox,nt(e));const a=[0,0,e.canvas.width,e.canvas.height];i=L.intersect(i,a)||[0,0,0,0];const o=Math.floor(i[0]),l=Math.floor(i[1]),h=Math.max(Math.ceil(i[2])-o,1),c=Math.max(Math.ceil(i[3])-l,1);this.current.startNewPathAndClipBox([0,0,h,c]);let d="groupAt"+this.groupLevel;t.smask&&(d+="_smask_"+this.smaskCounter++%2);const u=this.cachedCanvases.getCanvas(d,h,c),f=u.context;f.translate(-o,-l),f.transform(...s);let g=new Path2D;const[b,w,A,y]=t.bbox;if(g.rect(b,w,A-b,y-w),t.matrix){const S=new Path2D;S.addPath(g,new DOMMatrix(t.matrix)),g=S}f.clip(g),t.smask?this.smaskStack.push({canvas:u.canvas,context:f,offsetX:o,offsetY:l,subtype:t.smask.subtype,backdrop:t.smask.backdrop,transferMap:t.smask.transferMap||null,startTransformInverse:null}):(e.setTransform(1,0,0,1,0,0),e.translate(o,l),e.save()),Oa(e,f),this.ctx=f,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(e),this.groupLevel++}endGroup(t){if(!this.contentVisible)return;this.groupLevel--;const e=this.ctx,s=this.groupStack.pop();if(this.ctx=s,this.ctx.imageSmoothingEnabled=!1,t.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const i=nt(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...i);const a=L.getAxialAlignedBoundingBox([0,0,e.canvas.width,e.canvas.height],i);this.ctx.drawImage(e.canvas,0,0),this.ctx.restore(),this.compose(a)}}beginAnnotation(t,e,s,i,a){if(v(this,zs,Nc).call(this),Do(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),e){const o=e[2]-e[0],l=e[3]-e[1];if(a&&this.annotationCanvasMap){s=s.slice(),s[4]-=e[0],s[5]-=e[1],e=e.slice(),e[0]=e[1]=0,e[2]=o,e[3]=l;const[h,c]=L.singularValueDecompose2dScale(nt(this.ctx)),{viewportScale:d}=this,u=Math.ceil(o*this.outputScaleX*d),f=Math.ceil(l*this.outputScaleY*d);this.annotationCanvas=this.canvasFactory.create(u,f);const{canvas:g,context:b}=this.annotationCanvas;this.annotationCanvasMap.set(t,g),this.annotationCanvas.savedCtx=this.ctx,this.ctx=b,this.ctx.save(),this.ctx.setTransform(h,0,0,-c,0,l*c),Do(this.ctx)}else Do(this.ctx),this.endPath(),this.ctx.rect(e[0],e[1],o,l),this.ctx.clip(),this.ctx.beginPath()}this.current=new pu(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...s),this.transform(...i)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),v(this,zs,Fc).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(t){if(!this.contentVisible)return;const e=t.count;t=this.getObject(t.data,t),t.count=e;const s=this.ctx,i=this.processingType3;if(i&&(i.compiled===void 0&&(i.compiled=Ng(t)),i.compiled)){s.fill(i.compiled);return}const a=this._createMaskCanvas(t),o=a.canvas;s.save(),s.setTransform(1,0,0,1,0,0),s.drawImage(o,a.offsetX,a.offsetY),s.restore(),this.compose()}paintImageMaskXObjectRepeat(t,e,s=0,i=0,a,o){if(!this.contentVisible)return;t=this.getObject(t.data,t);const l=this.ctx;l.save();const h=nt(l);l.transform(e,s,i,a,0,0);const c=this._createMaskCanvas(t);l.setTransform(1,0,0,1,c.offsetX-h[4],c.offsetY-h[5]);for(let d=0,u=o.length;d<u;d+=2){const f=L.transform(h,[e,s,i,a,o[d],o[d+1]]),[g,b]=L.applyTransform([0,0],f);l.drawImage(c.canvas,g,b)}l.restore(),this.compose()}paintImageMaskXObjectGroup(t){if(!this.contentVisible)return;const e=this.ctx,s=this.current.fillColor,i=this.current.patternFill;for(const a of t){const{data:o,width:l,height:h,transform:c}=a,d=this.cachedCanvases.getCanvas("maskCanvas",l,h),u=d.context;u.save();const f=this.getObject(o,a);gu(u,f),u.globalCompositeOperation="source-in",u.fillStyle=i?s.getPattern(u,this,Ge(e),Wt.FILL):s,u.fillRect(0,0,l,h),u.restore(),e.save(),e.transform(...c),e.scale(1,-1),Lo(e,d.canvas,0,0,l,h,0,-1,1,1),e.restore()}this.compose()}paintImageXObject(t){if(!this.contentVisible)return;const e=this.getObject(t);if(!e){z("Dependent image isn't ready yet");return}this.paintInlineImageXObject(e)}paintImageXObjectRepeat(t,e,s,i){if(!this.contentVisible)return;const a=this.getObject(t);if(!a){z("Dependent image isn't ready yet");return}const o=a.width,l=a.height,h=[];for(let c=0,d=i.length;c<d;c+=2)h.push({transform:[e,0,0,s,i[c],i[c+1]],x:0,y:0,w:o,h:l});this.paintInlineImageXObjectGroup(a,h)}applyTransferMapsToCanvas(t){return this.current.transferMaps!=="none"&&(t.filter=this.current.transferMaps,t.drawImage(t.canvas,0,0),t.filter="none"),t.canvas}applyTransferMapsToBitmap(t){if(this.current.transferMaps==="none")return t.bitmap;const{bitmap:e,width:s,height:i}=t,a=this.cachedCanvases.getCanvas("inlineImage",s,i),o=a.context;return o.filter=this.current.transferMaps,o.drawImage(e,0,0),o.filter="none",a.canvas}paintInlineImageXObject(t){if(!this.contentVisible)return;const e=t.width,s=t.height,i=this.ctx;if(this.save(),!Nt){const{filter:l}=i;l!=="none"&&l!==""&&(i.filter="none")}i.scale(1/e,-1/s);let a;if(t.bitmap)a=this.applyTransferMapsToBitmap(t);else if(typeof HTMLElement=="function"&&t instanceof HTMLElement||!t.data)a=t;else{const l=this.cachedCanvases.getCanvas("inlineImage",e,s).context;fu(l,t),a=this.applyTransferMapsToCanvas(l)}const o=this._scaleImage(a,Ge(i));i.imageSmoothingEnabled=mu(nt(i),t.interpolate),Lo(i,o.img,0,0,o.paintWidth,o.paintHeight,0,-s,e,s),this.compose(),this.restore()}paintInlineImageXObjectGroup(t,e){if(!this.contentVisible)return;const s=this.ctx;let i;if(t.bitmap)i=t.bitmap;else{const a=t.width,o=t.height,l=this.cachedCanvases.getCanvas("inlineImage",a,o).context;fu(l,t),i=this.applyTransferMapsToCanvas(l)}for(const a of e)s.save(),s.transform(...a.transform),s.scale(1,-1),Lo(s,i,a.x,a.y,a.w,a.h,0,-1,1,1),s.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(t){}markPointProps(t,e){}beginMarkedContent(t){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(t,e){t==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(e)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(t,e){const s=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(e);const i=this.ctx;this.pendingClip&&(s||(this.pendingClip===vu?i.clip(t,"evenodd"):i.clip(t)),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),i.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const t=nt(this.ctx);if(t[1]===0&&t[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(t[0]),Math.abs(t[3]));else{const e=Math.abs(t[0]*t[3]-t[2]*t[1]),s=Math.hypot(t[0],t[2]),i=Math.hypot(t[1],t[3]);this._cachedGetSinglePixelWidth=Math.max(s,i)/e}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:t}=this.current,{a:e,b:s,c:i,d:a}=this.ctx.getTransform();let o,l;if(s===0&&i===0){const h=Math.abs(e),c=Math.abs(a);if(h===c)if(t===0)o=l=1/h;else{const d=h*t;o=l=d<1?1/d:1}else if(t===0)o=1/h,l=1/c;else{const d=h*t,u=c*t;o=d<1?1/d:1,l=u<1?1/u:1}}else{const h=Math.abs(e*a-s*i),c=Math.hypot(e,s),d=Math.hypot(i,a);if(t===0)o=d/h,l=c/h;else{const u=t*h;o=d>u?d/u:1,l=c>u?c/u:1}}this._cachedScaleForStroking[0]=o,this._cachedScaleForStroking[1]=l}return this._cachedScaleForStroking}rescaleAndStroke(t,e){const{ctx:s,current:{lineWidth:i}}=this,[a,o]=this.getScaleForStroking();if(a===o){s.lineWidth=(i||1)*a,s.stroke(t);return}const l=s.getLineDash();e&&s.save(),s.scale(a,o),tc.a=1/a,tc.d=1/o;const h=new Path2D;if(h.addPath(t,tc),l.length>0){const c=Math.max(a,o);s.setLineDash(l.map(d=>d/c)),s.lineDashOffset/=c}s.lineWidth=i||1,s.stroke(h),e&&s.restore()}isContentVisible(){for(let t=this.markedContentStack.length-1;t>=0;t--)if(!this.markedContentStack[t].visible)return!1;return!0}};zs=new WeakSet,Nc=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},Fc=function(){if(this.pageColors){const r=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(r!=="none"){const t=this.ctx.filter;this.ctx.filter=r,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=t}}},Oc=function(r,t,e){const s=new Path2D;return s.addPath(r,new DOMMatrix(e).invertSelf().multiplySelf(t)),s};let ll=Bg;for(const r in Zl)ll.prototype[r]!==void 0&&(ll.prototype[Zl[r]]=ll.prototype[r]);var dh,uh;class Ai{static get workerPort(){return n(this,dh)}static set workerPort(t){if(!(typeof Worker<"u"&&t instanceof Worker)&&t!==null)throw new Error("Invalid `workerPort` type.");p(this,dh,t)}static get workerSrc(){return n(this,uh)}static set workerSrc(t){if(typeof t!="string")throw new Error("Invalid `workerSrc` type.");p(this,uh,t)}}dh=new WeakMap,uh=new WeakMap,m(Ai,dh,null),m(Ai,uh,"");var zn,hl;class $g{constructor({parsedData:t,rawData:e}){m(this,zn),m(this,hl),p(this,zn,t),p(this,hl,e)}getRaw(){return n(this,hl)}get(t){return n(this,zn).get(t)??null}getAll(){return Cd(n(this,zn))}has(t){return n(this,zn).has(t)}}zn=new WeakMap,hl=new WeakMap;const Un=Symbol("INTERNAL");var cl,dl,ul,hr;class Hg{constructor(t,{name:e,intent:s,usage:i,rbGroups:a}){m(this,cl,!1),m(this,dl,!1),m(this,ul,!1),m(this,hr,!0),p(this,cl,!!(t&pe.DISPLAY)),p(this,dl,!!(t&pe.PRINT)),this.name=e,this.intent=s,this.usage=i,this.rbGroups=a}get visible(){if(n(this,ul))return n(this,hr);if(!n(this,hr))return!1;const{print:t,view:e}=this.usage;return n(this,cl)?(e==null?void 0:e.viewState)!=="OFF":n(this,dl)?(t==null?void 0:t.printState)!=="OFF":!0}_setVisible(t,e,s=!1){t!==Un&&Z("Internal method `_setVisible` called."),p(this,ul,s),p(this,hr,e)}}cl=new WeakMap,dl=new WeakMap,ul=new WeakMap,hr=new WeakMap;var Ii,Q,cr,dr,ph,Wc;class Gg{constructor(t,e=pe.DISPLAY){if(m(this,ph),m(this,Ii,null),m(this,Q,new Map),m(this,cr,null),m(this,dr,null),this.renderingIntent=e,this.name=null,this.creator=null,t!==null){this.name=t.name,this.creator=t.creator,p(this,dr,t.order);for(const s of t.groups)n(this,Q).set(s.id,new Hg(e,s));if(t.baseState==="OFF")for(const s of n(this,Q).values())s._setVisible(Un,!1);for(const s of t.on)n(this,Q).get(s)._setVisible(Un,!0);for(const s of t.off)n(this,Q).get(s)._setVisible(Un,!1);p(this,cr,this.getHash())}}isVisible(t){if(n(this,Q).size===0)return!0;if(!t)return zh("Optional content group not defined."),!0;if(t.type==="OCG")return n(this,Q).has(t.id)?n(this,Q).get(t.id).visible:(z(`Optional content group not found: ${t.id}`),!0);if(t.type==="OCMD"){if(t.expression)return v(this,ph,Wc).call(this,t.expression);if(!t.policy||t.policy==="AnyOn"){for(const e of t.ids){if(!n(this,Q).has(e))return z(`Optional content group not found: ${e}`),!0;if(n(this,Q).get(e).visible)return!0}return!1}else if(t.policy==="AllOn"){for(const e of t.ids){if(!n(this,Q).has(e))return z(`Optional content group not found: ${e}`),!0;if(!n(this,Q).get(e).visible)return!1}return!0}else if(t.policy==="AnyOff"){for(const e of t.ids){if(!n(this,Q).has(e))return z(`Optional content group not found: ${e}`),!0;if(!n(this,Q).get(e).visible)return!0}return!1}else if(t.policy==="AllOff"){for(const e of t.ids){if(!n(this,Q).has(e))return z(`Optional content group not found: ${e}`),!0;if(n(this,Q).get(e).visible)return!1}return!0}return z(`Unknown optional content policy ${t.policy}.`),!0}return z(`Unknown group type ${t.type}.`),!0}setVisibility(t,e=!0,s=!0){var i;const a=n(this,Q).get(t);if(!a){z(`Optional content group not found: ${t}`);return}if(s&&e&&a.rbGroups.length)for(const o of a.rbGroups)for(const l of o)l!==t&&((i=n(this,Q).get(l))==null||i._setVisible(Un,!1,!0));a._setVisible(Un,!!e,!0),p(this,Ii,null)}setOCGState({state:t,preserveRB:e}){let s;for(const i of t){switch(i){case"ON":case"OFF":case"Toggle":s=i;continue}const a=n(this,Q).get(i);if(a)switch(s){case"ON":this.setVisibility(i,!0,e);break;case"OFF":this.setVisibility(i,!1,e);break;case"Toggle":this.setVisibility(i,!a.visible,e);break}}p(this,Ii,null)}get hasInitialVisibility(){return n(this,cr)===null||this.getHash()===n(this,cr)}getOrder(){return n(this,Q).size?n(this,dr)?n(this,dr).slice():[...n(this,Q).keys()]:null}getGroups(){return n(this,Q).size>0?Cd(n(this,Q)):null}getGroup(t){return n(this,Q).get(t)||null}getHash(){if(n(this,Ii)!==null)return n(this,Ii);const t=new up;for(const[e,s]of n(this,Q))t.update(`${e}:${s.visible}`);return p(this,Ii,t.hexdigest())}}Ii=new WeakMap,Q=new WeakMap,cr=new WeakMap,dr=new WeakMap,ph=new WeakSet,Wc=function(r){const t=r.length;if(t<2)return!0;const e=r[0];for(let s=1;s<t;s++){const i=r[s];let a;if(Array.isArray(i))a=v(this,ph,Wc).call(this,i);else if(n(this,Q).has(i))a=n(this,Q).get(i).visible;else return z(`Optional content group not found: ${i}`),!0;switch(e){case"And":if(!a)return!1;break;case"Or":if(a)return!0;break;case"Not":return!a;default:return!0}}return e==="And"};class zg{constructor(t,{disableRange:e=!1,disableStream:s=!1}){wt(t,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:i,initialData:a,progressiveDone:o,contentDispositionFilename:l}=t;if(this._queuedChunks=[],this._progressiveDone=o,this._contentDispositionFilename=l,(a==null?void 0:a.length)>0){const h=a instanceof Uint8Array&&a.byteLength===a.buffer.byteLength?a.buffer:new Uint8Array(a).buffer;this._queuedChunks.push(h)}this._pdfDataRangeTransport=t,this._isStreamingSupported=!s,this._isRangeSupported=!e,this._contentLength=i,this._fullRequestReader=null,this._rangeReaders=[],t.addRangeListener((h,c)=>{this._onReceiveData({begin:h,chunk:c})}),t.addProgressListener((h,c)=>{this._onProgress({loaded:h,total:c})}),t.addProgressiveReadListener(h=>{this._onReceiveData({chunk:h})}),t.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),t.transportReady()}_onReceiveData({begin:t,chunk:e}){const s=e instanceof Uint8Array&&e.byteLength===e.buffer.byteLength?e.buffer:new Uint8Array(e).buffer;if(t===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(s):this._queuedChunks.push(s);else{const i=this._rangeReaders.some(function(a){return a._begin!==t?!1:(a._enqueue(s),!0)});wt(i,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var t;return((t=this._fullRequestReader)==null?void 0:t._loaded)??0}_onProgress(t){var e,s,i,a;t.total===void 0?(s=(e=this._rangeReaders[0])==null?void 0:e.onProgress)==null||s.call(e,{loaded:t.loaded}):(a=(i=this._fullRequestReader)==null?void 0:i.onProgress)==null||a.call(i,{loaded:t.loaded,total:t.total})}_onProgressiveDone(){var t;(t=this._fullRequestReader)==null||t.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(t){const e=this._rangeReaders.indexOf(t);e>=0&&this._rangeReaders.splice(e,1)}getFullReader(){wt(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const t=this._queuedChunks;return this._queuedChunks=null,new Ug(this,t,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const s=new jg(this,t,e);return this._pdfDataRangeTransport.requestDataRange(t,e),this._rangeReaders.push(s),s}cancelAllRequests(t){var e;(e=this._fullRequestReader)==null||e.cancel(t);for(const s of this._rangeReaders.slice(0))s.cancel(t);this._pdfDataRangeTransport.abort()}}class Ug{constructor(t,e,s=!1,i=null){this._stream=t,this._done=s||!1,this._filename=Pd(i)?i:null,this._queuedChunks=e||[],this._loaded=0;for(const a of this._queuedChunks)this._loaded+=a.byteLength;this._requests=[],this._headersReady=Promise.resolve(),t._fullRequestReader=this,this.onProgress=null}_enqueue(t){this._done||(this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunks.push(t),this._loaded+=t.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class jg{constructor(t,e,s){this._stream=t,this._begin=e,this._end=s,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(t){if(!this._done){if(this._requests.length===0)this._queuedChunk=t;else{this._requests.shift().resolve({value:t,done:!1});for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function Vg(r){let t=!0,e=s("filename\\*","i").exec(r);if(e){e=e[1];let d=l(e);return d=unescape(d),d=h(d),d=c(d),a(d)}if(e=o(r),e){const d=c(e);return a(d)}if(e=s("filename","i").exec(r),e){e=e[1];let d=l(e);return d=c(d),a(d)}function s(d,u){return new RegExp("(?:^|;)\\s*"+d+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',u)}function i(d,u){if(d){if(!/^[\x00-\xFF]+$/.test(u))return u;try{const f=new TextDecoder(d,{fatal:!0}),g=Ao(u);u=f.decode(g),t=!1}catch{}}return u}function a(d){return t&&/[\x80-\xff]/.test(d)&&(d=i("utf-8",d),t&&(d=i("iso-8859-1",d))),d}function o(d){const u=[];let f;const g=s("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(f=g.exec(d))!==null;){let[,w,A,y]=f;if(w=parseInt(w,10),w in u){if(w===0)break;continue}u[w]=[A,y]}const b=[];for(let w=0;w<u.length&&w in u;++w){let[A,y]=u[w];y=l(y),A&&(y=unescape(y),w===0&&(y=h(y))),b.push(y)}return b.join("")}function l(d){if(d.startsWith('"')){const u=d.slice(1).split('\\"');for(let f=0;f<u.length;++f){const g=u[f].indexOf('"');g!==-1&&(u[f]=u[f].slice(0,g),u.length=f+1),u[f]=u[f].replaceAll(/\\(.)/g,"$1")}d=u.join('"')}return d}function h(d){const u=d.indexOf("'");if(u===-1)return d;const f=d.slice(0,u),g=d.slice(u+1).replace(/^[^']*'/,"");return i(f,g)}function c(d){return!d.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(d)?d:d.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(u,f,g,b){if(g==="q"||g==="Q")return b=b.replaceAll("_"," "),b=b.replaceAll(/=([0-9a-fA-F]{2})/g,function(w,A){return String.fromCharCode(parseInt(A,16))}),i(f,b);try{b=atob(b)}catch{}return i(f,b)})}return""}function Ep(r,t){const e=new Headers;if(!r||!t||typeof t!="object")return e;for(const s in t){const i=t[s];i!==void 0&&e.append(s,i)}return e}function jh(r){var t;return((t=URL.parse(r))==null?void 0:t.origin)??null}function kp({responseHeaders:r,isHttp:t,rangeChunkSize:e,disableRange:s}){const i={allowRangeRequests:!1,suggestedLength:void 0},a=parseInt(r.get("Content-Length"),10);return!Number.isInteger(a)||(i.suggestedLength=a,a<=2*e)||s||!t||r.get("Accept-Ranges")!=="bytes"||(r.get("Content-Encoding")||"identity")!=="identity"||(i.allowRangeRequests=!0),i}function Mp(r){const t=r.get("Content-Disposition");if(t){let e=Vg(t);if(e.includes("%"))try{e=decodeURIComponent(e)}catch{}if(Pd(e))return e}return null}function xo(r,t){return new th(`Unexpected server response (${r}) while retrieving PDF "${t}".`,r,r===404||r===0&&t.startsWith("file:"))}function Cp(r){return r===200||r===206}function Tp(r,t,e){return{method:"GET",headers:r,signal:e.signal,mode:"cors",credentials:t?"include":"same-origin",redirect:"follow"}}function Rp(r){return r instanceof Uint8Array?r.buffer:r instanceof ArrayBuffer?r:(z(`getArrayBuffer - unexpected data format: ${r}`),new Uint8Array(r).buffer)}class wu{constructor(t){I(this,"_responseOrigin",null),this.source=t,this.isHttp=/^https?:/i.test(t.url),this.headers=Ep(this.isHttp,t.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var t;return((t=this._fullRequestReader)==null?void 0:t._loaded)??0}getFullReader(){return wt(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new qg(this),this._fullRequestReader}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const s=new Xg(this,t,e);return this._rangeRequestReaders.push(s),s}cancelAllRequests(t){var e;(e=this._fullRequestReader)==null||e.cancel(t);for(const s of this._rangeRequestReaders.slice(0))s.cancel(t)}}class qg{constructor(t){this._stream=t,this._reader=null,this._loaded=0,this._filename=null;const e=t.source;this._withCredentials=e.withCredentials||!1,this._contentLength=e.length,this._headersCapability=Promise.withResolvers(),this._disableRange=e.disableRange||!1,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange;const s=new Headers(t.headers),i=e.url;fetch(i,Tp(s,this._withCredentials,this._abortController)).then(a=>{if(t._responseOrigin=jh(a.url),!Cp(a.status))throw xo(a.status,i);this._reader=a.body.getReader(),this._headersCapability.resolve();const o=a.headers,{allowRangeRequests:l,suggestedLength:h}=kp({responseHeaders:o,isHttp:t.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=l,this._contentLength=h||this._contentLength,this._filename=Mp(o),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new bi("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var t;await this._headersCapability.promise;const{value:e,done:s}=await this._reader.read();return s?{value:e,done:s}:(this._loaded+=e.byteLength,(t=this.onProgress)==null||t.call(this,{loaded:this._loaded,total:this._contentLength}),{value:Rp(e),done:!1})}cancel(t){var e;(e=this._reader)==null||e.cancel(t),this._abortController.abort()}}class Xg{constructor(t,e,s){this._stream=t,this._reader=null,this._loaded=0;const i=t.source;this._withCredentials=i.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!i.disableStream,this._abortController=new AbortController;const a=new Headers(t.headers);a.append("Range",`bytes=${e}-${s-1}`);const o=i.url;fetch(o,Tp(a,this._withCredentials,this._abortController)).then(l=>{const h=jh(l.url);if(h!==t._responseOrigin)throw new Error(`Expected range response-origin "${h}" to match "${t._responseOrigin}".`);if(!Cp(l.status))throw xo(l.status,o);this._readCapability.resolve(),this._reader=l.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){var t;await this._readCapability.promise;const{value:e,done:s}=await this._reader.read();return s?{value:e,done:s}:(this._loaded+=e.byteLength,(t=this.onProgress)==null||t.call(this,{loaded:this._loaded}),{value:Rp(e),done:!1})}cancel(t){var e;(e=this._reader)==null||e.cancel(t),this._abortController.abort()}}const ec=200,sc=206;function Yg(r){const t=r.response;return typeof t!="string"?t:Ao(t).buffer}class Kg{constructor({url:t,httpHeaders:e,withCredentials:s}){I(this,"_responseOrigin",null),this.url=t,this.isHttp=/^https?:/i.test(t),this.headers=Ep(this.isHttp,e),this.withCredentials=s||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(t){const e=new XMLHttpRequest,s=this.currXhrId++,i=this.pendingRequests[s]={xhr:e};e.open("GET",this.url),e.withCredentials=this.withCredentials;for(const[a,o]of this.headers)e.setRequestHeader(a,o);return this.isHttp&&"begin"in t&&"end"in t?(e.setRequestHeader("Range",`bytes=${t.begin}-${t.end-1}`),i.expectedStatus=sc):i.expectedStatus=ec,e.responseType="arraybuffer",wt(t.onError,"Expected `onError` callback to be provided."),e.onerror=()=>{t.onError(e.status)},e.onreadystatechange=this.onStateChange.bind(this,s),e.onprogress=this.onProgress.bind(this,s),i.onHeadersReceived=t.onHeadersReceived,i.onDone=t.onDone,i.onError=t.onError,i.onProgress=t.onProgress,e.send(null),s}onProgress(t,e){var s;const i=this.pendingRequests[t];i&&((s=i.onProgress)==null||s.call(i,e))}onStateChange(t,e){const s=this.pendingRequests[t];if(!s)return;const i=s.xhr;if(i.readyState>=2&&s.onHeadersReceived&&(s.onHeadersReceived(),delete s.onHeadersReceived),i.readyState!==4||!(t in this.pendingRequests))return;if(delete this.pendingRequests[t],i.status===0&&this.isHttp){s.onError(i.status);return}const a=i.status||ec;if(!(a===ec&&s.expectedStatus===sc)&&a!==s.expectedStatus){s.onError(i.status);return}const o=Yg(i);if(a===sc){const l=i.getResponseHeader("Content-Range"),h=/bytes (\d+)-(\d+)\/(\d+)/.exec(l);h?s.onDone({begin:parseInt(h[1],10),chunk:o}):(z('Missing or invalid "Content-Range" header.'),s.onError(0))}else o?s.onDone({begin:0,chunk:o}):s.onError(i.status)}getRequestXhr(t){return this.pendingRequests[t].xhr}isPendingRequest(t){return t in this.pendingRequests}abortRequest(t){const e=this.pendingRequests[t].xhr;delete this.pendingRequests[t],e.abort()}}class Qg{constructor(t){this._source=t,this._manager=new Kg(t),this._rangeChunkSize=t.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(t){const e=this._rangeRequestReaders.indexOf(t);e>=0&&this._rangeRequestReaders.splice(e,1)}getFullReader(){return wt(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new Jg(this._manager,this._source),this._fullRequestReader}getRangeReader(t,e){const s=new Zg(this._manager,t,e);return s.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(s),s}cancelAllRequests(t){var e;(e=this._fullRequestReader)==null||e.cancel(t);for(const s of this._rangeRequestReaders.slice(0))s.cancel(t)}}class Jg{constructor(t,e){this._manager=t,this._url=e.url,this._fullRequestId=t.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=e.disableRange||!1,this._contentLength=e.length,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const t=this._fullRequestId,e=this._manager.getRequestXhr(t);this._manager._responseOrigin=jh(e.responseURL);const s=e.getAllResponseHeaders(),i=new Headers(s?s.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(l=>{const[h,...c]=l.split(": ");return[h,c.join(": ")]}):[]),{allowRangeRequests:a,suggestedLength:o}=kp({responseHeaders:i,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});a&&(this._isRangeSupported=!0),this._contentLength=o||this._contentLength,this._filename=Mp(i),this._isRangeSupported&&this._manager.abortRequest(t),this._headersCapability.resolve()}_onDone(t){if(t&&(this._requests.length>0?this._requests.shift().resolve({value:t.chunk,done:!1}):this._cachedChunks.push(t.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(t){this._storedError=xo(t,this._url),this._headersCapability.reject(this._storedError);for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(t){var e;(e=this.onProgress)==null||e.call(this,{loaded:t.loaded,total:t.lengthComputable?t.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0,this._headersCapability.reject(t);for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class Zg{constructor(t,e,s){this._manager=t,this._url=t.url,this._requestId=t.request({begin:e,end:s,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){var t;const e=jh((t=this._manager.getRequestXhr(this._requestId))==null?void 0:t.responseURL);e!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${e}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){var t;(t=this.onClosed)==null||t.call(this,this)}_onDone(t){const e=t.chunk;this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunk=e,this._done=!0;for(const s of this._requests)s.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(t){this._storedError??(this._storedError=xo(t,this._url));for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(t){var e;this.isStreamingSupported||(e=this.onProgress)==null||e.call(this,{loaded:t.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const tm=/^[a-z][a-z0-9\-+.]+:/i;function em(r){if(tm.test(r))return new URL(r);const t=process.getBuiltinModule("url");return new URL(t.pathToFileURL(r))}class sm{constructor(t){this.source=t,this.url=em(t.url),wt(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var t;return((t=this._fullRequestReader)==null?void 0:t._loaded)??0}getFullReader(){return wt(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new im(this),this._fullRequestReader}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const s=new nm(this,t,e);return this._rangeRequestReaders.push(s),s}cancelAllRequests(t){var e;(e=this._fullRequestReader)==null||e.cancel(t);for(const s of this._rangeRequestReaders.slice(0))s.cancel(t)}}class im{constructor(t){this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null;const e=t.source;this._contentLength=e.length,this._loaded=0,this._filename=null,this._disableRange=e.disableRange||!1,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();const s=process.getBuiltinModule("fs");s.promises.lstat(this._url).then(i=>{this._contentLength=i.size,this._setReadableStream(s.createReadStream(this._url)),this._headersCapability.resolve()},i=>{i.code==="ENOENT"&&(i=xo(0,this._url.href)),this._storedError=i,this._headersCapability.reject(i)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var t;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,(t=this.onProgress)==null||t.call(this,{loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(e).buffer,done:!1})}cancel(t){if(!this._readableStream){this._error(t);return}this._readableStream.destroy(t)}_error(t){this._storedError=t,this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t,t.on("readable",()=>{this._readCapability.resolve()}),t.on("end",()=>{t.destroy(),this._done=!0,this._readCapability.resolve()}),t.on("error",e=>{this._error(e)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new bi("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class nm{constructor(t,e,s){this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const i=t.source;this._isStreamingSupported=!i.disableStream;const a=process.getBuiltinModule("fs");this._setReadableStream(a.createReadStream(this._url,{start:e,end:s-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){var t;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,(t=this.onProgress)==null||t.call(this,{loaded:this._loaded}),{value:new Uint8Array(e).buffer,done:!1})}cancel(t){if(!this._readableStream){this._error(t);return}this._readableStream.destroy(t)}_error(t){this._storedError=t,this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t,t.on("readable",()=>{this._readCapability.resolve()}),t.on("end",()=>{t.destroy(),this._done=!0,this._readCapability.resolve()}),t.on("error",e=>{this._error(e)}),this._storedError&&this._readableStream.destroy(this._storedError)}}const am=1e5,bu=30;var Au,Li,ce,pl,fl,on,oi,fh,gh,jn,Kr,ur,ln,Qr,mh,pr,Ea,vh,wh,fr,da,No,_i,Jr,ka,Pp,yu,Bc,Es,gl,ic,Ip,_u;const te=class gr{constructor({textContentSource:t,container:e,viewport:s}){m(this,ka),m(this,Li,Promise.withResolvers()),m(this,ce,null),m(this,pl,!1),m(this,fl,!!((Au=globalThis.FontInspector)!=null&&Au.enabled)),m(this,on,null),m(this,oi,null),m(this,fh,0),m(this,gh,0),m(this,jn,null),m(this,Kr,null),m(this,ur,0),m(this,ln,0),m(this,Qr,Object.create(null)),m(this,mh,[]),m(this,pr,null),m(this,Ea,[]),m(this,vh,new WeakMap),m(this,wh,null);var i;if(t instanceof ReadableStream)p(this,pr,t);else if(typeof t=="object")p(this,pr,new ReadableStream({start(c){c.enqueue(t),c.close()}}));else throw new Error('No "textContentSource" parameter specified.');p(this,ce,p(this,Kr,e)),p(this,ln,s.scale*Ls.pixelRatio),p(this,ur,s.rotation),p(this,oi,{div:null,properties:null,ctx:null});const{pageWidth:a,pageHeight:o,pageX:l,pageY:h}=s.rawDims;p(this,wh,[1,0,0,-1,-l,h+o]),p(this,gh,a),p(this,fh,o),v(i=gr,Es,Ip).call(i),fn(e,s),n(this,Li).promise.finally(()=>{n(gr,Jr).delete(this),p(this,oi,null),p(this,Qr,null)}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:t,isFirefox:e}=Bt.platform;return j(this,"fontFamilyMap",new Map([["sans-serif",`${t&&e?"Calibri, ":""}sans-serif`],["monospace",`${t&&e?"Lucida Console, ":""}monospace`]]))}render(){const t=()=>{n(this,jn).read().then(({value:e,done:s})=>{if(s){n(this,Li).resolve();return}n(this,on)??p(this,on,e.lang),Object.assign(n(this,Qr),e.styles),v(this,ka,Pp).call(this,e.items),t()},n(this,Li).reject)};return p(this,jn,n(this,pr).getReader()),n(gr,Jr).add(this),t(),n(this,Li).promise}update({viewport:t,onBefore:e=null}){var s;const i=t.scale*Ls.pixelRatio,a=t.rotation;if(a!==n(this,ur)&&(e==null||e(),p(this,ur,a),fn(n(this,Kr),{rotation:a})),i!==n(this,ln)){e==null||e(),p(this,ln,i);const o={div:null,properties:null,ctx:v(s=gr,Es,gl).call(s,n(this,on))};for(const l of n(this,Ea))o.properties=n(this,vh).get(l),o.div=l,v(this,ka,Bc).call(this,o)}}cancel(){var t;const e=new bi("TextLayer task cancelled.");(t=n(this,jn))==null||t.cancel(e).catch(()=>{}),p(this,jn,null),n(this,Li).reject(e)}get textDivs(){return n(this,Ea)}get textContentItemsStr(){return n(this,mh)}static cleanup(){if(!(n(this,Jr).size>0)){n(this,fr).clear();for(const{canvas:t}of n(this,da).values())t.remove();n(this,da).clear()}}};Li=new WeakMap,ce=new WeakMap,pl=new WeakMap,fl=new WeakMap,on=new WeakMap,oi=new WeakMap,fh=new WeakMap,gh=new WeakMap,jn=new WeakMap,Kr=new WeakMap,ur=new WeakMap,ln=new WeakMap,Qr=new WeakMap,mh=new WeakMap,pr=new WeakMap,Ea=new WeakMap,vh=new WeakMap,wh=new WeakMap,fr=new WeakMap,da=new WeakMap,No=new WeakMap,_i=new WeakMap,Jr=new WeakMap,ka=new WeakSet,Pp=function(r){var t,e;if(n(this,pl))return;(e=n(this,oi)).ctx??(e.ctx=v(t=te,Es,gl).call(t,n(this,on)));const s=n(this,Ea),i=n(this,mh);for(const a of r){if(s.length>am){z("Ignoring additional textDivs for performance reasons."),p(this,pl,!0);return}if(a.str===void 0){if(a.type==="beginMarkedContentProps"||a.type==="beginMarkedContent"){const o=n(this,ce);p(this,ce,document.createElement("span")),n(this,ce).classList.add("markedContent"),a.id!==null&&n(this,ce).setAttribute("id",`${a.id}`),o.append(n(this,ce))}else a.type==="endMarkedContent"&&p(this,ce,n(this,ce).parentNode);continue}i.push(a.str),v(this,ka,yu).call(this,a)}},yu=function(r){var t;const e=document.createElement("span"),s={angle:0,canvasWidth:0,hasText:r.str!=="",hasEOL:r.hasEOL,fontSize:0};n(this,Ea).push(e);const i=L.transform(n(this,wh),r.transform);let a=Math.atan2(i[1],i[0]);const o=n(this,Qr)[r.fontName];o.vertical&&(a+=Math.PI/2);let l=n(this,fl)&&o.fontSubstitution||o.fontFamily;l=te.fontFamilyMap.get(l)||l;const h=Math.hypot(i[2],i[3]),c=h*v(t=te,Es,_u).call(t,l,o,n(this,on));let d,u;a===0?(d=i[4],u=i[5]-c):(d=i[4]+c*Math.sin(a),u=i[5]-c*Math.cos(a));const f="calc(var(--total-scale-factor) *",g=e.style;n(this,ce)===n(this,Kr)?(g.left=`${(100*d/n(this,gh)).toFixed(2)}%`,g.top=`${(100*u/n(this,fh)).toFixed(2)}%`):(g.left=`${f}${d.toFixed(2)}px)`,g.top=`${f}${u.toFixed(2)}px)`),g.fontSize=`${f}${(n(te,_i)*h).toFixed(2)}px)`,g.fontFamily=l,s.fontSize=h,e.setAttribute("role","presentation"),e.textContent=r.str,e.dir=r.dir,n(this,fl)&&(e.dataset.fontName=o.fontSubstitutionLoadedName||r.fontName),a!==0&&(s.angle=a*(180/Math.PI));let b=!1;if(r.str.length>1)b=!0;else if(r.str!==" "&&r.transform[0]!==r.transform[3]){const w=Math.abs(r.transform[0]),A=Math.abs(r.transform[3]);w!==A&&Math.max(w,A)/Math.min(w,A)>1.5&&(b=!0)}if(b&&(s.canvasWidth=o.vertical?r.height:r.width),n(this,vh).set(e,s),n(this,oi).div=e,n(this,oi).properties=s,v(this,ka,Bc).call(this,n(this,oi)),s.hasText&&n(this,ce).append(e),s.hasEOL){const w=document.createElement("br");w.setAttribute("role","presentation"),n(this,ce).append(w)}},Bc=function(r){var t;const{div:e,properties:s,ctx:i}=r,{style:a}=e;let o="";if(n(te,_i)>1&&(o=`scale(${1/n(te,_i)})`),s.canvasWidth!==0&&s.hasText){const{fontFamily:l}=a,{canvasWidth:h,fontSize:c}=s;v(t=te,Es,ic).call(t,i,c*n(this,ln),l);const{width:d}=i.measureText(e.textContent);d>0&&(o=`scaleX(${h*n(this,ln)/d}) ${o}`)}s.angle!==0&&(o=`rotate(${s.angle}deg) ${o}`),o.length>0&&(a.transform=o)},Es=new WeakSet,gl=function(r=null){let t=n(this,da).get(r||(r=""));if(!t){const e=document.createElement("canvas");e.className="hiddenCanvasElement",e.lang=r,document.body.append(e),t=e.getContext("2d",{alpha:!1,willReadFrequently:!0}),n(this,da).set(r,t),n(this,No).set(t,{size:0,family:""})}return t},ic=function(r,t,e){const s=n(this,No).get(r);t===s.size&&e===s.family||(r.font=`${t}px ${e}`,s.size=t,s.family=e)},Ip=function(){if(n(this,_i)!==null)return;const r=document.createElement("div");r.style.opacity=0,r.style.lineHeight=1,r.style.fontSize="1px",r.style.position="absolute",r.textContent="X",document.body.append(r),p(this,_i,r.getBoundingClientRect().height),r.remove()},_u=function(r,t,e){const s=n(this,fr).get(r);if(s)return s;const i=v(this,Es,gl).call(this,e);i.canvas.width=i.canvas.height=bu,v(this,Es,ic).call(this,i,bu,r);const a=i.measureText(""),o=a.fontBoundingBoxAscent,l=Math.abs(a.fontBoundingBoxDescent);i.canvas.width=i.canvas.height=0;let h=.8;return o?h=o/(o+l):(Bt.platform.isFirefox&&z("Enable the `dom.textMetrics.fontBoundingBox.enabled` preference in `about:config` to improve TextLayer rendering."),t.ascent?h=t.ascent:t.descent&&(h=1+t.descent)),n(this,fr).set(r,h),h},m(te,Es),m(te,fr,new Map),m(te,da,new Map),m(te,No,new WeakMap),m(te,_i,null),m(te,Jr,new Set);let $c=te;class bo{static textContent(t){const e=[],s={items:e,styles:Object.create(null)};function i(a){var o;if(!a)return;let l=null;const h=a.name;if(h==="#text")l=a.value;else if(bo.shouldBuildText(h))(o=a==null?void 0:a.attributes)!=null&&o.textContent?l=a.attributes.textContent:a.value&&(l=a.value);else return;if(l!==null&&e.push({str:l}),!!a.children)for(const c of a.children)i(c)}return i(t),s}static shouldBuildText(t){return!(t==="textarea"||t==="input"||t==="option"||t==="select")}}const rm=65536,om=100;function lm(r={}){typeof r=="string"||r instanceof URL?r={url:r}:(r instanceof ArrayBuffer||ArrayBuffer.isView(r))&&(r={data:r});const t=new pm,{docId:e}=t,s=r.url?hm(r.url):null,i=r.data?cm(r.data):null,a=r.httpHeaders||null,o=r.withCredentials===!0,l=r.password??null,h=r.range instanceof Np?r.range:null,c=Number.isInteger(r.rangeChunkSize)&&r.rangeChunkSize>0?r.rangeChunkSize:rm;let d=r.worker instanceof wl?r.worker:null;const u=r.verbosity,f=typeof r.docBaseUrl=="string"&&!Uh(r.docBaseUrl)?r.docBaseUrl:null,g=Fo(r.cMapUrl),b=r.cMapPacked!==!1,w=r.CMapReaderFactory||(Nt?_g:au),A=Fo(r.iccUrl),y=Fo(r.standardFontDataUrl),S=r.StandardFontDataFactory||(Nt?Sg:ru),_=Fo(r.wasmUrl),x=r.WasmFactory||(Nt?xg:ou),k=r.stopAtErrors!==!0,E=Number.isInteger(r.maxImageSize)&&r.maxImageSize>-1?r.maxImageSize:-1,M=r.isEvalSupported!==!1,C=typeof r.isOffscreenCanvasSupported=="boolean"?r.isOffscreenCanvasSupported:!Nt,T=typeof r.isImageDecoderSupported=="boolean"?r.isImageDecoderSupported:!Nt&&(Bt.platform.isFirefox||!globalThis.chrome),N=Number.isInteger(r.canvasMaxAreaInBytes)?r.canvasMaxAreaInBytes:-1,W=typeof r.disableFontFace=="boolean"?r.disableFontFace:Nt,Y=r.fontExtraProperties===!0,q=r.enableXfa===!0,tt=r.ownerDocument||globalThis.document,B=r.disableRange===!0,P=r.disableStream===!0,xt=r.disableAutoFetch===!0,le=r.pdfBug===!0,yi=r.CanvasFactory||(Nt?yg:wg),rs=r.FilterFactory||(Nt?Ag:bg),os=r.enableHWA===!0,$t=r.useWasm!==!1,ut=h?h.length:r.length??NaN,wn=typeof r.useSystemFonts=="boolean"?r.useSystemFonts:!Nt&&!W,Ds=typeof r.useWorkerFetch=="boolean"?r.useWorkerFetch:!!(w===au&&S===ru&&x===ou&&g&&y&&_&&_n(g,document.baseURI)&&_n(y,document.baseURI)&&_n(_,document.baseURI)),He=null;qf(u);const ot={canvasFactory:new yi({ownerDocument:tt,enableHWA:os}),filterFactory:new rs({docId:e,ownerDocument:tt}),cMapReaderFactory:Ds?null:new w({baseUrl:g,isCompressed:b}),standardFontDataFactory:Ds?null:new S({baseUrl:y}),wasmFactory:Ds?null:new x({baseUrl:_})};if(!d){const Na={verbosity:u,port:Ai.workerPort};d=Na.port?wl.fromPort(Na):new wl(Na),t._worker=d}const Bf={docId:e,apiVersion:"5.1.91",data:i,password:l,disableAutoFetch:xt,rangeChunkSize:c,length:ut,docBaseUrl:f,enableXfa:q,evaluatorOptions:{maxImageSize:E,disableFontFace:W,ignoreErrors:k,isEvalSupported:M,isOffscreenCanvasSupported:C,isImageDecoderSupported:T,canvasMaxAreaInBytes:N,fontExtraProperties:Y,useSystemFonts:wn,useWasm:$t,useWorkerFetch:Ds,cMapUrl:g,iccUrl:A,standardFontDataUrl:y,wasmUrl:_}},$f={ownerDocument:tt,pdfBug:le,styleElement:He,loadingParams:{disableAutoFetch:xt,enableXfa:q}};return d.promise.then(function(){if(t.destroyed)throw new Error("Loading aborted");if(d.destroyed)throw new Error("Worker was destroyed");const Na=d.messageHandler.sendWithPromise("GetDocRequest",Bf,i?[i.buffer]:null);let qh;if(h)qh=new zg(h,{disableRange:B,disableStream:P});else if(!i){if(!s)throw new Error("getDocument - no `url` parameter provided.");let bn;if(Nt)if(_n(s)){if(typeof fetch>"u"||typeof Response>"u"||!("body"in Response.prototype))throw new Error("getDocument - the Fetch API was disabled in Node.js, see `--no-experimental-fetch`.");bn=wu}else bn=sm;else bn=_n(s)?wu:Qg;qh=new bn({url:s,length:ut,httpHeaders:a,withCredentials:o,rangeChunkSize:c,disableRange:B,disableStream:P})}return Na.then(bn=>{if(t.destroyed)throw new Error("Loading aborted");if(d.destroyed)throw new Error("Worker was destroyed");const Gd=new ar(e,bn,d.port),Hf=new vm(Gd,t,qh,$f,ot);t._transport=Hf,Gd.send("Ready",null)})}).catch(t._capability.reject),t}function hm(r){if(r instanceof URL)return r.href;if(typeof r=="string"){if(Nt)return r;const t=URL.parse(r,window.location);if(t)return t.href}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function cm(r){if(Nt&&typeof Buffer<"u"&&r instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(r instanceof Uint8Array&&r.byteLength===r.buffer.byteLength)return r;if(typeof r=="string")return Ao(r);if(r instanceof ArrayBuffer||ArrayBuffer.isView(r)||typeof r=="object"&&!isNaN(r==null?void 0:r.length))return new Uint8Array(r);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function Fo(r){if(typeof r!="string")return null;if(r.endsWith("/"))return r;throw new Error(`Invalid factory url: "${r}" must include trailing slash.`)}const Hc=r=>typeof r=="object"&&Number.isInteger(r==null?void 0:r.num)&&r.num>=0&&Number.isInteger(r==null?void 0:r.gen)&&r.gen>=0,dm=r=>typeof r=="object"&&typeof(r==null?void 0:r.name)=="string",um=ig.bind(null,Hc,dm);var Gc;const Lp=class Dp{constructor(){I(this,"_capability",Promise.withResolvers()),I(this,"_transport",null),I(this,"_worker",null),I(this,"docId",`d${oe(Dp,Gc)._++}`),I(this,"destroyed",!1),I(this,"onPassword",null),I(this,"onProgress",null)}get promise(){return this._capability.promise}async destroy(){var t,e,s,i;this.destroyed=!0;try{(t=this._worker)!=null&&t.port&&(this._worker._pendingDestroy=!0),await((e=this._transport)==null?void 0:e.destroy())}catch(a){throw(s=this._worker)!=null&&s.port&&delete this._worker._pendingDestroy,a}this._transport=null,(i=this._worker)==null||i.destroy(),this._worker=null}async getData(){return this._transport.getData()}};Gc=new WeakMap,m(Lp,Gc,0);let pm=Lp;class Np{constructor(t,e,s=!1,i=null){this.length=t,this.initialData=e,this.progressiveDone=s,this.contentDispositionFilename=i,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=Promise.withResolvers()}addRangeListener(t){this._rangeListeners.push(t)}addProgressListener(t){this._progressListeners.push(t)}addProgressiveReadListener(t){this._progressiveReadListeners.push(t)}addProgressiveDoneListener(t){this._progressiveDoneListeners.push(t)}onDataRange(t,e){for(const s of this._rangeListeners)s(t,e)}onDataProgress(t,e){this._readyCapability.promise.then(()=>{for(const s of this._progressListeners)s(t,e)})}onDataProgressiveRead(t){this._readyCapability.promise.then(()=>{for(const e of this._progressiveReadListeners)e(t)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(const t of this._progressiveDoneListeners)t()})}transportReady(){this._readyCapability.resolve()}requestDataRange(t,e){Z("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}class fm{constructor(t,e){this._pdfInfo=t,this._transport=e}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return j(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(t){return this._transport.getPage(t)}getPageIndex(t){return this._transport.getPageIndex(t)}getDestinations(){return this._transport.getDestinations()}getDestination(t){return this._transport.getDestination(t)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:t="display"}={}){const{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getOptionalContentConfig(e)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(t=!1){return this._transport.startCleanup(t||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(t){return this._transport.cachedPageNumber(t)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}var li,Vn,mr;class gm{constructor(t,e,s,i=!1){m(this,Vn),m(this,li,!1),this._pageIndex=t,this._pageInfo=e,this._transport=s,this._stats=i?new jd:null,this._pdfBug=i,this.commonObjs=s.commonObjs,this.objs=new Fp,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:t,rotation:e=this.rotate,offsetX:s=0,offsetY:i=0,dontFlip:a=!1}={}){return new _o({viewBox:this.view,userUnit:this.userUnit,scale:t,rotation:e,offsetX:s,offsetY:i,dontFlip:a})}getAnnotations({intent:t="display"}={}){const{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getAnnotations(this._pageIndex,e)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return j(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){var t;return((t=this._transport._htmlForXfa)==null?void 0:t.children[this._pageIndex])||null}render({canvasContext:t,viewport:e,intent:s="display",annotationMode:i=ni.ENABLE,transform:a=null,background:o=null,optionalContentConfigPromise:l=null,annotationCanvasMap:h=null,pageColors:c=null,printAnnotationStorage:d=null,isEditing:u=!1}){var f,g;(f=this._stats)==null||f.time("Overall");const b=this._transport.getRenderingIntent(s,i,d,u),{renderingIntent:w,cacheKey:A}=b;p(this,li,!1),l||(l=this._transport.getOptionalContentConfig(w));let y=this._intentStates.get(A);y||(y=Object.create(null),this._intentStates.set(A,y)),y.streamReaderCancelTimeout&&(clearTimeout(y.streamReaderCancelTimeout),y.streamReaderCancelTimeout=null);const S=!!(w&pe.PRINT);y.displayReadyCapability||(y.displayReadyCapability=Promise.withResolvers(),y.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(g=this._stats)==null||g.time("Page Request"),this._pumpOperatorList(b));const _=E=>{var M;y.renderTasks.delete(x),S&&p(this,li,!0),v(this,Vn,mr).call(this),E?(x.capability.reject(E),this._abortOperatorList({intentState:y,reason:E instanceof Error?E:new Error(E)})):x.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),(M=globalThis.Stats)!=null&&M.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},x=new bm({callback:_,params:{canvasContext:t,viewport:e,transform:a,background:o},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:h,operatorList:y.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!S,pdfBug:this._pdfBug,pageColors:c});(y.renderTasks||(y.renderTasks=new Set)).add(x);const k=x.task;return Promise.all([y.displayReadyCapability.promise,l]).then(([E,M])=>{var C;if(this.destroyed){_();return}if((C=this._stats)==null||C.time("Rendering"),!(M.renderingIntent&w))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");x.initializeGraphics({transparency:E,optionalContentConfig:M}),x.operatorListChanged()}).catch(_),k}getOperatorList({intent:t="display",annotationMode:e=ni.ENABLE,printAnnotationStorage:s=null,isEditing:i=!1}={}){var a;function o(){h.operatorList.lastChunk&&(h.opListReadCapability.resolve(h.operatorList),h.renderTasks.delete(c))}const l=this._transport.getRenderingIntent(t,e,s,i,!0);let h=this._intentStates.get(l.cacheKey);h||(h=Object.create(null),this._intentStates.set(l.cacheKey,h));let c;return h.opListReadCapability||(c=Object.create(null),c.operatorListChanged=o,h.opListReadCapability=Promise.withResolvers(),(h.renderTasks||(h.renderTasks=new Set)).add(c),h.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(a=this._stats)==null||a.time("Page Request"),this._pumpOperatorList(l)),h.opListReadCapability.promise}streamTextContent({includeMarkedContent:t=!1,disableNormalization:e=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:t===!0,disableNormalization:e===!0},{highWaterMark:100,size(s){return s.items.length}})}getTextContent(t={}){if(this._transport._htmlForXfa)return this.getXfa().then(s=>bo.textContent(s));const e=this.streamTextContent(t);return new Promise(function(s,i){function a(){o.read().then(function({value:h,done:c}){if(c){s(l);return}l.lang??(l.lang=h.lang),Object.assign(l.styles,h.styles),l.items.push(...h.items),a()},i)}const o=e.getReader(),l={items:[],styles:Object.create(null),lang:null};a()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const t=[];for(const e of this._intentStates.values())if(this._abortOperatorList({intentState:e,reason:new Error("Page was destroyed."),force:!0}),!e.opListReadCapability)for(const s of e.renderTasks)t.push(s.completed),s.cancel();return this.objs.clear(),p(this,li,!1),Promise.all(t)}cleanup(t=!1){p(this,li,!0);const e=v(this,Vn,mr).call(this);return t&&e&&this._stats&&(this._stats=new jd),e}_startRenderPage(t,e){var s,i;const a=this._intentStates.get(e);a&&((s=this._stats)==null||s.timeEnd("Page Request"),(i=a.displayReadyCapability)==null||i.resolve(t))}_renderPageChunk(t,e){for(let s=0,i=t.length;s<i;s++)e.operatorList.fnArray.push(t.fnArray[s]),e.operatorList.argsArray.push(t.argsArray[s]);e.operatorList.lastChunk=t.lastChunk,e.operatorList.separateAnnots=t.separateAnnots;for(const s of e.renderTasks)s.operatorListChanged();t.lastChunk&&v(this,Vn,mr).call(this)}_pumpOperatorList({renderingIntent:t,cacheKey:e,annotationStorageSerializable:s,modifiedIds:i}){const{map:a,transfer:o}=s,l=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:t,cacheKey:e,annotationStorage:a,modifiedIds:i},o).getReader(),h=this._intentStates.get(e);h.streamReader=l;const c=()=>{l.read().then(({value:d,done:u})=>{if(u){h.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(d,h),c())},d=>{if(h.streamReader=null,!this._transport.destroyed){if(h.operatorList){h.operatorList.lastChunk=!0;for(const u of h.renderTasks)u.operatorListChanged();v(this,Vn,mr).call(this)}if(h.displayReadyCapability)h.displayReadyCapability.reject(d);else if(h.opListReadCapability)h.opListReadCapability.reject(d);else throw d}})};c()}_abortOperatorList({intentState:t,reason:e,force:s=!1}){if(t.streamReader){if(t.streamReaderCancelTimeout&&(clearTimeout(t.streamReaderCancelTimeout),t.streamReaderCancelTimeout=null),!s){if(t.renderTasks.size>0)return;if(e instanceof Rd){let i=om;e.extraDelay>0&&e.extraDelay<1e3&&(i+=e.extraDelay),t.streamReaderCancelTimeout=setTimeout(()=>{t.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:t,reason:e,force:!0})},i);return}}if(t.streamReader.cancel(new bi(e.message)).catch(()=>{}),t.streamReader=null,!this._transport.destroyed){for(const[i,a]of this._intentStates)if(a===t){this._intentStates.delete(i);break}this.cleanup()}}}get stats(){return this._stats}}li=new WeakMap,Vn=new WeakSet,mr=function(){if(!n(this,li)||this.destroyed)return!1;for(const{renderTasks:r,operatorList:t}of this._intentStates.values())if(r.size>0||!t.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),p(this,li,!1),!0};var Us,zc;class mm{constructor(){m(this,Us,new Map),m(this,zc,Promise.resolve())}postMessage(t,e){const s={data:structuredClone(t,e?{transfer:e}:null)};n(this,zc).then(()=>{for(const[i]of n(this,Us))i.call(this,s)})}addEventListener(t,e,s=null){let i=null;if((s==null?void 0:s.signal)instanceof AbortSignal){const{signal:a}=s;if(a.aborted){z("LoopbackPort - cannot use an `aborted` signal.");return}const o=()=>this.removeEventListener(t,e);i=()=>a.removeEventListener("abort",o),a.addEventListener("abort",o)}n(this,Us).set(e,i)}removeEventListener(t,e){const s=n(this,Us).get(e);s==null||s(),n(this,Us).delete(e)}terminate(){for(const[,t]of n(this,Us))t==null||t();n(this,Us).clear()}}Us=new WeakMap,zc=new WeakMap;var Uc,Ma,en,vr,ml,Zr,vl;const js=class Xt{constructor({name:t=null,port:e=null,verbosity:s=Xf()}={}){m(this,vr);var i;if(this.name=t,this.destroyed=!1,this.verbosity=s,this._readyCapability=Promise.withResolvers(),this._port=null,this._webWorker=null,this._messageHandler=null,e){if((i=n(Xt,en))!=null&&i.has(e))throw new Error("Cannot use more than one PDFWorker per port.");(n(Xt,en)||p(Xt,en,new WeakMap)).set(e,this),this._initializeFromPort(e);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(t){this._port=t,this._messageHandler=new ar("main","worker",t),this._messageHandler.on("ready",function(){}),v(this,vr,ml).call(this)}_initialize(){if(n(Xt,Ma)||n(Xt,Zr,vl)){this._setupFakeWorker();return}let{workerSrc:t}=Xt;try{Xt._isSameOrigin(window.location,t)||(t=Xt._createCDNWrapper(new URL(t,window.location).href));const e=new Worker(t,{type:"module"}),s=new ar("main","worker",e),i=()=>{a.abort(),s.destroy(),e.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},a=new AbortController;e.addEventListener("error",()=>{this._webWorker||i()},{signal:a.signal}),s.on("test",l=>{if(a.abort(),this.destroyed||!l){i();return}this._messageHandler=s,this._port=e,this._webWorker=e,v(this,vr,ml).call(this)}),s.on("ready",l=>{if(a.abort(),this.destroyed){i();return}try{o()}catch{this._setupFakeWorker()}});const o=()=>{const l=new Uint8Array;s.send("test",l,[l.buffer])};o();return}catch{zh("The worker has been disabled.")}this._setupFakeWorker()}_setupFakeWorker(){n(Xt,Ma)||(z("Setting up fake worker."),p(Xt,Ma,!0)),Xt._setupFakeWorkerGlobal.then(t=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}const e=new mm;this._port=e;const s=`fake${oe(Xt,Uc)._++}`,i=new ar(s+"_worker",s,e);t.setup(i,e),this._messageHandler=new ar(s,s+"_worker",e),v(this,vr,ml).call(this)}).catch(t=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${t.message}".`))})}destroy(){var t,e,s;this.destroyed=!0,(t=this._webWorker)==null||t.terminate(),this._webWorker=null,(e=n(Xt,en))==null||e.delete(this._port),this._port=null,(s=this._messageHandler)==null||s.destroy(),this._messageHandler=null}static fromPort(t){var e;if(!(t!=null&&t.port))throw new Error("PDFWorker.fromPort - invalid method signature.");const s=(e=n(this,en))==null?void 0:e.get(t.port);if(s){if(s._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return s}return new Xt(t)}static get workerSrc(){if(Ai.workerSrc)return Ai.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return j(this,"_setupFakeWorkerGlobal",(async()=>n(this,Zr,vl)?n(this,Zr,vl):(await import(this.workerSrc)).WorkerMessageHandler)())}};Uc=new WeakMap,Ma=new WeakMap,en=new WeakMap,vr=new WeakSet,ml=function(){this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})},Zr=new WeakSet,vl=function(){var r;try{return((r=globalThis.pdfjsWorker)==null?void 0:r.WorkerMessageHandler)||null}catch{return null}},m(js,Zr),m(js,Uc,0),m(js,Ma,!1),m(js,en),Nt&&(p(js,Ma,!0),Ai.workerSrc||(Ai.workerSrc="./pdf.worker.mjs")),js._isSameOrigin=(r,t)=>{const e=URL.parse(r);if(!(e!=null&&e.origin)||e.origin==="null")return!1;const s=new URL(t,e);return e.origin===s.origin},js._createCDNWrapper=r=>{const t=`await import("${r}");`;return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))};let wl=js;var hi,fs,wr,br,Vs,qn,Ar;class vm{constructor(t,e,s,i,a){m(this,qn),m(this,hi,new Map),m(this,fs,new Map),m(this,wr,new Map),m(this,br,new Map),m(this,Vs,null),this.messageHandler=t,this.loadingTask=e,this.commonObjs=new Fp,this.fontLoader=new mg({ownerDocument:i.ownerDocument,styleElement:i.styleElement}),this.loadingParams=i.loadingParams,this._params=i,this.canvasFactory=a.canvasFactory,this.filterFactory=a.filterFactory,this.cMapReaderFactory=a.cMapReaderFactory,this.standardFontDataFactory=a.standardFontDataFactory,this.wasmFactory=a.wasmFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=s,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.setupMessageHandler()}get annotationStorage(){return j(this,"annotationStorage",new Fd)}getRenderingIntent(t,e=ni.ENABLE,s=null,i=!1,a=!1){let o=pe.DISPLAY,l=Rc;switch(t){case"any":o=pe.ANY;break;case"display":break;case"print":o=pe.PRINT;break;default:z(`getRenderingIntent - invalid intent: ${t}`)}const h=o&pe.PRINT&&s instanceof fp?s:this.annotationStorage;switch(e){case ni.DISABLE:o+=pe.ANNOTATIONS_DISABLE;break;case ni.ENABLE:break;case ni.ENABLE_FORMS:o+=pe.ANNOTATIONS_FORMS;break;case ni.ENABLE_STORAGE:o+=pe.ANNOTATIONS_STORAGE,l=h.serializable;break;default:z(`getRenderingIntent - invalid annotationMode: ${e}`)}i&&(o+=pe.IS_EDITING),a&&(o+=pe.OPLIST);const{ids:c,hash:d}=h.modifiedIds,u=[o,l.hash,d];return{renderingIntent:o,cacheKey:u.join("_"),annotationStorageSerializable:l,modifiedIds:c}}destroy(){var t;if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),(t=n(this,Vs))==null||t.reject(new Error("Worker was destroyed during onPassword callback"));const e=[];for(const i of n(this,fs).values())e.push(i._destroy());n(this,fs).clear(),n(this,wr).clear(),n(this,br).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const s=this.messageHandler.sendWithPromise("Terminate",null);return e.push(s),Promise.all(e).then(()=>{var i,a;this.commonObjs.clear(),this.fontLoader.clear(),n(this,hi).clear(),this.filterFactory.destroy(),$c.cleanup(),(i=this._networkStream)==null||i.cancelAllRequests(new bi("Worker was terminated.")),(a=this.messageHandler)==null||a.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:t,loadingTask:e}=this;t.on("GetReader",(s,i)=>{wt(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=a=>{this._lastProgress={loaded:a.loaded,total:a.total}},i.onPull=()=>{this._fullReader.read().then(function({value:a,done:o}){if(o){i.close();return}wt(a instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(a),1,[a])}).catch(a=>{i.error(a)})},i.onCancel=a=>{this._fullReader.cancel(a),i.ready.catch(o=>{if(!this.destroyed)throw o})}}),t.on("ReaderHeadersReady",async s=>{var i;await this._fullReader.headersReady;const{isStreamingSupported:a,isRangeSupported:o,contentLength:l}=this._fullReader;return(!a||!o)&&(this._lastProgress&&((i=e.onProgress)==null||i.call(e,this._lastProgress)),this._fullReader.onProgress=h=>{var c;(c=e.onProgress)==null||c.call(e,{loaded:h.loaded,total:h.total})}),{isStreamingSupported:a,isRangeSupported:o,contentLength:l}}),t.on("GetRangeReader",(s,i)=>{wt(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const a=this._networkStream.getRangeReader(s.begin,s.end);if(!a){i.close();return}i.onPull=()=>{a.read().then(function({value:o,done:l}){if(l){i.close();return}wt(o instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(o),1,[o])}).catch(o=>{i.error(o)})},i.onCancel=o=>{a.cancel(o),i.ready.catch(l=>{if(!this.destroyed)throw l})}}),t.on("GetDoc",({pdfInfo:s})=>{this._numPages=s.numPages,this._htmlForXfa=s.htmlForXfa,delete s.htmlForXfa,e._capability.resolve(new fm(s,this))}),t.on("DocException",s=>{e._capability.reject(ne(s))}),t.on("PasswordRequest",s=>{p(this,Vs,Promise.withResolvers());try{if(!e.onPassword)throw ne(s);const i=a=>{a instanceof Error?n(this,Vs).reject(a):n(this,Vs).resolve({password:a})};e.onPassword(i,s.code)}catch(i){n(this,Vs).reject(i)}return n(this,Vs).promise}),t.on("DataLoaded",s=>{var i;(i=e.onProgress)==null||i.call(e,{loaded:s.length,total:s.length}),this.downloadInfoCapability.resolve(s)}),t.on("StartRenderPage",s=>{this.destroyed||n(this,fs).get(s.pageIndex)._startRenderPage(s.transparency,s.cacheKey)}),t.on("commonobj",([s,i,a])=>{var o;if(this.destroyed||this.commonObjs.has(s))return null;switch(i){case"Font":if("error"in a){const d=a.error;z(`Error during font loading: ${d}`),this.commonObjs.resolve(s,d);break}const l=this._params.pdfBug&&(o=globalThis.FontInspector)!=null&&o.enabled?(d,u)=>globalThis.FontInspector.fontAdded(d,u):null,h=new vg(a,l);this.fontLoader.bind(h).catch(()=>t.sendWithPromise("FontFallback",{id:s})).finally(()=>{!h.fontExtraProperties&&h.data&&(h.data=null),this.commonObjs.resolve(s,h)});break;case"CopyLocalImage":const{imageRef:c}=a;wt(c,"The imageRef must be defined.");for(const d of n(this,fs).values())for(const[,u]of d.objs)if((u==null?void 0:u.ref)===c)return u.dataLen?(this.commonObjs.resolve(s,structuredClone(u)),u.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(s,a);break;default:throw new Error(`Got unknown common object type ${i}`)}return null}),t.on("obj",([s,i,a,o])=>{var l;if(this.destroyed)return;const h=n(this,fs).get(i);if(!h.objs.has(s)){if(h._intentStates.size===0){(l=o==null?void 0:o.bitmap)==null||l.close();return}switch(a){case"Image":case"Pattern":h.objs.resolve(s,o);break;default:throw new Error(`Got unknown object type ${a}`)}}}),t.on("DocProgress",s=>{var i;this.destroyed||(i=e.onProgress)==null||i.call(e,{loaded:s.loaded,total:s.total})}),t.on("FetchBinaryData",async s=>{if(this.destroyed)throw new Error("Worker was destroyed.");const i=this[s.type];if(!i)throw new Error(`${s.type} not initialized, see the \`useWorkerFetch\` parameter.`);return i.fetch(s)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var t;this.annotationStorage.size<=0&&z("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:e,transfer:s}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:e,filename:((t=this._fullReader)==null?void 0:t.filename)??null},s).finally(()=>{this.annotationStorage.resetModified()})}getPage(t){if(!Number.isInteger(t)||t<=0||t>this._numPages)return Promise.reject(new Error("Invalid page request."));const e=t-1,s=n(this,wr).get(e);if(s)return s;const i=this.messageHandler.sendWithPromise("GetPage",{pageIndex:e}).then(a=>{if(this.destroyed)throw new Error("Transport destroyed");a.refStr&&n(this,br).set(a.refStr,t);const o=new gm(e,a,this,this._params.pdfBug);return n(this,fs).set(e,o),o});return n(this,wr).set(e,i),i}getPageIndex(t){return Hc(t)?this.messageHandler.sendWithPromise("GetPageIndex",{num:t.num,gen:t.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(t,e){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:t,intent:e})}getFieldObjects(){return v(this,qn,Ar).call(this,"GetFieldObjects")}hasJSActions(){return v(this,qn,Ar).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(t){return typeof t!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:t})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return v(this,qn,Ar).call(this,"GetDocJSActions")}getPageJSActions(t){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:t})}getStructTree(t){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:t})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(t){return v(this,qn,Ar).call(this,"GetOptionalContentConfig").then(e=>new Gg(e,t))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const t="GetMetadata",e=n(this,hi).get(t);if(e)return e;const s=this.messageHandler.sendWithPromise(t,null).then(i=>{var a,o;return{info:i[0],metadata:i[1]?new $g(i[1]):null,contentDispositionFilename:((a=this._fullReader)==null?void 0:a.filename)??null,contentLength:((o=this._fullReader)==null?void 0:o.contentLength)??null}});return n(this,hi).set(t,s),s}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(t=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const e of n(this,fs).values())if(!e.cleanup())throw new Error(`startCleanup: Page ${e.pageNumber} is currently rendering.`);this.commonObjs.clear(),t||this.fontLoader.clear(),n(this,hi).clear(),this.filterFactory.destroy(!0),$c.cleanup()}}cachedPageNumber(t){if(!Hc(t))return null;const e=t.gen===0?`${t.num}R`:`${t.num}R${t.gen}`;return n(this,br).get(e)??null}}hi=new WeakMap,fs=new WeakMap,wr=new WeakMap,br=new WeakMap,Vs=new WeakMap,qn=new WeakSet,Ar=function(r,t=null){const e=n(this,hi).get(r);if(e)return e;const s=this.messageHandler.sendWithPromise(r,t);return n(this,hi).set(r,s),s};const yr=Symbol("INITIAL_DATA");var _e,bl,jc;class Fp{constructor(){m(this,bl),m(this,_e,Object.create(null))}get(t,e=null){if(e){const i=v(this,bl,jc).call(this,t);return i.promise.then(()=>e(i.data)),null}const s=n(this,_e)[t];if(!s||s.data===yr)throw new Error(`Requesting object that isn't resolved yet ${t}.`);return s.data}has(t){const e=n(this,_e)[t];return!!e&&e.data!==yr}delete(t){const e=n(this,_e)[t];return!e||e.data===yr?!1:(delete n(this,_e)[t],!0)}resolve(t,e=null){const s=v(this,bl,jc).call(this,t);s.data=e,s.resolve()}clear(){var t;for(const e in n(this,_e)){const{data:s}=n(this,_e)[e];(t=s==null?void 0:s.bitmap)==null||t.close()}p(this,_e,Object.create(null))}*[Symbol.iterator](){for(const t in n(this,_e)){const{data:e}=n(this,_e)[t];e!==yr&&(yield[t,e])}}}_e=new WeakMap,bl=new WeakSet,jc=function(r){var t;return(t=n(this,_e))[r]||(t[r]={...Promise.withResolvers(),data:yr})};var Di;class wm{constructor(t){m(this,Di,null),I(this,"onContinue",null),I(this,"onError",null),p(this,Di,t)}get promise(){return n(this,Di).capability.promise}cancel(t=0){n(this,Di).cancel(null,t)}get separateAnnots(){const{separateAnnots:t}=n(this,Di).operatorList;if(!t)return!1;const{annotationCanvasMap:e}=n(this,Di);return t.form||t.canvas&&(e==null?void 0:e.size)>0}}Di=new WeakMap;var Ni,ua;const Op=class _r{constructor({callback:t,params:e,objs:s,commonObjs:i,annotationCanvasMap:a,operatorList:o,pageIndex:l,canvasFactory:h,filterFactory:c,useRequestAnimationFrame:d=!1,pdfBug:u=!1,pageColors:f=null}){m(this,Ni,null),this.callback=t,this.params=e,this.objs=s,this.commonObjs=i,this.annotationCanvasMap=a,this.operatorListIdx=null,this.operatorList=o,this._pageIndex=l,this.canvasFactory=h,this.filterFactory=c,this._pdfBug=u,this.pageColors=f,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=d===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new wm(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=e.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:t=!1,optionalContentConfig:e}){var s,i;if(this.cancelled)return;if(this._canvas){if(n(_r,ua).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");n(_r,ua).add(this._canvas)}this._pdfBug&&(s=globalThis.StepperManager)!=null&&s.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:a,viewport:o,transform:l,background:h}=this.params;this.gfx=new ll(a,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:e},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:l,viewport:o,transparency:t,background:h}),this.operatorListIdx=0,this.graphicsReady=!0,(i=this.graphicsReadyCallback)==null||i.call(this)}cancel(t=null,e=0){var s,i,a;this.running=!1,this.cancelled=!0,(s=this.gfx)==null||s.endDrawing(),n(this,Ni)&&(window.cancelAnimationFrame(n(this,Ni)),p(this,Ni,null)),n(_r,ua).delete(this._canvas),t||(t=new Rd(`Rendering cancelled, page ${this._pageIndex+1}`,e)),this.callback(t),(a=(i=this.task).onError)==null||a.call(i,t)}operatorListChanged(){var t;if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}(t=this.stepper)==null||t.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?p(this,Ni,window.requestAnimationFrame(()=>{p(this,Ni,null),this._nextBound().catch(this._cancelBound)})):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),n(_r,ua).delete(this._canvas),this.callback())))}};Ni=new WeakMap,ua=new WeakMap,m(Op,ua,new WeakSet);let bm=Op;const Am="5.1.91",ym="45cbe8bb0";function Su(r){return Math.floor(Math.max(0,Math.min(1,r))*255).toString(16).padStart(2,"0")}function Wa(r){return Math.max(0,Math.min(255,255*r))}class xu{static CMYK_G([t,e,s,i]){return["G",1-Math.min(1,.3*t+.59*s+.11*e+i)]}static G_CMYK([t]){return["CMYK",0,0,0,1-t]}static G_RGB([t]){return["RGB",t,t,t]}static G_rgb([t]){return t=Wa(t),[t,t,t]}static G_HTML([t]){const e=Su(t);return`#${e}${e}${e}`}static RGB_G([t,e,s]){return["G",.3*t+.59*e+.11*s]}static RGB_rgb(t){return t.map(Wa)}static RGB_HTML(t){return`#${t.map(Su).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([t,e,s,i]){return["RGB",1-Math.min(1,t+i),1-Math.min(1,s+i),1-Math.min(1,e+i)]}static CMYK_rgb([t,e,s,i]){return[Wa(1-Math.min(1,t+i)),Wa(1-Math.min(1,s+i)),Wa(1-Math.min(1,e+i))]}static CMYK_HTML(t){const e=this.CMYK_RGB(t).slice(1);return this.RGB_HTML(e)}static RGB_CMYK([t,e,s]){const i=1-t,a=1-e,o=1-s,l=Math.min(i,a,o);return["CMYK",i,a,o,l]}}class _m{create(t,e,s=!1){if(t<=0||e<=0)throw new Error("Invalid SVG dimensions");const i=this._createSVG("svg:svg");return i.setAttribute("version","1.1"),s||(i.setAttribute("width",`${t}px`),i.setAttribute("height",`${e}px`)),i.setAttribute("preserveAspectRatio","none"),i.setAttribute("viewBox",`0 0 ${t} ${e}`),i}createElement(t){if(typeof t!="string")throw new Error("Invalid SVG element type");return this._createSVG(t)}_createSVG(t){Z("Abstract method `_createSVG` called.")}}class bh extends _m{_createSVG(t){return document.createElementNS(ls,t)}}class Wp{static setupStorage(t,e,s,i,a){const o=i.getValue(e,{value:null});switch(s.name){case"textarea":if(o.value!==null&&(t.textContent=o.value),a==="print")break;t.addEventListener("input",l=>{i.setValue(e,{value:l.target.value})});break;case"input":if(s.attributes.type==="radio"||s.attributes.type==="checkbox"){if(o.value===s.attributes.xfaOn?t.setAttribute("checked",!0):o.value===s.attributes.xfaOff&&t.removeAttribute("checked"),a==="print")break;t.addEventListener("change",l=>{i.setValue(e,{value:l.target.checked?l.target.getAttribute("xfaOn"):l.target.getAttribute("xfaOff")})})}else{if(o.value!==null&&t.setAttribute("value",o.value),a==="print")break;t.addEventListener("input",l=>{i.setValue(e,{value:l.target.value})})}break;case"select":if(o.value!==null){t.setAttribute("value",o.value);for(const l of s.children)l.attributes.value===o.value?l.attributes.selected=!0:l.attributes.hasOwnProperty("selected")&&delete l.attributes.selected}t.addEventListener("input",l=>{const h=l.target.options,c=h.selectedIndex===-1?"":h[h.selectedIndex].value;i.setValue(e,{value:c})});break}}static setAttributes({html:t,element:e,storage:s=null,intent:i,linkService:a}){const{attributes:o}=e,l=t instanceof HTMLAnchorElement;o.type==="radio"&&(o.name=`${o.name}-${i}`);for(const[h,c]of Object.entries(o))if(c!=null)switch(h){case"class":c.length&&t.setAttribute(h,c.join(" "));break;case"dataId":break;case"id":t.setAttribute("data-element-id",c);break;case"style":Object.assign(t.style,c);break;case"textContent":t.textContent=c;break;default:(!l||h!=="href"&&h!=="newWindow")&&t.setAttribute(h,c)}l&&a.addLinkAttributes(t,o.href,o.newWindow),s&&o.dataId&&this.setupStorage(t,o.dataId,e,s)}static render(t){var e,s;const i=t.annotationStorage,a=t.linkService,o=t.xfaHtml,l=t.intent||"display",h=document.createElement(o.name);o.attributes&&this.setAttributes({html:h,element:o,intent:l,linkService:a});const c=l!=="richText",d=t.div;if(d.append(h),t.viewport){const g=`matrix(${t.viewport.transform.join(",")})`;d.style.transform=g}c&&d.setAttribute("class","xfaLayer xfaFont");const u=[];if(o.children.length===0){if(o.value){const g=document.createTextNode(o.value);h.append(g),c&&bo.shouldBuildText(o.name)&&u.push(g)}return{textDivs:u}}const f=[[o,-1,h]];for(;f.length>0;){const[g,b,w]=f.at(-1);if(b+1===g.children.length){f.pop();continue}const A=g.children[++f.at(-1)[1]];if(A===null)continue;const{name:y}=A;if(y==="#text"){const _=document.createTextNode(A.value);u.push(_),w.append(_);continue}const S=(e=A==null?void 0:A.attributes)!=null&&e.xmlns?document.createElementNS(A.attributes.xmlns,y):document.createElement(y);if(w.append(S),A.attributes&&this.setAttributes({html:S,element:A,storage:i,intent:l,linkService:a}),((s=A.children)==null?void 0:s.length)>0)f.push([A,-1,S]);else if(A.value){const _=document.createTextNode(A.value);c&&bo.shouldBuildText(y)&&u.push(_),S.append(_)}}for(const g of d.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))g.setAttribute("readOnly",!0);return{textDivs:u}}static update(t){const e=`matrix(${t.viewport.transform.join(",")})`;t.div.style.transform=e,t.div.hidden=!1}}const Eo=1e3,Sm=9,gn=new WeakSet;class Eu{static create(t){switch(t.data.annotationType){case ft.LINK:return new Gp(t);case ft.TEXT:return new Em(t);case ft.WIDGET:switch(t.data.fieldType){case"Tx":return new km(t);case"Btn":return t.data.radioButton?new zp(t):t.data.checkBox?new Cm(t):new Tm(t);case"Ch":return new Rm(t);case"Sig":return new Mm(t)}return new vn(t);case ft.POPUP:return new qc(t);case ft.FREETEXT:return new Vp(t);case ft.LINE:return new Im(t);case ft.SQUARE:return new Lm(t);case ft.CIRCLE:return new Dm(t);case ft.POLYLINE:return new qp(t);case ft.CARET:return new Fm(t);case ft.INK:return new Bd(t);case ft.POLYGON:return new Nm(t);case ft.HIGHLIGHT:return new Xp(t);case ft.UNDERLINE:return new Om(t);case ft.SQUIGGLY:return new Wm(t);case ft.STRIKEOUT:return new Bm(t);case ft.STAMP:return new Yp(t);case ft.FILEATTACHMENT:return new $m(t);default:return new St(t)}}}var Fi,Sr,xr,Al,Vc;const xm=class Bp{constructor(t,{isRenderable:e=!1,ignoreBorder:s=!1,createQuadrilaterals:i=!1}={}){m(this,Al),m(this,Fi,null),m(this,Sr,!1),m(this,xr,null),this.isRenderable=e,this.data=t.data,this.layer=t.layer,this.linkService=t.linkService,this.downloadManager=t.downloadManager,this.imageResourcesPath=t.imageResourcesPath,this.renderForms=t.renderForms,this.svgFactory=t.svgFactory,this.annotationStorage=t.annotationStorage,this.enableScripting=t.enableScripting,this.hasJSActions=t.hasJSActions,this._fieldObjects=t.fieldObjects,this.parent=t.parent,e&&(this.container=this._createContainer(s)),i&&this._createQuadrilaterals()}static _hasPopupData({titleObj:t,contentsObj:e,richText:s}){return!!(t!=null&&t.str||e!=null&&e.str||s!=null&&s.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return Bp._hasPopupData(this.data)}updateEdited(t){var e;if(!this.container)return;n(this,Fi)||p(this,Fi,{rect:this.data.rect.slice(0)});const{rect:s}=t;s&&v(this,Al,Vc).call(this,s),(e=n(this,xr))==null||e.popup.updateEdited(t)}resetEdited(){var t;n(this,Fi)&&(v(this,Al,Vc).call(this,n(this,Fi).rect),(t=n(this,xr))==null||t.popup.resetEdited(),p(this,Fi,null))}_createContainer(t){const{data:e,parent:{page:s,viewport:i}}=this,a=document.createElement("section");a.setAttribute("data-annotation-id",e.id),this instanceof vn||(a.tabIndex=Eo);const{style:o}=a;if(o.zIndex=this.parent.zIndex++,e.alternativeText&&(a.title=e.alternativeText),e.noRotate&&a.classList.add("norotate"),!e.rect||this instanceof qc){const{rotation:w}=e;return!e.hasOwnCanvas&&w!==0&&this.setRotation(w,a),a}const{width:l,height:h}=this;if(!t&&e.borderStyle.width>0){o.borderWidth=`${e.borderStyle.width}px`;const w=e.borderStyle.horizontalCornerRadius,A=e.borderStyle.verticalCornerRadius;if(w>0||A>0){const S=`calc(${w}px * var(--total-scale-factor)) / calc(${A}px * var(--total-scale-factor))`;o.borderRadius=S}else if(this instanceof zp){const S=`calc(${l}px * var(--total-scale-factor)) / calc(${h}px * var(--total-scale-factor))`;o.borderRadius=S}switch(e.borderStyle.style){case An.SOLID:o.borderStyle="solid";break;case An.DASHED:o.borderStyle="dashed";break;case An.BEVELED:z("Unimplemented border style: beveled");break;case An.INSET:z("Unimplemented border style: inset");break;case An.UNDERLINE:o.borderBottomStyle="solid";break}const y=e.borderColor||null;y?(p(this,Sr,!0),o.borderColor=L.makeHexColor(y[0]|0,y[1]|0,y[2]|0)):o.borderWidth=0}const c=L.normalizeRect([e.rect[0],s.view[3]-e.rect[1]+s.view[1],e.rect[2],s.view[3]-e.rect[3]+s.view[1]]),{pageWidth:d,pageHeight:u,pageX:f,pageY:g}=i.rawDims;o.left=`${100*(c[0]-f)/d}%`,o.top=`${100*(c[1]-g)/u}%`;const{rotation:b}=e;return e.hasOwnCanvas||b===0?(o.width=`${100*l/d}%`,o.height=`${100*h/u}%`):this.setRotation(b,a),a}setRotation(t,e=this.container){if(!this.data.rect)return;const{pageWidth:s,pageHeight:i}=this.parent.viewport.rawDims;let{width:a,height:o}=this;t%180!==0&&([a,o]=[o,a]),e.style.width=`${100*a/s}%`,e.style.height=`${100*o/i}%`,e.setAttribute("data-main-rotation",(360-t)%360)}get _commonActions(){const t=(e,s,i)=>{const a=i.detail[e],o=a[0],l=a.slice(1);i.target.style[s]=xu[`${o}_HTML`](l),this.annotationStorage.setValue(this.data.id,{[s]:xu[`${o}_rgb`](l)})};return j(this,"_commonActions",{display:e=>{const{display:s}=e.detail,i=s%2===1;this.container.style.visibility=i?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:i,noPrint:s===1||s===2})},print:e=>{this.annotationStorage.setValue(this.data.id,{noPrint:!e.detail.print})},hidden:e=>{const{hidden:s}=e.detail;this.container.style.visibility=s?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:s,noView:s})},focus:e=>{setTimeout(()=>e.target.focus({preventScroll:!1}),0)},userName:e=>{e.target.title=e.detail.userName},readonly:e=>{e.target.disabled=e.detail.readonly},required:e=>{this._setRequired(e.target,e.detail.required)},bgColor:e=>{t("bgColor","backgroundColor",e)},fillColor:e=>{t("fillColor","backgroundColor",e)},fgColor:e=>{t("fgColor","color",e)},textColor:e=>{t("textColor","color",e)},borderColor:e=>{t("borderColor","borderColor",e)},strokeColor:e=>{t("strokeColor","borderColor",e)},rotation:e=>{const s=e.detail.rotation;this.setRotation(s),this.annotationStorage.setValue(this.data.id,{rotation:s})}})}_dispatchEventFromSandbox(t,e){const s=this._commonActions;for(const i of Object.keys(e.detail)){const a=t[i]||s[i];a==null||a(e)}}_setDefaultPropertiesFromJS(t){if(!this.enableScripting)return;const e=this.annotationStorage.getRawValue(this.data.id);if(!e)return;const s=this._commonActions;for(const[i,a]of Object.entries(e)){const o=s[i];if(o){const l={detail:{[i]:a},target:t};o(l),delete e[i]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:t}=this.data;if(!t)return;const[e,s,i,a]=this.data.rect.map(w=>Math.fround(w));if(t.length===8){const[w,A,y,S]=t.subarray(2,6);if(i===w&&a===A&&e===y&&s===S)return}const{style:o}=this.container;let l;if(n(this,Sr)){const{borderColor:w,borderWidth:A}=o;o.borderWidth=0,l=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${w}" stroke-width="${A}">`],this.container.classList.add("hasBorder")}const h=i-e,c=a-s,{svgFactory:d}=this,u=d.createElement("svg");u.classList.add("quadrilateralsContainer"),u.setAttribute("width",0),u.setAttribute("height",0);const f=d.createElement("defs");u.append(f);const g=d.createElement("clipPath"),b=`clippath_${this.data.id}`;g.setAttribute("id",b),g.setAttribute("clipPathUnits","objectBoundingBox"),f.append(g);for(let w=2,A=t.length;w<A;w+=8){const y=t[w],S=t[w+1],_=t[w+2],x=t[w+3],k=d.createElement("rect"),E=(_-e)/h,M=(a-S)/c,C=(y-_)/h,T=(S-x)/c;k.setAttribute("x",E),k.setAttribute("y",M),k.setAttribute("width",C),k.setAttribute("height",T),g.append(k),l==null||l.push(`<rect vector-effect="non-scaling-stroke" x="${E}" y="${M}" width="${C}" height="${T}"/>`)}n(this,Sr)&&(l.push("</g></svg>')"),o.backgroundImage=l.join("")),this.container.append(u),this.container.style.clipPath=`url(#${b})`}_createPopup(){const{data:t}=this,e=p(this,xr,new qc({data:{color:t.color,titleObj:t.titleObj,modificationDate:t.modificationDate,contentsObj:t.contentsObj,richText:t.richText,parentRect:t.rect,borderStyle:0,id:`popup_${t.id}`,rotation:t.rotation},parent:this.parent,elements:[this]}));this.parent.div.append(e.render())}render(){Z("Abstract method `AnnotationElement.render` called")}_getElementsByName(t,e=null){const s=[];if(this._fieldObjects){const i=this._fieldObjects[t];if(i)for(const{page:a,id:o,exportValues:l}of i){if(a===-1||o===e)continue;const h=typeof l=="string"?l:null,c=document.querySelector(`[data-element-id="${o}"]`);if(c&&!gn.has(c)){z(`_getElementsByName - element not allowed: ${o}`);continue}s.push({id:o,exportValue:h,domElement:c})}return s}for(const i of document.getElementsByName(t)){const{exportValue:a}=i,o=i.getAttribute("data-element-id");o!==e&&gn.has(i)&&s.push({id:o,exportValue:a,domElement:i})}return s}show(){var t;this.container&&(this.container.hidden=!1),(t=this.popup)==null||t.maybeShow()}hide(){var t;this.container&&(this.container.hidden=!0),(t=this.popup)==null||t.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const t=this.getElementsToTriggerPopup();if(Array.isArray(t))for(const e of t)e.classList.add("highlightArea");else t.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:t,data:{id:e}}=this;this.container.addEventListener("dblclick",()=>{var s;(s=this.linkService.eventBus)==null||s.dispatch("switchannotationeditormode",{source:this,mode:t,editId:e})})}get width(){return this.data.rect[2]-this.data.rect[0]}get height(){return this.data.rect[3]-this.data.rect[1]}};Fi=new WeakMap,Sr=new WeakMap,xr=new WeakMap,Al=new WeakSet,Vc=function(r){const{container:{style:t},data:{rect:e,rotation:s},parent:{viewport:{rawDims:{pageWidth:i,pageHeight:a,pageX:o,pageY:l}}}}=this;e==null||e.splice(0,4,...r),t.left=`${100*(r[0]-o)/i}%`,t.top=`${100*(a-r[3]+l)/a}%`,s===0?(t.width=`${100*(r[2]-r[0])/i}%`,t.height=`${100*(r[3]-r[1])/a}%`):this.setRotation(s)};let St=xm;var es,hn,$p,Hp;class Gp extends St{constructor(t,e=null){super(t,{isRenderable:!0,ignoreBorder:!!(e!=null&&e.ignoreBorder),createQuadrilaterals:!0}),m(this,es),this.isTooltipOnly=t.data.isTooltipOnly}render(){const{data:t,linkService:e}=this,s=document.createElement("a");s.setAttribute("data-element-id",t.id);let i=!1;return t.url?(e.addLinkAttributes(s,t.url,t.newWindow),i=!0):t.action?(this._bindNamedAction(s,t.action),i=!0):t.attachment?(v(this,es,$p).call(this,s,t.attachment,t.attachmentDest),i=!0):t.setOCGState?(v(this,es,Hp).call(this,s,t.setOCGState),i=!0):t.dest?(this._bindLink(s,t.dest),i=!0):(t.actions&&(t.actions.Action||t.actions["Mouse Up"]||t.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(s,t),i=!0),t.resetForm?(this._bindResetFormAction(s,t.resetForm),i=!0):this.isTooltipOnly&&!i&&(this._bindLink(s,""),i=!0)),this.container.classList.add("linkAnnotation"),i&&this.container.append(s),this.container}_bindLink(t,e){t.href=this.linkService.getDestinationHash(e),t.onclick=()=>(e&&this.linkService.goToDestination(e),!1),(e||e==="")&&v(this,es,hn).call(this)}_bindNamedAction(t,e){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeNamedAction(e),!1),v(this,es,hn).call(this)}_bindJSAction(t,e){t.href=this.linkService.getAnchorUrl("");const s=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const i of Object.keys(e.actions)){const a=s.get(i);a&&(t[a]=()=>{var o;return(o=this.linkService.eventBus)==null||o.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e.id,name:i}}),!1})}t.onclick||(t.onclick=()=>!1),v(this,es,hn).call(this)}_bindResetFormAction(t,e){const s=t.onclick;if(s||(t.href=this.linkService.getAnchorUrl("")),v(this,es,hn).call(this),!this._fieldObjects){z('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),s||(t.onclick=()=>!1);return}t.onclick=()=>{var i;s==null||s();const{fields:a,refs:o,include:l}=e,h=[];if(a.length!==0||o.length!==0){const u=new Set(o);for(const f of a){const g=this._fieldObjects[f]||[];for(const{id:b}of g)u.add(b)}for(const f of Object.values(this._fieldObjects))for(const g of f)u.has(g.id)===l&&h.push(g)}else for(const u of Object.values(this._fieldObjects))h.push(...u);const c=this.annotationStorage,d=[];for(const u of h){const{id:f}=u;switch(d.push(f),u.type){case"text":{const b=u.defaultValue||"";c.setValue(f,{value:b});break}case"checkbox":case"radiobutton":{const b=u.defaultValue===u.exportValues;c.setValue(f,{value:b});break}case"combobox":case"listbox":{const b=u.defaultValue||"";c.setValue(f,{value:b});break}default:continue}const g=document.querySelector(`[data-element-id="${f}"]`);if(g){if(!gn.has(g)){z(`_bindResetFormAction - element not allowed: ${f}`);continue}}else continue;g.dispatchEvent(new Event("resetform"))}return this.enableScripting&&((i=this.linkService.eventBus)==null||i.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:d,name:"ResetForm"}})),!1}}}es=new WeakSet,hn=function(){this.container.setAttribute("data-internal-link","")},$p=function(r,t,e=null){r.href=this.linkService.getAnchorUrl(""),t.description&&(r.title=t.description),r.onclick=()=>{var s;return(s=this.downloadManager)==null||s.openOrDownloadData(t.content,t.filename,e),!1},v(this,es,hn).call(this)},Hp=function(r,t){r.href=this.linkService.getAnchorUrl(""),r.onclick=()=>(this.linkService.executeSetOCGState(t),!1),v(this,es,hn).call(this)};class Em extends St{constructor(t){super(t,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const t=document.createElement("img");return t.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",t.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),t.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(t),this.container}}class vn extends St{render(){return this.container}showElementAndHideCanvas(t){var e;this.data.hasOwnCanvas&&(((e=t.previousSibling)==null?void 0:e.nodeName)==="CANVAS"&&(t.previousSibling.hidden=!0),t.hidden=!1)}_getKeyModifier(t){return Bt.platform.isMac?t.metaKey:t.ctrlKey}_setEventListener(t,e,s,i,a){s.includes("mouse")?t.addEventListener(s,o=>{var l;(l=this.linkService.eventBus)==null||l.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:a(o),shift:o.shiftKey,modifier:this._getKeyModifier(o)}})}):t.addEventListener(s,o=>{var l;if(s==="blur"){if(!e.focused||!o.relatedTarget)return;e.focused=!1}else if(s==="focus"){if(e.focused)return;e.focused=!0}a&&((l=this.linkService.eventBus)==null||l.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:a(o)}}))})}_setEventListeners(t,e,s,i){var a,o,l;for(const[h,c]of s)(c==="Action"||(a=this.data.actions)!=null&&a[c])&&((c==="Focus"||c==="Blur")&&(e||(e={focused:!1})),this._setEventListener(t,e,h,c,i),c==="Focus"&&!((o=this.data.actions)!=null&&o.Blur)?this._setEventListener(t,e,"blur","Blur",null):c==="Blur"&&!((l=this.data.actions)!=null&&l.Focus)&&this._setEventListener(t,e,"focus","Focus",null))}_setBackgroundColor(t){const e=this.data.backgroundColor||null;t.style.backgroundColor=e===null?"transparent":L.makeHexColor(e[0],e[1],e[2])}_setTextStyle(t){const e=["left","center","right"],{fontColor:s}=this.data.defaultAppearanceData,i=this.data.defaultAppearanceData.fontSize||Sm,a=t.style;let o;const l=2,h=c=>Math.round(10*c)/10;if(this.data.multiLine){const c=Math.abs(this.data.rect[3]-this.data.rect[1]-l),d=Math.round(c/(Xh*i))||1,u=c/d;o=Math.min(i,h(u/Xh))}else{const c=Math.abs(this.data.rect[3]-this.data.rect[1]-l);o=Math.min(i,h(c/Xh))}a.fontSize=`calc(${o}px * var(--total-scale-factor))`,a.color=L.makeHexColor(s[0],s[1],s[2]),this.data.textAlignment!==null&&(a.textAlign=e[this.data.textAlignment])}_setRequired(t,e){e?t.setAttribute("required",!0):t.removeAttribute("required"),t.setAttribute("aria-required",e)}}class km extends vn{constructor(t){const e=t.renderForms||t.data.hasOwnCanvas||!t.data.hasAppearance&&!!t.data.fieldValue;super(t,{isRenderable:e})}setPropertyOnSiblings(t,e,s,i){const a=this.annotationStorage;for(const o of this._getElementsByName(t.name,t.id))o.domElement&&(o.domElement[e]=s),a.setValue(o.id,{[i]:s})}render(){var t,e;const s=this.annotationStorage,i=this.data.id;this.container.classList.add("textWidgetAnnotation");let a=null;if(this.renderForms){const o=s.getValue(i,{value:this.data.fieldValue});let l=o.value||"";const h=s.getValue(i,{charLimit:this.data.maxLen}).charLimit;h&&l.length>h&&(l=l.slice(0,h));let c=o.formattedValue||((t=this.data.textContent)==null?void 0:t.join(`
`))||null;c&&this.data.comb&&(c=c.replaceAll(/\s+/g,""));const d={userValue:l,formattedValue:c,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(a=document.createElement("textarea"),a.textContent=c??l,this.data.doNotScroll&&(a.style.overflowY="hidden")):(a=document.createElement("input"),a.type=this.data.password?"password":"text",a.setAttribute("value",c??l),this.data.doNotScroll&&(a.style.overflowX="hidden")),this.data.hasOwnCanvas&&(a.hidden=!0),gn.add(a),a.setAttribute("data-element-id",i),a.disabled=this.data.readOnly,a.name=this.data.fieldName,a.tabIndex=Eo,this._setRequired(a,this.data.required),h&&(a.maxLength=h),a.addEventListener("input",f=>{s.setValue(i,{value:f.target.value}),this.setPropertyOnSiblings(a,"value",f.target.value,"value"),d.formattedValue=null}),a.addEventListener("resetform",f=>{const g=this.data.defaultFieldValue??"";a.value=d.userValue=g,d.formattedValue=null});let u=f=>{const{formattedValue:g}=d;g!=null&&(f.target.value=g),f.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){a.addEventListener("focus",g=>{var b;if(d.focused)return;const{target:w}=g;d.userValue&&(w.value=d.userValue),d.lastCommittedValue=w.value,d.commitKey=1,(b=this.data.actions)!=null&&b.Focus||(d.focused=!0)}),a.addEventListener("updatefromsandbox",g=>{this.showElementAndHideCanvas(g.target);const b={value(w){d.userValue=w.detail.value??"",s.setValue(i,{value:d.userValue.toString()}),w.target.value=d.userValue},formattedValue(w){const{formattedValue:A}=w.detail;d.formattedValue=A,A!=null&&w.target!==document.activeElement&&(w.target.value=A),s.setValue(i,{formattedValue:A})},selRange(w){w.target.setSelectionRange(...w.detail.selRange)},charLimit:w=>{var A;const{charLimit:y}=w.detail,{target:S}=w;if(y===0){S.removeAttribute("maxLength");return}S.setAttribute("maxLength",y);let _=d.userValue;!_||_.length<=y||(_=_.slice(0,y),S.value=d.userValue=_,s.setValue(i,{value:_}),(A=this.linkService.eventBus)==null||A.dispatch("dispatcheventinsandbox",{source:this,detail:{id:i,name:"Keystroke",value:_,willCommit:!0,commitKey:1,selStart:S.selectionStart,selEnd:S.selectionEnd}}))}};this._dispatchEventFromSandbox(b,g)}),a.addEventListener("keydown",g=>{var b;d.commitKey=1;let w=-1;if(g.key==="Escape"?w=0:g.key==="Enter"&&!this.data.multiLine?w=2:g.key==="Tab"&&(d.commitKey=3),w===-1)return;const{value:A}=g.target;d.lastCommittedValue!==A&&(d.lastCommittedValue=A,d.userValue=A,(b=this.linkService.eventBus)==null||b.dispatch("dispatcheventinsandbox",{source:this,detail:{id:i,name:"Keystroke",value:A,willCommit:!0,commitKey:w,selStart:g.target.selectionStart,selEnd:g.target.selectionEnd}}))});const f=u;u=null,a.addEventListener("blur",g=>{var b,w;if(!d.focused||!g.relatedTarget)return;(b=this.data.actions)!=null&&b.Blur||(d.focused=!1);const{value:A}=g.target;d.userValue=A,d.lastCommittedValue!==A&&((w=this.linkService.eventBus)==null||w.dispatch("dispatcheventinsandbox",{source:this,detail:{id:i,name:"Keystroke",value:A,willCommit:!0,commitKey:d.commitKey,selStart:g.target.selectionStart,selEnd:g.target.selectionEnd}})),f(g)}),(e=this.data.actions)!=null&&e.Keystroke&&a.addEventListener("beforeinput",g=>{var b;d.lastCommittedValue=null;const{data:w,target:A}=g,{value:y,selectionStart:S,selectionEnd:_}=A;let x=S,k=_;switch(g.inputType){case"deleteWordBackward":{const E=y.substring(0,S).match(/\w*[^\w]*$/);E&&(x-=E[0].length);break}case"deleteWordForward":{const E=y.substring(S).match(/^[^\w]*\w*/);E&&(k+=E[0].length);break}case"deleteContentBackward":S===_&&(x-=1);break;case"deleteContentForward":S===_&&(k+=1);break}g.preventDefault(),(b=this.linkService.eventBus)==null||b.dispatch("dispatcheventinsandbox",{source:this,detail:{id:i,name:"Keystroke",value:y,change:w||"",willCommit:!1,selStart:x,selEnd:k}})}),this._setEventListeners(a,d,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],g=>g.target.value)}if(u&&a.addEventListener("blur",u),this.data.comb){const f=(this.data.rect[2]-this.data.rect[0])/h;a.classList.add("comb"),a.style.letterSpacing=`calc(${f}px * var(--total-scale-factor) - 1ch)`}}else a=document.createElement("div"),a.textContent=this.data.fieldValue,a.style.verticalAlign="middle",a.style.display="table-cell",this.data.hasOwnCanvas&&(a.hidden=!0);return this._setTextStyle(a),this._setBackgroundColor(a),this._setDefaultPropertiesFromJS(a),this.container.append(a),this.container}}class Mm extends vn{constructor(t){super(t,{isRenderable:!!t.data.hasOwnCanvas})}}class Cm extends vn{constructor(t){super(t,{isRenderable:t.renderForms})}render(){const t=this.annotationStorage,e=this.data,s=e.id;let i=t.getValue(s,{value:e.exportValue===e.fieldValue}).value;typeof i=="string"&&(i=i!=="Off",t.setValue(s,{value:i})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const a=document.createElement("input");return gn.add(a),a.setAttribute("data-element-id",s),a.disabled=e.readOnly,this._setRequired(a,this.data.required),a.type="checkbox",a.name=e.fieldName,i&&a.setAttribute("checked",!0),a.setAttribute("exportValue",e.exportValue),a.tabIndex=Eo,a.addEventListener("change",o=>{const{name:l,checked:h}=o.target;for(const c of this._getElementsByName(l,s)){const d=h&&c.exportValue===e.exportValue;c.domElement&&(c.domElement.checked=d),t.setValue(c.id,{value:d})}t.setValue(s,{value:h})}),a.addEventListener("resetform",o=>{const l=e.defaultFieldValue||"Off";o.target.checked=l===e.exportValue}),this.enableScripting&&this.hasJSActions&&(a.addEventListener("updatefromsandbox",o=>{const l={value(h){h.target.checked=h.detail.value!=="Off",t.setValue(s,{value:h.target.checked})}};this._dispatchEventFromSandbox(l,o)}),this._setEventListeners(a,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],o=>o.target.checked)),this._setBackgroundColor(a),this._setDefaultPropertiesFromJS(a),this.container.append(a),this.container}}class zp extends vn{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const t=this.annotationStorage,e=this.data,s=e.id;let i=t.getValue(s,{value:e.fieldValue===e.buttonValue}).value;if(typeof i=="string"&&(i=i!==e.buttonValue,t.setValue(s,{value:i})),i)for(const o of this._getElementsByName(e.fieldName,s))t.setValue(o.id,{value:!1});const a=document.createElement("input");if(gn.add(a),a.setAttribute("data-element-id",s),a.disabled=e.readOnly,this._setRequired(a,this.data.required),a.type="radio",a.name=e.fieldName,i&&a.setAttribute("checked",!0),a.tabIndex=Eo,a.addEventListener("change",o=>{const{name:l,checked:h}=o.target;for(const c of this._getElementsByName(l,s))t.setValue(c.id,{value:!1});t.setValue(s,{value:h})}),a.addEventListener("resetform",o=>{const l=e.defaultFieldValue;o.target.checked=l!=null&&l===e.buttonValue}),this.enableScripting&&this.hasJSActions){const o=e.buttonValue;a.addEventListener("updatefromsandbox",l=>{const h={value:c=>{const d=o===c.detail.value;for(const u of this._getElementsByName(c.target.name)){const f=d&&u.id===s;u.domElement&&(u.domElement.checked=f),t.setValue(u.id,{value:f})}}};this._dispatchEventFromSandbox(h,l)}),this._setEventListeners(a,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],l=>l.target.checked)}return this._setBackgroundColor(a),this._setDefaultPropertiesFromJS(a),this.container.append(a),this.container}}class Tm extends Gp{constructor(t){super(t,{ignoreBorder:t.data.hasAppearance})}render(){const t=super.render();t.classList.add("buttonWidgetAnnotation","pushButton");const e=t.lastChild;return this.enableScripting&&this.hasJSActions&&e&&(this._setDefaultPropertiesFromJS(e),e.addEventListener("updatefromsandbox",s=>{this._dispatchEventFromSandbox({},s)})),t}}class Rm extends vn{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const t=this.annotationStorage,e=this.data.id,s=t.getValue(e,{value:this.data.fieldValue}),i=document.createElement("select");gn.add(i),i.setAttribute("data-element-id",e),i.disabled=this.data.readOnly,this._setRequired(i,this.data.required),i.name=this.data.fieldName,i.tabIndex=Eo;let a=this.data.combo&&this.data.options.length>0;this.data.combo||(i.size=this.data.options.length,this.data.multiSelect&&(i.multiple=!0)),i.addEventListener("resetform",d=>{const u=this.data.defaultFieldValue;for(const f of i.options)f.selected=f.value===u});for(const d of this.data.options){const u=document.createElement("option");u.textContent=d.displayValue,u.value=d.exportValue,s.value.includes(d.exportValue)&&(u.setAttribute("selected",!0),a=!1),i.append(u)}let o=null;if(a){const d=document.createElement("option");d.value=" ",d.setAttribute("hidden",!0),d.setAttribute("selected",!0),i.prepend(d),o=()=>{d.remove(),i.removeEventListener("input",o),o=null},i.addEventListener("input",o)}const l=d=>{const u=d?"value":"textContent",{options:f,multiple:g}=i;return g?Array.prototype.filter.call(f,b=>b.selected).map(b=>b[u]):f.selectedIndex===-1?null:f[f.selectedIndex][u]};let h=l(!1);const c=d=>{const u=d.target.options;return Array.prototype.map.call(u,f=>({displayValue:f.textContent,exportValue:f.value}))};return this.enableScripting&&this.hasJSActions?(i.addEventListener("updatefromsandbox",d=>{const u={value(f){o==null||o();const g=f.detail.value,b=new Set(Array.isArray(g)?g:[g]);for(const w of i.options)w.selected=b.has(w.value);t.setValue(e,{value:l(!0)}),h=l(!1)},multipleSelection(f){i.multiple=!0},remove(f){const g=i.options,b=f.detail.remove;g[b].selected=!1,i.remove(b),g.length>0&&Array.prototype.findIndex.call(g,w=>w.selected)===-1&&(g[0].selected=!0),t.setValue(e,{value:l(!0),items:c(f)}),h=l(!1)},clear(f){for(;i.length!==0;)i.remove(0);t.setValue(e,{value:null,items:[]}),h=l(!1)},insert(f){const{index:g,displayValue:b,exportValue:w}=f.detail.insert,A=i.children[g],y=document.createElement("option");y.textContent=b,y.value=w,A?A.before(y):i.append(y),t.setValue(e,{value:l(!0),items:c(f)}),h=l(!1)},items(f){const{items:g}=f.detail;for(;i.length!==0;)i.remove(0);for(const b of g){const{displayValue:w,exportValue:A}=b,y=document.createElement("option");y.textContent=w,y.value=A,i.append(y)}i.options.length>0&&(i.options[0].selected=!0),t.setValue(e,{value:l(!0),items:c(f)}),h=l(!1)},indices(f){const g=new Set(f.detail.indices);for(const b of f.target.options)b.selected=g.has(b.index);t.setValue(e,{value:l(!0)}),h=l(!1)},editable(f){f.target.disabled=!f.detail.editable}};this._dispatchEventFromSandbox(u,d)}),i.addEventListener("input",d=>{var u;const f=l(!0),g=l(!1);t.setValue(e,{value:f}),d.preventDefault(),(u=this.linkService.eventBus)==null||u.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:h,change:g,changeEx:f,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(i,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],d=>d.target.value)):i.addEventListener("input",function(d){t.setValue(e,{value:l(!0)})}),this.data.combo&&this._setTextStyle(i),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}class qc extends St{constructor(t){const{data:e,elements:s}=t;super(t,{isRenderable:St._hasPopupData(e)}),this.elements=s,this.popup=null}render(){this.container.classList.add("popupAnnotation");const t=this.popup=new Pm({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),e=[];for(const s of this.elements)s.popup=t,s.container.ariaHasPopup="dialog",e.push(s.data.id),s.addHighlightArea();return this.container.setAttribute("aria-controls",e.map(s=>`${Td}${s}`).join(",")),this.container}}var to,Xc,Yc,eo,Er,dt,Zs,kr,Ah,yh,so,qs,Ye,ci,_h,di,yl,Oi,Xn,yt,_l,nc,ku,Up,jp,Mu,Sh,xh,Kc;class Pm{constructor({container:t,color:e,elements:s,titleObj:i,modificationDate:a,contentsObj:o,richText:l,parent:h,rect:c,parentRect:d,open:u}){m(this,yt),m(this,to,v(this,yt,jp).bind(this)),m(this,Xc,v(this,yt,Kc).bind(this)),m(this,Yc,v(this,yt,xh).bind(this)),m(this,eo,v(this,yt,Sh).bind(this)),m(this,Er,null),m(this,dt,null),m(this,Zs,null),m(this,kr,null),m(this,Ah,null),m(this,yh,null),m(this,so,null),m(this,qs,!1),m(this,Ye,null),m(this,ci,null),m(this,_h,null),m(this,di,null),m(this,yl,null),m(this,Oi,null),m(this,Xn,!1);var f;p(this,dt,t),p(this,yl,i),p(this,Zs,o),p(this,di,l),p(this,yh,h),p(this,Er,e),p(this,_h,c),p(this,so,d),p(this,Ah,s),p(this,kr,Id.toDateObject(a)),this.trigger=s.flatMap(g=>g.getElementsToTriggerPopup());for(const g of this.trigger)g.addEventListener("click",n(this,eo)),g.addEventListener("mouseenter",n(this,Yc)),g.addEventListener("mouseleave",n(this,Xc)),g.classList.add("popupTriggerArea");for(const g of s)(f=g.container)==null||f.addEventListener("keydown",n(this,to));n(this,dt).hidden=!0,u&&v(this,yt,Sh).call(this)}render(){if(n(this,Ye))return;const t=p(this,Ye,document.createElement("div"));if(t.className="popup",n(this,Er)){const a=t.style.outlineColor=L.makeHexColor(...n(this,Er));t.style.backgroundColor=`color-mix(in srgb, ${a} 30%, white)`}const e=document.createElement("span");e.className="header";const s=document.createElement("h1");if(e.append(s),{dir:s.dir,str:s.textContent}=n(this,yl),t.append(e),n(this,kr)){const a=document.createElement("span");a.classList.add("popupDate"),a.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),a.setAttribute("data-l10n-args",JSON.stringify({dateObj:n(this,kr).valueOf()})),e.append(a)}const i=n(this,yt,_l);if(i)Wp.render({xfaHtml:i,intent:"richText",div:t}),t.lastChild.classList.add("richText","popupContent");else{const a=this._formatContents(n(this,Zs));t.append(a)}n(this,dt).append(t)}_formatContents({str:t,dir:e}){const s=document.createElement("p");s.classList.add("popupContent"),s.dir=e;const i=t.split(/(?:\r\n?|\n)/);for(let a=0,o=i.length;a<o;++a){const l=i[a];s.append(document.createTextNode(l)),a<o-1&&s.append(document.createElement("br"))}return s}updateEdited({rect:t,popupContent:e}){var s;n(this,Oi)||p(this,Oi,{contentsObj:n(this,Zs),richText:n(this,di)}),t&&p(this,ci,null),e&&(p(this,di,v(this,yt,Up).call(this,e)),p(this,Zs,null)),(s=n(this,Ye))==null||s.remove(),p(this,Ye,null)}resetEdited(){var t;n(this,Oi)&&({contentsObj:oe(this,Zs)._,richText:oe(this,di)._}=n(this,Oi),p(this,Oi,null),(t=n(this,Ye))==null||t.remove(),p(this,Ye,null),p(this,ci,null))}forceHide(){p(this,Xn,this.isVisible),n(this,Xn)&&(n(this,dt).hidden=!0)}maybeShow(){n(this,Xn)&&(n(this,Ye)||v(this,yt,xh).call(this),p(this,Xn,!1),n(this,dt).hidden=!1)}get isVisible(){return n(this,dt).hidden===!1}}to=new WeakMap,Xc=new WeakMap,Yc=new WeakMap,eo=new WeakMap,Er=new WeakMap,dt=new WeakMap,Zs=new WeakMap,kr=new WeakMap,Ah=new WeakMap,yh=new WeakMap,so=new WeakMap,qs=new WeakMap,Ye=new WeakMap,ci=new WeakMap,_h=new WeakMap,di=new WeakMap,yl=new WeakMap,Oi=new WeakMap,Xn=new WeakMap,yt=new WeakSet,_l=function(){const r=n(this,di),t=n(this,Zs);return r!=null&&r.str&&(!(t!=null&&t.str)||t.str===r.str)&&n(this,di).html||null},nc=function(){var r,t,e;return((e=(t=(r=n(this,yt,_l))==null?void 0:r.attributes)==null?void 0:t.style)==null?void 0:e.fontSize)||0},ku=function(){var r,t,e;return((e=(t=(r=n(this,yt,_l))==null?void 0:r.attributes)==null?void 0:t.style)==null?void 0:e.color)||null},Up=function(r){const t=[],e={str:r,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:t}]}},s={style:{color:n(this,yt,ku),fontSize:n(this,yt,nc)?`calc(${n(this,yt,nc)}px * var(--total-scale-factor))`:""}};for(const i of r.split(`
`))t.push({name:"span",value:i,attributes:s});return e},jp=function(r){r.altKey||r.shiftKey||r.ctrlKey||r.metaKey||(r.key==="Enter"||r.key==="Escape"&&n(this,qs))&&v(this,yt,Sh).call(this)},Mu=function(){if(n(this,ci)!==null)return;const{page:{view:r},viewport:{rawDims:{pageWidth:t,pageHeight:e,pageX:s,pageY:i}}}=n(this,yh);let a=!!n(this,so),o=a?n(this,so):n(this,_h);for(const f of n(this,Ah))if(!o||L.intersect(f.data.rect,o)!==null){o=f.data.rect,a=!0;break}const l=L.normalizeRect([o[0],r[3]-o[1]+r[1],o[2],r[3]-o[3]+r[1]]),h=a?o[2]-o[0]+5:0,c=l[0]+h,d=l[1];p(this,ci,[100*(c-s)/t,100*(d-i)/e]);const{style:u}=n(this,dt);u.left=`${n(this,ci)[0]}%`,u.top=`${n(this,ci)[1]}%`},Sh=function(){p(this,qs,!n(this,qs)),n(this,qs)?(v(this,yt,xh).call(this),n(this,dt).addEventListener("click",n(this,eo)),n(this,dt).addEventListener("keydown",n(this,to))):(v(this,yt,Kc).call(this),n(this,dt).removeEventListener("click",n(this,eo)),n(this,dt).removeEventListener("keydown",n(this,to)))},xh=function(){n(this,Ye)||this.render(),this.isVisible?n(this,qs)&&n(this,dt).classList.add("focused"):(v(this,yt,Mu).call(this),n(this,dt).hidden=!1,n(this,dt).style.zIndex=parseInt(n(this,dt).style.zIndex)+1e3)},Kc=function(){n(this,dt).classList.remove("focused"),!(n(this,qs)||!this.isVisible)&&(n(this,dt).hidden=!0,n(this,dt).style.zIndex=parseInt(n(this,dt).style.zIndex)-1e3)};class Vp extends St{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.textContent=t.data.textContent,this.textPosition=t.data.textPosition,this.annotationEditorType=G.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const t=document.createElement("div");t.classList.add("annotationTextContent"),t.setAttribute("role","comment");for(const e of this.textContent){const s=document.createElement("span");s.textContent=e,t.append(s)}this.container.append(t)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}var Sl;class Im extends St{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),m(this,Sl,null)}render(){this.container.classList.add("lineAnnotation");const{data:t,width:e,height:s}=this,i=this.svgFactory.create(e,s,!0),a=p(this,Sl,this.svgFactory.createElement("svg:line"));return a.setAttribute("x1",t.rect[2]-t.lineCoordinates[0]),a.setAttribute("y1",t.rect[3]-t.lineCoordinates[1]),a.setAttribute("x2",t.rect[2]-t.lineCoordinates[2]),a.setAttribute("y2",t.rect[3]-t.lineCoordinates[3]),a.setAttribute("stroke-width",t.borderStyle.width||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),i.append(a),this.container.append(i),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return n(this,Sl)}addHighlightArea(){this.container.classList.add("highlightArea")}}Sl=new WeakMap;var xl;class Lm extends St{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),m(this,xl,null)}render(){this.container.classList.add("squareAnnotation");const{data:t,width:e,height:s}=this,i=this.svgFactory.create(e,s,!0),a=t.borderStyle.width,o=p(this,xl,this.svgFactory.createElement("svg:rect"));return o.setAttribute("x",a/2),o.setAttribute("y",a/2),o.setAttribute("width",e-a),o.setAttribute("height",s-a),o.setAttribute("stroke-width",a||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),i.append(o),this.container.append(i),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return n(this,xl)}addHighlightArea(){this.container.classList.add("highlightArea")}}xl=new WeakMap;var El;class Dm extends St{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),m(this,El,null)}render(){this.container.classList.add("circleAnnotation");const{data:t,width:e,height:s}=this,i=this.svgFactory.create(e,s,!0),a=t.borderStyle.width,o=p(this,El,this.svgFactory.createElement("svg:ellipse"));return o.setAttribute("cx",e/2),o.setAttribute("cy",s/2),o.setAttribute("rx",e/2-a/2),o.setAttribute("ry",s/2-a/2),o.setAttribute("stroke-width",a||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),i.append(o),this.container.append(i),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return n(this,El)}addHighlightArea(){this.container.classList.add("highlightArea")}}El=new WeakMap;var kl;class qp extends St{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),m(this,kl,null),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,vertices:e,borderStyle:s,popupRef:i},width:a,height:o}=this;if(!e)return this.container;const l=this.svgFactory.create(a,o,!0);let h=[];for(let d=0,u=e.length;d<u;d+=2){const f=e[d]-t[0],g=t[3]-e[d+1];h.push(`${f},${g}`)}h=h.join(" ");const c=p(this,kl,this.svgFactory.createElement(this.svgElementName));return c.setAttribute("points",h),c.setAttribute("stroke-width",s.width||1),c.setAttribute("stroke","transparent"),c.setAttribute("fill","transparent"),l.append(c),this.container.append(l),!i&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return n(this,kl)}addHighlightArea(){this.container.classList.add("highlightArea")}}kl=new WeakMap;class Nm extends qp{constructor(t){super(t),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class Fm extends St{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}var Ml,Yn,Cl,Qc;class Bd extends St{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),m(this,Cl),m(this,Ml,null),m(this,Yn,[]),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?G.HIGHLIGHT:G.INK}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,rotation:e,inkLists:s,borderStyle:i,popupRef:a}}=this,{transform:o,width:l,height:h}=v(this,Cl,Qc).call(this,e,t),c=this.svgFactory.create(l,h,!0),d=p(this,Ml,this.svgFactory.createElement("svg:g"));c.append(d),d.setAttribute("stroke-width",i.width||1),d.setAttribute("stroke-linecap","round"),d.setAttribute("stroke-linejoin","round"),d.setAttribute("stroke-miterlimit",10),d.setAttribute("stroke","transparent"),d.setAttribute("fill","transparent"),d.setAttribute("transform",o);for(let u=0,f=s.length;u<f;u++){const g=this.svgFactory.createElement(this.svgElementName);n(this,Yn).push(g),g.setAttribute("points",s[u].join(",")),d.append(g)}return!a&&this.hasPopupData&&this._createPopup(),this.container.append(c),this._editOnDoubleClick(),this.container}updateEdited(t){super.updateEdited(t);const{thickness:e,points:s,rect:i}=t,a=n(this,Ml);if(e>=0&&a.setAttribute("stroke-width",e||1),s)for(let o=0,l=n(this,Yn).length;o<l;o++)n(this,Yn)[o].setAttribute("points",s[o].join(","));if(i){const{transform:o,width:l,height:h}=v(this,Cl,Qc).call(this,this.data.rotation,i);a.parentElement.setAttribute("viewBox",`0 0 ${l} ${h}`),a.setAttribute("transform",o)}}getElementsToTriggerPopup(){return n(this,Yn)}addHighlightArea(){this.container.classList.add("highlightArea")}}Ml=new WeakMap,Yn=new WeakMap,Cl=new WeakSet,Qc=function(r,t){switch(r){case 90:return{transform:`rotate(90) translate(${-t[0]},${t[1]}) scale(1,-1)`,width:t[3]-t[1],height:t[2]-t[0]};case 180:return{transform:`rotate(180) translate(${-t[2]},${t[1]}) scale(1,-1)`,width:t[2]-t[0],height:t[3]-t[1]};case 270:return{transform:`rotate(270) translate(${-t[2]},${t[3]}) scale(1,-1)`,width:t[3]-t[1],height:t[2]-t[0]};default:return{transform:`translate(${-t[0]},${t[3]}) scale(1,-1)`,width:t[2]-t[0],height:t[3]-t[1]}}};class Xp extends St{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=G.HIGHLIGHT}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),this.container}}class Om extends St{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}}class Wm extends St{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}}class Bm extends St{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}}class Yp extends St{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=G.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}var Tl,Rl,Jc;class $m extends St{constructor(t){var e;super(t,{isRenderable:!0}),m(this,Rl),m(this,Tl,null);const{file:s}=this.data;this.filename=s.filename,this.content=s.content,(e=this.linkService.eventBus)==null||e.dispatch("fileattachmentannotation",{source:this,...s})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:t,data:e}=this;let s;e.hasAppearance||e.fillAlpha===0?s=document.createElement("div"):(s=document.createElement("img"),s.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(e.name)?"paperclip":"pushpin"}.svg`,e.fillAlpha&&e.fillAlpha<1&&(s.style=`filter: opacity(${Math.round(e.fillAlpha*100)}%);`)),s.addEventListener("dblclick",v(this,Rl,Jc).bind(this)),p(this,Tl,s);const{isMac:i}=Bt.platform;return t.addEventListener("keydown",a=>{a.key==="Enter"&&(i?a.metaKey:a.ctrlKey)&&v(this,Rl,Jc).call(this)}),!e.popupRef&&this.hasPopupData?this._createPopup():s.classList.add("popupTriggerArea"),t.append(s),t}getElementsToTriggerPopup(){return n(this,Tl)}addHighlightArea(){this.container.classList.add("highlightArea")}}Tl=new WeakMap,Rl=new WeakSet,Jc=function(){var r;(r=this.downloadManager)==null||r.openOrDownloadData(this.content,this.filename)};var Eh,pa,sn,kh,Kn,Zc,td;const Hm=class Kp{constructor({div:t,accessibilityManager:e,annotationCanvasMap:s,annotationEditorUIManager:i,page:a,viewport:o,structTreeLayer:l}){m(this,Kn),m(this,Eh,null),m(this,pa,null),m(this,sn,new Map),m(this,kh,null),this.div=t,p(this,Eh,e),p(this,pa,s),p(this,kh,l||null),this.page=a,this.viewport=o,this.zIndex=0,this._annotationEditorUIManager=i}hasEditableAnnotations(){return n(this,sn).size>0}async render(t){var e;const{annotations:s}=t,i=this.div;fn(i,this.viewport);const a=new Map,o={data:null,layer:i,linkService:t.linkService,downloadManager:t.downloadManager,imageResourcesPath:t.imageResourcesPath||"",renderForms:t.renderForms!==!1,svgFactory:new bh,annotationStorage:t.annotationStorage||new Fd,enableScripting:t.enableScripting===!0,hasJSActions:t.hasJSActions,fieldObjects:t.fieldObjects,parent:this,elements:null};for(const l of s){if(l.noHTML)continue;const h=l.annotationType===ft.POPUP;if(h){const u=a.get(l.id);if(!u)continue;o.elements=u}else if(l.rect[2]===l.rect[0]||l.rect[3]===l.rect[1])continue;o.data=l;const c=Eu.create(o);if(!c.isRenderable)continue;if(!h&&l.popupRef){const u=a.get(l.popupRef);u?u.push(c):a.set(l.popupRef,[c])}const d=c.render();l.hidden&&(d.style.visibility="hidden"),await v(this,Kn,Zc).call(this,d,l.id),c._isEditable&&(n(this,sn).set(c.data.id,c),(e=this._annotationEditorUIManager)==null||e.renderAnnotationElement(c))}v(this,Kn,td).call(this)}async addLinkAnnotations(t,e){const s={data:null,layer:this.div,linkService:e,svgFactory:new bh,parent:this};for(const i of t){i.borderStyle||(i.borderStyle=Kp._defaultBorderStyle),s.data=i;const a=Eu.create(s);if(!a.isRenderable)continue;const o=a.render();await v(this,Kn,Zc).call(this,o,i.id)}}update({viewport:t}){const e=this.div;this.viewport=t,fn(e,{rotation:t.rotation}),v(this,Kn,td).call(this),e.hidden=!1}getEditableAnnotations(){return Array.from(n(this,sn).values())}getEditableAnnotation(t){return n(this,sn).get(t)}static get _defaultBorderStyle(){return j(this,"_defaultBorderStyle",Object.freeze({width:1,rawWidth:1,style:An.SOLID,dashArray:[3],horizontalCornerRadius:0,verticalCornerRadius:0}))}};Eh=new WeakMap,pa=new WeakMap,sn=new WeakMap,kh=new WeakMap,Kn=new WeakSet,Zc=async function(r,t){var e,s;const i=r.firstChild||r,a=i.id=`${Td}${t}`,o=await((e=n(this,kh))==null?void 0:e.getAriaAttributes(a));if(o)for(const[l,h]of o)i.setAttribute(l,h);this.div.append(r),(s=n(this,Eh))==null||s.moveElementInDOM(this.div,r,i,!1)},td=function(){var r;if(!n(this,pa))return;const t=this.div;for(const[e,s]of n(this,pa)){const i=t.querySelector(`[data-annotation-id="${e}"]`);if(!i)continue;s.className="annotationContent";const{firstChild:a}=i;a?a.nodeName==="CANVAS"?a.replaceWith(s):a.classList.contains("annotationContent")?a.after(s):a.before(s):i.append(s);const o=n(this,sn).get(e);o&&(o._hasNoCanvas?((r=this._annotationEditorUIManager)==null||r.setMissingCanvas(e,i.id,s),o._hasNoCanvas=!1):o.canvas=s)}n(this,pa).clear()};let Gm=Hm;const Pl=/\r\n?|\n/g;var ss,Ce,Il,Qn,Te,de,Qp,Jp,Zp,Mh,cn,Ch,Ll,tf,ed,ef;const gs=class Tt extends ht{constructor(t){super({...t,name:"freeTextEditor"}),m(this,de),m(this,ss),m(this,Ce,""),m(this,Il,`${this.id}-editor`),m(this,Qn,null),m(this,Te),p(this,ss,t.color||Tt._defaultColor||ht._defaultLineColor),p(this,Te,t.fontSize||Tt._defaultFontSize)}static get _keyboardManager(){const t=Tt.prototype,e=a=>a.isEmpty(),s=wo.TRANSLATE_SMALL,i=wo.TRANSLATE_BIG;return j(this,"_keyboardManager",new So([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],t.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],t.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],t._translateEmpty,{args:[-s,0],checker:e}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t._translateEmpty,{args:[-i,0],checker:e}],[["ArrowRight","mac+ArrowRight"],t._translateEmpty,{args:[s,0],checker:e}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t._translateEmpty,{args:[i,0],checker:e}],[["ArrowUp","mac+ArrowUp"],t._translateEmpty,{args:[0,-s],checker:e}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t._translateEmpty,{args:[0,-i],checker:e}],[["ArrowDown","mac+ArrowDown"],t._translateEmpty,{args:[0,s],checker:e}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t._translateEmpty,{args:[0,i],checker:e}]]))}static initialize(t,e){ht.initialize(t,e);const s=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(s.getPropertyValue("--freetext-padding"))}static updateDefaultParams(t,e){switch(t){case V.FREETEXT_SIZE:Tt._defaultFontSize=e;break;case V.FREETEXT_COLOR:Tt._defaultColor=e;break}}updateParams(t,e){switch(t){case V.FREETEXT_SIZE:v(this,de,Qp).call(this,e);break;case V.FREETEXT_COLOR:v(this,de,Jp).call(this,e);break}}static get defaultPropertiesToUpdate(){return[[V.FREETEXT_SIZE,Tt._defaultFontSize],[V.FREETEXT_COLOR,Tt._defaultColor||ht._defaultLineColor]]}get propertiesToUpdate(){return[[V.FREETEXT_SIZE,n(this,Te)],[V.FREETEXT_COLOR,n(this,ss)]]}_translateEmpty(t,e){this._uiManager.translateSelectedEditors(t,e,!0)}getInitialTranslation(){const t=this.parentScale;return[-Tt._internalPadding*t,-(Tt._internalPadding+n(this,Te))*t]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(this.isInEditMode())return;this.parent.setEditingState(!1),this.parent.updateToolbar(G.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),p(this,Qn,new AbortController);const t=this._uiManager.combinedSignal(n(this,Qn));this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:t}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:t}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:t}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:t}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:t})}disableEditMode(){var t;this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",n(this,Il)),this._isDraggable=!0,(t=n(this,Qn))==null||t.abort(),p(this,Qn,null),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"))}focusin(t){this._focusEventsAllowed&&(super.focusin(t),t.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(t){var e;this.width||(this.enableEditMode(),t&&this.editorDiv.focus(),(e=this._initialOptions)!=null&&e.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const t=n(this,Ce),e=p(this,Ce,v(this,de,Zp).call(this).trimEnd());if(t===e)return;const s=i=>{if(p(this,Ce,i),!i){this.remove();return}v(this,de,Ll).call(this),this._uiManager.rebuild(this),v(this,de,Mh).call(this)};this.addCommands({cmd:()=>{s(e)},undo:()=>{s(t)},mustExec:!1}),v(this,de,Mh).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(t){this.enterInEditMode()}keydown(t){t.target===this.div&&t.key==="Enter"&&(this.enterInEditMode(),t.preventDefault())}editorDivKeydown(t){Tt._keyboardManager.exec(this,t)}editorDivFocus(t){this.isEditing=!0}editorDivBlur(t){this.isEditing=!1}editorDivInput(t){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let t,e;(this._isCopy||this.annotationElementId)&&(t=this.x,e=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",n(this,Il)),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:s}=this.editorDiv;if(s.fontSize=`calc(${n(this,Te)}px * var(--total-scale-factor))`,s.color=n(this,ss),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),Nd(this,this.div,["dblclick","keydown"]),this._isCopy||this.annotationElementId){const[i,a]=this.parentDimensions;if(this.annotationElementId){const{position:o}=this._initialData;let[l,h]=this.getInitialTranslation();[l,h]=this.pageTranslationToScreen(l,h);const[c,d]=this.pageDimensions,[u,f]=this.pageTranslation;let g,b;switch(this.rotation){case 0:g=t+(o[0]-u)/c,b=e+this.height-(o[1]-f)/d;break;case 90:g=t+(o[0]-u)/c,b=e-(o[1]-f)/d,[l,h]=[h,-l];break;case 180:g=t-this.width+(o[0]-u)/c,b=e-(o[1]-f)/d,[l,h]=[-l,-h];break;case 270:g=t+(o[0]-u-this.height*d)/c,b=e+(o[1]-f-this.width*c)/d,[l,h]=[-h,l];break}this.setAt(g*i,b*a,l,h)}else this._moveAfterPaste(t,e);v(this,de,Ll).call(this),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}editorDivPaste(t){var e,s,i;const a=t.clipboardData||window.clipboardData,{types:o}=a;if(o.length===1&&o[0]==="text/plain")return;t.preventDefault();const l=v(e=Tt,cn,ed).call(e,a.getData("text")||"").replaceAll(Pl,`
`);if(!l)return;const h=window.getSelection();if(!h.rangeCount)return;this.editorDiv.normalize(),h.deleteFromDocument();const c=h.getRangeAt(0);if(!l.includes(`
`)){c.insertNode(document.createTextNode(l)),this.editorDiv.normalize(),h.collapseToStart();return}const{startContainer:d,startOffset:u}=c,f=[],g=[];if(d.nodeType===Node.TEXT_NODE){const A=d.parentElement;if(g.push(d.nodeValue.slice(u).replaceAll(Pl,"")),A!==this.editorDiv){let y=f;for(const S of this.editorDiv.childNodes){if(S===A){y=g;continue}y.push(v(s=Tt,cn,Ch).call(s,S))}}f.push(d.nodeValue.slice(0,u).replaceAll(Pl,""))}else if(d===this.editorDiv){let A=f,y=0;for(const S of this.editorDiv.childNodes)y++===u&&(A=g),A.push(v(i=Tt,cn,Ch).call(i,S))}p(this,Ce,`${f.join(`
`)}${l}${g.join(`
`)}`),v(this,de,Ll).call(this);const b=new Range;let w=Math.sumPrecise(f.map(A=>A.length));for(const{firstChild:A}of this.editorDiv.childNodes)if(A.nodeType===Node.TEXT_NODE){const y=A.nodeValue.length;if(w<=y){b.setStart(A,w),b.setEnd(A,w);break}w-=y}h.removeAllRanges(),h.addRange(b)}get contentDiv(){return this.editorDiv}static async deserialize(t,e,s){var i;let a=null;if(t instanceof Vp){const{data:{defaultAppearanceData:{fontSize:l,fontColor:h},rect:c,rotation:d,id:u,popupRef:f},textContent:g,textPosition:b,parent:{page:{pageNumber:w}}}=t;if(!g||g.length===0)return null;a=t={annotationType:G.FREETEXT,color:Array.from(h),fontSize:l,value:g.join(`
`),position:b,pageIndex:w-1,rect:c.slice(0),rotation:d,id:u,deleted:!1,popupRef:f}}const o=await super.deserialize(t,e,s);return p(o,Te,t.fontSize),p(o,ss,L.makeHexColor(...t.color)),p(o,Ce,v(i=Tt,cn,ed).call(i,t.value)),o.annotationElementId=t.id||null,o._initialData=a,o}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const e=Tt._internalPadding*this.parentScale,s=this.getRect(e,e),i=ht._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:n(this,ss)),a={annotationType:G.FREETEXT,color:i,fontSize:n(this,Te),value:v(this,de,tf).call(this),pageIndex:this.pageIndex,rect:s,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return t?(a.isCopy=!0,a):this.annotationElementId&&!v(this,de,ef).call(this,a)?null:(a.id=this.annotationElementId,a)}renderAnnotationElement(t){const e=super.renderAnnotationElement(t);if(this.deleted)return e;const{style:s}=e;s.fontSize=`calc(${n(this,Te)}px * var(--total-scale-factor))`,s.color=n(this,ss),e.replaceChildren();for(const a of n(this,Ce).split(`
`)){const o=document.createElement("div");o.append(a?document.createTextNode(a):document.createElement("br")),e.append(o)}const i=Tt._internalPadding*this.parentScale;return t.updateEdited({rect:this.getRect(i,i),popupContent:n(this,Ce)}),e}resetAnnotationElement(t){super.resetAnnotationElement(t),t.resetEdited()}};ss=new WeakMap,Ce=new WeakMap,Il=new WeakMap,Qn=new WeakMap,Te=new WeakMap,de=new WeakSet,Qp=function(r){const t=s=>{this.editorDiv.style.fontSize=`calc(${s}px * var(--total-scale-factor))`,this.translate(0,-(s-n(this,Te))*this.parentScale),p(this,Te,s),v(this,de,Mh).call(this)},e=n(this,Te);this.addCommands({cmd:t.bind(this,r),undo:t.bind(this,e),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:V.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},Jp=function(r){const t=s=>{p(this,ss,this.editorDiv.style.color=s)},e=n(this,ss);this.addCommands({cmd:t.bind(this,r),undo:t.bind(this,e),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:V.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},Zp=function(){var r;const t=[];this.editorDiv.normalize();let e=null;for(const s of this.editorDiv.childNodes)(e==null?void 0:e.nodeType)===Node.TEXT_NODE&&s.nodeName==="BR"||(t.push(v(r=gs,cn,Ch).call(r,s)),e=s);return t.join(`
`)},Mh=function(){const[r,t]=this.parentDimensions;let e;if(this.isAttachedToDOM)e=this.div.getBoundingClientRect();else{const{currentLayer:s,div:i}=this,a=i.style.display,o=i.classList.contains("hidden");i.classList.remove("hidden"),i.style.display="hidden",s.div.append(this.div),e=i.getBoundingClientRect(),i.remove(),i.style.display=a,i.classList.toggle("hidden",o)}this.rotation%180===this.parentRotation%180?(this.width=e.width/r,this.height=e.height/t):(this.width=e.height/r,this.height=e.width/t),this.fixAndSetPosition()},cn=new WeakSet,Ch=function(r){return(r.nodeType===Node.TEXT_NODE?r.nodeValue:r.innerText).replaceAll(Pl,"")},Ll=function(){if(this.editorDiv.replaceChildren(),!!n(this,Ce))for(const r of n(this,Ce).split(`
`)){const t=document.createElement("div");t.append(r?document.createTextNode(r):document.createElement("br")),this.editorDiv.append(t)}},tf=function(){return n(this,Ce).replaceAll(" "," ")},ed=function(r){return r.replaceAll(" "," ")},ef=function(r){const{value:t,fontSize:e,color:s,pageIndex:i}=this._initialData;return this._hasBeenMoved||r.value!==t||r.fontSize!==e||r.color.some((a,o)=>a!==s[o])||r.pageIndex!==i},m(gs,cn),I(gs,"_freeTextDefaultContent",""),I(gs,"_internalPadding",0),I(gs,"_defaultColor",null),I(gs,"_defaultFontSize",10),I(gs,"_type","freetext"),I(gs,"_editorType",G.FREETEXT);let zm=gs;class R{toSVGPath(){Z("Abstract method `toSVGPath` must be implemented.")}get box(){Z("Abstract getter `box` must be implemented.")}serialize(t,e){Z("Abstract method `serialize` must be implemented.")}static _rescale(t,e,s,i,a,o){o||(o=new Float32Array(t.length));for(let l=0,h=t.length;l<h;l+=2)o[l]=e+t[l]*i,o[l+1]=s+t[l+1]*a;return o}static _rescaleAndSwap(t,e,s,i,a,o){o||(o=new Float32Array(t.length));for(let l=0,h=t.length;l<h;l+=2)o[l]=e+t[l+1]*i,o[l+1]=s+t[l]*a;return o}static _translate(t,e,s,i){i||(i=new Float32Array(t.length));for(let a=0,o=t.length;a<o;a+=2)i[a]=e+t[a],i[a+1]=s+t[a+1];return i}static svgRound(t){return Math.round(t*1e4)}static _normalizePoint(t,e,s,i,a){switch(a){case 90:return[1-e/s,t/i];case 180:return[1-t/s,1-e/i];case 270:return[e/s,1-t/i];default:return[t/s,e/i]}}static _normalizePagePoint(t,e,s){switch(s){case 90:return[1-e,t];case 180:return[1-t,1-e];case 270:return[e,1-t];default:return[t,e]}}static createBezierPoints(t,e,s,i,a,o){return[(t+5*s)/6,(e+5*i)/6,(5*s+a)/6,(5*i+o)/6,(s+a)/2,(i+o)/2]}}I(R,"PRECISION",1e-4);var Re,is,io,no,ms,U,Ca,Ta,Dl,Nl,ao,Mr,Wi,Fl,ac,sd,Pe,Ba,sf,nf,af,rf,of,lf;const Jn=class id{constructor({x:t,y:e},s,i,a,o,l=0){m(this,Pe),m(this,Re),m(this,is,[]),m(this,io),m(this,no),m(this,ms,[]),m(this,U,new Float32Array(18)),m(this,Ca),m(this,Ta),m(this,Dl),m(this,Nl),m(this,ao),m(this,Mr),m(this,Wi,[]),p(this,Re,s),p(this,Mr,a*i),p(this,no,o),n(this,U).set([NaN,NaN,NaN,NaN,t,e],6),p(this,io,l),p(this,Nl,n(id,Fl)*i),p(this,Dl,n(id,sd)*i),p(this,ao,i),n(this,Wi).push(t,e)}isEmpty(){return isNaN(n(this,U)[8])}add({x:t,y:e}){var s;p(this,Ca,t),p(this,Ta,e);const[i,a,o,l]=n(this,Re);let[h,c,d,u]=n(this,U).subarray(8,12);const f=t-d,g=e-u,b=Math.hypot(f,g);if(b<n(this,Dl))return!1;const w=b-n(this,Nl),A=w/b,y=A*f,S=A*g;let _=h,x=c;h=d,c=u,d+=y,u+=S,(s=n(this,Wi))==null||s.push(t,e);const k=-S/w,E=y/w,M=k*n(this,Mr),C=E*n(this,Mr);return n(this,U).set(n(this,U).subarray(2,8),0),n(this,U).set([d+M,u+C],4),n(this,U).set(n(this,U).subarray(14,18),12),n(this,U).set([d-M,u-C],16),isNaN(n(this,U)[6])?(n(this,ms).length===0&&(n(this,U).set([h+M,c+C],2),n(this,ms).push(NaN,NaN,NaN,NaN,(h+M-i)/o,(c+C-a)/l),n(this,U).set([h-M,c-C],14),n(this,is).push(NaN,NaN,NaN,NaN,(h-M-i)/o,(c-C-a)/l)),n(this,U).set([_,x,h,c,d,u],6),!this.isEmpty()):(n(this,U).set([_,x,h,c,d,u],6),Math.abs(Math.atan2(x-c,_-h)-Math.atan2(S,y))<Math.PI/2?([h,c,d,u]=n(this,U).subarray(2,6),n(this,ms).push(NaN,NaN,NaN,NaN,((h+d)/2-i)/o,((c+u)/2-a)/l),[h,c,_,x]=n(this,U).subarray(14,18),n(this,is).push(NaN,NaN,NaN,NaN,((_+h)/2-i)/o,((x+c)/2-a)/l),!0):([_,x,h,c,d,u]=n(this,U).subarray(0,6),n(this,ms).push(((_+5*h)/6-i)/o,((x+5*c)/6-a)/l,((5*h+d)/6-i)/o,((5*c+u)/6-a)/l,((h+d)/2-i)/o,((c+u)/2-a)/l),[d,u,h,c,_,x]=n(this,U).subarray(12,18),n(this,is).push(((_+5*h)/6-i)/o,((x+5*c)/6-a)/l,((5*h+d)/6-i)/o,((5*c+u)/6-a)/l,((h+d)/2-i)/o,((c+u)/2-a)/l),!0))}toSVGPath(){if(this.isEmpty())return"";const t=n(this,ms),e=n(this,is);if(isNaN(n(this,U)[6])&&!this.isEmpty())return v(this,Pe,sf).call(this);const s=[];s.push(`M${t[4]} ${t[5]}`);for(let i=6;i<t.length;i+=6)isNaN(t[i])?s.push(`L${t[i+4]} ${t[i+5]}`):s.push(`C${t[i]} ${t[i+1]} ${t[i+2]} ${t[i+3]} ${t[i+4]} ${t[i+5]}`);v(this,Pe,af).call(this,s);for(let i=e.length-6;i>=6;i-=6)isNaN(e[i])?s.push(`L${e[i+4]} ${e[i+5]}`):s.push(`C${e[i]} ${e[i+1]} ${e[i+2]} ${e[i+3]} ${e[i+4]} ${e[i+5]}`);return v(this,Pe,nf).call(this,s),s.join(" ")}newFreeDrawOutline(t,e,s,i,a,o){return new df(t,e,s,i,a,o)}getOutlines(){var t;const e=n(this,ms),s=n(this,is),i=n(this,U),[a,o,l,h]=n(this,Re),c=new Float32Array((((t=n(this,Wi))==null?void 0:t.length)??0)+2);for(let f=0,g=c.length-2;f<g;f+=2)c[f]=(n(this,Wi)[f]-a)/l,c[f+1]=(n(this,Wi)[f+1]-o)/h;if(c[c.length-2]=(n(this,Ca)-a)/l,c[c.length-1]=(n(this,Ta)-o)/h,isNaN(i[6])&&!this.isEmpty())return v(this,Pe,rf).call(this,c);const d=new Float32Array(n(this,ms).length+24+n(this,is).length);let u=e.length;for(let f=0;f<u;f+=2){if(isNaN(e[f])){d[f]=d[f+1]=NaN;continue}d[f]=e[f],d[f+1]=e[f+1]}u=v(this,Pe,lf).call(this,d,u);for(let f=s.length-6;f>=6;f-=6)for(let g=0;g<6;g+=2){if(isNaN(s[f+g])){d[u]=d[u+1]=NaN,u+=2;continue}d[u]=s[f+g],d[u+1]=s[f+g+1],u+=2}return v(this,Pe,of).call(this,d,u),this.newFreeDrawOutline(d,c,n(this,Re),n(this,ao),n(this,io),n(this,no))}};Re=new WeakMap,is=new WeakMap,io=new WeakMap,no=new WeakMap,ms=new WeakMap,U=new WeakMap,Ca=new WeakMap,Ta=new WeakMap,Dl=new WeakMap,Nl=new WeakMap,ao=new WeakMap,Mr=new WeakMap,Wi=new WeakMap,Fl=new WeakMap,ac=new WeakMap,sd=new WeakMap,Pe=new WeakSet,Ba=function(){const r=n(this,U).subarray(4,6),t=n(this,U).subarray(16,18),[e,s,i,a]=n(this,Re);return[(n(this,Ca)+(r[0]-t[0])/2-e)/i,(n(this,Ta)+(r[1]-t[1])/2-s)/a,(n(this,Ca)+(t[0]-r[0])/2-e)/i,(n(this,Ta)+(t[1]-r[1])/2-s)/a]},sf=function(){const[r,t,e,s]=n(this,Re),[i,a,o,l]=v(this,Pe,Ba).call(this);return`M${(n(this,U)[2]-r)/e} ${(n(this,U)[3]-t)/s} L${(n(this,U)[4]-r)/e} ${(n(this,U)[5]-t)/s} L${i} ${a} L${o} ${l} L${(n(this,U)[16]-r)/e} ${(n(this,U)[17]-t)/s} L${(n(this,U)[14]-r)/e} ${(n(this,U)[15]-t)/s} Z`},nf=function(r){const t=n(this,is);r.push(`L${t[4]} ${t[5]} Z`)},af=function(r){const[t,e,s,i]=n(this,Re),a=n(this,U).subarray(4,6),o=n(this,U).subarray(16,18),[l,h,c,d]=v(this,Pe,Ba).call(this);r.push(`L${(a[0]-t)/s} ${(a[1]-e)/i} L${l} ${h} L${c} ${d} L${(o[0]-t)/s} ${(o[1]-e)/i}`)},rf=function(r){const t=n(this,U),[e,s,i,a]=n(this,Re),[o,l,h,c]=v(this,Pe,Ba).call(this),d=new Float32Array(36);return d.set([NaN,NaN,NaN,NaN,(t[2]-e)/i,(t[3]-s)/a,NaN,NaN,NaN,NaN,(t[4]-e)/i,(t[5]-s)/a,NaN,NaN,NaN,NaN,o,l,NaN,NaN,NaN,NaN,h,c,NaN,NaN,NaN,NaN,(t[16]-e)/i,(t[17]-s)/a,NaN,NaN,NaN,NaN,(t[14]-e)/i,(t[15]-s)/a],0),this.newFreeDrawOutline(d,r,n(this,Re),n(this,ao),n(this,io),n(this,no))},of=function(r,t){const e=n(this,is);return r.set([NaN,NaN,NaN,NaN,e[4],e[5]],t),t+=6},lf=function(r,t){const e=n(this,U).subarray(4,6),s=n(this,U).subarray(16,18),[i,a,o,l]=n(this,Re),[h,c,d,u]=v(this,Pe,Ba).call(this);return r.set([NaN,NaN,NaN,NaN,(e[0]-i)/o,(e[1]-a)/l,NaN,NaN,NaN,NaN,h,c,NaN,NaN,NaN,NaN,d,u,NaN,NaN,NaN,NaN,(s[0]-i)/o,(s[1]-a)/l],t),t+=24},m(Jn,Fl,8),m(Jn,ac,2),m(Jn,sd,n(Jn,Fl)+n(Jn,ac));let hf=Jn;var Cr,fa,ui,Ol,be,Wl,mt,nd,cf;class df extends R{constructor(t,e,s,i,a,o){super(),m(this,nd),m(this,Cr),m(this,fa,new Float32Array(4)),m(this,ui),m(this,Ol),m(this,be),m(this,Wl),m(this,mt),p(this,mt,t),p(this,be,e),p(this,Cr,s),p(this,Wl,i),p(this,ui,a),p(this,Ol,o),this.lastPoint=[NaN,NaN],v(this,nd,cf).call(this,o);const[l,h,c,d]=n(this,fa);for(let u=0,f=t.length;u<f;u+=2)t[u]=(t[u]-l)/c,t[u+1]=(t[u+1]-h)/d;for(let u=0,f=e.length;u<f;u+=2)e[u]=(e[u]-l)/c,e[u+1]=(e[u+1]-h)/d}toSVGPath(){const t=[`M${n(this,mt)[4]} ${n(this,mt)[5]}`];for(let e=6,s=n(this,mt).length;e<s;e+=6){if(isNaN(n(this,mt)[e])){t.push(`L${n(this,mt)[e+4]} ${n(this,mt)[e+5]}`);continue}t.push(`C${n(this,mt)[e]} ${n(this,mt)[e+1]} ${n(this,mt)[e+2]} ${n(this,mt)[e+3]} ${n(this,mt)[e+4]} ${n(this,mt)[e+5]}`)}return t.push("Z"),t.join(" ")}serialize([t,e,s,i],a){const o=s-t,l=i-e;let h,c;switch(a){case 0:h=R._rescale(n(this,mt),t,i,o,-l),c=R._rescale(n(this,be),t,i,o,-l);break;case 90:h=R._rescaleAndSwap(n(this,mt),t,e,o,l),c=R._rescaleAndSwap(n(this,be),t,e,o,l);break;case 180:h=R._rescale(n(this,mt),s,e,-o,l),c=R._rescale(n(this,be),s,e,-o,l);break;case 270:h=R._rescaleAndSwap(n(this,mt),s,i,-o,-l),c=R._rescaleAndSwap(n(this,be),s,i,-o,-l);break}return{outline:Array.from(h),points:[Array.from(c)]}}get box(){return n(this,fa)}newOutliner(t,e,s,i,a,o=0){return new hf(t,e,s,i,a,o)}getNewOutline(t,e){const[s,i,a,o]=n(this,fa),[l,h,c,d]=n(this,Cr),u=a*c,f=o*d,g=s*c+l,b=i*d+h,w=this.newOutliner({x:n(this,be)[0]*u+g,y:n(this,be)[1]*f+b},n(this,Cr),n(this,Wl),t,n(this,Ol),e??n(this,ui));for(let A=2;A<n(this,be).length;A+=2)w.add({x:n(this,be)[A]*u+g,y:n(this,be)[A+1]*f+b});return w.getOutlines()}}Cr=new WeakMap,fa=new WeakMap,ui=new WeakMap,Ol=new WeakMap,be=new WeakMap,Wl=new WeakMap,mt=new WeakMap,nd=new WeakSet,cf=function(r){const t=n(this,mt);let e=t[4],s=t[5];const i=[e,s,e,s];let a=e,o=s;const l=r?Math.max:Math.min;for(let c=6,d=t.length;c<d;c+=6){const u=t[c+4],f=t[c+5];if(isNaN(t[c]))L.pointBoundingBox(u,f,i),o<f?(a=u,o=f):o===f&&(a=l(a,u));else{const g=[1/0,1/0,-1/0,-1/0];L.bezierBoundingBox(e,s,...t.slice(c,c+6),g),L.rectBoundingBox(...g,i),o<g[3]?(a=g[2],o=g[3]):o===g[3]&&(a=l(a,g[2]))}e=u,s=f}const h=n(this,fa);h[0]=i[0]-n(this,ui),h[1]=i[1]-n(this,ui),h[2]=i[2]-i[0]+2*n(this,ui),h[3]=i[3]-i[1]+2*n(this,ui),this.lastPoint=[a,o]};var Th,Rh,Bi,Ve,ns,uf,Oo,pf,ff,ad;class rd{constructor(t,e=0,s=0,i=!0){m(this,ns),m(this,Th),m(this,Rh),m(this,Bi,[]),m(this,Ve,[]);const a=[1/0,1/0,-1/0,-1/0],o=10**-4;for(const{x:g,y:b,width:w,height:A}of t){const y=Math.floor((g-e)/o)*o,S=Math.ceil((g+w+e)/o)*o,_=Math.floor((b-e)/o)*o,x=Math.ceil((b+A+e)/o)*o,k=[y,_,x,!0],E=[S,_,x,!1];n(this,Bi).push(k,E),L.rectBoundingBox(y,_,S,x,a)}const l=a[2]-a[0]+2*s,h=a[3]-a[1]+2*s,c=a[0]-s,d=a[1]-s,u=n(this,Bi).at(i?-1:-2),f=[u[0],u[2]];for(const g of n(this,Bi)){const[b,w,A]=g;g[0]=(b-c)/l,g[1]=(w-d)/h,g[2]=(A-d)/h}p(this,Th,new Float32Array([c,d,l,h])),p(this,Rh,f)}getOutlines(){n(this,Bi).sort((e,s)=>e[0]-s[0]||e[1]-s[1]||e[2]-s[2]);const t=[];for(const e of n(this,Bi))e[3]?(t.push(...v(this,ns,ad).call(this,e)),v(this,ns,pf).call(this,e)):(v(this,ns,ff).call(this,e),t.push(...v(this,ns,ad).call(this,e)));return v(this,ns,uf).call(this,t)}}Th=new WeakMap,Rh=new WeakMap,Bi=new WeakMap,Ve=new WeakMap,ns=new WeakSet,uf=function(r){const t=[],e=new Set;for(const a of r){const[o,l,h]=a;t.push([o,l,a],[o,h,a])}t.sort((a,o)=>a[1]-o[1]||a[0]-o[0]);for(let a=0,o=t.length;a<o;a+=2){const l=t[a][2],h=t[a+1][2];l.push(h),h.push(l),e.add(l),e.add(h)}const s=[];let i;for(;e.size>0;){const a=e.values().next().value;let[o,l,h,c,d]=a;e.delete(a);let u=o,f=l;for(i=[o,h],s.push(i);;){let g;if(e.has(c))g=c;else if(e.has(d))g=d;else break;e.delete(g),[o,l,h,c,d]=g,u!==o&&(i.push(u,f,o,f===l?l:h),u=o),f=f===l?h:l}i.push(u,f)}return new Um(s,n(this,Th),n(this,Rh))},Oo=function(r){const t=n(this,Ve);let e=0,s=t.length-1;for(;e<=s;){const i=e+s>>1,a=t[i][0];if(a===r)return i;a<r?e=i+1:s=i-1}return s+1},pf=function([,r,t]){const e=v(this,ns,Oo).call(this,r);n(this,Ve).splice(e,0,[r,t])},ff=function([,r,t]){const e=v(this,ns,Oo).call(this,r);for(let s=e;s<n(this,Ve).length;s++){const[i,a]=n(this,Ve)[s];if(i!==r)break;if(i===r&&a===t){n(this,Ve).splice(s,1);return}}for(let s=e-1;s>=0;s--){const[i,a]=n(this,Ve)[s];if(i!==r)break;if(i===r&&a===t){n(this,Ve).splice(s,1);return}}},ad=function(r){const[t,e,s]=r,i=[[t,e,s]],a=v(this,ns,Oo).call(this,s);for(let o=0;o<a;o++){const[l,h]=n(this,Ve)[o];for(let c=0,d=i.length;c<d;c++){const[,u,f]=i[c];if(!(h<=u||f<=l)){if(u>=l){if(f>h)i[c][1]=h;else{if(d===1)return[];i.splice(c,1),c--,d--}continue}i[c][2]=l,f>h&&i.push([t,h,f])}}}return i};var Bl,Tr;class Um extends R{constructor(t,e,s){super(),m(this,Bl),m(this,Tr),p(this,Tr,t),p(this,Bl,e),this.lastPoint=s}toSVGPath(){const t=[];for(const e of n(this,Tr)){let[s,i]=e;t.push(`M${s} ${i}`);for(let a=2;a<e.length;a+=2){const o=e[a],l=e[a+1];o===s?(t.push(`V${l}`),i=l):l===i&&(t.push(`H${o}`),s=o)}t.push("Z")}return t.join(" ")}serialize([t,e,s,i],a){const o=[],l=s-t,h=i-e;for(const c of n(this,Tr)){const d=new Array(c.length);for(let u=0;u<c.length;u+=2)d[u]=t+c[u]*l,d[u+1]=i-c[u+1]*h;o.push(d)}return o}get box(){return n(this,Bl)}get classNamesForOutlining(){return["highlightOutline"]}}Bl=new WeakMap,Tr=new WeakMap;class od extends hf{newFreeDrawOutline(t,e,s,i,a,o){return new jm(t,e,s,i,a,o)}}class jm extends df{newOutliner(t,e,s,i,a,o=0){return new od(t,e,s,i,a,o)}}var Ke,Zn,ro,kt,Ph,Rr,$l,Ih,dn,as,oo,lo,lt,ld,hd,cd,$i,Cu,ti;const Hl=class vs{constructor({editor:t=null,uiManager:e=null}){m(this,lt),m(this,Ke,null),m(this,Zn,null),m(this,ro),m(this,kt,null),m(this,Ph,!1),m(this,Rr,!1),m(this,$l,null),m(this,Ih),m(this,dn,null),m(this,as,null),m(this,oo);var s;t?(p(this,Rr,!1),p(this,oo,V.HIGHLIGHT_COLOR),p(this,$l,t)):(p(this,Rr,!0),p(this,oo,V.HIGHLIGHT_DEFAULT_COLOR)),p(this,as,(t==null?void 0:t._uiManager)||e),p(this,Ih,n(this,as)._eventBus),p(this,ro,(t==null?void 0:t.color)||((s=n(this,as))==null?void 0:s.highlightColors.values().next().value)||"#FFFF98"),n(vs,lo)||p(vs,lo,Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"}))}static get _keyboardManager(){return j(this,"_keyboardManager",new So([[["Escape","mac+Escape"],vs.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],vs.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],vs.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],vs.prototype._moveToPrevious],[["Home","mac+Home"],vs.prototype._moveToBeginning],[["End","mac+End"],vs.prototype._moveToEnd]]))}renderButton(){const t=p(this,Ke,document.createElement("button"));t.className="colorPicker",t.tabIndex="0",t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),t.setAttribute("aria-haspopup",!0);const e=n(this,as)._signal;t.addEventListener("click",v(this,lt,$i).bind(this),{signal:e}),t.addEventListener("keydown",v(this,lt,cd).bind(this),{signal:e});const s=p(this,Zn,document.createElement("span"));return s.className="swatch",s.setAttribute("aria-hidden",!0),s.style.backgroundColor=n(this,ro),t.append(s),t}renderMainDropdown(){const t=p(this,kt,v(this,lt,ld).call(this));return t.setAttribute("aria-orientation","horizontal"),t.setAttribute("aria-labelledby","highlightColorPickerLabel"),t}_colorSelectFromKeyboard(t){if(t.target===n(this,Ke)){v(this,lt,$i).call(this,t);return}const e=t.target.getAttribute("data-color");e&&v(this,lt,hd).call(this,e,t)}_moveToNext(t){var e,s;if(!n(this,lt,ti)){v(this,lt,$i).call(this,t);return}if(t.target===n(this,Ke)){(e=n(this,kt).firstChild)==null||e.focus();return}(s=t.target.nextSibling)==null||s.focus()}_moveToPrevious(t){var e,s;if(t.target===((e=n(this,kt))==null?void 0:e.firstChild)||t.target===n(this,Ke)){n(this,lt,ti)&&this._hideDropdownFromKeyboard();return}n(this,lt,ti)||v(this,lt,$i).call(this,t),(s=t.target.previousSibling)==null||s.focus()}_moveToBeginning(t){var e;if(!n(this,lt,ti)){v(this,lt,$i).call(this,t);return}(e=n(this,kt).firstChild)==null||e.focus()}_moveToEnd(t){var e;if(!n(this,lt,ti)){v(this,lt,$i).call(this,t);return}(e=n(this,kt).lastChild)==null||e.focus()}hideDropdown(){var t,e;(t=n(this,kt))==null||t.classList.add("hidden"),(e=n(this,dn))==null||e.abort(),p(this,dn,null)}_hideDropdownFromKeyboard(){var t;if(!n(this,Rr)){if(!n(this,lt,ti)){(t=n(this,$l))==null||t.unselect();return}this.hideDropdown(),n(this,Ke).focus({preventScroll:!0,focusVisible:n(this,Ph)})}}updateColor(t){if(n(this,Zn)&&(n(this,Zn).style.backgroundColor=t),!n(this,kt))return;const e=n(this,as).highlightColors.values();for(const s of n(this,kt).children)s.setAttribute("aria-selected",e.next().value===t)}destroy(){var t,e;(t=n(this,Ke))==null||t.remove(),p(this,Ke,null),p(this,Zn,null),(e=n(this,kt))==null||e.remove(),p(this,kt,null)}};Ke=new WeakMap,Zn=new WeakMap,ro=new WeakMap,kt=new WeakMap,Ph=new WeakMap,Rr=new WeakMap,$l=new WeakMap,Ih=new WeakMap,dn=new WeakMap,as=new WeakMap,oo=new WeakMap,lo=new WeakMap,lt=new WeakSet,ld=function(){const r=document.createElement("div"),t=n(this,as)._signal;r.addEventListener("contextmenu",$e,{signal:t}),r.className="dropdown",r.role="listbox",r.setAttribute("aria-multiselectable",!1),r.setAttribute("aria-orientation","vertical"),r.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown");for(const[e,s]of n(this,as).highlightColors){const i=document.createElement("button");i.tabIndex="0",i.role="option",i.setAttribute("data-color",s),i.title=e,i.setAttribute("data-l10n-id",n(Hl,lo)[e]);const a=document.createElement("span");i.append(a),a.className="swatch",a.style.backgroundColor=s,i.setAttribute("aria-selected",s===n(this,ro)),i.addEventListener("click",v(this,lt,hd).bind(this,s),{signal:t}),r.append(i)}return r.addEventListener("keydown",v(this,lt,cd).bind(this),{signal:t}),r},hd=function(r,t){t.stopPropagation(),n(this,Ih).dispatch("switchannotationeditorparams",{source:this,type:n(this,oo),value:r})},cd=function(r){Hl._keyboardManager.exec(this,r)},$i=function(r){if(n(this,lt,ti)){this.hideDropdown();return}if(p(this,Ph,r.detail===0),n(this,dn)||(p(this,dn,new AbortController),window.addEventListener("pointerdown",v(this,lt,Cu).bind(this),{signal:n(this,as).combinedSignal(n(this,dn))})),n(this,kt)){n(this,kt).classList.remove("hidden");return}const t=p(this,kt,v(this,lt,ld).call(this));n(this,Ke).append(t)},Cu=function(r){var t;(t=n(this,kt))!=null&&t.contains(r.target)||this.hideDropdown()},ti=function(){return n(this,kt)&&!n(this,kt).classList.contains("hidden")},m(Hl,lo,null);let gf=Hl;var ho,Lh,gi,ga,co,ue,Dh,Nh,Ra,Fe,xe,qt,uo,mi,Qt,Pr,We,Gl,K,dd,Fh,mf,vf,Tu,ud,Hi,Rs,Pa,wf,zl,po,bf,Af,yf,_f,Sf;const ee=class zt extends ht{constructor(t){super({...t,name:"highlightEditor"}),m(this,K),m(this,ho,null),m(this,Lh,0),m(this,gi),m(this,ga,null),m(this,co,null),m(this,ue,null),m(this,Dh,null),m(this,Nh,0),m(this,Ra,null),m(this,Fe,null),m(this,xe,null),m(this,qt,!1),m(this,uo,null),m(this,mi),m(this,Qt,null),m(this,Pr,""),m(this,We),m(this,Gl,""),this.color=t.color||zt._defaultColor,p(this,We,t.thickness||zt._defaultThickness),p(this,mi,t.opacity||zt._defaultOpacity),p(this,gi,t.boxes||null),p(this,Gl,t.methodOfCreation||""),p(this,Pr,t.text||""),this._isDraggable=!1,this.defaultL10nId="pdfjs-editor-highlight-editor",t.highlightId>-1?(p(this,qt,!0),v(this,K,Fh).call(this,t),v(this,K,Hi).call(this)):n(this,gi)&&(p(this,ho,t.anchorNode),p(this,Lh,t.anchorOffset),p(this,Dh,t.focusNode),p(this,Nh,t.focusOffset),v(this,K,dd).call(this),v(this,K,Hi).call(this),this.rotate(this.rotation))}static get _keyboardManager(){const t=zt.prototype;return j(this,"_keyboardManager",new So([[["ArrowLeft","mac+ArrowLeft"],t._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],t._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],t._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],t._moveCaret,{args:[3]}]]))}get telemetryInitialData(){return{action:"added",type:n(this,qt)?"free_highlight":"highlight",color:this._uiManager.highlightColorNames.get(this.color),thickness:n(this,We),methodOfCreation:n(this,Gl)}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.highlightColorNames.get(this.color)}}static computeTelemetryFinalData(t){return{numberOfColors:t.get("color").size}}static initialize(t,e){var s;ht.initialize(t,e),zt._defaultColor||(zt._defaultColor=((s=e.highlightColors)==null?void 0:s.values().next().value)||"#fff066")}static updateDefaultParams(t,e){switch(t){case V.HIGHLIGHT_DEFAULT_COLOR:zt._defaultColor=e;break;case V.HIGHLIGHT_THICKNESS:zt._defaultThickness=e;break}}translateInPage(t,e){}get toolbarPosition(){return n(this,uo)}updateParams(t,e){switch(t){case V.HIGHLIGHT_COLOR:v(this,K,mf).call(this,e);break;case V.HIGHLIGHT_THICKNESS:v(this,K,vf).call(this,e);break}}static get defaultPropertiesToUpdate(){return[[V.HIGHLIGHT_DEFAULT_COLOR,zt._defaultColor],[V.HIGHLIGHT_THICKNESS,zt._defaultThickness]]}get propertiesToUpdate(){return[[V.HIGHLIGHT_COLOR,this.color||zt._defaultColor],[V.HIGHLIGHT_THICKNESS,n(this,We)||zt._defaultThickness],[V.HIGHLIGHT_FREE,n(this,qt)]]}async addEditToolbar(){const t=await super.addEditToolbar();return t?(this._uiManager.highlightColors&&(p(this,co,new gf({editor:this})),t.addColorPicker(n(this,co))),t):null}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(v(this,K,po).call(this))}getBaseTranslation(){return[0,0]}getRect(t,e){return super.getRect(t,e,v(this,K,po).call(this))}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),t&&this.div.focus()}remove(){v(this,K,ud).call(this),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(v(this,K,Hi).call(this),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){var e;let s=!1;this.parent&&!t?v(this,K,ud).call(this):t&&(v(this,K,Hi).call(this,t),s=!this.parent&&((e=this.div)==null?void 0:e.classList.contains("selectedEditor"))),super.setParent(t),this.show(this._isVisible),s&&this.select()}rotate(t){var e,s,i;const{drawLayer:a}=this.parent;let o;n(this,qt)?(t=(t-this.rotation+360)%360,o=v(e=zt,Rs,Pa).call(e,n(this,Fe).box,t)):o=v(s=zt,Rs,Pa).call(s,[this.x,this.y,this.width,this.height],t),a.updateProperties(n(this,xe),{bbox:o,root:{"data-main-rotation":t}}),a.updateProperties(n(this,Qt),{bbox:v(i=zt,Rs,Pa).call(i,n(this,ue).box,t),root:{"data-main-rotation":t}})}render(){if(this.div)return this.div;const t=super.render();n(this,Pr)&&(t.setAttribute("aria-label",n(this,Pr)),t.setAttribute("role","mark")),n(this,qt)?t.classList.add("free"):this.div.addEventListener("keydown",v(this,K,wf).bind(this),{signal:this._uiManager._signal});const e=p(this,Ra,document.createElement("div"));t.append(e),e.setAttribute("aria-hidden","true"),e.className="internal",e.style.clipPath=n(this,ga);const[s,i]=this.parentDimensions;return this.setDims(this.width*s,this.height*i),Nd(this,n(this,Ra),["pointerover","pointerleave"]),this.enableEditing(),t}pointerover(){var t;this.isSelected||(t=this.parent)==null||t.drawLayer.updateProperties(n(this,Qt),{rootClass:{hovered:!0}})}pointerleave(){var t;this.isSelected||(t=this.parent)==null||t.drawLayer.updateProperties(n(this,Qt),{rootClass:{hovered:!1}})}_moveCaret(t){switch(this.parent.unselect(this),t){case 0:case 2:v(this,K,zl).call(this,!0);break;case 1:case 3:v(this,K,zl).call(this,!1);break}}select(){var t;super.select(),n(this,Qt)&&((t=this.parent)==null||t.drawLayer.updateProperties(n(this,Qt),{rootClass:{hovered:!1,selected:!0}}))}unselect(){var t;super.unselect(),n(this,Qt)&&((t=this.parent)==null||t.drawLayer.updateProperties(n(this,Qt),{rootClass:{selected:!1}}),n(this,qt)||v(this,K,zl).call(this,!1))}get _mustFixPosition(){return!n(this,qt)}show(t=this._isVisible){super.show(t),this.parent&&(this.parent.drawLayer.updateProperties(n(this,xe),{rootClass:{hidden:!t}}),this.parent.drawLayer.updateProperties(n(this,Qt),{rootClass:{hidden:!t}}))}static startHighlighting(t,e,{target:s,x:i,y:a}){const{x:o,y:l,width:h,height:c}=s.getBoundingClientRect(),d=new AbortController,u=t.combinedSignal(d),f=g=>{d.abort(),v(this,Rs,_f).call(this,t,g)};window.addEventListener("blur",f,{signal:u}),window.addEventListener("pointerup",f,{signal:u}),window.addEventListener("pointerdown",vt,{capture:!0,passive:!1,signal:u}),window.addEventListener("contextmenu",$e,{signal:u}),s.addEventListener("pointermove",v(this,Rs,yf).bind(this,t),{signal:u}),this._freeHighlight=new od({x:i,y:a},[o,l,h,c],t.scale,this._defaultThickness/2,e,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static async deserialize(t,e,s){var i,a,o,l;let h=null;if(t instanceof Xp){const{data:{quadPoints:S,rect:_,rotation:x,id:k,color:E,opacity:M,popupRef:C},parent:{page:{pageNumber:T}}}=t;h=t={annotationType:G.HIGHLIGHT,color:Array.from(E),opacity:M,quadPoints:S,boxes:null,pageIndex:T-1,rect:_.slice(0),rotation:x,id:k,deleted:!1,popupRef:C}}else if(t instanceof Bd){const{data:{inkLists:S,rect:_,rotation:x,id:k,color:E,borderStyle:{rawWidth:M},popupRef:C},parent:{page:{pageNumber:T}}}=t;h=t={annotationType:G.HIGHLIGHT,color:Array.from(E),thickness:M,inkLists:S,boxes:null,pageIndex:T-1,rect:_.slice(0),rotation:x,id:k,deleted:!1,popupRef:C}}const{color:c,quadPoints:d,inkLists:u,opacity:f}=t,g=await super.deserialize(t,e,s);g.color=L.makeHexColor(...c),p(g,mi,f||1),u&&p(g,We,t.thickness),g.annotationElementId=t.id||null,g._initialData=h;const[b,w]=g.pageDimensions,[A,y]=g.pageTranslation;if(d){const S=p(g,gi,[]);for(let _=0;_<d.length;_+=8)S.push({x:(d[_]-A)/b,y:1-(d[_+1]-y)/w,width:(d[_+2]-d[_])/b,height:(d[_+1]-d[_+5])/w});v(i=g,K,dd).call(i),v(a=g,K,Hi).call(a),g.rotate(g.rotation)}else if(u){p(g,qt,!0);const S=u[0],_={x:S[0]-A,y:w-(S[1]-y)},x=new od(_,[0,0,b,w],1,n(g,We)/2,!0,.001);for(let M=0,C=S.length;M<C;M+=2)_.x=S[M]-A,_.y=w-(S[M+1]-y),x.add(_);const{id:k,clipPathId:E}=e.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:g.color,"fill-opacity":g._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:x.toSVGPath()}},!0,!0);v(o=g,K,Fh).call(o,{highlightOutlines:x.getOutlines(),highlightId:k,clipPathId:E}),v(l=g,K,Hi).call(l),g.rotate(g.parentRotation)}return g}serialize(t=!1){if(this.isEmpty()||t)return null;if(this.deleted)return this.serializeDeleted();const e=this.getRect(0,0),s=ht._colorManager.convert(this.color),i={annotationType:G.HIGHLIGHT,color:s,opacity:n(this,mi),thickness:n(this,We),quadPoints:v(this,K,bf).call(this),outlines:v(this,K,Af).call(this,e),pageIndex:this.pageIndex,rect:e,rotation:v(this,K,po).call(this),structTreeParentId:this._structTreeParentId};return this.annotationElementId&&!v(this,K,Sf).call(this,i)?null:(i.id=this.annotationElementId,i)}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}};ho=new WeakMap,Lh=new WeakMap,gi=new WeakMap,ga=new WeakMap,co=new WeakMap,ue=new WeakMap,Dh=new WeakMap,Nh=new WeakMap,Ra=new WeakMap,Fe=new WeakMap,xe=new WeakMap,qt=new WeakMap,uo=new WeakMap,mi=new WeakMap,Qt=new WeakMap,Pr=new WeakMap,We=new WeakMap,Gl=new WeakMap,K=new WeakSet,dd=function(){const r=new rd(n(this,gi),.001);p(this,Fe,r.getOutlines()),[this.x,this.y,this.width,this.height]=n(this,Fe).box;const t=new rd(n(this,gi),.0025,.001,this._uiManager.direction==="ltr");p(this,ue,t.getOutlines());const{lastPoint:e}=n(this,ue);p(this,uo,[(e[0]-this.x)/this.width,(e[1]-this.y)/this.height])},Fh=function({highlightOutlines:r,highlightId:t,clipPathId:e}){var s,i;if(p(this,Fe,r),p(this,ue,r.getNewOutline(n(this,We)/2+1.5,.0025)),t>=0)p(this,xe,t),p(this,ga,e),this.parent.drawLayer.finalizeDraw(t,{bbox:r.box,path:{d:r.toSVGPath()}}),p(this,Qt,this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:n(this,ue).box,path:{d:n(this,ue).toSVGPath()}},!0));else if(this.parent){const d=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(n(this,xe),{bbox:v(s=ee,Rs,Pa).call(s,n(this,Fe).box,(d-this.rotation+360)%360),path:{d:r.toSVGPath()}}),this.parent.drawLayer.updateProperties(n(this,Qt),{bbox:v(i=ee,Rs,Pa).call(i,n(this,ue).box,d),path:{d:n(this,ue).toSVGPath()}})}const[a,o,l,h]=r.box;switch(this.rotation){case 0:this.x=a,this.y=o,this.width=l,this.height=h;break;case 90:{const[d,u]=this.parentDimensions;this.x=o,this.y=1-a,this.width=l*u/d,this.height=h*d/u;break}case 180:this.x=1-a,this.y=1-o,this.width=l,this.height=h;break;case 270:{const[d,u]=this.parentDimensions;this.x=1-o,this.y=a,this.width=l*u/d,this.height=h*d/u;break}}const{lastPoint:c}=n(this,ue);p(this,uo,[(c[0]-a)/l,(c[1]-o)/h])},mf=function(r){const t=(i,a)=>{var o,l;this.color=i,p(this,mi,a),(o=this.parent)==null||o.drawLayer.updateProperties(n(this,xe),{root:{fill:i,"fill-opacity":a}}),(l=n(this,co))==null||l.updateColor(i)},e=this.color,s=n(this,mi);this.addCommands({cmd:t.bind(this,r,ee._defaultOpacity),undo:t.bind(this,e,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:V.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.highlightColorNames.get(r)},!0)},vf=function(r){const t=n(this,We),e=s=>{p(this,We,s),v(this,K,Tu).call(this,s)};this.addCommands({cmd:e.bind(this,r),undo:e.bind(this,t),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:V.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:r},!0)},Tu=function(r){if(!n(this,qt))return;v(this,K,Fh).call(this,{highlightOutlines:n(this,Fe).getNewOutline(r/2)}),this.fixAndSetPosition();const[t,e]=this.parentDimensions;this.setDims(this.width*t,this.height*e)},ud=function(){n(this,xe)===null||!this.parent||(this.parent.drawLayer.remove(n(this,xe)),p(this,xe,null),this.parent.drawLayer.remove(n(this,Qt)),p(this,Qt,null))},Hi=function(r=this.parent){n(this,xe)===null&&({id:oe(this,xe)._,clipPathId:oe(this,ga)._}=r.drawLayer.draw({bbox:n(this,Fe).box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":n(this,mi)},rootClass:{highlight:!0,free:n(this,qt)},path:{d:n(this,Fe).toSVGPath()}},!1,!0),p(this,Qt,r.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:n(this,qt)},bbox:n(this,ue).box,path:{d:n(this,ue).toSVGPath()}},n(this,qt))),n(this,Ra)&&(n(this,Ra).style.clipPath=n(this,ga)))},Rs=new WeakSet,Pa=function([r,t,e,s],i){switch(i){case 90:return[1-t-s,r,s,e];case 180:return[1-r-e,1-t-s,e,s];case 270:return[t,1-r-e,s,e]}return[r,t,e,s]},wf=function(r){ee._keyboardManager.exec(this,r)},zl=function(r){if(!n(this,ho))return;const t=window.getSelection();r?t.setPosition(n(this,ho),n(this,Lh)):t.setPosition(n(this,Dh),n(this,Nh))},po=function(){return n(this,qt)?this.rotation:0},bf=function(){if(n(this,qt))return null;const[r,t]=this.pageDimensions,[e,s]=this.pageTranslation,i=n(this,gi),a=new Float32Array(i.length*8);let o=0;for(const{x:l,y:h,width:c,height:d}of i){const u=l*r+e,f=(1-h)*t+s;a[o]=a[o+4]=u,a[o+1]=a[o+3]=f,a[o+2]=a[o+6]=u+c*r,a[o+5]=a[o+7]=f-d*t,o+=8}return a},Af=function(r){return n(this,Fe).serialize(r,v(this,K,po).call(this))},yf=function(r,t){this._freeHighlight.add(t)&&r.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})},_f=function(r,t){this._freeHighlight.isEmpty()?r.drawLayer.remove(this._freeHighlightId):r.createAndAddNewEditor(t,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""},Sf=function(r){const{color:t}=this._initialData;return r.color.some((e,s)=>e!==t[s])},m(ee,Rs),I(ee,"_defaultColor",null),I(ee,"_defaultOpacity",1),I(ee,"_defaultThickness",12),I(ee,"_type","highlight"),I(ee,"_editorType",G.HIGHLIGHT),I(ee,"_freeHighlightId",-1),I(ee,"_freeHighlight",null),I(ee,"_freeHighlightClipId","");let Ru=ee;var ta;class xf{constructor(){m(this,ta,Object.create(null))}updateProperty(t,e){this[t]=e,this.updateSVGProperty(t,e)}updateProperties(t){if(t)for(const[e,s]of Object.entries(t))e.startsWith("_")||this.updateProperty(e,s)}updateSVGProperty(t,e){n(this,ta)[t]=e}toSVGProperties(){const t=n(this,ta);return p(this,ta,Object.create(null)),{root:t}}reset(){p(this,ta,Object.create(null))}updateAll(t=this){this.updateProperties(t)}clone(){Z("Not implemented")}}ta=new WeakMap;var Ee,Ir,Lt,ma,va,ei,si,ii,wa,et,pd,rc,fd,Lr,Pu,Ul,fo,ea;const Ae=class H extends ht{constructor(t){super(t),m(this,et),m(this,Ee,null),m(this,Ir),I(this,"_drawId",null),p(this,Ir,t.mustBeCommitted||!1),this._addOutlines(t)}_addOutlines(t){t.drawOutlines&&(v(this,et,pd).call(this,t),v(this,et,Lr).call(this))}static _mergeSVGProperties(t,e){const s=new Set(Object.keys(t));for(const[i,a]of Object.entries(e))s.has(i)?Object.assign(t[i],a):t[i]=a;return t}static getDefaultDrawingOptions(t){Z("Not implemented")}static get typesMap(){Z("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(t,e){const s=this.typesMap.get(t);s&&this._defaultDrawingOptions.updateProperty(s,e),this._currentParent&&(n(H,Lt).updateProperty(s,e),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(t,e){const s=this.constructor.typesMap.get(t);s&&this._updateProperty(t,s,e)}static get defaultPropertiesToUpdate(){const t=[],e=this._defaultDrawingOptions;for(const[s,i]of this.typesMap)t.push([s,e[i]]);return t}get propertiesToUpdate(){const t=[],{_drawingOptions:e}=this;for(const[s,i]of this.constructor.typesMap)t.push([s,e[i]]);return t}_updateProperty(t,e,s){const i=this._drawingOptions,a=i[e],o=l=>{var h;i.updateProperty(e,l);const c=n(this,Ee).updateProperty(e,l);c&&v(this,et,fo).call(this,c),(h=this.parent)==null||h.drawLayer.updateProperties(this._drawId,i.toSVGProperties())};this.addCommands({cmd:o.bind(this,s),undo:o.bind(this,a),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:t,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,H._mergeSVGProperties(n(this,Ee).getPathResizingSVGProperties(v(this,et,Ul).call(this)),{bbox:v(this,et,ea).call(this)}))}_onResized(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,H._mergeSVGProperties(n(this,Ee).getPathResizedSVGProperties(v(this,et,Ul).call(this)),{bbox:v(this,et,ea).call(this)}))}_onTranslating(t,e){var s;(s=this.parent)==null||s.drawLayer.updateProperties(this._drawId,{bbox:v(this,et,ea).call(this)})}_onTranslated(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,H._mergeSVGProperties(n(this,Ee).getPathTranslatedSVGProperties(v(this,et,Ul).call(this),this.parentDimensions),{bbox:v(this,et,ea).call(this)}))}_onStartDragging(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,n(this,Ir)&&(p(this,Ir,!1),this.commit(),this.parent.setSelected(this),t&&this.isOnScreen&&this.div.focus())}remove(){v(this,et,fd).call(this),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(v(this,et,Lr).call(this),v(this,et,fo).call(this,n(this,Ee).box),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){var e;let s=!1;this.parent&&!t?(this._uiManager.removeShouldRescale(this),v(this,et,fd).call(this)):t&&(this._uiManager.addShouldRescale(this),v(this,et,Lr).call(this,t),s=!this.parent&&((e=this.div)==null?void 0:e.classList.contains("selectedEditor"))),super.setParent(t),s&&this.select()}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,H._mergeSVGProperties({bbox:v(this,et,ea).call(this)},n(this,Ee).updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&v(this,et,fo).call(this,n(this,Ee).updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;let t,e;this._isCopy&&(t=this.x,e=this.y);const s=super.render();s.classList.add("draw");const i=document.createElement("div");s.append(i),i.setAttribute("aria-hidden","true"),i.className="internal";const[a,o]=this.parentDimensions;return this.setDims(this.width*a,this.height*o),this._uiManager.addShouldRescale(this),this.disableEditing(),this._isCopy&&this._moveAfterPaste(t,e),s}static createDrawerInstance(t,e,s,i,a){Z("Not implemented")}static startDrawing(t,e,s,i){var a;const{target:o,offsetX:l,offsetY:h,pointerId:c,pointerType:d}=i;if(n(H,si)&&n(H,si)!==d)return;const{viewport:{rotation:u}}=t,{width:f,height:g}=o.getBoundingClientRect(),b=p(H,ma,new AbortController),w=t.combinedSignal(b);if(n(H,ei)||p(H,ei,c),n(H,si)??p(H,si,d),window.addEventListener("pointerup",A=>{var y;n(H,ei)===A.pointerId?this._endDraw(A):(y=n(H,ii))==null||y.delete(A.pointerId)},{signal:w}),window.addEventListener("pointercancel",A=>{var y;n(H,ei)===A.pointerId?this._currentParent.endDrawingSession():(y=n(H,ii))==null||y.delete(A.pointerId)},{signal:w}),window.addEventListener("pointerdown",A=>{n(H,si)===A.pointerType&&((n(H,ii)||p(H,ii,new Set)).add(A.pointerId),n(H,Lt).isCancellable()&&(n(H,Lt).removeLastElement(),n(H,Lt).isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:w}),window.addEventListener("contextmenu",$e,{signal:w}),o.addEventListener("pointermove",this._drawMove.bind(this),{signal:w}),o.addEventListener("touchmove",A=>{A.timeStamp===n(H,wa)&&vt(A)},{signal:w}),t.toggleDrawing(),(a=e._editorUndoBar)==null||a.hide(),n(H,Lt)){t.drawLayer.updateProperties(this._currentDrawId,n(H,Lt).startNew(l,h,f,g,u));return}e.updateUIForDefaultProperties(this),p(H,Lt,this.createDrawerInstance(l,h,f,g,u)),p(H,va,this.getDefaultDrawingOptions()),this._currentParent=t,{id:this._currentDrawId}=t.drawLayer.draw(this._mergeSVGProperties(n(H,va).toSVGProperties(),n(H,Lt).defaultSVGProperties),!0,!1)}static _drawMove(t){var e;if(p(H,wa,-1),!n(H,Lt))return;const{offsetX:s,offsetY:i,pointerId:a}=t;if(n(H,ei)===a){if(((e=n(H,ii))==null?void 0:e.size)>=1){this._endDraw(t);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,n(H,Lt).add(s,i)),p(H,wa,t.timeStamp),vt(t)}}static _cleanup(t){t&&(this._currentDrawId=-1,this._currentParent=null,p(H,Lt,null),p(H,va,null),p(H,si,null),p(H,wa,NaN)),n(H,ma)&&(n(H,ma).abort(),p(H,ma,null),p(H,ei,NaN),p(H,ii,null))}static _endDraw(t){const e=this._currentParent;if(e){if(e.toggleDrawing(!0),this._cleanup(!1),(t==null?void 0:t.target)===e.div&&e.drawLayer.updateProperties(this._currentDrawId,n(H,Lt).end(t.offsetX,t.offsetY)),this.supportMultipleDrawings){const s=n(H,Lt),i=this._currentDrawId,a=s.getLastElement();e.addCommands({cmd:()=>{e.drawLayer.updateProperties(i,s.setLastElement(a))},undo:()=>{e.drawLayer.updateProperties(i,s.removeLastElement())},mustExec:!1,type:V.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(t){const e=this._currentParent;if(!e)return null;if(e.toggleDrawing(!0),e.cleanUndoStack(V.DRAW_STEP),!n(H,Lt).isEmpty()){const{pageDimensions:[s,i],scale:a}=e,o=e.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:n(H,Lt).getOutlines(s*a,i*a,a,this._INNER_MARGIN),drawingOptions:n(H,va),mustBeCommitted:!t});return this._cleanup(!0),o}return e.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(t){}static deserializeDraw(t,e,s,i,a,o){Z("Not implemented")}static async deserialize(t,e,s){var i,a;const{rawDims:{pageWidth:o,pageHeight:l,pageX:h,pageY:c}}=e.viewport,d=this.deserializeDraw(h,c,o,l,this._INNER_MARGIN,t),u=await super.deserialize(t,e,s);return u.createDrawingOptions(t),v(i=u,et,pd).call(i,{drawOutlines:d}),v(a=u,et,Lr).call(a),u.onScaleChanging(),u.rotate(),u}serializeDraw(t){const[e,s]=this.pageTranslation,[i,a]=this.pageDimensions;return n(this,Ee).serialize([e,s,i,a],t)}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}};Ee=new WeakMap,Ir=new WeakMap,Lt=new WeakMap,ma=new WeakMap,va=new WeakMap,ei=new WeakMap,si=new WeakMap,ii=new WeakMap,wa=new WeakMap,et=new WeakSet,pd=function({drawOutlines:r,drawId:t,drawingOptions:e}){p(this,Ee,r),this._drawingOptions||(this._drawingOptions=e),t>=0?(this._drawId=t,this.parent.drawLayer.finalizeDraw(t,r.defaultProperties)):this._drawId=v(this,et,rc).call(this,r,this.parent),v(this,et,fo).call(this,r.box)},rc=function(r,t){const{id:e}=t.drawLayer.draw(Ae._mergeSVGProperties(this._drawingOptions.toSVGProperties(),r.defaultSVGProperties),!1,!1);return e},fd=function(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())},Lr=function(r=this.parent){if(!(this._drawId!==null&&this.parent===r)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,r.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=v(this,et,rc).call(this,n(this,Ee),r)}},Pu=function([r,t,e,s]){const{parentDimensions:[i,a],rotation:o}=this;switch(o){case 90:return[t,1-r,e*(a/i),s*(i/a)];case 180:return[1-r,1-t,e,s];case 270:return[1-t,r,e*(a/i),s*(i/a)];default:return[r,t,e,s]}},Ul=function(){const{x:r,y:t,width:e,height:s,parentDimensions:[i,a],rotation:o}=this;switch(o){case 90:return[1-t,r,e*(i/a),s*(a/i)];case 180:return[1-r,1-t,e,s];case 270:return[t,1-r,e*(i/a),s*(a/i)];default:return[r,t,e,s]}},fo=function(r){if([this.x,this.y,this.width,this.height]=v(this,et,Pu).call(this,r),this.div){this.fixAndSetPosition();const[t,e]=this.parentDimensions;this.setDims(this.width*t,this.height*e)}this._onResized()},ea=function(){const{x:r,y:t,width:e,height:s,rotation:i,parentRotation:a,parentDimensions:[o,l]}=this;switch((i*4+a)/90){case 1:return[1-t-s,r,s,e];case 2:return[1-r-e,1-t-s,e,s];case 3:return[t,1-r-e,s,e];case 4:return[r,t-e*(o/l),s*(l/o),e*(o/l)];case 5:return[1-t,r,e*(o/l),s*(l/o)];case 6:return[1-r-s*(l/o),1-t,s*(l/o),e*(o/l)];case 7:return[t-e*(o/l),1-r-s*(l/o),e*(o/l),s*(l/o)];case 8:return[r-e,t-s,e,s];case 9:return[1-t,r-e,s,e];case 10:return[1-r,1-t,e,s];case 11:return[t-s,1-r,s,e];case 12:return[r-s*(l/o),t,s*(l/o),e*(o/l)];case 13:return[1-t-e*(o/l),r-s*(l/o),e*(o/l),s*(l/o)];case 14:return[1-r,1-t-e*(o/l),s*(l/o),e*(o/l)];case 15:return[t,1-r,e*(o/l),s*(l/o)];default:return[r,t,e,s]}},I(Ae,"_currentDrawId",-1),I(Ae,"_currentParent",null),m(Ae,Lt,null),m(Ae,ma,null),m(Ae,va,null),m(Ae,ei,NaN),m(Ae,si,null),m(Ae,ii,null),m(Ae,wa,NaN),I(Ae,"_INNER_MARGIN",3);let Ef=Ae;var ws,Rt,Pt,ba,Dr,se,It,Ne,sa,Aa,ya,Nr,jl;class Vm{constructor(t,e,s,i,a,o){m(this,Nr),m(this,ws,new Float64Array(6)),m(this,Rt),m(this,Pt),m(this,ba),m(this,Dr),m(this,se),m(this,It,""),m(this,Ne,0),m(this,sa,new ko),m(this,Aa),m(this,ya),p(this,Aa,s),p(this,ya,i),p(this,ba,a),p(this,Dr,o),[t,e]=v(this,Nr,jl).call(this,t,e);const l=p(this,Rt,[NaN,NaN,NaN,NaN,t,e]);p(this,se,[t,e]),p(this,Pt,[{line:l,points:n(this,se)}]),n(this,ws).set(l,0)}updateProperty(t,e){t==="stroke-width"&&p(this,Dr,e)}isEmpty(){return!n(this,Pt)||n(this,Pt).length===0}isCancellable(){return n(this,se).length<=10}add(t,e){[t,e]=v(this,Nr,jl).call(this,t,e);const[s,i,a,o]=n(this,ws).subarray(2,6),l=t-a,h=e-o;return Math.hypot(n(this,Aa)*l,n(this,ya)*h)<=2?null:(n(this,se).push(t,e),isNaN(s)?(n(this,ws).set([a,o,t,e],2),n(this,Rt).push(NaN,NaN,NaN,NaN,t,e),{path:{d:this.toSVGPath()}}):(isNaN(n(this,ws)[0])&&n(this,Rt).splice(6,6),n(this,ws).set([s,i,a,o,t,e],0),n(this,Rt).push(...R.createBezierPoints(s,i,a,o,t,e)),{path:{d:this.toSVGPath()}}))}end(t,e){return this.add(t,e)||(n(this,se).length===2?{path:{d:this.toSVGPath()}}:null)}startNew(t,e,s,i,a){p(this,Aa,s),p(this,ya,i),p(this,ba,a),[t,e]=v(this,Nr,jl).call(this,t,e);const o=p(this,Rt,[NaN,NaN,NaN,NaN,t,e]);p(this,se,[t,e]);const l=n(this,Pt).at(-1);return l&&(l.line=new Float32Array(l.line),l.points=new Float32Array(l.points)),n(this,Pt).push({line:o,points:n(this,se)}),n(this,ws).set(o,0),p(this,Ne,0),this.toSVGPath(),null}getLastElement(){return n(this,Pt).at(-1)}setLastElement(t){return n(this,Pt)?(n(this,Pt).push(t),p(this,Rt,t.line),p(this,se,t.points),p(this,Ne,0),{path:{d:this.toSVGPath()}}):n(this,sa).setLastElement(t)}removeLastElement(){if(!n(this,Pt))return n(this,sa).removeLastElement();n(this,Pt).pop(),p(this,It,"");for(let t=0,e=n(this,Pt).length;t<e;t++){const{line:s,points:i}=n(this,Pt)[t];p(this,Rt,s),p(this,se,i),p(this,Ne,0),this.toSVGPath()}return{path:{d:n(this,It)}}}toSVGPath(){const t=R.svgRound(n(this,Rt)[4]),e=R.svgRound(n(this,Rt)[5]);if(n(this,se).length===2)return p(this,It,`${n(this,It)} M ${t} ${e} Z`),n(this,It);if(n(this,se).length<=6){const i=n(this,It).lastIndexOf("M");p(this,It,`${n(this,It).slice(0,i)} M ${t} ${e}`),p(this,Ne,6)}if(n(this,se).length===4){const i=R.svgRound(n(this,Rt)[10]),a=R.svgRound(n(this,Rt)[11]);return p(this,It,`${n(this,It)} L ${i} ${a}`),p(this,Ne,12),n(this,It)}const s=[];n(this,Ne)===0&&(s.push(`M ${t} ${e}`),p(this,Ne,6));for(let i=n(this,Ne),a=n(this,Rt).length;i<a;i+=6){const[o,l,h,c,d,u]=n(this,Rt).slice(i,i+6).map(R.svgRound);s.push(`C${o} ${l} ${h} ${c} ${d} ${u}`)}return p(this,It,n(this,It)+s.join(" ")),p(this,Ne,n(this,Rt).length),n(this,It)}getOutlines(t,e,s,i){const a=n(this,Pt).at(-1);return a.line=new Float32Array(a.line),a.points=new Float32Array(a.points),n(this,sa).build(n(this,Pt),t,e,s,n(this,ba),n(this,Dr),i),p(this,ws,null),p(this,Rt,null),p(this,Pt,null),p(this,It,null),n(this,sa)}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}ws=new WeakMap,Rt=new WeakMap,Pt=new WeakMap,ba=new WeakMap,Dr=new WeakMap,se=new WeakMap,It=new WeakMap,Ne=new WeakMap,sa=new WeakMap,Aa=new WeakMap,ya=new WeakMap,Nr=new WeakSet,jl=function(r,t){return R._normalizePoint(r,t,n(this,Aa),n(this,ya),n(this,ba))};var ae,Vl,Oh,Se,Cs,Ts,go,mo,Ia,ge,Ps,kf,Mf,Cf;class ko extends R{constructor(){super(...arguments),m(this,ge),m(this,ae),m(this,Vl,0),m(this,Oh),m(this,Se),m(this,Cs),m(this,Ts),m(this,go),m(this,mo),m(this,Ia)}build(t,e,s,i,a,o,l){p(this,Cs,e),p(this,Ts,s),p(this,go,i),p(this,mo,a),p(this,Ia,o),p(this,Oh,l??0),p(this,Se,t),v(this,ge,Mf).call(this)}get thickness(){return n(this,Ia)}setLastElement(t){return n(this,Se).push(t),{path:{d:this.toSVGPath()}}}removeLastElement(){return n(this,Se).pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){const t=[];for(const{line:e}of n(this,Se)){if(t.push(`M${R.svgRound(e[4])} ${R.svgRound(e[5])}`),e.length===6){t.push("Z");continue}if(e.length===12&&isNaN(e[6])){t.push(`L${R.svgRound(e[10])} ${R.svgRound(e[11])}`);continue}for(let s=6,i=e.length;s<i;s+=6){const[a,o,l,h,c,d]=e.subarray(s,s+6).map(R.svgRound);t.push(`C${a} ${o} ${l} ${h} ${c} ${d}`)}}return t.join("")}serialize([t,e,s,i],a){const o=[],l=[],[h,c,d,u]=v(this,ge,kf).call(this);let f,g,b,w,A,y,S,_,x;switch(n(this,mo)){case 0:x=R._rescale,f=t,g=e+i,b=s,w=-i,A=t+h*s,y=e+(1-c-u)*i,S=t+(h+d)*s,_=e+(1-c)*i;break;case 90:x=R._rescaleAndSwap,f=t,g=e,b=s,w=i,A=t+c*s,y=e+h*i,S=t+(c+u)*s,_=e+(h+d)*i;break;case 180:x=R._rescale,f=t+s,g=e,b=-s,w=i,A=t+(1-h-d)*s,y=e+c*i,S=t+(1-h)*s,_=e+(c+u)*i;break;case 270:x=R._rescaleAndSwap,f=t+s,g=e+i,b=-s,w=-i,A=t+(1-c-u)*s,y=e+(1-h-d)*i,S=t+(1-c)*s,_=e+(1-h)*i;break}for(const{line:k,points:E}of n(this,Se))o.push(x(k,f,g,b,w,a?new Array(k.length):null)),l.push(x(E,f,g,b,w,a?new Array(E.length):null));return{lines:o,points:l,rect:[A,y,S,_]}}static deserialize(t,e,s,i,a,{paths:{lines:o,points:l},rotation:h,thickness:c}){const d=[];let u,f,g,b,w;switch(h){case 0:w=R._rescale,u=-t/s,f=e/i+1,g=1/s,b=-1/i;break;case 90:w=R._rescaleAndSwap,u=-e/i,f=-t/s,g=1/i,b=1/s;break;case 180:w=R._rescale,u=t/s+1,f=-e/i,g=-1/s,b=1/i;break;case 270:w=R._rescaleAndSwap,u=e/i+1,f=t/s+1,g=-1/i,b=-1/s;break}if(!o){o=[];for(const y of l){const S=y.length;if(S===2){o.push(new Float32Array([NaN,NaN,NaN,NaN,y[0],y[1]]));continue}if(S===4){o.push(new Float32Array([NaN,NaN,NaN,NaN,y[0],y[1],NaN,NaN,NaN,NaN,y[2],y[3]]));continue}const _=new Float32Array(3*(S-2));o.push(_);let[x,k,E,M]=y.subarray(0,4);_.set([NaN,NaN,NaN,NaN,x,k],0);for(let C=4;C<S;C+=2){const T=y[C],N=y[C+1];_.set(R.createBezierPoints(x,k,E,M,T,N),(C-2)*3),[x,k,E,M]=[E,M,T,N]}}}for(let y=0,S=o.length;y<S;y++)d.push({line:w(o[y].map(_=>_??NaN),u,f,g,b),points:w(l[y].map(_=>_??NaN),u,f,g,b)});const A=new this.prototype.constructor;return A.build(d,s,i,1,h,c,a),A}get box(){return n(this,ae)}updateProperty(t,e){return t==="stroke-width"?v(this,ge,Cf).call(this,e):null}updateParentDimensions([t,e],s){const[i,a]=v(this,ge,Ps).call(this);p(this,Cs,t),p(this,Ts,e),p(this,go,s);const[o,l]=v(this,ge,Ps).call(this),h=o-i,c=l-a,d=n(this,ae);return d[0]-=h,d[1]-=c,d[2]+=2*h,d[3]+=2*c,d}updateRotation(t){return p(this,Vl,t),{path:{transform:this.rotationTransform}}}get viewBox(){return n(this,ae).map(R.svgRound).join(" ")}get defaultProperties(){const[t,e]=n(this,ae);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${R.svgRound(t)} ${R.svgRound(e)}`}}}get rotationTransform(){const[,,t,e]=n(this,ae);let s=0,i=0,a=0,o=0,l=0,h=0;switch(n(this,Vl)){case 90:i=e/t,a=-t/e,l=t;break;case 180:s=-1,o=-1,l=t,h=e;break;case 270:i=-e/t,a=t/e,h=e;break;default:return""}return`matrix(${s} ${i} ${a} ${o} ${R.svgRound(l)} ${R.svgRound(h)})`}getPathResizingSVGProperties([t,e,s,i]){const[a,o]=v(this,ge,Ps).call(this),[l,h,c,d]=n(this,ae);if(Math.abs(c-a)<=R.PRECISION||Math.abs(d-o)<=R.PRECISION){const w=t+s/2-(l+c/2),A=e+i/2-(h+d/2);return{path:{"transform-origin":`${R.svgRound(t)} ${R.svgRound(e)}`,transform:`${this.rotationTransform} translate(${w} ${A})`}}}const u=(s-2*a)/(c-2*a),f=(i-2*o)/(d-2*o),g=c/s,b=d/i;return{path:{"transform-origin":`${R.svgRound(l)} ${R.svgRound(h)}`,transform:`${this.rotationTransform} scale(${g} ${b}) translate(${R.svgRound(a)} ${R.svgRound(o)}) scale(${u} ${f}) translate(${R.svgRound(-a)} ${R.svgRound(-o)})`}}}getPathResizedSVGProperties([t,e,s,i]){const[a,o]=v(this,ge,Ps).call(this),l=n(this,ae),[h,c,d,u]=l;if(l[0]=t,l[1]=e,l[2]=s,l[3]=i,Math.abs(d-a)<=R.PRECISION||Math.abs(u-o)<=R.PRECISION){const A=t+s/2-(h+d/2),y=e+i/2-(c+u/2);for(const{line:S,points:_}of n(this,Se))R._translate(S,A,y,S),R._translate(_,A,y,_);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${R.svgRound(t)} ${R.svgRound(e)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}const f=(s-2*a)/(d-2*a),g=(i-2*o)/(u-2*o),b=-f*(h+a)+t+a,w=-g*(c+o)+e+o;if(f!==1||g!==1||b!==0||w!==0)for(const{line:A,points:y}of n(this,Se))R._rescale(A,b,w,f,g,A),R._rescale(y,b,w,f,g,y);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${R.svgRound(t)} ${R.svgRound(e)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([t,e],s){const[i,a]=s,o=n(this,ae),l=t-o[0],h=e-o[1];if(n(this,Cs)===i&&n(this,Ts)===a)for(const{line:c,points:d}of n(this,Se))R._translate(c,l,h,c),R._translate(d,l,h,d);else{const c=n(this,Cs)/i,d=n(this,Ts)/a;p(this,Cs,i),p(this,Ts,a);for(const{line:u,points:f}of n(this,Se))R._rescale(u,l,h,c,d,u),R._rescale(f,l,h,c,d,f);o[2]*=c,o[3]*=d}return o[0]=t,o[1]=e,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${R.svgRound(t)} ${R.svgRound(e)}`}}}get defaultSVGProperties(){const t=n(this,ae);return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${R.svgRound(t[0])} ${R.svgRound(t[1])}`,transform:this.rotationTransform||null},bbox:t}}}ae=new WeakMap,Vl=new WeakMap,Oh=new WeakMap,Se=new WeakMap,Cs=new WeakMap,Ts=new WeakMap,go=new WeakMap,mo=new WeakMap,Ia=new WeakMap,ge=new WeakSet,Ps=function(r=n(this,Ia)){const t=n(this,Oh)+r/2*n(this,go);return n(this,mo)%180===0?[t/n(this,Cs),t/n(this,Ts)]:[t/n(this,Ts),t/n(this,Cs)]},kf=function(){const[r,t,e,s]=n(this,ae),[i,a]=v(this,ge,Ps).call(this,0);return[r+i,t+a,e-2*i,s-2*a]},Mf=function(){const r=p(this,ae,new Float32Array([1/0,1/0,-1/0,-1/0]));for(const{line:s}of n(this,Se)){if(s.length<=12){for(let o=4,l=s.length;o<l;o+=6)L.pointBoundingBox(s[o],s[o+1],r);continue}let i=s[4],a=s[5];for(let o=6,l=s.length;o<l;o+=6){const[h,c,d,u,f,g]=s.subarray(o,o+6);L.bezierBoundingBox(i,a,h,c,d,u,f,g,r),i=f,a=g}}const[t,e]=v(this,ge,Ps).call(this);r[0]=Jt(r[0]-t,0,1),r[1]=Jt(r[1]-e,0,1),r[2]=Jt(r[2]+t,0,1),r[3]=Jt(r[3]+e,0,1),r[2]-=r[0],r[3]-=r[1]},Cf=function(r){const[t,e]=v(this,ge,Ps).call(this);p(this,Ia,r);const[s,i]=v(this,ge,Ps).call(this),[a,o]=[s-t,i-e],l=n(this,ae);return l[0]-=a,l[1]-=o,l[2]+=2*a,l[3]+=2*o,l};class Vh extends xf{constructor(t){super(),this._viewParameters=t,super.updateProperties({fill:"none",stroke:ht._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(t,e){t==="stroke-width"&&(e??(e=this["stroke-width"]),e*=this._viewParameters.realScale),super.updateSVGProperty(t,e)}clone(){const t=new Vh(this._viewParameters);return t.updateAll(this),t}}var gd,Tf;const ql=class Rf extends Ef{constructor(t){super({...t,name:"inkEditor"}),m(this,gd),this._willKeepAspectRatio=!0,this.defaultL10nId="pdfjs-editor-ink-editor"}static initialize(t,e){ht.initialize(t,e),this._defaultDrawingOptions=new Vh(e.viewParameters)}static getDefaultDrawingOptions(t){const e=this._defaultDrawingOptions.clone();return e.updateProperties(t),e}static get supportMultipleDrawings(){return!0}static get typesMap(){return j(this,"typesMap",new Map([[V.INK_THICKNESS,"stroke-width"],[V.INK_COLOR,"stroke"],[V.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(t,e,s,i,a){return new Vm(t,e,s,i,a,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(t,e,s,i,a,o){return ko.deserialize(t,e,s,i,a,o)}static async deserialize(t,e,s){let i=null;if(t instanceof Bd){const{data:{inkLists:o,rect:l,rotation:h,id:c,color:d,opacity:u,borderStyle:{rawWidth:f},popupRef:g},parent:{page:{pageNumber:b}}}=t;i=t={annotationType:G.INK,color:Array.from(d),thickness:f,opacity:u,paths:{points:o},boxes:null,pageIndex:b-1,rect:l.slice(0),rotation:h,id:c,deleted:!1,popupRef:g}}const a=await super.deserialize(t,e,s);return a.annotationElementId=t.id||null,a._initialData=i,a}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();const{_drawId:t,_drawingOptions:e,parent:s}=this;e.updateSVGProperty("stroke-width"),s.drawLayer.updateProperties(t,e.toSVGProperties())}static onScaleChangingWhenDrawing(){const t=this._currentParent;t&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),t.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:t,thickness:e,opacity:s}){this._drawingOptions=Rf.getDefaultDrawingOptions({stroke:L.makeHexColor(...t),"stroke-width":e,"stroke-opacity":s})}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const{lines:e,points:s,rect:i}=this.serializeDraw(t),{_drawingOptions:{stroke:a,"stroke-opacity":o,"stroke-width":l}}=this,h={annotationType:G.INK,color:ht._colorManager.convert(a),opacity:o,thickness:l,paths:{lines:e,points:s},pageIndex:this.pageIndex,rect:i,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return t?(h.isCopy=!0,h):this.annotationElementId&&!v(this,gd,Tf).call(this,h)?null:(h.id=this.annotationElementId,h)}renderAnnotationElement(t){const{points:e,rect:s}=this.serializeDraw(!1);return t.updateEdited({rect:s,thickness:this._drawingOptions["stroke-width"],points:e}),null}};gd=new WeakSet,Tf=function(r){const{color:t,thickness:e,opacity:s,pageIndex:i}=this._initialData;return this._hasBeenMoved||this._hasBeenResized||r.color.some((a,o)=>a!==t[o])||r.thickness!==e||r.opacity!==s||r.pageIndex!==i},I(ql,"_type","ink"),I(ql,"_editorType",G.INK),I(ql,"_defaultDrawingOptions",null);let qm=ql;class md extends ko{toSVGPath(){let t=super.toSVGPath();return t.endsWith("Z")||(t+="Z"),t}}const Wo=8,$a=3;var La,_t,oc,Ue,Iu,Lu,vd,Bo,Pf,If,Lf,wd,bd,Df;class Is{static extractContoursFromText(t,{fontFamily:e,fontStyle:s,fontWeight:i},a,o,l,h){let c=new OffscreenCanvas(1,1),d=c.getContext("2d",{alpha:!1});const u=200,f=d.font=`${s} ${i} ${u}px ${e}`,{actualBoundingBoxLeft:g,actualBoundingBoxRight:b,actualBoundingBoxAscent:w,actualBoundingBoxDescent:A,fontBoundingBoxAscent:y,fontBoundingBoxDescent:S,width:_}=d.measureText(t),x=1.5,k=Math.ceil(Math.max(Math.abs(g)+Math.abs(b)||0,_)*x),E=Math.ceil(Math.max(Math.abs(w)+Math.abs(A)||u,Math.abs(y)+Math.abs(S)||u)*x);c=new OffscreenCanvas(k,E),d=c.getContext("2d",{alpha:!0,willReadFrequently:!0}),d.font=f,d.filter="grayscale(1)",d.fillStyle="white",d.fillRect(0,0,k,E),d.fillStyle="black",d.fillText(t,k*(x-1)/2,E*(3-x)/2);const M=v(this,_t,wd).call(this,d.getImageData(0,0,k,E).data),C=v(this,_t,Lf).call(this,M),T=v(this,_t,bd).call(this,C),N=v(this,_t,vd).call(this,M,k,E,T);return this.processDrawnLines({lines:{curves:N,width:k,height:E},pageWidth:a,pageHeight:o,rotation:l,innerMargin:h,mustSmooth:!0,areContours:!0})}static process(t,e,s,i,a){const[o,l,h]=v(this,_t,Df).call(this,t),[c,d]=v(this,_t,If).call(this,o,l,h,Math.hypot(l,h)*n(this,La).sigmaSFactor,n(this,La).sigmaR,n(this,La).kernelSize),u=v(this,_t,bd).call(this,d),f=v(this,_t,vd).call(this,c,l,h,u);return this.processDrawnLines({lines:{curves:f,width:l,height:h},pageWidth:e,pageHeight:s,rotation:i,innerMargin:a,mustSmooth:!0,areContours:!0})}static processDrawnLines({lines:t,pageWidth:e,pageHeight:s,rotation:i,innerMargin:a,mustSmooth:o,areContours:l}){i%180!==0&&([e,s]=[s,e]);const{curves:h,width:c,height:d}=t,u=t.thickness??0,f=[],g=Math.min(e/c,s/d),b=g/e,w=g/s,A=[];for(const{points:S}of h){const _=o?v(this,_t,Pf).call(this,S):S;if(!_)continue;A.push(_);const x=_.length,k=new Float32Array(x),E=new Float32Array(3*(x===2?2:x-2));if(f.push({line:E,points:k}),x===2){k[0]=_[0]*b,k[1]=_[1]*w,E.set([NaN,NaN,NaN,NaN,k[0],k[1]],0);continue}let[M,C,T,N]=_;M*=b,C*=w,T*=b,N*=w,k.set([M,C,T,N],0),E.set([NaN,NaN,NaN,NaN,M,C],0);for(let W=4;W<x;W+=2){const Y=k[W]=_[W]*b,q=k[W+1]=_[W+1]*w;E.set(R.createBezierPoints(M,C,T,N,Y,q),(W-2)*3),[M,C,T,N]=[T,N,Y,q]}}if(f.length===0)return null;const y=l?new md:new ko;return y.build(f,e,s,1,i,l?0:u,a),{outline:y,newCurves:A,areContours:l,thickness:u,width:c,height:d}}static async compressSignature({outlines:t,areContours:e,thickness:s,width:i,height:a}){let o=1/0,l=-1/0,h=0;for(const _ of t){h+=_.length;for(let x=2,k=_.length;x<k;x++){const E=_[x]-_[x-2];o=Math.min(o,E),l=Math.max(l,E)}}let c;o>=-128&&l<=127?c=Int8Array:o>=-32768&&l<=32767?c=Int16Array:c=Int32Array;const d=t.length,u=Wo+$a*d,f=new Uint32Array(u);let g=0;f[g++]=u*Uint32Array.BYTES_PER_ELEMENT+(h-2*d)*c.BYTES_PER_ELEMENT,f[g++]=0,f[g++]=i,f[g++]=a,f[g++]=e?0:1,f[g++]=Math.max(0,Math.floor(s??0)),f[g++]=d,f[g++]=c.BYTES_PER_ELEMENT;for(const _ of t)f[g++]=_.length-2,f[g++]=_[0],f[g++]=_[1];const b=new CompressionStream("deflate-raw"),w=b.writable.getWriter();await w.ready,w.write(f);const A=c.prototype.constructor;for(const _ of t){const x=new A(_.length-2);for(let k=2,E=_.length;k<E;k++)x[k-2]=_[k]-_[k-2];w.write(x)}w.close();const y=await new Response(b.readable).arrayBuffer(),S=new Uint8Array(y);return Wu(S)}static async decompressSignature(t){try{const e=ng(t),{readable:s,writable:i}=new DecompressionStream("deflate-raw"),a=i.getWriter();await a.ready,a.write(e).then(async()=>{await a.ready,await a.close()}).catch(()=>{});let o=null,l=0;for await(const _ of s)o||(o=new Uint8Array(new Uint32Array(_.buffer,0,4)[0])),o.set(_,l),l+=_.length;const h=new Uint32Array(o.buffer,0,o.length>>2),c=h[1];if(c!==0)throw new Error(`Invalid version: ${c}`);const d=h[2],u=h[3],f=h[4]===0,g=h[5],b=h[6],w=h[7],A=[],y=(Wo+$a*b)*Uint32Array.BYTES_PER_ELEMENT;let S;switch(w){case Int8Array.BYTES_PER_ELEMENT:S=new Int8Array(o.buffer,y);break;case Int16Array.BYTES_PER_ELEMENT:S=new Int16Array(o.buffer,y);break;case Int32Array.BYTES_PER_ELEMENT:S=new Int32Array(o.buffer,y);break}l=0;for(let _=0;_<b;_++){const x=h[$a*_+Wo],k=new Float32Array(x+2);A.push(k);for(let E=0;E<$a-1;E++)k[E]=h[$a*_+Wo+E+1];for(let E=0;E<x;E++)k[E+2]=k[E]+S[l++]}return{areContours:f,thickness:g,outlines:A,width:d,height:u}}catch(e){return z(`decompressSignature: ${e}`),null}}}La=new WeakMap,_t=new WeakSet,oc=function(r,t,e,s){return e-=r,s-=t,e===0?s>0?0:4:e===1?s+6:2-s},Ue=new WeakMap,Iu=function(r,t,e,s,i,a,o){const l=v(this,_t,oc).call(this,e,s,i,a);for(let h=0;h<8;h++){const c=(-h+l-o+16)%8,d=n(this,Ue)[2*c],u=n(this,Ue)[2*c+1];if(r[(e+d)*t+(s+u)]!==0)return c}return-1},Lu=function(r,t,e,s,i,a,o){const l=v(this,_t,oc).call(this,e,s,i,a);for(let h=0;h<8;h++){const c=(h+l+o+16)%8,d=n(this,Ue)[2*c],u=n(this,Ue)[2*c+1];if(r[(e+d)*t+(s+u)]!==0)return c}return-1},vd=function(r,t,e,s){const i=r.length,a=new Int32Array(i);for(let c=0;c<i;c++)a[c]=r[c]<=s?1:0;for(let c=1;c<e-1;c++)a[c*t]=a[c*t+t-1]=0;for(let c=0;c<t;c++)a[c]=a[t*e-1-c]=0;let o=1,l;const h=[];for(let c=1;c<e-1;c++){l=1;for(let d=1;d<t-1;d++){const u=c*t+d,f=a[u];if(f===0)continue;let g=c,b=d;if(f===1&&a[u-1]===0)o+=1,b-=1;else if(f>=1&&a[u+1]===0)o+=1,b+=1,f>1&&(l=f);else{f!==1&&(l=Math.abs(f));continue}const w=[d,c],A=b===d+1,y={isHole:A,points:w,id:o,parent:0};h.push(y);let S;for(const N of h)if(N.id===l){S=N;break}S?S.isHole?y.parent=A?S.parent:l:y.parent=A?l:S.parent:y.parent=A?l:0;const _=v(this,_t,Iu).call(this,a,t,c,d,g,b,0);if(_===-1){a[u]=-o,a[u]!==1&&(l=Math.abs(a[u]));continue}let x=n(this,Ue)[2*_],k=n(this,Ue)[2*_+1];const E=c+x,M=d+k;g=E,b=M;let C=c,T=d;for(;;){const N=v(this,_t,Lu).call(this,a,t,C,T,g,b,1);x=n(this,Ue)[2*N],k=n(this,Ue)[2*N+1];const W=C+x,Y=T+k;w.push(Y,W);const q=C*t+T;if(a[q+1]===0?a[q]=-o:a[q]===1&&(a[q]=o),W===c&&Y===d&&C===E&&T===M){a[u]!==1&&(l=Math.abs(a[u]));break}else g=C,b=T,C=W,T=Y}}}return h},Bo=function(r,t,e,s){if(e-t<=4){for(let E=t;E<e-2;E+=2)s.push(r[E],r[E+1]);return}const i=r[t],a=r[t+1],o=r[e-4]-i,l=r[e-3]-a,h=Math.hypot(o,l),c=o/h,d=l/h,u=c*a-d*i,f=l/o,g=1/h,b=Math.atan(f),w=Math.cos(b),A=Math.sin(b),y=g*(Math.abs(w)+Math.abs(A)),S=g*(1-y+y**2),_=Math.max(Math.atan(Math.abs(A+w)*S),Math.atan(Math.abs(A-w)*S));let x=0,k=t;for(let E=t+2;E<e-2;E+=2){const M=Math.abs(u-c*r[E+1]+d*r[E]);M>x&&(k=E,x=M)}x>(h*_)**2?(v(this,_t,Bo).call(this,r,t,k+2,s),v(this,_t,Bo).call(this,r,k,e,s)):s.push(i,a)},Pf=function(r){const t=[],e=r.length;return v(this,_t,Bo).call(this,r,0,e,t),t.push(r[e-2],r[e-1]),t.length<=4?null:t},If=function(r,t,e,s,i,a){const o=new Float32Array(a**2),l=-2*s**2,h=a>>1;for(let b=0;b<a;b++){const w=(b-h)**2;for(let A=0;A<a;A++)o[b*a+A]=Math.exp((w+(A-h)**2)/l)}const c=new Float32Array(256),d=-2*i**2;for(let b=0;b<256;b++)c[b]=Math.exp(b**2/d);const u=r.length,f=new Uint8Array(u),g=new Uint32Array(256);for(let b=0;b<e;b++)for(let w=0;w<t;w++){const A=b*t+w,y=r[A];let S=0,_=0;for(let k=0;k<a;k++){const E=b+k-h;if(!(E<0||E>=e))for(let M=0;M<a;M++){const C=w+M-h;if(C<0||C>=t)continue;const T=r[E*t+C],N=o[k*a+M]*c[Math.abs(T-y)];S+=T*N,_+=N}}const x=f[A]=Math.round(S/_);g[x]++}return[f,g]},Lf=function(r){const t=new Uint32Array(256);for(const e of r)t[e]++;return t},wd=function(r){const t=r.length,e=new Uint8ClampedArray(t>>2);let s=-1/0,i=1/0;for(let o=0,l=e.length;o<l;o++){if(r[(o<<2)+3]===0){s=e[o]=255;continue}const h=e[o]=r[o<<2];h>s&&(s=h),h<i&&(i=h)}const a=255/(s-i);for(let o=0;o<t;o++)e[o]=(e[o]-i)*a;return e},bd=function(r){let t,e=-1/0,s=-1/0;const i=r.findIndex(l=>l!==0);let a=i,o=i;for(t=i;t<256;t++){const l=r[t];l>e&&(t-a>s&&(s=t-a,o=t-1),e=l,a=t)}for(t=o-1;t>=0&&!(r[t]>r[t+1]);t--);return t},Df=function(r){const t=r,{width:e,height:s}=r,{maxDim:i}=n(this,La);let a=e,o=s;if(e>i||s>i){let c=e,d=s,u=Math.log2(Math.max(e,s)/i);const f=Math.floor(u);u=u===f?f-1:f;for(let b=0;b<u;b++){a=c,o=d,a>i&&(a=Math.ceil(a/2)),o>i&&(o=Math.ceil(o/2));const w=new OffscreenCanvas(a,o);w.getContext("2d").drawImage(r,0,0,c,d,0,0,a,o),c=a,d=o,r!==t&&r.close(),r=w.transferToImageBitmap()}const g=Math.min(i/a,i/o);a=Math.round(a*g),o=Math.round(o*g)}const l=new OffscreenCanvas(a,o).getContext("2d",{willReadFrequently:!0});l.filter="grayscale(1)",l.drawImage(r,0,0,r.width,r.height,0,0,a,o);const h=l.getImageData(0,0,a,o).data;return[v(this,_t,wd).call(this,h),a,o]},m(Is,_t),m(Is,La,{maxDim:512,sigmaSFactor:.02,sigmaR:25,kernelSize:16}),m(Is,Ue,new Int32Array([0,1,-1,1,-1,0,-1,-1,0,-1,1,-1,1,0,1,1]));class $d extends xf{constructor(){super(),super.updateProperties({fill:"CanvasText","stroke-width":0})}clone(){const t=new $d;return t.updateAll(this),t}}class Hd extends Vh{constructor(t){super(t),super.updateProperties({stroke:"CanvasText","stroke-width":1})}clone(){const t=new Hd(this._viewParameters);return t.updateAll(this),t}}var Gi,ye,zi,Ui;const Xl=class bs extends Ef{constructor(t){super({...t,mustBeCommitted:!0,name:"signatureEditor"}),m(this,Gi,!1),m(this,ye,null),m(this,zi,null),m(this,Ui,null),this._willKeepAspectRatio=!0,p(this,zi,t.signatureData||null),p(this,ye,null),this.defaultL10nId="pdfjs-editor-signature-editor1"}static initialize(t,e){ht.initialize(t,e),this._defaultDrawingOptions=new $d,this._defaultDrawnSignatureOptions=new Hd(e.viewParameters)}static getDefaultDrawingOptions(t){const e=this._defaultDrawingOptions.clone();return e.updateProperties(t),e}static get supportMultipleDrawings(){return!1}static get typesMap(){return j(this,"typesMap",new Map)}static get isDrawer(){return!1}get telemetryFinalData(){return{type:"signature",hasDescription:!!n(this,ye)}}static computeTelemetryFinalData(t){const e=t.get("hasDescription");return{hasAltText:e.get(!0)??0,hasNoAltText:e.get(!1)??0}}get isResizable(){return!0}onScaleChanging(){this._drawId!==null&&super.onScaleChanging()}render(){if(this.div)return this.div;let t,e;const{_isCopy:s}=this;if(s&&(this._isCopy=!1,t=this.x,e=this.y),super.render(),this._drawId===null)if(n(this,zi)){const{lines:i,mustSmooth:a,areContours:o,description:l,uuid:h,heightInPage:c}=n(this,zi),{rawDims:{pageWidth:d,pageHeight:u},rotation:f}=this.parent.viewport,g=Is.processDrawnLines({lines:i,pageWidth:d,pageHeight:u,rotation:f,innerMargin:bs._INNER_MARGIN,mustSmooth:a,areContours:o});this.addSignature(g,c,l,h)}else this.div.setAttribute("data-l10n-args",JSON.stringify({description:""})),this.div.hidden=!0,this._uiManager.getSignature(this);return s&&(this._isCopy=!0,this._moveAfterPaste(t,e)),this.div}setUuid(t){p(this,Ui,t),this.addEditToolbar()}getUuid(){return n(this,Ui)}get description(){return n(this,ye)}set description(t){p(this,ye,t),super.addEditToolbar().then(e=>{e==null||e.updateEditSignatureButton(t)})}getSignaturePreview(){const{newCurves:t,areContours:e,thickness:s,width:i,height:a}=n(this,zi),o=Math.max(i,a),l=Is.processDrawnLines({lines:{curves:t.map(h=>({points:h})),thickness:s,width:i,height:a},pageWidth:o,pageHeight:o,rotation:0,innerMargin:0,mustSmooth:!1,areContours:e});return{areContours:e,outline:l.outline}}async addEditToolbar(){const t=await super.addEditToolbar();return t?(this._uiManager.signatureManager&&n(this,ye)!==null&&(await t.addEditSignatureButton(this._uiManager.signatureManager,n(this,Ui),n(this,ye)),t.show()),t):null}addSignature(t,e,s,i){const{x:a,y:o}=this,{outline:l}=p(this,zi,t);p(this,Gi,l instanceof md),p(this,ye,s),this.div.setAttribute("data-l10n-args",JSON.stringify({description:s}));let h;n(this,Gi)?h=bs.getDefaultDrawingOptions():(h=bs._defaultDrawnSignatureOptions.clone(),h.updateProperties({"stroke-width":l.thickness})),this._addOutlines({drawOutlines:l,drawingOptions:h});const[c,d]=this.parentDimensions,[,u]=this.pageDimensions;let f=e/u;f=f>=1?.5:f,this.width*=f/this.height,this.width>=1&&(f*=.9/this.width,this.width=.9),this.height=f,this.setDims(c*this.width,d*this.height),this.x=a,this.y=o,this.center(),this._onResized(),this.onScaleChanging(),this.rotate(),this._uiManager.addToAnnotationStorage(this),this.setUuid(i),this._reportTelemetry({action:"pdfjs.signature.inserted",data:{hasBeenSaved:!!i,hasDescription:!!s}}),this.div.hidden=!1}getFromImage(t){const{rawDims:{pageWidth:e,pageHeight:s},rotation:i}=this.parent.viewport;return Is.process(t,e,s,i,bs._INNER_MARGIN)}getFromText(t,e){const{rawDims:{pageWidth:s,pageHeight:i},rotation:a}=this.parent.viewport;return Is.extractContoursFromText(t,e,s,i,a,bs._INNER_MARGIN)}getDrawnSignature(t){const{rawDims:{pageWidth:e,pageHeight:s},rotation:i}=this.parent.viewport;return Is.processDrawnLines({lines:t,pageWidth:e,pageHeight:s,rotation:i,innerMargin:bs._INNER_MARGIN,mustSmooth:!1,areContours:!1})}createDrawingOptions({areContours:t,thickness:e}){t?this._drawingOptions=bs.getDefaultDrawingOptions():(this._drawingOptions=bs._defaultDrawnSignatureOptions.clone(),this._drawingOptions.updateProperties({"stroke-width":e}))}serialize(t=!1){if(this.isEmpty())return null;const{lines:e,points:s,rect:i}=this.serializeDraw(t),{_drawingOptions:{"stroke-width":a}}=this,o={annotationType:G.SIGNATURE,isSignature:!0,areContours:n(this,Gi),color:[0,0,0],thickness:n(this,Gi)?0:a,pageIndex:this.pageIndex,rect:i,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return t?(o.paths={lines:e,points:s},o.uuid=n(this,Ui),o.isCopy=!0):o.lines=e,n(this,ye)&&(o.accessibilityData={type:"Figure",alt:n(this,ye)}),o}static deserializeDraw(t,e,s,i,a,o){return o.areContours?md.deserialize(t,e,s,i,a,o):ko.deserialize(t,e,s,i,a,o)}static async deserialize(t,e,s){var i;const a=await super.deserialize(t,e,s);return p(a,Gi,t.areContours),p(a,ye,((i=t.accessibilityData)==null?void 0:i.alt)||""),p(a,Ui,t.uuid),a}};Gi=new WeakMap,ye=new WeakMap,zi=new WeakMap,Ui=new WeakMap,I(Xl,"_type","signature"),I(Xl,"_editorType",G.SIGNATURE),I(Xl,"_defaultDrawingOptions",null);let Xm=Xl;var rt,Dt,nn,vi,un,Fr,wi,ia,As,Ie,vo,st,Ha,Ga,Yl,Wh,Bh,Ad,Kl,Nf;class yd extends ht{constructor(t){super({...t,name:"stampEditor"}),m(this,st),m(this,rt,null),m(this,Dt,null),m(this,nn,null),m(this,vi,null),m(this,un,null),m(this,Fr,""),m(this,wi,null),m(this,ia,!1),m(this,As,null),m(this,Ie,!1),m(this,vo,!1),p(this,vi,t.bitmapUrl),p(this,un,t.bitmapFile),this.defaultL10nId="pdfjs-editor-stamp-editor"}static initialize(t,e){ht.initialize(t,e)}static isHandlingMimeForPasting(t){return Dd.includes(t)}static paste(t,e){e.pasteEditor(G.STAMP,{bitmapFile:t.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){var t;return{type:"stamp",hasAltText:!!((t=this.altTextData)!=null&&t.altText)}}static computeTelemetryFinalData(t){const e=t.get("hasAltText");return{hasAltText:e.get(!0)??0,hasNoAltText:e.get(!1)??0}}async mlGuessAltText(t=null,e=!0){if(this.hasAltTextData())return null;const{mlManager:s}=this._uiManager;if(!s)throw new Error("No ML.");if(!await s.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:i,width:a,height:o}=t||this.copyCanvas(null,null,!0).imageData,l=await s.guess({name:"altText",request:{data:i,width:a,height:o,channels:i.length/(a*o)}});if(!l)throw new Error("No response from the AI service.");if(l.error)throw new Error("Error from the AI service.");if(l.cancel)return null;if(!l.output)throw new Error("No valid response from the AI service.");const h=l.output;return await this.setGuessedAltText(h),e&&!this.hasAltTextData()&&(this.altTextData={alt:h,decorative:!1}),h}remove(){var t;n(this,Dt)&&(p(this,rt,null),this._uiManager.imageManager.deleteId(n(this,Dt)),(t=n(this,wi))==null||t.remove(),p(this,wi,null),n(this,As)&&(clearTimeout(n(this,As)),p(this,As,null))),super.remove()}rebuild(){if(!this.parent){n(this,Dt)&&v(this,st,Yl).call(this);return}super.rebuild(),this.div!==null&&(n(this,Dt)&&n(this,wi)===null&&v(this,st,Yl).call(this),this.isAttachedToDOM||this.parent.add(this))}onceAdded(t){this._isDraggable=!0,t&&this.div.focus()}isEmpty(){return!(n(this,nn)||n(this,rt)||n(this,vi)||n(this,un)||n(this,Dt)||n(this,ia))}get isResizable(){return!0}render(){if(this.div)return this.div;let t,e;return this._isCopy&&(t=this.x,e=this.y),super.render(),this.div.hidden=!0,this.addAltTextButton(),n(this,ia)||(n(this,rt)?v(this,st,Wh).call(this):v(this,st,Yl).call(this)),this._isCopy&&this._moveAfterPaste(t,e),this._uiManager.addShouldRescale(this),this.div}setCanvas(t,e){const{id:s,bitmap:i}=this._uiManager.imageManager.getFromCanvas(t,e);e.remove(),s&&this._uiManager.imageManager.isValidId(s)&&(p(this,Dt,s),i&&p(this,rt,i),p(this,ia,!1),v(this,st,Wh).call(this))}_onResized(){this.onScaleChanging()}onScaleChanging(){this.parent&&(n(this,As)!==null&&clearTimeout(n(this,As)),p(this,As,setTimeout(()=>{p(this,As,null),v(this,st,Ad).call(this)},200)))}copyCanvas(t,e,s=!1){var i;t||(t=224);const{width:a,height:o}=n(this,rt),l=new Ls;let h=n(this,rt),c=a,d=o,u=null;if(e){if(a>e||o>e){const M=Math.min(e/a,e/o);c=Math.floor(a*M),d=Math.floor(o*M)}u=document.createElement("canvas");const g=u.width=Math.ceil(c*l.sx),b=u.height=Math.ceil(d*l.sy);n(this,Ie)||(h=v(this,st,Bh).call(this,g,b));const w=u.getContext("2d");w.filter=this._uiManager.hcmFilter;let A="white",y="#cfcfd8";this._uiManager.hcmFilter!=="none"?y="black":(i=window.matchMedia)!=null&&i.call(window,"(prefers-color-scheme: dark)").matches&&(A="#8f8f9d",y="#42414d");const S=15,_=S*l.sx,x=S*l.sy,k=new OffscreenCanvas(_*2,x*2),E=k.getContext("2d");E.fillStyle=A,E.fillRect(0,0,_*2,x*2),E.fillStyle=y,E.fillRect(0,0,_,x),E.fillRect(_,x,_,x),w.fillStyle=w.createPattern(k,"repeat"),w.fillRect(0,0,g,b),w.drawImage(h,0,0,h.width,h.height,0,0,g,b)}let f=null;if(s){let g,b;if(l.symmetric&&h.width<t&&h.height<t)g=h.width,b=h.height;else if(h=n(this,rt),a>t||o>t){const A=Math.min(t/a,t/o);g=Math.floor(a*A),b=Math.floor(o*A),n(this,Ie)||(h=v(this,st,Bh).call(this,g,b))}const w=new OffscreenCanvas(g,b).getContext("2d",{willReadFrequently:!0});w.drawImage(h,0,0,h.width,h.height,0,0,g,b),f={width:g,height:b,data:w.getImageData(0,0,g,b).data}}return{canvas:u,width:c,height:d,imageData:f}}static async deserialize(t,e,s){var i;let a=null,o=!1;if(t instanceof Yp){const{data:{rect:A,rotation:y,id:S,structParent:_,popupRef:x},container:k,parent:{page:{pageNumber:E}},canvas:M}=t;let C,T;M?(delete t.canvas,{id:C,bitmap:T}=s.imageManager.getFromCanvas(k.id,M),M.remove()):(o=!0,t._hasNoCanvas=!0);const N=((i=await e._structTree.getAriaAttributes(`${Td}${S}`))==null?void 0:i.get("aria-label"))||"";a=t={annotationType:G.STAMP,bitmapId:C,bitmap:T,pageIndex:E-1,rect:A.slice(0),rotation:y,id:S,deleted:!1,accessibilityData:{decorative:!1,altText:N},isSvg:!1,structParent:_,popupRef:x}}const l=await super.deserialize(t,e,s),{rect:h,bitmap:c,bitmapUrl:d,bitmapId:u,isSvg:f,accessibilityData:g}=t;o?(s.addMissingCanvas(t.id,l),p(l,ia,!0)):u&&s.imageManager.isValidId(u)?(p(l,Dt,u),c&&p(l,rt,c)):p(l,vi,d),p(l,Ie,f);const[b,w]=l.pageDimensions;return l.width=(h[2]-h[0])/b,l.height=(h[3]-h[1])/w,l.annotationElementId=t.id||null,g&&(l.altTextData=g),l._initialData=a,p(l,vo,!!a),l}serialize(t=!1,e=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const s={annotationType:G.STAMP,bitmapId:n(this,Dt),pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:n(this,Ie),structTreeParentId:this._structTreeParentId};if(t)return s.bitmapUrl=v(this,st,Kl).call(this,!0),s.accessibilityData=this.serializeAltText(!0),s.isCopy=!0,s;const{decorative:i,altText:a}=this.serializeAltText(!1);if(!i&&a&&(s.accessibilityData={type:"Figure",alt:a}),this.annotationElementId){const l=v(this,st,Nf).call(this,s);if(l.isSame)return null;l.isSameAltText?delete s.accessibilityData:s.accessibilityData.structParent=this._initialData.structParent??-1}if(s.id=this.annotationElementId,e===null)return s;e.stamps||(e.stamps=new Map);const o=n(this,Ie)?(s.rect[2]-s.rect[0])*(s.rect[3]-s.rect[1]):null;if(!e.stamps.has(n(this,Dt)))e.stamps.set(n(this,Dt),{area:o,serialized:s}),s.bitmap=v(this,st,Kl).call(this,!1);else if(n(this,Ie)){const l=e.stamps.get(n(this,Dt));o>l.area&&(l.area=o,l.serialized.bitmap.close(),l.serialized.bitmap=v(this,st,Kl).call(this,!1))}return s}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}}rt=new WeakMap,Dt=new WeakMap,nn=new WeakMap,vi=new WeakMap,un=new WeakMap,Fr=new WeakMap,wi=new WeakMap,ia=new WeakMap,As=new WeakMap,Ie=new WeakMap,vo=new WeakMap,st=new WeakSet,Ha=function(r,t=!1){if(!r){this.remove();return}p(this,rt,r.bitmap),t||(p(this,Dt,r.id),p(this,Ie,r.isSvg)),r.file&&p(this,Fr,r.file.name),v(this,st,Wh).call(this)},Ga=function(){if(p(this,nn,null),this._uiManager.enableWaiting(!1),!!n(this,wi)){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&n(this,rt)){this._editToolbar.hide(),this._uiManager.editAltText(this,!0);return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&n(this,rt)){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}},Yl=function(){if(n(this,Dt)){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(n(this,Dt)).then(e=>v(this,st,Ha).call(this,e,!0)).finally(()=>v(this,st,Ga).call(this));return}if(n(this,vi)){const e=n(this,vi);p(this,vi,null),this._uiManager.enableWaiting(!0),p(this,nn,this._uiManager.imageManager.getFromUrl(e).then(s=>v(this,st,Ha).call(this,s)).finally(()=>v(this,st,Ga).call(this)));return}if(n(this,un)){const e=n(this,un);p(this,un,null),this._uiManager.enableWaiting(!0),p(this,nn,this._uiManager.imageManager.getFromFile(e).then(s=>v(this,st,Ha).call(this,s)).finally(()=>v(this,st,Ga).call(this)));return}const r=document.createElement("input");r.type="file",r.accept=Dd.join(",");const t=this._uiManager._signal;p(this,nn,new Promise(e=>{r.addEventListener("change",async()=>{if(!r.files||r.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const s=await this._uiManager.imageManager.getFromFile(r.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),v(this,st,Ha).call(this,s)}e()},{signal:t}),r.addEventListener("cancel",()=>{this.remove(),e()},{signal:t})}).finally(()=>v(this,st,Ga).call(this))),r.click()},Wh=function(){var r;const{div:t}=this;let{width:e,height:s}=n(this,rt);const[i,a]=this.pageDimensions,o=.75;if(this.width)e=this.width*i,s=this.height*a;else if(e>o*i||s>o*a){const d=Math.min(o*i/e,o*a/s);e*=d,s*=d}const[l,h]=this.parentDimensions;this.setDims(e*l/i,s*h/a),this._uiManager.enableWaiting(!1);const c=p(this,wi,document.createElement("canvas"));c.setAttribute("role","img"),this.addContainer(c),this.width=e/i,this.height=s/a,(r=this._initialOptions)!=null&&r.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(t.hidden=!1),v(this,st,Ad).call(this),n(this,vo)||(this.parent.addUndoableEditor(this),p(this,vo,!0)),this._reportTelemetry({action:"inserted_image"}),n(this,Fr)&&this.div.setAttribute("aria-description",n(this,Fr))},Bh=function(r,t){const{width:e,height:s}=n(this,rt);let i=e,a=s,o=n(this,rt);for(;i>2*r||a>2*t;){const l=i,h=a;i>2*r&&(i=i>=16384?Math.floor(i/2)-1:Math.ceil(i/2)),a>2*t&&(a=a>=16384?Math.floor(a/2)-1:Math.ceil(a/2));const c=new OffscreenCanvas(i,a);c.getContext("2d").drawImage(o,0,0,l,h,0,0,i,a),o=c.transferToImageBitmap()}return o},Ad=function(){const[r,t]=this.parentDimensions,{width:e,height:s}=this,i=new Ls,a=Math.ceil(e*r*i.sx),o=Math.ceil(s*t*i.sy),l=n(this,wi);if(!l||l.width===a&&l.height===o)return;l.width=a,l.height=o;const h=n(this,Ie)?n(this,rt):v(this,st,Bh).call(this,a,o),c=l.getContext("2d");c.filter=this._uiManager.hcmFilter,c.drawImage(h,0,0,h.width,h.height,0,0,a,o)},Kl=function(r){if(r){if(n(this,Ie)){const e=this._uiManager.imageManager.getSvgUrl(n(this,Dt));if(e)return e}const t=document.createElement("canvas");return{width:t.width,height:t.height}=n(this,rt),t.getContext("2d").drawImage(n(this,rt),0,0),t.toDataURL()}if(n(this,Ie)){const[t,e]=this.pageDimensions,s=Math.round(this.width*t*Da.PDF_TO_CSS_UNITS),i=Math.round(this.height*e*Da.PDF_TO_CSS_UNITS),a=new OffscreenCanvas(s,i);return a.getContext("2d").drawImage(n(this,rt),0,0,n(this,rt).width,n(this,rt).height,0,0,s,i),a.transferToImageBitmap()}return structuredClone(n(this,rt))},Nf=function(r){var t;const{pageIndex:e,accessibilityData:{altText:s}}=this._initialData,i=r.pageIndex===e,a=(((t=r.accessibilityData)==null?void 0:t.alt)||"")===s;return{isSame:!this._hasBeenMoved&&!this._hasBeenResized&&i&&a,isSameAltText:a}},I(yd,"_type","stamp"),I(yd,"_editorType",G.STAMP);var na,Or,ys,ji,Xs,Oe,Vi,Wr,aa,qe,Ys,Zt,Ks,D,pn,bt,Ff,Qe,_d,Sd,Ql;const Jl=class qi{constructor({uiManager:t,pageIndex:e,div:s,structTreeLayer:i,accessibilityManager:a,annotationLayer:o,drawLayer:l,textLayer:h,viewport:c,l10n:d}){m(this,bt),m(this,na),m(this,Or,!1),m(this,ys,null),m(this,ji,null),m(this,Xs,null),m(this,Oe,new Map),m(this,Vi,!1),m(this,Wr,!1),m(this,aa,!1),m(this,qe,null),m(this,Ys,null),m(this,Zt,null),m(this,Ks,null),m(this,D);const u=[...n(qi,pn).values()];if(!qi._initialized){qi._initialized=!0;for(const f of u)f.initialize(d,t)}t.registerEditorTypes(u),p(this,D,t),this.pageIndex=e,this.div=s,p(this,na,a),p(this,ys,o),this.viewport=c,p(this,Zt,h),this.drawLayer=l,this._structTree=i,n(this,D).addLayer(this)}get isEmpty(){return n(this,Oe).size===0}get isInvisible(){return this.isEmpty&&n(this,D).getMode()===G.NONE}updateToolbar(t){n(this,D).updateToolbar(t)}updateMode(t=n(this,D).getMode()){switch(v(this,bt,Ql).call(this),t){case G.NONE:this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case G.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case G.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:e}=this.div;for(const s of n(qi,pn).values())e.toggle(`${s._type}Editing`,t===s._editorType);this.div.hidden=!1}hasTextLayer(t){var e;return t===((e=n(this,Zt))==null?void 0:e.div)}setEditingState(t){n(this,D).setEditingState(t)}addCommands(t){n(this,D).addCommands(t)}cleanUndoStack(t){n(this,D).cleanUndoStack(t)}toggleDrawing(t=!1){this.div.classList.toggle("drawing",!t)}togglePointerEvents(t=!1){this.div.classList.toggle("disabled",!t)}toggleAnnotationLayerPointerEvents(t=!1){var e;(e=n(this,ys))==null||e.div.classList.toggle("disabled",!t)}async enable(){p(this,aa,!0),this.div.tabIndex=0,this.togglePointerEvents(!0);const t=new Set;for(const s of n(this,Oe).values())s.enableEditing(),s.show(!0),s.annotationElementId&&(n(this,D).removeChangedExistingAnnotation(s),t.add(s.annotationElementId));if(!n(this,ys)){p(this,aa,!1);return}const e=n(this,ys).getEditableAnnotations();for(const s of e){if(s.hide(),n(this,D).isDeletedAnnotationElement(s.data.id)||t.has(s.data.id))continue;const i=await this.deserialize(s);i&&(this.addOrRebuild(i),i.enableEditing())}p(this,aa,!1)}disable(){var t;p(this,Wr,!0),this.div.tabIndex=-1,this.togglePointerEvents(!1);const e=new Map,s=new Map;for(const a of n(this,Oe).values())if(a.disableEditing(),!!a.annotationElementId){if(a.serialize()!==null){e.set(a.annotationElementId,a);continue}else s.set(a.annotationElementId,a);(t=this.getEditableAnnotation(a.annotationElementId))==null||t.show(),a.remove()}if(n(this,ys)){const a=n(this,ys).getEditableAnnotations();for(const o of a){const{id:l}=o.data;if(n(this,D).isDeletedAnnotationElement(l))continue;let h=s.get(l);if(h){h.resetAnnotationElement(o),h.show(!1),o.show();continue}h=e.get(l),h&&(n(this,D).addChangedExistingAnnotation(h),h.renderAnnotationElement(o)&&h.show(!1)),o.show()}}v(this,bt,Ql).call(this),this.isEmpty&&(this.div.hidden=!0);const{classList:i}=this.div;for(const a of n(qi,pn).values())i.remove(`${a._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),p(this,Wr,!1)}getEditableAnnotation(t){var e;return((e=n(this,ys))==null?void 0:e.getEditableAnnotation(t))||null}setActiveEditor(t){n(this,D).getActive()!==t&&n(this,D).setActiveEditor(t)}enableTextSelection(){var t;if(this.div.tabIndex=-1,(t=n(this,Zt))!=null&&t.div&&!n(this,Ks)){p(this,Ks,new AbortController);const e=n(this,D).combinedSignal(n(this,Ks));n(this,Zt).div.addEventListener("pointerdown",v(this,bt,Ff).bind(this),{signal:e}),n(this,Zt).div.classList.add("highlighting")}}disableTextSelection(){var t;this.div.tabIndex=0,(t=n(this,Zt))!=null&&t.div&&n(this,Ks)&&(n(this,Ks).abort(),p(this,Ks,null),n(this,Zt).div.classList.remove("highlighting"))}enableClick(){if(n(this,ji))return;p(this,ji,new AbortController);const t=n(this,D).combinedSignal(n(this,ji));this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:t});const e=this.pointerup.bind(this);this.div.addEventListener("pointerup",e,{signal:t}),this.div.addEventListener("pointercancel",e,{signal:t})}disableClick(){var t;(t=n(this,ji))==null||t.abort(),p(this,ji,null)}attach(t){n(this,Oe).set(t.id,t);const{annotationElementId:e}=t;e&&n(this,D).isDeletedAnnotationElement(e)&&n(this,D).removeDeletedAnnotationElement(t)}detach(t){var e;n(this,Oe).delete(t.id),(e=n(this,na))==null||e.removePointerInTextLayer(t.contentDiv),!n(this,Wr)&&t.annotationElementId&&n(this,D).addDeletedAnnotationElement(t)}remove(t){this.detach(t),n(this,D).removeEditor(t),t.div.remove(),t.isAttachedToDOM=!1}changeParent(t){var e;t.parent!==this&&(t.parent&&t.annotationElementId&&(n(this,D).addDeletedAnnotationElement(t.annotationElementId),ht.deleteAnnotationElement(t),t.annotationElementId=null),this.attach(t),(e=t.parent)==null||e.detach(t),t.setParent(this),t.div&&t.isAttachedToDOM&&(t.div.remove(),this.div.append(t.div)))}add(t){if(!(t.parent===this&&t.isAttachedToDOM)){if(this.changeParent(t),n(this,D).addEditor(t),this.attach(t),!t.isAttachedToDOM){const e=t.render();this.div.append(e),t.isAttachedToDOM=!0}t.fixAndSetPosition(),t.onceAdded(!n(this,aa)),n(this,D).addToAnnotationStorage(t),t._reportTelemetry(t.telemetryInitialData)}}moveEditorInDOM(t){var e;if(!t.isAttachedToDOM)return;const{activeElement:s}=document;t.div.contains(s)&&!n(this,Xs)&&(t._focusEventsAllowed=!1,p(this,Xs,setTimeout(()=>{p(this,Xs,null),t.div.contains(document.activeElement)?t._focusEventsAllowed=!0:(t.div.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:n(this,D)._signal}),s.focus())},0))),t._structTreeParentId=(e=n(this,na))==null?void 0:e.moveElementInDOM(this.div,t.div,t.contentDiv,!0)}addOrRebuild(t){t.needsToBeRebuilt()?(t.parent||(t.parent=this),t.rebuild(),t.show()):this.add(t)}addUndoableEditor(t){const e=()=>t._uiManager.rebuild(t),s=()=>{t.remove()};this.addCommands({cmd:e,undo:s,mustExec:!1})}getNextId(){return n(this,D).getId()}combinedSignal(t){return n(this,D).combinedSignal(t)}canCreateNewEmptyEditor(){var t;return(t=n(this,bt,Qe))==null?void 0:t.canCreateNewEmptyEditor()}async pasteEditor(t,e){n(this,D).updateToolbar(t),await n(this,D).updateMode(t);const{offsetX:s,offsetY:i}=v(this,bt,Sd).call(this),a=this.getNextId(),o=v(this,bt,_d).call(this,{parent:this,id:a,x:s,y:i,uiManager:n(this,D),isCentered:!0,...e});o&&this.add(o)}async deserialize(t){var e;return await((e=n(qi,pn).get(t.annotationType??t.annotationEditorType))==null?void 0:e.deserialize(t,this,n(this,D)))||null}createAndAddNewEditor(t,e,s={}){const i=this.getNextId(),a=v(this,bt,_d).call(this,{parent:this,id:i,x:t.offsetX,y:t.offsetY,uiManager:n(this,D),isCentered:e,...s});return a&&this.add(a),a}addNewEditor(t={}){this.createAndAddNewEditor(v(this,bt,Sd).call(this),!0,t)}setSelected(t){n(this,D).setSelected(t)}toggleSelected(t){n(this,D).toggleSelected(t)}unselect(t){n(this,D).unselect(t)}pointerup(t){var e;const{isMac:s}=Bt.platform;if(t.button!==0||t.ctrlKey&&s||t.target!==this.div||!n(this,Vi)||(p(this,Vi,!1),(e=n(this,bt,Qe))!=null&&e.isDrawer&&n(this,bt,Qe).supportMultipleDrawings))return;if(!n(this,Or)){p(this,Or,!0);return}const i=n(this,D).getMode();if(i===G.STAMP||i===G.SIGNATURE){n(this,D).unselectAll();return}this.createAndAddNewEditor(t,!1)}pointerdown(t){var e;if(n(this,D).getMode()===G.HIGHLIGHT&&this.enableTextSelection(),n(this,Vi)){p(this,Vi,!1);return}const{isMac:s}=Bt.platform;if(t.button!==0||t.ctrlKey&&s||t.target!==this.div)return;if(p(this,Vi,!0),(e=n(this,bt,Qe))!=null&&e.isDrawer){this.startDrawingSession(t);return}const i=n(this,D).getActive();p(this,Or,!i||i.isEmpty())}startDrawingSession(t){if(this.div.focus({preventScroll:!0}),n(this,qe)){n(this,bt,Qe).startDrawing(this,n(this,D),!1,t);return}n(this,D).setCurrentDrawingSession(this),p(this,qe,new AbortController);const e=n(this,D).combinedSignal(n(this,qe));this.div.addEventListener("blur",({relatedTarget:s})=>{s&&!this.div.contains(s)&&(p(this,Ys,null),this.commitOrRemove())},{signal:e}),n(this,bt,Qe).startDrawing(this,n(this,D),!1,t)}pause(t){if(t){const{activeElement:e}=document;this.div.contains(e)&&p(this,Ys,e);return}n(this,Ys)&&setTimeout(()=>{var e;(e=n(this,Ys))==null||e.focus(),p(this,Ys,null)},0)}endDrawingSession(t=!1){return n(this,qe)?(n(this,D).setCurrentDrawingSession(null),n(this,qe).abort(),p(this,qe,null),p(this,Ys,null),n(this,bt,Qe).endDrawing(t)):null}findNewParent(t,e,s){const i=n(this,D).findParent(e,s);return i===null||i===this?!1:(i.changeParent(t),!0)}commitOrRemove(){return n(this,qe)?(this.endDrawingSession(),!0):!1}onScaleChanging(){n(this,qe)&&n(this,bt,Qe).onScaleChangingWhenDrawing(this)}destroy(){var t,e;this.commitOrRemove(),((t=n(this,D).getActive())==null?void 0:t.parent)===this&&(n(this,D).commitOrRemove(),n(this,D).setActiveEditor(null)),n(this,Xs)&&(clearTimeout(n(this,Xs)),p(this,Xs,null));for(const s of n(this,Oe).values())(e=n(this,na))==null||e.removePointerInTextLayer(s.contentDiv),s.setParent(null),s.isAttachedToDOM=!1,s.div.remove();this.div=null,n(this,Oe).clear(),n(this,D).removeLayer(this)}render({viewport:t}){this.viewport=t,fn(this.div,t);for(const e of n(this,D).getEditors(this.pageIndex))this.add(e),e.rebuild();this.updateMode()}update({viewport:t}){n(this,D).commitOrRemove(),v(this,bt,Ql).call(this);const e=this.viewport.rotation,s=t.rotation;if(this.viewport=t,fn(this.div,{rotation:s}),e!==s)for(const i of n(this,Oe).values())i.rotate(s)}get pageDimensions(){const{pageWidth:t,pageHeight:e}=this.viewport.rawDims;return[t,e]}get scale(){return n(this,D).viewParameters.realScale}};na=new WeakMap,Or=new WeakMap,ys=new WeakMap,ji=new WeakMap,Xs=new WeakMap,Oe=new WeakMap,Vi=new WeakMap,Wr=new WeakMap,aa=new WeakMap,qe=new WeakMap,Ys=new WeakMap,Zt=new WeakMap,Ks=new WeakMap,D=new WeakMap,pn=new WeakMap,bt=new WeakSet,Ff=function(r){n(this,D).unselectAll();const{target:t}=r;if(t===n(this,Zt).div||(t.getAttribute("role")==="img"||t.classList.contains("endOfContent"))&&n(this,Zt).div.contains(t)){const{isMac:e}=Bt.platform;if(r.button!==0||r.ctrlKey&&e)return;n(this,D).showAllEditors("highlight",!0,!0),n(this,Zt).div.classList.add("free"),this.toggleDrawing(),Ru.startHighlighting(this,n(this,D).direction==="ltr",{target:n(this,Zt).div,x:r.x,y:r.y}),n(this,Zt).div.addEventListener("pointerup",()=>{n(this,Zt).div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:n(this,D)._signal}),r.preventDefault()}},Qe=function(){return n(Jl,pn).get(n(this,D).getMode())},_d=function(r){const t=n(this,bt,Qe);return t?new t.prototype.constructor(r):null},Sd=function(){const{x:r,y:t,width:e,height:s}=this.div.getBoundingClientRect(),i=Math.max(0,r),a=Math.max(0,t),o=Math.min(window.innerWidth,r+e),l=Math.min(window.innerHeight,t+s),h=(i+o)/2-r,c=(a+l)/2-t,[d,u]=this.viewport.rotation%180===0?[h,c]:[c,h];return{offsetX:d,offsetY:u}},Ql=function(){for(const r of n(this,Oe).values())r.isEmpty()&&r.remove()},I(Jl,"_initialized",!1),m(Jl,pn,new Map([zm,qm,yd,Ru,Xm].map(r=>[r._editorType,r])));let Ym=Jl;var Je,ie,ra,$h,xd,Of,Xi,Ed,Wf,kd;const oa=class he{constructor({pageIndex:t}){m(this,Xi),m(this,Je,null),m(this,ie,new Map),m(this,ra,new Map),this.pageIndex=t}setParent(t){if(!n(this,Je)){p(this,Je,t);return}if(n(this,Je)!==t){if(n(this,ie).size>0)for(const e of n(this,ie).values())e.remove(),t.append(e);p(this,Je,t)}}static get _svgFactory(){return j(this,"_svgFactory",new bh)}draw(t,e=!1,s=!1){const i=oe(he,$h)._++,a=v(this,Xi,Ed).call(this),o=he._svgFactory.createElement("defs");a.append(o);const l=he._svgFactory.createElement("path");o.append(l);const h=`path_p${this.pageIndex}_${i}`;l.setAttribute("id",h),l.setAttribute("vector-effect","non-scaling-stroke"),e&&n(this,ra).set(i,l);const c=s?v(this,Xi,Wf).call(this,o,h):null,d=he._svgFactory.createElement("use");return a.append(d),d.setAttribute("href",`#${h}`),this.updateProperties(a,t),n(this,ie).set(i,a),{id:i,clipPathId:`url(#${c})`}}drawOutline(t,e){const s=oe(he,$h)._++,i=v(this,Xi,Ed).call(this),a=he._svgFactory.createElement("defs");i.append(a);const o=he._svgFactory.createElement("path");a.append(o);const l=`path_p${this.pageIndex}_${s}`;o.setAttribute("id",l),o.setAttribute("vector-effect","non-scaling-stroke");let h;if(e){const u=he._svgFactory.createElement("mask");a.append(u),h=`mask_p${this.pageIndex}_${s}`,u.setAttribute("id",h),u.setAttribute("maskUnits","objectBoundingBox");const f=he._svgFactory.createElement("rect");u.append(f),f.setAttribute("width","1"),f.setAttribute("height","1"),f.setAttribute("fill","white");const g=he._svgFactory.createElement("use");u.append(g),g.setAttribute("href",`#${l}`),g.setAttribute("stroke","none"),g.setAttribute("fill","black"),g.setAttribute("fill-rule","nonzero"),g.classList.add("mask")}const c=he._svgFactory.createElement("use");i.append(c),c.setAttribute("href",`#${l}`),h&&c.setAttribute("mask",`url(#${h})`);const d=c.cloneNode();return i.append(d),c.classList.add("mainOutline"),d.classList.add("secondaryOutline"),this.updateProperties(i,t),n(this,ie).set(s,i),s}finalizeDraw(t,e){n(this,ra).delete(t),this.updateProperties(t,e)}updateProperties(t,e){var s;if(!e)return;const{root:i,bbox:a,rootClass:o,path:l}=e,h=typeof t=="number"?n(this,ie).get(t):t;if(h){if(i&&v(this,Xi,kd).call(this,h,i),a&&v(s=he,xd,Of).call(s,h,a),o){const{classList:c}=h;for(const[d,u]of Object.entries(o))c.toggle(d,u)}if(l){const c=h.firstChild.firstChild;v(this,Xi,kd).call(this,c,l)}}}updateParent(t,e){if(e===this)return;const s=n(this,ie).get(t);s&&(n(e,Je).append(s),n(this,ie).delete(t),n(e,ie).set(t,s))}remove(t){n(this,ra).delete(t),n(this,Je)!==null&&(n(this,ie).get(t).remove(),n(this,ie).delete(t))}destroy(){p(this,Je,null);for(const t of n(this,ie).values())t.remove();n(this,ie).clear(),n(this,ra).clear()}};Je=new WeakMap,ie=new WeakMap,ra=new WeakMap,$h=new WeakMap,xd=new WeakSet,Of=function(r,[t,e,s,i]){const{style:a}=r;a.top=`${100*e}%`,a.left=`${100*t}%`,a.width=`${100*s}%`,a.height=`${100*i}%`},Xi=new WeakSet,Ed=function(){const r=oa._svgFactory.create(1,1,!0);return n(this,Je).append(r),r.setAttribute("aria-hidden",!0),r},Wf=function(r,t){const e=oa._svgFactory.createElement("clipPath");r.append(e);const s=`clip_${t}`;e.setAttribute("id",s),e.setAttribute("clipPathUnits","objectBoundingBox");const i=oa._svgFactory.createElement("use");return e.append(i),i.setAttribute("href",`#${t}`),i.classList.add("clip"),s},kd=function(r,t){for(const[e,s]of Object.entries(t))s===null?r.removeAttribute(e):r.setAttribute(e,s)},m(oa,xd),m(oa,$h,0);let Km=oa;globalThis.pdfjsTestingUtils={HighlightOutliner:rd};var tv=$.AbortException,ev=$.AnnotationEditorLayer,sv=$.AnnotationEditorParamsType,iv=$.AnnotationEditorType,nv=$.AnnotationEditorUIManager,av=$.AnnotationLayer,rv=$.AnnotationMode,ov=$.AnnotationType,lv=$.ColorPicker,hv=$.DOMSVGFactory,cv=$.DrawLayer,dv=$.FeatureTest,uv=$.GlobalWorkerOptions,pv=$.ImageKind,fv=$.InvalidPDFException,gv=$.MathClamp,mv=$.OPS,vv=$.OutputScale,wv=$.PDFDataRangeTransport,bv=$.PDFDateString,Av=$.PDFWorker,yv=$.PasswordResponses,_v=$.PermissionFlag,Sv=$.PixelsPerInch,xv=$.RenderingCancelledException,Ev=$.ResponseException,kv=$.SignatureExtractor,Mv=$.SupportedImageMimeTypes,Cv=$.TextLayer,Tv=$.TouchManager,Rv=$.Util,Pv=$.VerbosityLevel,Iv=$.XfaLayer,Lv=$.build,Dv=$.createValidAbsoluteUrl,Nv=$.fetchData,Fv=$.getDocument,Ov=$.getFilenameFromUrl,Wv=$.getPdfFilenameFromUrl,Bv=$.getUuid,$v=$.getXfaPageViewport,Hv=$.isDataScheme,Gv=$.isPdfFile,zv=$.isValidExplicitDest,Uv=$.noContextMenu,jv=$.normalizeUnicode,Vv=$.setLayerDimensions,qv=$.shadow,Xv=$.stopEvent,Yv=$.version;export{tv as AbortException,ev as AnnotationEditorLayer,sv as AnnotationEditorParamsType,iv as AnnotationEditorType,nv as AnnotationEditorUIManager,av as AnnotationLayer,rv as AnnotationMode,ov as AnnotationType,lv as ColorPicker,hv as DOMSVGFactory,cv as DrawLayer,dv as FeatureTest,uv as GlobalWorkerOptions,pv as ImageKind,fv as InvalidPDFException,gv as MathClamp,mv as OPS,vv as OutputScale,wv as PDFDataRangeTransport,bv as PDFDateString,Av as PDFWorker,yv as PasswordResponses,_v as PermissionFlag,Sv as PixelsPerInch,xv as RenderingCancelledException,Ev as ResponseException,kv as SignatureExtractor,Mv as SupportedImageMimeTypes,Cv as TextLayer,Tv as TouchManager,Rv as Util,Pv as VerbosityLevel,Iv as XfaLayer,Lv as build,Dv as createValidAbsoluteUrl,Nv as fetchData,Fv as getDocument,Ov as getFilenameFromUrl,Wv as getPdfFilenameFromUrl,Bv as getUuid,$v as getXfaPageViewport,Hv as isDataScheme,Gv as isPdfFile,zv as isValidExplicitDest,Uv as noContextMenu,jv as normalizeUnicode,Vv as setLayerDimensions,qv as shadow,Xv as stopEvent,Yv as version};
